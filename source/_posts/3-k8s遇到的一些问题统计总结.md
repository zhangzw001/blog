---
title: k8s遇到的一些问题统计总结
date: 2019-09-20 09:20:39
copyright: true
tags:
  - k8s
categories:
  - [技术文档]
  - [k8s,问题总结]
top: 10
---

 不定时更新,文章可能比较散乱,>_<

<!-- more -->

<center>
<img src="http://zhangzw001.github.io/images/dockerniu.jpeg" width = "100" height = "100" style="border: 0"/>
</center>

### 1. 单机版k8s pod一直是pending的问题
> describe一下pod会发现错误: 1 node(s) had taints that the pod didnt tolerate.
> 这是因为master上存在污点,pod不会再改节点上创建
> 两种办法:


- deploy 的时候加上 容忍该污点
- 直接取消master上的污点 

```
# 取消master上污点
  kubectl taint nodes --all node-role.kubernetes.io/master-

# 查看taint
kubectl describe node node1
```

<center>
<img src="http://zhangzw001.github.io/images/dockerniu.jpeg" width = "100" height = "100" style="border: 0"/>
</center>

### 2. 修改service-node-port-range

> 由于traefik部署需要对外开放80端口, 但默认仅允许30000以上端口

```
# kubeadm 1.14 配置
apiServer:
  extraArgs:
    authorization-mode: Node,RBAC
    service-node-port-range: 79-33000

# kubeadm 1.10配置
apiServerExtraArgs:
  service-node-port-range: 79-33000
```

<center>
<img src="http://zhangzw001.github.io/images/dockerniu.jpeg" width = "100" height = "100" style="border: 0"/>
</center>

### 3. traefik断电后重新启动报错 command traefik error: field not found, node: redirect

```
看到这个错误猜测可能是用的latest镜像问题, 从hub.docker.com 查看更新了v2.0+的版本

将traefik的deployment配置中 image改成 traefik:1.7

重新部署后 问题解
```

<center>
<img src="http://zhangzw001.github.io/images/dockerniu.jpeg" width = "100" height = "100" style="border: 0"/>
</center>

### 4. 查看当前集群的(CustomResourceDefinition)
```
# 查看k8s有哪些api
kubectl api-versions

# 查看当前crd
kubectl get crd

# 其次查看该api是什么版本
kubectl describe crd destinationrules.networking.istio.io

```
