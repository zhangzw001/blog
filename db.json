{"meta":{"version":1,"warehouse":"2.2.0"},"models":{"Asset":[{"_id":"themes/nextv6/source/css/main.styl","path":"css/main.styl","modified":1,"renderable":1},{"_id":"themes/nextv6/source/images/algolia_logo.svg","path":"images/algolia_logo.svg","modified":1,"renderable":1},{"_id":"themes/nextv6/source/images/apple-touch-icon-next.png","path":"images/apple-touch-icon-next.png","modified":1,"renderable":1},{"_id":"themes/nextv6/source/images/avatar.gif","path":"images/avatar.gif","modified":1,"renderable":1},{"_id":"themes/nextv6/source/images/cc-by-nc-nd.svg","path":"images/cc-by-nc-nd.svg","modified":1,"renderable":1},{"_id":"themes/nextv6/source/images/cc-by-nc.svg","path":"images/cc-by-nc.svg","modified":1,"renderable":1},{"_id":"themes/nextv6/source/images/cc-by-nc-sa.svg","path":"images/cc-by-nc-sa.svg","modified":1,"renderable":1},{"_id":"themes/nextv6/source/images/cc-by-nd.svg","path":"images/cc-by-nd.svg","modified":1,"renderable":1},{"_id":"themes/nextv6/source/images/cc-by-sa.svg","path":"images/cc-by-sa.svg","modified":1,"renderable":1},{"_id":"themes/nextv6/source/images/cc-by.svg","path":"images/cc-by.svg","modified":1,"renderable":1},{"_id":"themes/nextv6/source/images/cc-zero.svg","path":"images/cc-zero.svg","modified":1,"renderable":1},{"_id":"themes/nextv6/source/images/docker1.jpg","path":"images/docker1.jpg","modified":1,"renderable":1},{"_id":"themes/nextv6/source/images/dockerniu.jpeg","path":"images/dockerniu.jpeg","modified":1,"renderable":1},{"_id":"themes/nextv6/source/images/favicon-16x16-next.png","path":"images/favicon-16x16-next.png","modified":1,"renderable":1},{"_id":"themes/nextv6/source/images/favicon-32x32-next.png","path":"images/favicon-32x32-next.png","modified":1,"renderable":1},{"_id":"themes/nextv6/source/images/loading.gif","path":"images/loading.gif","modified":1,"renderable":1},{"_id":"themes/nextv6/source/images/logo.svg","path":"images/logo.svg","modified":1,"renderable":1},{"_id":"themes/nextv6/source/images/placeholder.gif","path":"images/placeholder.gif","modified":1,"renderable":1},{"_id":"themes/nextv6/source/images/quote-l.svg","path":"images/quote-l.svg","modified":1,"renderable":1},{"_id":"themes/nextv6/source/images/quote-r.svg","path":"images/quote-r.svg","modified":1,"renderable":1},{"_id":"themes/nextv6/source/images/searchicon.png","path":"images/searchicon.png","modified":1,"renderable":1},{"_id":"themes/nextv6/source/images/tcp三次握手图.png","path":"images/tcp三次握手图.png","modified":1,"renderable":1},{"_id":"themes/nextv6/source/images/tcp四次挥手图.png","path":"images/tcp四次挥手图.png","modified":1,"renderable":1},{"_id":"themes/nextv6/source/images/title3.jpg","path":"images/title3.jpg","modified":1,"renderable":1},{"_id":"themes/nextv6/source/images/title2.jpg","path":"images/title2.jpg","modified":1,"renderable":1},{"_id":"themes/nextv6/source/live2d-widget/LICENSE","path":"live2d-widget/LICENSE","modified":1,"renderable":1},{"_id":"themes/nextv6/source/live2d-widget/README.md","path":"live2d-widget/README.md","modified":1,"renderable":1},{"_id":"themes/nextv6/source/live2d-widget/autoload.js","path":"live2d-widget/autoload.js","modified":1,"renderable":1},{"_id":"themes/nextv6/source/live2d-widget/waifu-tips.js","path":"live2d-widget/waifu-tips.js","modified":1,"renderable":1},{"_id":"themes/nextv6/source/live2d-widget/waifu-tips.json","path":"live2d-widget/waifu-tips.json","modified":1,"renderable":1},{"_id":"themes/nextv6/source/live2d-widget/waifu.css","path":"live2d-widget/waifu.css","modified":1,"renderable":1},{"_id":"themes/nextv6/source/sh/master-docker-entrypoint.sh","path":"sh/master-docker-entrypoint.sh","modified":1,"renderable":1},{"_id":"themes/nextv6/source/sh/slave-docker-entrypoint.sh","path":"sh/slave-docker-entrypoint.sh","modified":1,"renderable":1},{"_id":"themes/nextv6/source/images/title4.jpg","path":"images/title4.jpg","modified":1,"renderable":1},{"_id":"themes/nextv6/source/images/16/容器的原理-1.png","path":"images/16/容器的原理-1.png","modified":1,"renderable":1},{"_id":"themes/nextv6/source/images/16/容器的原理-1.webp","path":"images/16/容器的原理-1.webp","modified":1,"renderable":1},{"_id":"themes/nextv6/source/images/blog6/rancher-pv.png","path":"images/blog6/rancher-pv.png","modified":1,"renderable":1},{"_id":"themes/nextv6/source/images/jixie-title.jpg","path":"images/jixie-title.jpg","modified":1,"renderable":1},{"_id":"themes/nextv6/source/images/test1/test1.jpg","path":"images/test1/test1.jpg","modified":1,"renderable":1},{"_id":"themes/nextv6/source/js/src/affix.js","path":"js/src/affix.js","modified":1,"renderable":1},{"_id":"themes/nextv6/source/js/src/algolia-search.js","path":"js/src/algolia-search.js","modified":1,"renderable":1},{"_id":"themes/nextv6/source/js/src/bootstrap.js","path":"js/src/bootstrap.js","modified":1,"renderable":1},{"_id":"themes/nextv6/source/js/src/exturl.js","path":"js/src/exturl.js","modified":1,"renderable":1},{"_id":"themes/nextv6/source/js/src/instantclick.js","path":"js/src/instantclick.js","modified":1,"renderable":1},{"_id":"themes/nextv6/source/js/src/js.cookie.js","path":"js/src/js.cookie.js","modified":1,"renderable":1},{"_id":"themes/nextv6/source/js/src/live2d.js","path":"js/src/live2d.js","modified":1,"renderable":1},{"_id":"themes/nextv6/source/js/src/love.js","path":"js/src/love.js","modified":1,"renderable":1},{"_id":"themes/nextv6/source/js/src/love2.js","path":"js/src/love2.js","modified":1,"renderable":1},{"_id":"themes/nextv6/source/js/src/motion.js","path":"js/src/motion.js","modified":1,"renderable":1},{"_id":"themes/nextv6/source/js/src/post-details.js","path":"js/src/post-details.js","modified":1,"renderable":1},{"_id":"themes/nextv6/source/js/src/scroll-cookie.js","path":"js/src/scroll-cookie.js","modified":1,"renderable":1},{"_id":"themes/nextv6/source/js/src/scrollspy.js","path":"js/src/scrollspy.js","modified":1,"renderable":1},{"_id":"themes/nextv6/source/js/src/utils.js","path":"js/src/utils.js","modified":1,"renderable":1},{"_id":"themes/nextv6/source/lib/velocity/velocity.min.js","path":"lib/velocity/velocity.min.js","modified":1,"renderable":1},{"_id":"themes/nextv6/source/lib/velocity/velocity.ui.js","path":"lib/velocity/velocity.ui.js","modified":1,"renderable":1},{"_id":"themes/nextv6/source/lib/velocity/velocity.ui.min.js","path":"lib/velocity/velocity.ui.min.js","modified":1,"renderable":1},{"_id":"themes/nextv6/source/live2d-widget/assets/screenshot-1.png","path":"live2d-widget/assets/screenshot-1.png","modified":1,"renderable":1},{"_id":"themes/nextv6/source/live2d-widget/demo/demo1.html","path":"live2d-widget/demo/demo1.html","modified":1,"renderable":1},{"_id":"themes/nextv6/source/live2d-widget/demo/demo2.html","path":"live2d-widget/demo/demo2.html","modified":1,"renderable":1},{"_id":"themes/nextv6/source/live2d-widget/live2d.min.js","path":"live2d-widget/live2d.min.js","modified":1,"renderable":1},{"_id":"themes/nextv6/source/live2d-widget/assets/screenshot-2.png","path":"live2d-widget/assets/screenshot-2.png","modified":1,"renderable":1},{"_id":"themes/nextv6/source/live2d-widget/assets/screenshot-3.png","path":"live2d-widget/assets/screenshot-3.png","modified":1,"renderable":1},{"_id":"themes/nextv6/source/js/src/schemes/pisces.js","path":"js/src/schemes/pisces.js","modified":1,"renderable":1},{"_id":"themes/nextv6/source/lib/jquery/index.js","path":"lib/jquery/index.js","modified":1,"renderable":1},{"_id":"themes/nextv6/source/images/title1.jpg","path":"images/title1.jpg","modified":1,"renderable":1},{"_id":"themes/nextv6/source/lib/velocity/velocity.js","path":"lib/velocity/velocity.js","modified":1,"renderable":1}],"Cache":[{"_id":"themes/nextv6/.all-contributorsrc","hash":"e32dc4075e304af04b98d0726d489081bea722c0","modified":1571217327851},{"_id":"themes/nextv6/.bowerrc","hash":"3228a58ed0ece9f85e1e3136352094080b8dece1","modified":1571217327851},{"_id":"themes/nextv6/.editorconfig","hash":"792fd2bd8174ece1a75d5fd24ab16594886f3a7f","modified":1571217327851},{"_id":"themes/nextv6/.eslintrc.json","hash":"cc5f297f0322672fe3f684f823bc4659e4a54c41","modified":1571217327851},{"_id":"themes/nextv6/.gitattributes","hash":"44bd4729c74ccb88110804f41746fec07bf487d4","modified":1571217327851},{"_id":"themes/nextv6/.gitignore","hash":"a18c2e83bb20991b899b58e6aeadcb87dd8aa16e","modified":1571217327851},{"_id":"themes/nextv6/.stylintrc","hash":"b28e24704a5d8de08346c45286574c8e76cc109f","modified":1571217327851},{"_id":"themes/nextv6/LICENSE.md","hash":"18144d8ed58c75af66cb419d54f3f63374cd5c5b","modified":1571217327851},{"_id":"themes/nextv6/README.md","hash":"b4f780a96b0e5d3737eb93bc00da6de91f042c4b","modified":1571217327851},{"_id":"themes/nextv6/.travis.yml","hash":"3d1dc928c4a97933e64379cfde749dedf62f252c","modified":1571217327851},{"_id":"themes/nextv6/_config.yml","hash":"6c2b6efe1fd95f48a976e3dfd62a57d15f302b2c","modified":1571282352867},{"_id":"themes/nextv6/bower.json","hash":"09628558259cf990fac43ed1f5ef9edae73f124b","modified":1571217327851},{"_id":"themes/nextv6/crowdin.yml","hash":"e026078448c77dcdd9ef50256bb6635a8f83dca6","modified":1571217327851},{"_id":"themes/nextv6/gulpfile.coffee","hash":"48d2f9fa88a4210308fc41cc7d3f6d53989f71b7","modified":1571217327853},{"_id":"themes/nextv6/package.json","hash":"c791b45d1e6fde11a1e1e11ba5a6ced1f5ba0fce","modified":1571217327857},{"_id":"source/categories/index.md","hash":"15f79eea17f5a7d01b6dd45aa91b2c34870a41df","modified":1571217327840},{"_id":"source/_posts/10-centos6安装nginx1-16-php7-2.md","hash":"2607618a1e9ff508eba0aee03bb86e248bd0ccec","modified":1571217327839},{"_id":"source/_posts/11-mysql简单记录.md","hash":"bdc6b3e39e3b58d9f90fa80000d4eb8f992f0af3","modified":1571974368972},{"_id":"source/_posts/12-awk简单记录.md","hash":"5bae205dba75a7466f055cdcb7dd4aa0595015cc","modified":1571217327839},{"_id":"source/_posts/13-云原生博客汇总.md","hash":"33e0825798ce873be940e0dfd0b273f2cd38fc40","modified":1571282885602},{"_id":"source/_posts/14-mysql目录copy方式迁移.md","hash":"a061a438a18a509e6ed7ae75944b9a5c1d621f83","modified":1571217327839},{"_id":"source/_posts/15-docker简介和使用.md","hash":"2891a1af4e30f5a90411cfd988f162cc4c42d1de","modified":1571217327839},{"_id":"source/_posts/16-dockerfile介绍.md","hash":"9a5f5e7b5d1c2413e484fabea8cb6317d571f434","modified":1571221217143},{"_id":"source/_posts/17-markdown一些写法记录.md","hash":"28615d2944ac6f12db4fb7257d7f15103c4e7e67","modified":1571219886956},{"_id":"source/_posts/18-收藏链接.md","hash":"23fae1ce86a8a9685b066cbd2eab81b2bea772da","modified":1571282945978},{"_id":"source/_posts/19-shell中gt和>的区别.md","hash":"9a8b30329049db6fce1bc183f828f815a00b3923","modified":1571293572086},{"_id":"source/_posts/2-部署elk7-2-0.md","hash":"f3e4224aecbd879ec4c47f6f28839cb34a6f42dd","modified":1571217327840},{"_id":"source/_posts/20-k8s搭建mysql5-7-24主从.md","hash":"3071c4b2ebfbd93b35a4cacbcfb96fab5f1bcbdb","modified":1571987249576},{"_id":"source/_posts/3-k8s遇到的一些问题统计总结.md","hash":"923665b956d9e39d7ef9ffd2a277a9461fa612ee","modified":1571279158878},{"_id":"source/_posts/4-hexo鼠标移动和鼠标点击特效.md","hash":"8ccf6cf8f1d0cf88ec364259e83dc36bbb112dbc","modified":1571217327840},{"_id":"source/_posts/5-hexo添加看板娘.md","hash":"8cbda646dcbb4e027d458b8a893c9f2e0b386c03","modified":1571217327840},{"_id":"source/_posts/6-ceph安装部署.md","hash":"db2e402ba831c51d410a2201ccf540d798c6837b","modified":1571217327840},{"_id":"source/_posts/7-k8s部署storageclass动态创建pv-nfs-rbd.md","hash":"0b7e29324ece899ea9ecbb6f3e6b4d59eb64d622","modified":1571217327840},{"_id":"source/_posts/8-mysql5-7二进制部署.md","hash":"585d59044b2665abc8af859039d38dff2985067c","modified":1571217327840},{"_id":"source/_posts/9-linux遇到一些问题统计总结.md","hash":"b0fa7f5628078f469ed6d0e0e56e4bd2dcdb5ac8","modified":1571279043584},{"_id":"source/_posts/首次搭建hexo博客系统.md","hash":"2fa0933d825bd1308bd0e6f37b73556fb88768cb","modified":1571217327840},{"_id":"source/tags/index.md","hash":"44040952fee1263c49f2204e254ba23200dfe2cd","modified":1571217327840},{"_id":"themes/nextv6/.github/CODE_OF_CONDUCT.md","hash":"b63696d41f022525e40d7e7870c3785b6bc7536b","modified":1571217327851},{"_id":"themes/nextv6/.github/CONTRIBUTING.md","hash":"a5335a99377069ae76fd993d488bc3eaf48f3a05","modified":1571217327851},{"_id":"themes/nextv6/.github/ISSUE_TEMPLATE.md","hash":"00c25366764e6b9ccb40b877c60dc13b2916bbf7","modified":1571217327851},{"_id":"themes/nextv6/.github/PULL_REQUEST_TEMPLATE.md","hash":"207b7097ac56c6c1fc1493577995db234bc80e21","modified":1571217327851},{"_id":"themes/nextv6/.github/browserstack_logo.png","hash":"a6c43887f64a7f48a2814e3714eaa1215e542037","modified":1571217327851},{"_id":"themes/nextv6/.github/stale.yml","hash":"a782ac925201a8fe07959bba0d7696c7b2b5fd2d","modified":1571217327851},{"_id":"themes/nextv6/docs/AGPL3.md","hash":"0d2b8c5fa8a614723be0767cc3bca39c49578036","modified":1571217327852},{"_id":"themes/nextv6/docs/ALGOLIA-SEARCH.md","hash":"141e989844d0b5ae2e09fb162a280715afb39b0d","modified":1571217327852},{"_id":"themes/nextv6/docs/AUTHORS.md","hash":"7b24be2891167bdedb9284a682c2344ec63e50b5","modified":1571217327852},{"_id":"themes/nextv6/docs/DATA-FILES.md","hash":"8e1962dd3e1b700169b3ae5bba43992f100651ce","modified":1571217327852},{"_id":"themes/nextv6/docs/INSTALLATION.md","hash":"2bbdd6c1751b2b42ce9b9335da420c6026a483e9","modified":1571217327852},{"_id":"themes/nextv6/docs/LEANCLOUD-COUNTER-SECURITY.md","hash":"120750c03ec30ccaa470b113bbe39f3d423c67f0","modified":1571217327852},{"_id":"themes/nextv6/docs/LICENSE.txt","hash":"368bf2c29d70f27d8726dd914f1b3211cae4bbab","modified":1571217327852},{"_id":"themes/nextv6/docs/MATH.md","hash":"e6023505dcccaef0b856102543585a13fc6af0b1","modified":1571217327852},{"_id":"themes/nextv6/docs/UPDATE-FROM-5.1.X.md","hash":"ad57c168d12ba01cf144a1ea0627b2ffd1847d3e","modified":1571217327852},{"_id":"themes/nextv6/languages/de.yml","hash":"fb478c5040a4e58a4c1ad5fb52a91e5983d65a3a","modified":1571217327853},{"_id":"themes/nextv6/languages/default.yml","hash":"c540c3a0d7db2d4239293c8783881962640b6c34","modified":1571217327853},{"_id":"themes/nextv6/languages/en.yml","hash":"c540c3a0d7db2d4239293c8783881962640b6c34","modified":1571217327853},{"_id":"themes/nextv6/languages/fr.yml","hash":"0162a85ae4175e66882a9ead1249fedb89200467","modified":1571217327853},{"_id":"themes/nextv6/languages/id.yml","hash":"e7fb582e117a0785036dcdbb853a6551263d6aa6","modified":1571217327853},{"_id":"themes/nextv6/languages/it.yml","hash":"62ef41d0a9a3816939cb4d93a524e6930ab9c517","modified":1571217327853},{"_id":"themes/nextv6/languages/ja.yml","hash":"e331b15b1fda0f2285d25853f834682ab8dc3c39","modified":1571217327853},{"_id":"themes/nextv6/languages/ko.yml","hash":"fae155018ae0efdf68669b2c7dd3f959c2e45cc9","modified":1571217327853},{"_id":"themes/nextv6/languages/nl.yml","hash":"bb9ce8adfa5ee94bc6b5fac6ad24ba4605d180d3","modified":1571217327853},{"_id":"themes/nextv6/languages/pt-BR.yml","hash":"bfc80c8a363fa2e8dde38ea2bc85cd19e15ab653","modified":1571217327853},{"_id":"themes/nextv6/languages/pt.yml","hash":"3cb51937d13ff12fcce747f972ccb664840a9ef3","modified":1571217327853},{"_id":"themes/nextv6/languages/ru.yml","hash":"db0644e738d2306ac38567aa183ca3e859a3980f","modified":1571217327853},{"_id":"themes/nextv6/languages/tr.yml","hash":"c5f0c20743b1dd52ccb256050b1397d023e6bcd9","modified":1571217327854},{"_id":"themes/nextv6/languages/uk.yml","hash":"1eb59e581568da9a81d6e20541b4ada5fc1c55c0","modified":1571217327854},{"_id":"themes/nextv6/languages/vi.yml","hash":"8da921dd8335dd676efce31bf75fdd4af7ce6448","modified":1571217327854},{"_id":"themes/nextv6/languages/zh-CN.yml","hash":"fbbf3a0b664ae8e927c700b0a813692b94345156","modified":1571217327854},{"_id":"themes/nextv6/languages/zh-HK.yml","hash":"7903b96912c605e630fb695534012501b2fad805","modified":1571217327854},{"_id":"themes/nextv6/languages/zh-TW.yml","hash":"6e6d2cd8f4244cb1b349b94904cb4770935acefd","modified":1571217327854},{"_id":"themes/nextv6/layout/_layout.swig","hash":"e99ae78f42380dbac41c2f77efff0c401ec3b1c8","modified":1571217327854},{"_id":"themes/nextv6/layout/archive.swig","hash":"2b6450c6b6d2bcbcd123ad9f59922a5e323d77a5","modified":1571217327857},{"_id":"themes/nextv6/layout/category.swig","hash":"5d955284a42f802a48560b4452c80906a5d1da02","modified":1571217327857},{"_id":"themes/nextv6/layout/index.swig","hash":"c2a3896c64e96790edc10426ef586b6186a87f46","modified":1571217327857},{"_id":"themes/nextv6/layout/page.swig","hash":"20ad4e986d29ac69d2a2db4f2a406a92120b1d44","modified":1571217327857},{"_id":"themes/nextv6/layout/post.swig","hash":"f74929fd792541916eb25c2addfb35431be071ba","modified":1571217327857},{"_id":"themes/nextv6/layout/schedule.swig","hash":"3268dd3d90d8b0e142cfa1a2ebb23355baeda148","modified":1571217327857},{"_id":"themes/nextv6/layout/tag.swig","hash":"ba402ce8fd55e80b240e019e8d8c48949b194373","modified":1571217327857},{"_id":"themes/nextv6/scripts/merge-configs.js","hash":"33afe97284d34542015d358a720823feeebef120","modified":1571217327858},{"_id":"themes/nextv6/scripts/merge.js","hash":"9130dabe6a674c54b535f322b17d75fe6081472f","modified":1571217327858},{"_id":"themes/nextv6/test/.jshintrc","hash":"19f93d13d1689fe033c82eb2d5f3ce30b6543cc0","modified":1571217327872},{"_id":"themes/nextv6/test/helpers.js","hash":"a1f5de25154c3724ffc24a91ddc576cdbd60864f","modified":1571217327872},{"_id":"themes/nextv6/test/intern.js","hash":"11fa8a4f5c3b4119a179ae0a2584c8187f907a73","modified":1571217327872},{"_id":"themes/nextv6/source/fonts/.gitkeep","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1571217327863},{"_id":"themes/nextv6/docs/ru/DATA-FILES.md","hash":"d6d20f60f77a76c77f8e65d0c9adbd79d0274557","modified":1571217327852},{"_id":"themes/nextv6/docs/ru/INSTALLATION.md","hash":"6c5d69e94961c793da156217ecf1179e868d7ba1","modified":1571217327852},{"_id":"themes/nextv6/docs/ru/README.md","hash":"953deb732e0b3b22c423122a189d6847d908c4b8","modified":1571217327852},{"_id":"themes/nextv6/docs/ru/UPDATE-FROM-5.1.X.md","hash":"b1dd18d9b890b21718883ea1832e7e02a773104a","modified":1571217327852},{"_id":"themes/nextv6/docs/zh-CN/ALGOLIA-SEARCH.md","hash":"6855402e2ef59aae307e8bd2a990647d3a605eb8","modified":1571217327852},{"_id":"themes/nextv6/docs/zh-CN/CODE_OF_CONDUCT.md","hash":"a45a791b49954331390d548ac34169d573ea5922","modified":1571217327852},{"_id":"themes/nextv6/docs/zh-CN/CONTRIBUTING.md","hash":"bd2c955d9b7b1b45bd74a4536717d547e03fcde3","modified":1571217327853},{"_id":"themes/nextv6/docs/zh-CN/DATA-FILES.md","hash":"f3eec572a7d83542e2710a7404082014aaa1a5e7","modified":1571217327853},{"_id":"themes/nextv6/docs/zh-CN/INSTALLATION.md","hash":"b19a6e0ae96eb7c756fb5b1ba03934c7f9cbb3c3","modified":1571217327853},{"_id":"themes/nextv6/docs/zh-CN/LEANCLOUD-COUNTER-SECURITY.md","hash":"24cf2618d164440b047bb9396263de83bee5b993","modified":1571217327853},{"_id":"themes/nextv6/docs/zh-CN/MATH.md","hash":"8ac2f5d2a023211d8d8ea626cbf6b8dea67ac201","modified":1571217327853},{"_id":"themes/nextv6/docs/zh-CN/README.md","hash":"15e55eb77616500fa4c64982d6bad9ac17a46e2a","modified":1571217327853},{"_id":"themes/nextv6/docs/zh-CN/UPDATE-FROM-5.1.X.md","hash":"5da70d7fa0c988a66a469b9795d33d471a4a4433","modified":1571217327853},{"_id":"themes/nextv6/layout/_custom/head.swig","hash":"9e1b9666efa77f4cf8d8261bcfa445a9ac608e53","modified":1571217327854},{"_id":"themes/nextv6/layout/_custom/header.swig","hash":"adc83b19e793491b1c6ea0fd8b46cd9f32e592fc","modified":1571217327854},{"_id":"themes/nextv6/layout/_custom/sidebar.swig","hash":"adc83b19e793491b1c6ea0fd8b46cd9f32e592fc","modified":1571217327854},{"_id":"themes/nextv6/layout/_macro/my-copyright.swig","hash":"86380d5b29f40ab8095b12715c0e5e15f4ce7ab4","modified":1571217327854},{"_id":"themes/nextv6/layout/_macro/post-collapse.swig","hash":"35affac8c523f399e59fcc4d3905e03e4e1ed9aa","modified":1571217327854},{"_id":"themes/nextv6/layout/_macro/post.swig","hash":"e10227b55c72a76411d24fc5bbaf13bcb1215c71","modified":1571217327854},{"_id":"themes/nextv6/layout/_macro/sidebar.swig","hash":"a1ded7ba92354ed55ae20a0b6bcc15bbb4b801c2","modified":1571217327854},{"_id":"themes/nextv6/layout/_partials/comments.swig","hash":"dce2938bb54c3cef3319f09f2621b93bc41117a0","modified":1571217327854},{"_id":"themes/nextv6/layout/_partials/footer.swig","hash":"ecd10acd3469cecab2289fee839a95177b4343a0","modified":1571217327854},{"_id":"themes/nextv6/layout/_partials/github-banner.swig","hash":"11128d3fbe195d7d105e43cf774a1a70b2c1de24","modified":1571217327854},{"_id":"themes/nextv6/layout/_partials/pagination.swig","hash":"dbe321bcf3cf45917cc11a3e3f50d8572bac2c70","modified":1571217327855},{"_id":"themes/nextv6/layout/_partials/post-edit.swig","hash":"06dac109504812b63766a80ede9ddacbd42d227d","modified":1571217327855},{"_id":"themes/nextv6/layout/_scripts/boostrap.swig","hash":"d01881f8056203c4b6920328db8c2ae8fa662a08","modified":1571217327855},{"_id":"themes/nextv6/layout/_scripts/commons.swig","hash":"d66bc7ec3cc03f60fcc7d555368a5b9b010f7f11","modified":1571217327855},{"_id":"themes/nextv6/layout/_scripts/noscript.swig","hash":"edaff4766e0c05fd5c889d9dd32884d376bef9d9","modified":1571217327855},{"_id":"themes/nextv6/layout/_scripts/vendors.swig","hash":"c4c58ea2bd4cf10372a5e46dbec1b9a2e0e69f0f","modified":1571217327856},{"_id":"themes/nextv6/layout/_third-party/bookmark.swig","hash":"10b61a8bac671e375916a4d234c120117098a78f","modified":1571217327856},{"_id":"themes/nextv6/layout/_third-party/copy-code.swig","hash":"01056ad0e5ad73885e02244943544d7b740bc3bb","modified":1571217327856},{"_id":"themes/nextv6/layout/_third-party/exturl.swig","hash":"d359e638a86bd9664101c48e9344f21ec96e6a15","modified":1571217327856},{"_id":"themes/nextv6/layout/_third-party/needsharebutton.swig","hash":"2c4a66be4677d3e4dec3f169ac8a769098dad1fe","modified":1571217327857},{"_id":"themes/nextv6/layout/_third-party/pangu.swig","hash":"c28f9dc96ab735daeb7f599f86470aa5a83c03cf","modified":1571217327857},{"_id":"themes/nextv6/layout/_third-party/pdf.swig","hash":"5453d76e00bfcd1d732fc5f41828a90eb681f645","modified":1571217327857},{"_id":"themes/nextv6/layout/_third-party/rating.swig","hash":"cbe40cb67dad15ade967b0f396c1a95b6871f76a","modified":1571217327857},{"_id":"themes/nextv6/layout/_third-party/schedule.swig","hash":"272c46f03766ea0c169163342bb98f09f561cf4c","modified":1571217327857},{"_id":"themes/nextv6/layout/_third-party/scroll-cookie.swig","hash":"1b250c1b7945cb1029b9e855edb09854f7c8250a","modified":1571217327857},{"_id":"themes/nextv6/scripts/helpers/engine.js","hash":"60eb1554456d9d0e5afc4a2d16f1580a0aa02da8","modified":1571217327857},{"_id":"themes/nextv6/scripts/helpers/next-url.js","hash":"15582e823d228c0b2288543c1eb460c40afad29b","modified":1571217327858},{"_id":"themes/nextv6/scripts/tags/button.js","hash":"4b12c376bea894d23cca0f9fcb3d6518b6db279d","modified":1571217327858},{"_id":"themes/nextv6/scripts/tags/center-quote.js","hash":"f13430d9d1c9773b390787c2f046bb1f12a79878","modified":1571217327858},{"_id":"themes/nextv6/scripts/tags/exturl.js","hash":"7ded3e7a78380b32de3e12f156e0978ef5c2890a","modified":1571217327858},{"_id":"themes/nextv6/scripts/tags/full-image.js","hash":"5f2f4c6e15b3197f26a26926876af70ef6390fc4","modified":1571217327858},{"_id":"themes/nextv6/scripts/tags/group-pictures.js","hash":"981e01aaf45a1f0f23ce0796d03134f9e437aaca","modified":1571217327858},{"_id":"themes/nextv6/scripts/tags/include-raw.js","hash":"5db59d56f4f4082382bf1c16722e6c383892b0c5","modified":1571217327858},{"_id":"themes/nextv6/scripts/tags/label.js","hash":"f0ecd3b5773b19a6bd93a819dfe0c49ee418e4de","modified":1571217327858},{"_id":"themes/nextv6/scripts/tags/note.js","hash":"adb945ba93ac487d46b969ca4e59d3681b8f8d1c","modified":1571217327858},{"_id":"themes/nextv6/scripts/tags/tabs.js","hash":"dbc8750a3f6d5676c52bb570d13ac7c51a234f21","modified":1571217327858},{"_id":"themes/nextv6/source/css/main.styl","hash":"c26ca6e7b5bd910b9046d6722c8e00be672890e0","modified":1571217327863},{"_id":"themes/nextv6/source/images/algolia_logo.svg","hash":"ec119560b382b2624e00144ae01c137186e91621","modified":1571217327863},{"_id":"themes/nextv6/source/images/apple-touch-icon-next.png","hash":"2959dbc97f31c80283e67104fe0854e2369e40aa","modified":1571217327863},{"_id":"themes/nextv6/source/images/avatar.gif","hash":"264082bb3a1af70d5499c7d22b0902cb454b6d12","modified":1571217327863},{"_id":"themes/nextv6/source/images/cc-by-nc-nd.svg","hash":"c6524ece3f8039a5f612feaf865d21ec8a794564","modified":1571217327864},{"_id":"themes/nextv6/source/images/cc-by-nc.svg","hash":"8d39b39d88f8501c0d27f8df9aae47136ebc59b7","modified":1571217327864},{"_id":"themes/nextv6/source/images/cc-by-nc-sa.svg","hash":"3031be41e8753c70508aa88e84ed8f4f653f157e","modified":1571217327864},{"_id":"themes/nextv6/source/images/cc-by-nd.svg","hash":"c563508ce9ced1e66948024ba1153400ac0e0621","modified":1571217327864},{"_id":"themes/nextv6/source/images/cc-by-sa.svg","hash":"aa4742d733c8af8d38d4c183b8adbdcab045872e","modified":1571217327864},{"_id":"themes/nextv6/source/images/cc-by.svg","hash":"28a0a4fe355a974a5e42f68031652b76798d4f7e","modified":1571217327864},{"_id":"themes/nextv6/source/images/cc-zero.svg","hash":"87669bf8ac268a91d027a0a4802c92a1473e9030","modified":1571217327864},{"_id":"themes/nextv6/source/images/docker1.jpg","hash":"04236a8756d0fd6c0142a9ce806a34e19c959a65","modified":1571217327865},{"_id":"themes/nextv6/source/images/dockerniu.jpeg","hash":"6170dc34beb11064fa08b138c5394fc16863fbe9","modified":1571217327865},{"_id":"themes/nextv6/source/images/favicon-16x16-next.png","hash":"943a0d67a9cdf8c198109b28f9dbd42f761d11c3","modified":1571217327865},{"_id":"themes/nextv6/source/images/favicon-32x32-next.png","hash":"0749d7b24b0d2fae1c8eb7f671ad4646ee1894b1","modified":1571217327865},{"_id":"themes/nextv6/source/images/loading.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1571217327865},{"_id":"themes/nextv6/source/images/logo.svg","hash":"d29cacbae1bdc4bbccb542107ee0524fe55ad6de","modified":1571217327865},{"_id":"themes/nextv6/source/images/placeholder.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1571217327865},{"_id":"themes/nextv6/source/images/quote-l.svg","hash":"94e870b4c8c48da61d09522196d4dd40e277a98f","modified":1571217327865},{"_id":"themes/nextv6/source/images/quote-r.svg","hash":"e60ae504f9d99b712c793c3740c6b100d057d4ec","modified":1571217327866},{"_id":"themes/nextv6/source/images/searchicon.png","hash":"67727a6a969be0b2659b908518fa6706eed307b8","modified":1571217327866},{"_id":"themes/nextv6/source/images/tcp三次握手图.png","hash":"43d3cc1b2cd77995bf995717c2bf6b8c69ccc266","modified":1571217327866},{"_id":"themes/nextv6/source/images/tcp四次挥手图.png","hash":"856611712188ccef959815fbcce4f2c1a75a7ffd","modified":1571217327866},{"_id":"themes/nextv6/source/images/title3.jpg","hash":"3f15484731b187942553f65a79ac55d3dab820f2","modified":1571217327867},{"_id":"themes/nextv6/source/images/title2.jpg","hash":"2fef77971762c0b2375d361de519d0c4c4fd6807","modified":1571217327867},{"_id":"themes/nextv6/source/live2d-widget/LICENSE","hash":"31a3d460bb3c7d98845187c716a30db81c44b615","modified":1571217327870},{"_id":"themes/nextv6/source/live2d-widget/README.md","hash":"02c661d530f393050e7f30747c0842442ac5d324","modified":1571217327871},{"_id":"themes/nextv6/source/live2d-widget/autoload.js","hash":"095dc7abf0913058a7da9191ace78460bc3a4d6f","modified":1571217327871},{"_id":"themes/nextv6/source/live2d-widget/waifu-tips.js","hash":"9035861e77ca3453afe41c988ebaa75676980081","modified":1571217327872},{"_id":"themes/nextv6/source/live2d-widget/waifu-tips.json","hash":"92ae6d37e99f64da93a4e108c14e2badc392e714","modified":1571217327872},{"_id":"themes/nextv6/source/live2d-widget/waifu.css","hash":"bc73e27438917b75d43b8213dc5aa87972461357","modified":1571217327872},{"_id":"themes/nextv6/source/sh/master-docker-entrypoint.sh","hash":"0b04dad154a9bdb4f4debff5e8d1ab278e4902e4","modified":1571903994000},{"_id":"themes/nextv6/source/sh/slave-docker-entrypoint.sh","hash":"12dc8a11240fb688102fa507d06497a65b8c8163","modified":1571904249000},{"_id":"themes/nextv6/layout/_scripts/schemes/mist.swig","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1571217327855},{"_id":"themes/nextv6/layout/_scripts/schemes/muse.swig","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1571217327855},{"_id":"themes/nextv6/source/css/_mixins/Mist.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1571217327862},{"_id":"themes/nextv6/source/css/_mixins/Muse.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1571217327862},{"_id":"themes/nextv6/source/css/_mixins/custom.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1571217327862},{"_id":"themes/nextv6/source/css/_variables/Muse.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1571217327863},{"_id":"themes/nextv6/source/css/_variables/custom.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1571217327863},{"_id":"themes/nextv6/source/images/title4.jpg","hash":"4afe4390599d5addb94fc6bae8f60d74aba73d0a","modified":1571217327867},{"_id":"themes/nextv6/layout/_macro/menu/menu-badge.swig","hash":"65c5e585982dae7ae1542cada71858b4ea1f73d6","modified":1571217327854},{"_id":"themes/nextv6/layout/_macro/menu/menu-item.swig","hash":"fb33f499022cd02722f834fcef1a0e193362cfde","modified":1571217327854},{"_id":"themes/nextv6/layout/_partials/head/external-fonts.swig","hash":"fc6bafc8c633afadc538c5afa5620ea2a1cdcb84","modified":1571217327854},{"_id":"themes/nextv6/layout/_partials/head/head-unique.swig","hash":"dc53a41196b675268bfd2a944f6258c57ed44e91","modified":1571217327854},{"_id":"themes/nextv6/layout/_partials/head/head.swig","hash":"6a825ce9412339ec4a128d9714804994cb85522c","modified":1571217327855},{"_id":"themes/nextv6/layout/_partials/header/brand.swig","hash":"58e2e153e8b67e643b24453a1e1cceaae3323647","modified":1571217327855},{"_id":"themes/nextv6/layout/_partials/header/index.swig","hash":"2082f5077551123e695e8afec471c9c44b436acb","modified":1571217327855},{"_id":"themes/nextv6/layout/_partials/header/menu.swig","hash":"3db735d0cd2d449edf2674310ac1e7c0043cb357","modified":1571217327855},{"_id":"themes/nextv6/layout/_partials/header/sub-menu.swig","hash":"5adc60100e129c1d0307bdcaa0c7b8e8375a6ea4","modified":1571217327855},{"_id":"themes/nextv6/layout/_partials/page/breadcrumb.swig","hash":"69722be16ce5eae5c027168f9b2fded4776e1b53","modified":1571217327855},{"_id":"themes/nextv6/layout/_partials/page/page-header.swig","hash":"2940df694fff28e8bf71b6546b4162f1e38227db","modified":1571217327855},{"_id":"themes/nextv6/layout/_partials/post/post-copyright.swig","hash":"2f73cc9ffb63534f0b6d8f0e9ee853c1af1b1244","modified":1571217327855},{"_id":"themes/nextv6/layout/_partials/post/post-related.swig","hash":"eea95b785c9c36d28e1839619793f66e89773bee","modified":1571217327855},{"_id":"themes/nextv6/layout/_partials/post/reward.swig","hash":"64d65d9ad0cc94734ac6ded279e2b5dc870a1cab","modified":1571217327855},{"_id":"themes/nextv6/layout/_partials/post/wechat-subscriber.swig","hash":"d63208ee20529450c35de8fe80ef41fffa831dc9","modified":1571217327855},{"_id":"themes/nextv6/layout/_partials/search/index.swig","hash":"a33b29ccbdc2248aedff23b04e0627f435824406","modified":1571217327855},{"_id":"themes/nextv6/layout/_partials/search/localsearch.swig","hash":"957701729b85fb0c5bfcf2fb99c19d54582f91ed","modified":1571217327855},{"_id":"themes/nextv6/layout/_partials/search/tinysou.swig","hash":"eefe2388ff3d424694045eda21346989b123977c","modified":1571217327855},{"_id":"themes/nextv6/layout/_partials/search/swiftype.swig","hash":"a5587bd1f60d35e58618576cec45e662aa44ea1f","modified":1571217327855},{"_id":"themes/nextv6/layout/_partials/share/add-this.swig","hash":"23e23dc0f76ef3c631f24c65277adf7ea517b383","modified":1571217327855},{"_id":"themes/nextv6/layout/_partials/share/baidushare.swig","hash":"1f1107468aaf03f7d0dcd7eb2b653e2813a675b4","modified":1571217327855},{"_id":"themes/nextv6/layout/_partials/share/duoshuo_share.swig","hash":"d5bfb363a1154e6505f0cccbd811fa71db133e3d","modified":1571217327855},{"_id":"themes/nextv6/layout/_scripts/pages/post-details.swig","hash":"c7f2855f19dfdf18aba8c58d55b7489e631ed035","modified":1571217327855},{"_id":"themes/nextv6/layout/_scripts/schemes/gemini.swig","hash":"94e106755c5fb6f40431b621beeba0bd33877e57","modified":1571217327855},{"_id":"themes/nextv6/layout/_scripts/schemes/pisces.swig","hash":"94e106755c5fb6f40431b621beeba0bd33877e57","modified":1571217327855},{"_id":"themes/nextv6/layout/_third-party/analytics/analytics-with-widget.swig","hash":"98df9d72e37dd071e882f2d5623c9d817815b139","modified":1571217327856},{"_id":"themes/nextv6/layout/_third-party/analytics/application-insights.swig","hash":"798d67e4a736613ab899eabe6529091bbcda7850","modified":1571217327856},{"_id":"themes/nextv6/layout/_third-party/analytics/baidu-analytics.swig","hash":"591b2ccd9713ccb922b9fcf5e278b6de9c5ec30b","modified":1571217327856},{"_id":"themes/nextv6/layout/_third-party/analytics/busuanzi-counter.swig","hash":"07307f1f0e0e9858f2c7143cbdfcb2a9a92149ab","modified":1571217327856},{"_id":"themes/nextv6/layout/_third-party/analytics/cnzz-analytics.swig","hash":"08cd47ef8572121b7811342d3c9a84a338a18191","modified":1571217327856},{"_id":"themes/nextv6/layout/_third-party/analytics/facebook-sdk.swig","hash":"050ea01f25cfe492be9bb77b409644d623fdf2dc","modified":1571217327856},{"_id":"themes/nextv6/layout/_third-party/analytics/firestore.swig","hash":"fae69a0e1a1d42f7bb44e594a29857d94594698b","modified":1571217327856},{"_id":"themes/nextv6/layout/_third-party/analytics/google-analytics.swig","hash":"529db1ff4b6c18822d6cf77f644a7f7b39c80870","modified":1571217327856},{"_id":"themes/nextv6/layout/_third-party/analytics/growingio.swig","hash":"9e576f12a294b14bd262f59c309a50cbf7003827","modified":1571217327856},{"_id":"themes/nextv6/layout/_third-party/analytics/index.swig","hash":"438c6f5e6665d72f4ea7ee206011d669246f6102","modified":1571217327856},{"_id":"themes/nextv6/layout/_third-party/analytics/lean-analytics.swig","hash":"c28f3f4aa31d7f996d26a97df6cd7ffa9bfd2cec","modified":1571217327856},{"_id":"themes/nextv6/layout/_third-party/analytics/tencent-analytics.swig","hash":"f240a50cd9b627620d9a374a29cf95f0c5e99d7c","modified":1571217327856},{"_id":"themes/nextv6/layout/_third-party/analytics/tencent-mta.swig","hash":"41b4644f7264b16336154ac842f35278e3bb09b8","modified":1571217327856},{"_id":"themes/nextv6/layout/_third-party/analytics/vkontakte-api.swig","hash":"cbf620cf2a78e3ac736cdd7e768513cfd6946e83","modified":1571217327856},{"_id":"themes/nextv6/layout/_third-party/comments/changyan.swig","hash":"aea70f5ec17917b75812020d8bf2aeabd434e8bc","modified":1571217327856},{"_id":"themes/nextv6/layout/_third-party/comments/disqus.swig","hash":"c4c50a646254a186413bb5e4e320af4071a8b072","modified":1571217327856},{"_id":"themes/nextv6/layout/_third-party/comments/gitalk.swig","hash":"3fee34fc9620195b1152e96f126c516a7175fdbb","modified":1571217327856},{"_id":"themes/nextv6/layout/_third-party/comments/gitment.swig","hash":"d34e054a6d5c8a5fb4dd4b4671e666891e4c9adf","modified":1571217327856},{"_id":"themes/nextv6/layout/_third-party/comments/index.swig","hash":"9809d63a4234c5f268ff0b489579149b849728fc","modified":1571217327856},{"_id":"themes/nextv6/layout/_third-party/comments/livere.swig","hash":"607a60588ad3d226eb0fb50df601e2f2ff6d627c","modified":1571217327856},{"_id":"themes/nextv6/layout/_third-party/comments/valine.swig","hash":"9eb881107c407d8d9e759d10d247f2ade412c2d9","modified":1571217327856},{"_id":"themes/nextv6/layout/_third-party/math/index.swig","hash":"a7e304b05a44279d3e4f611908d7faef9dc14d7c","modified":1571217327857},{"_id":"themes/nextv6/layout/_third-party/math/katex.swig","hash":"c2cb2f384bc30d31cdccf9794a729c03e687b45c","modified":1571217327857},{"_id":"themes/nextv6/layout/_third-party/math/mathjax.swig","hash":"c76c7ac9b97e74908467701b10e25707ba5c979e","modified":1571217327857},{"_id":"themes/nextv6/layout/_third-party/search/index.swig","hash":"c747fb5c6b1f500e8f0c583e44195878b66e4e29","modified":1571217327857},{"_id":"themes/nextv6/layout/_third-party/search/localsearch.swig","hash":"b3eaab6a269aa3fcbafe24fd06f0c9206dc12716","modified":1571217327857},{"_id":"themes/nextv6/layout/_third-party/search/tinysou.swig","hash":"cb3a5d36dbe1630bab84e03a52733a46df7c219b","modified":1571217327857},{"_id":"themes/nextv6/layout/_third-party/seo/baidu-push.swig","hash":"323ccd05bf8befb7d33de443cf3ac6a4195c3554","modified":1571217327857},{"_id":"themes/nextv6/scripts/filters/after_post_render/exturl.js","hash":"9c9f61b7bfb3349b03b1e61355f20232044b5fd8","modified":1571217327857},{"_id":"themes/nextv6/source/css/_custom/custom.styl","hash":"fc1688e6e09dfd99348b5b31632cde8ad1b450f4","modified":1571217327862},{"_id":"themes/nextv6/source/css/_mixins/Gemini.styl","hash":"2aa5b7166a85a8aa34b17792ae4f58a5a96df6cc","modified":1571217327862},{"_id":"themes/nextv6/source/css/_mixins/Pisces.styl","hash":"2640a54fa63bdd4c547eab7ce2fc1192cf0ccec8","modified":1571217327862},{"_id":"themes/nextv6/source/css/_mixins/base.styl","hash":"086f5979b3de091c3378512e6c5c2f8fcb4f6298","modified":1571217327862},{"_id":"themes/nextv6/source/css/_variables/Mist.styl","hash":"be087dcc060e8179f7e7f60ab4feb65817bd3d9f","modified":1571217327863},{"_id":"themes/nextv6/source/css/_variables/Gemini.styl","hash":"a8aa41625b94cf17a7f473ed10dcbe683b1db705","modified":1571217327863},{"_id":"themes/nextv6/source/css/_variables/Pisces.styl","hash":"fc15e277d1504532a09b7b1bd31f900ad95ec4b8","modified":1571217327863},{"_id":"themes/nextv6/source/css/_variables/base.styl","hash":"9e56e8b553cac103c9a6f2f615c51754992ec4e1","modified":1571217327863},{"_id":"themes/nextv6/source/images/16/容器的原理-1.png","hash":"e66aeed692626c316ee2928497093778c1421ff8","modified":1571217327863},{"_id":"themes/nextv6/source/images/16/容器的原理-1.webp","hash":"4f9bbb5060c2a051eb08525243507a593056593d","modified":1571217327863},{"_id":"themes/nextv6/source/images/blog6/rancher-pv.png","hash":"e6fba6597291638b3c07f18ffe82764d5ac6431b","modified":1571217327864},{"_id":"themes/nextv6/source/images/jixie-title.jpg","hash":"696ce5b0354f3e40afa16fd26602fb31870b2c25","modified":1571217327865},{"_id":"themes/nextv6/source/images/test1/test1.jpg","hash":"3f786850e387550fdab836ed7e6dc881de23001b","modified":1571217327866},{"_id":"themes/nextv6/source/js/src/affix.js","hash":"a2aab233d99297435a5274bf512c3c753fe08e80","modified":1571217327867},{"_id":"themes/nextv6/source/js/src/algolia-search.js","hash":"1f7f10c579e7703d0f6acb8b73f3d78a07d0c623","modified":1571217327867},{"_id":"themes/nextv6/source/js/src/bootstrap.js","hash":"1c41508b83cb0c4512e64b4d63afa1be954ce8ef","modified":1571217327867},{"_id":"themes/nextv6/source/js/src/exturl.js","hash":"54825acc8de4793feac415be227b965428f4e97d","modified":1571217327867},{"_id":"themes/nextv6/source/js/src/instantclick.js","hash":"76b10070628006c82c2e5324fc56a7db0a019112","modified":1571217327867},{"_id":"themes/nextv6/source/js/src/js.cookie.js","hash":"9b37973a90fd50e71ea91682265715e45ae82c75","modified":1571217327867},{"_id":"themes/nextv6/source/js/src/live2d.js","hash":"b1c80d906315183a97c05b8c43c3ed29c7374500","modified":1571217327867},{"_id":"themes/nextv6/source/js/src/love.js","hash":"effa770d8085f7e7fb903de217ce521dff163780","modified":1571217327867},{"_id":"themes/nextv6/source/js/src/love2.js","hash":"856aeabe93ffb22168f467c090bd4c933c823c49","modified":1571217327867},{"_id":"themes/nextv6/source/js/src/motion.js","hash":"7933a30382a84b655238f6e78d42ea1b99af4de6","modified":1571217327867},{"_id":"themes/nextv6/source/js/src/post-details.js","hash":"0dde5e6d4547587662a3256317a9d5d1db507692","modified":1571217327867},{"_id":"themes/nextv6/source/js/src/scroll-cookie.js","hash":"d07b3776708d4ae79ed2037c4c7391d5c9b06b19","modified":1571217327868},{"_id":"themes/nextv6/source/js/src/scrollspy.js","hash":"fa3c92968bcdbcb8d95a1729f7659d9753cbd077","modified":1571217327868},{"_id":"themes/nextv6/source/js/src/utils.js","hash":"f1394d64977439ec569d2777b1ac304905e043f1","modified":1571217327868},{"_id":"themes/nextv6/source/lib/velocity/velocity.min.js","hash":"2f1afadc12e4cf59ef3b405308d21baa97e739c6","modified":1571217327870},{"_id":"themes/nextv6/source/lib/velocity/velocity.ui.js","hash":"6a1d101eab3de87527bb54fcc8c7b36b79d8f0df","modified":1571217327870},{"_id":"themes/nextv6/source/lib/velocity/velocity.ui.min.js","hash":"ed5e534cd680a25d8d14429af824f38a2c7d9908","modified":1571217327870},{"_id":"themes/nextv6/source/live2d-widget/assets/screenshot-1.png","hash":"4bd4d97a1fcaa5deb3cea1c0a102a895a15af32f","modified":1571217327871},{"_id":"themes/nextv6/source/live2d-widget/demo/demo1.html","hash":"b54968db4c0244e79a06e544f40b616b541f7079","modified":1571217327871},{"_id":"themes/nextv6/source/live2d-widget/demo/demo2.html","hash":"e240bbe4d8da8393d0a3df4222353069ba0e475b","modified":1571217327871},{"_id":"themes/nextv6/source/live2d-widget/live2d.min.js","hash":"22365399514b0729c9b787d6a3e782488f1aac95","modified":1571217327872},{"_id":"themes/nextv6/source/live2d-widget/assets/screenshot-2.png","hash":"e766842b0f064efc148613c41f43a8a905c39557","modified":1571217327871},{"_id":"themes/nextv6/source/live2d-widget/assets/screenshot-3.png","hash":"ead66aa3edb390205081a0c8625a49844470a090","modified":1571217327871},{"_id":"themes/nextv6/layout/_third-party/search/algolia-search/dom.swig","hash":"ba698f49dd3a868c95b240d802f5b1b24ff287e4","modified":1571217327857},{"_id":"themes/nextv6/layout/_third-party/search/algolia-search/assets.swig","hash":"cd86bed852fec6e6933898067122a03755bc17f0","modified":1571217327857},{"_id":"themes/nextv6/source/css/_common/components/back-to-top-sidebar.styl","hash":"837ff3718cb5a63eb01a451e35989fd1dfe4218c","modified":1571217327858},{"_id":"themes/nextv6/source/css/_common/components/back-to-top.styl","hash":"31050fc7a25784805b4843550151c93bfa55c9c8","modified":1571217327858},{"_id":"themes/nextv6/source/css/_common/components/comments.styl","hash":"471f1627891aca5c0e1973e09fbcb01e1510d193","modified":1571217327858},{"_id":"themes/nextv6/source/css/_common/components/buttons.styl","hash":"7e509c7c28c59f905b847304dd3d14d94b6f3b8e","modified":1571217327858},{"_id":"themes/nextv6/source/css/_common/components/components.styl","hash":"a6bb5256be6195e76addbda12f4ed7c662d65e7a","modified":1571217327858},{"_id":"themes/nextv6/source/css/_common/components/pagination.styl","hash":"c5d48863f332ff8ce7c88dec2c893f709d7331d3","modified":1571217327859},{"_id":"themes/nextv6/source/css/_common/components/tag-cloud.styl","hash":"dd8a3b22fc2f222ac6e6c05bd8a773fb039169c0","modified":1571217327860},{"_id":"themes/nextv6/source/css/_common/outline/outline.styl","hash":"513779f38d94a98511db14fe4527cdc453f426b8","modified":1571217327862},{"_id":"themes/nextv6/source/css/_common/scaffolding/base.styl","hash":"d33420ef9a655ecaa1c70af6d9bfed0740d8a5bf","modified":1571217327862},{"_id":"themes/nextv6/source/css/_common/scaffolding/helpers.styl","hash":"9c25c75311e1bd4d68df031d3f2ae6d141a90766","modified":1571217327862},{"_id":"themes/nextv6/source/css/_common/scaffolding/mobile.styl","hash":"efc40a32487e0ac7b94b1ca81bdbdcc4ec8f2924","modified":1571217327862},{"_id":"themes/nextv6/source/css/_common/scaffolding/normalize.styl","hash":"ece571f38180febaf02ace8187ead8318a300ea7","modified":1571217327862},{"_id":"themes/nextv6/source/css/_common/scaffolding/scaffolding.styl","hash":"a280a583b7615e939aaddbf778f5c108ef8a2a6c","modified":1571217327862},{"_id":"themes/nextv6/source/css/_common/scaffolding/tables.styl","hash":"02d138ed65060e98f20bc5b1dd59a791222b7156","modified":1571217327862},{"_id":"themes/nextv6/source/css/_schemes/Gemini/index.styl","hash":"8dfd4d744e664a97df7a96d045bcfde282ab2dff","modified":1571217327862},{"_id":"themes/nextv6/source/css/_schemes/Mist/_base.styl","hash":"0bef9f0dc134215bc4d0984ba3a16a1a0b6f87ec","modified":1571217327862},{"_id":"themes/nextv6/source/css/_schemes/Mist/_header.styl","hash":"586933cf06200855d6409cf1e3cc6744ca3cc326","modified":1571217327862},{"_id":"themes/nextv6/source/css/_schemes/Mist/_logo.styl","hash":"38e5df90c8689a71c978fd83ba74af3d4e4e5386","modified":1571217327862},{"_id":"themes/nextv6/source/css/_schemes/Mist/_menu.styl","hash":"fe2dc74726a515549956d233becda188da64f948","modified":1571217327862},{"_id":"themes/nextv6/source/css/_schemes/Mist/_posts-expanded.styl","hash":"09ddd5a0388bee97e688ec07ece8429ca4fbba1e","modified":1571217327862},{"_id":"themes/nextv6/source/css/_schemes/Mist/_search.styl","hash":"1452cbe674cc1d008e1e9640eb4283841058fc64","modified":1571217327862},{"_id":"themes/nextv6/source/css/_schemes/Mist/index.styl","hash":"420dcea83a61b2e51d0b91b86fc49f84ecf06bcf","modified":1571217327862},{"_id":"themes/nextv6/source/css/_schemes/Muse/_layout.styl","hash":"0efa036a15c18f5abb058b7c0fad1dd9ac5eed4c","modified":1571217327862},{"_id":"themes/nextv6/source/css/_schemes/Muse/_logo.styl","hash":"fc160583f742c94316a0fee05c18468033173534","modified":1571217327862},{"_id":"themes/nextv6/source/css/_schemes/Muse/_menu.styl","hash":"936132428a0d35b3947ccedd4c379940abcf223a","modified":1571217327862},{"_id":"themes/nextv6/source/css/_schemes/Muse/_search.styl","hash":"1452cbe674cc1d008e1e9640eb4283841058fc64","modified":1571217327862},{"_id":"themes/nextv6/source/css/_schemes/Muse/index.styl","hash":"d5e8ea6336bc2e237d501ed0d5bbcbbfe296c832","modified":1571217327862},{"_id":"themes/nextv6/source/css/_schemes/Pisces/_brand.styl","hash":"09b5054ae34ba83c0d614821e574da265af55a14","modified":1571217327863},{"_id":"themes/nextv6/source/css/_schemes/Pisces/_layout.styl","hash":"9b076c92abdadcf9acee75da64592ff3badd69b8","modified":1571217327863},{"_id":"themes/nextv6/source/css/_schemes/Pisces/_menu.styl","hash":"74c7dccf0a3ee9fc2ca25ad8e998243191813a0e","modified":1571217327863},{"_id":"themes/nextv6/source/css/_schemes/Pisces/_posts.styl","hash":"2f878213cb24c5ddc18877f6d15ec5c5f57745ac","modified":1571217327863},{"_id":"themes/nextv6/source/css/_schemes/Pisces/_sidebar.styl","hash":"e7afdb343f9502f433f49044e42fe347719ce330","modified":1571217327863},{"_id":"themes/nextv6/source/css/_schemes/Pisces/_sub-menu.styl","hash":"b5b936dddb7b4de4720cd1e8428b30a2f06d63fb","modified":1571217327863},{"_id":"themes/nextv6/source/css/_schemes/Pisces/index.styl","hash":"5779cc8086b1cfde9bc4f1afdd85223bdc45f0a0","modified":1571217327863},{"_id":"themes/nextv6/source/js/src/schemes/pisces.js","hash":"9eb63cba0327d3d11b6cbfcbe40b88e97a8378a3","modified":1571217327867},{"_id":"themes/nextv6/source/lib/jquery/index.js","hash":"41b4bfbaa96be6d1440db6e78004ade1c134e276","modified":1571217327868},{"_id":"themes/nextv6/source/images/title1.jpg","hash":"2c0c87be6281c5660fb69280555b557338ce9122","modified":1571217327867},{"_id":"themes/nextv6/source/lib/velocity/velocity.js","hash":"9f08181baea0cc0e906703b7e5df9111b9ef3373","modified":1571217327870},{"_id":"themes/nextv6/source/css/_common/components/footer/footer.styl","hash":"39dee82d481dd9d44e33658960ec63e47cd0a715","modified":1571217327858},{"_id":"themes/nextv6/source/css/_common/components/header/github-banner.styl","hash":"ee37e6c465b9b2a7e39175fccfcbed14f2db039b","modified":1571217327858},{"_id":"themes/nextv6/source/css/_common/components/header/header.styl","hash":"7cc3f36222494c9a1325c5347d7eb9ae53755a32","modified":1571217327858},{"_id":"themes/nextv6/source/css/_common/components/header/headerband.styl","hash":"d27448f199fc2f9980b601bc22b87f08b5d64dd1","modified":1571217327859},{"_id":"themes/nextv6/source/css/_common/components/header/menu.styl","hash":"05e68adae13f4d99a6ac6493daab39c92e39a6bd","modified":1571217327859},{"_id":"themes/nextv6/source/css/_common/components/header/site-meta.styl","hash":"c0d9e18a9210fdcaf33e488518b3b288eb58c0a1","modified":1571217327859},{"_id":"themes/nextv6/source/css/_common/components/header/site-nav.styl","hash":"49c2b2c14a1e7fcc810c6be4b632975d0204c281","modified":1571217327859},{"_id":"themes/nextv6/source/css/_common/components/highlight/diff.styl","hash":"96f32ea6c3265a3889e6abe57587f6e2a2a40dfb","modified":1571217327859},{"_id":"themes/nextv6/source/css/_common/components/highlight/theme.styl","hash":"b76387934fb6bb75212b23c1a194486892cc495e","modified":1571217327859},{"_id":"themes/nextv6/source/css/_common/components/pages/archive.styl","hash":"6904fd7ea6455e008d9884558b68254608af9a3c","modified":1571217327859},{"_id":"themes/nextv6/source/css/_common/components/pages/breadcrumb.styl","hash":"7dd9a0378ccff3e4a2003f486b1a34e74c20dac6","modified":1571217327859},{"_id":"themes/nextv6/source/css/_common/components/pages/categories.styl","hash":"4eff5b252d7b614e500fc7d52c97ce325e57d3ab","modified":1571217327859},{"_id":"themes/nextv6/source/css/_common/components/pages/pages.styl","hash":"fb451dc4cc0355b57849c27d3eb110c73562f794","modified":1571217327859},{"_id":"themes/nextv6/source/css/_common/components/pages/post-detail.styl","hash":"9bf4362a4d0ae151ada84b219d39fbe5bb8c790e","modified":1571217327859},{"_id":"themes/nextv6/source/css/_common/components/pages/schedule.styl","hash":"f2911a048e5c20ca2a059bd1087d98ac1c51681c","modified":1571217327859},{"_id":"themes/nextv6/source/css/_common/components/post/my-post-copyright.styl","hash":"e3f0a29751c4253e2baaf0409ed6d669b0de0693","modified":1571217327859},{"_id":"themes/nextv6/source/css/_common/components/post/post-button.styl","hash":"e72a89e0f421444453e149ba32c77a64bd8e44e8","modified":1571217327859},{"_id":"themes/nextv6/source/css/_common/components/post/post-collapse.styl","hash":"4c9839e7d973861abd862e17538ba3b03fb4510e","modified":1571217327859},{"_id":"themes/nextv6/source/css/_common/components/post/post-eof.styl","hash":"2cdc094ecf907a02fce25ad4a607cd5c40da0f2b","modified":1571217327859},{"_id":"themes/nextv6/source/css/_common/components/post/post-copyright.styl","hash":"2356226157e8068b0e9bbe2f7d0f74e1ab49199b","modified":1571217327859},{"_id":"themes/nextv6/source/css/_common/components/post/post-expand.styl","hash":"ca89b167d368eac50a4f808fa53ba67e69cbef94","modified":1571217327859},{"_id":"themes/nextv6/source/css/_common/components/post/post-gallery.styl","hash":"387ce23bba52b22a586b2dfb4ec618fe1ffd3926","modified":1571217327859},{"_id":"themes/nextv6/source/css/_common/components/post/post-meta.styl","hash":"417f05ff12a2aaca6ceeac8b7e7eb26e9440c4c3","modified":1571217327859},{"_id":"themes/nextv6/source/css/_common/components/post/post-reading_progress.styl","hash":"f4e9f870baa56eae423a123062f00e24cc780be1","modified":1571217327859},{"_id":"themes/nextv6/source/css/_common/components/post/post-nav.styl","hash":"1cf64afd4b49143972f7617869539be3adb91a5e","modified":1571217327859},{"_id":"themes/nextv6/source/css/_common/components/post/post-reward.styl","hash":"5f964ef8a38b9901ac8f87e3f5c93e0c44ec947a","modified":1571217327859},{"_id":"themes/nextv6/source/css/_common/components/post/post-rtl.styl","hash":"017074ef58166e2d69c53bb7590a0e7a8947a1ed","modified":1571217327859},{"_id":"themes/nextv6/source/css/_common/components/post/post-tags.styl","hash":"a352ae5b1f8857393bf770d2e638bf15f0c9585d","modified":1571217327859},{"_id":"themes/nextv6/source/css/_common/components/post/post-title.styl","hash":"39beaf3ab19b52e4400bf833eb6e03bf36020ff5","modified":1571217327859},{"_id":"themes/nextv6/source/css/_common/components/post/post-type.styl","hash":"10251257aceecb117233c9554dcf8ecfef8e2104","modified":1571217327859},{"_id":"themes/nextv6/source/css/_common/components/post/post.styl","hash":"1eca48fc0e14c44afb1e492d16d50a6129ad2046","modified":1571217327860},{"_id":"themes/nextv6/source/css/_common/components/post/post-widgets.styl","hash":"578bb2d5f24cad39205bbafb4c39c7e9962b9fa9","modified":1571217327859},{"_id":"themes/nextv6/source/css/_common/components/sidebar/sidebar-author-links.styl","hash":"35c0350096921dd8e2222ec41b6c17a4ea6b44f2","modified":1571217327860},{"_id":"themes/nextv6/source/css/_common/components/sidebar/sidebar-author.styl","hash":"e18b90c97aaff027e795f5a0cb10476a71bf1c3a","modified":1571217327860},{"_id":"themes/nextv6/source/css/_common/components/sidebar/sidebar-blogroll.styl","hash":"b34bb2ea4d16e47e6fdc06cd4feb32d93ccbd779","modified":1571217327860},{"_id":"themes/nextv6/source/css/_common/components/sidebar/sidebar-dimmer.styl","hash":"efa5e5022e205b52786ce495d4879f5e7b8f84b2","modified":1571217327860},{"_id":"themes/nextv6/source/css/_common/components/sidebar/sidebar-feed-link.styl","hash":"9486ddd2cb255227db102d09a7df4cae0fabad72","modified":1571217327860},{"_id":"themes/nextv6/source/css/_common/components/sidebar/sidebar-nav.styl","hash":"45fa7193435a8eae9960267438750b4c9fa9587f","modified":1571217327860},{"_id":"themes/nextv6/source/css/_common/components/sidebar/sidebar-toc.styl","hash":"4427ed3250483ed5b7baad74fa93474bd1eda729","modified":1571217327860},{"_id":"themes/nextv6/source/css/_common/components/sidebar/sidebar-toggle.styl","hash":"f7784aba0c1cd20d824c918c120012d57a5eaa2a","modified":1571217327860},{"_id":"themes/nextv6/source/css/_common/components/sidebar/sidebar.styl","hash":"43bc58daa8d35d5d515dc787ceb21dd77633fe49","modified":1571217327860},{"_id":"themes/nextv6/source/css/_common/components/sidebar/site-state.styl","hash":"3623e7fa4324ec1307370f33d8f287a9e20a5578","modified":1571217327860},{"_id":"themes/nextv6/source/css/_common/components/tags/full-image.styl","hash":"6ec8ea7b11a146777b6b8da0f71f0cc1dbd129df","modified":1571217327860},{"_id":"themes/nextv6/source/css/_common/components/tags/group-pictures.styl","hash":"4851b981020c5cbc354a1af9b831a2dcb3cf9d39","modified":1571217327860},{"_id":"themes/nextv6/source/css/_common/components/tags/blockquote-center.styl","hash":"c2abe4d87148e23e15d49ee225bc650de60baf46","modified":1571217327860},{"_id":"themes/nextv6/source/css/_common/components/tags/label.styl","hash":"4a457d265d62f287c63d48764ce45d9bcfc9ec5a","modified":1571217327860},{"_id":"themes/nextv6/source/css/_common/components/tags/note-modern.styl","hash":"ee7528900578ef4753effe05b346381c40de5499","modified":1571217327860},{"_id":"themes/nextv6/source/css/_common/components/tags/note.styl","hash":"32c9156bea5bac9e9ad0b4c08ffbca8b3d9aac4b","modified":1571217327860},{"_id":"themes/nextv6/source/css/_common/components/tags/tags.styl","hash":"5e340ee2407a4e39cd708794cfcc718a5f398d7b","modified":1571217327860},{"_id":"themes/nextv6/source/css/_common/components/tags/tabs.styl","hash":"4ab5deed8c3b0c338212380f678f8382672e1bcb","modified":1571217327860},{"_id":"themes/nextv6/source/css/_common/components/third-party/algolia-search.styl","hash":"090018c4467a5cc056bdceebd2517a87e3cb7835","modified":1571217327860},{"_id":"themes/nextv6/source/css/_common/components/third-party/busuanzi-counter.styl","hash":"d4e6d8d7b34dc69994593c208f875ae8f7e8a3ae","modified":1571217327860},{"_id":"themes/nextv6/source/css/_common/components/third-party/gitalk.styl","hash":"ac7753d536341aa824d7bce0332735e838916995","modified":1571217327860},{"_id":"themes/nextv6/source/css/_common/components/third-party/gitment.styl","hash":"34935b40237c074be5f5e8818c14ccfd802b7439","modified":1571217327860},{"_id":"themes/nextv6/source/css/_common/components/third-party/han.styl","hash":"6157665b8fc26ce4635c926128ffbd831a2fdd46","modified":1571217327860},{"_id":"themes/nextv6/source/css/_common/components/third-party/localsearch.styl","hash":"d89c4b562b528e4746696b2ad8935764d133bdae","modified":1571217327860},{"_id":"themes/nextv6/source/css/_common/components/third-party/needsharebutton.styl","hash":"a5e3e6b4b4b814a9fe40b34d784fed67d6d977fa","modified":1571217327860},{"_id":"themes/nextv6/source/css/_common/components/third-party/related-posts.styl","hash":"76937db9702053d772f6758d9cea4088c2a6e2a3","modified":1571217327860},{"_id":"themes/nextv6/source/css/_common/components/third-party/third-party.styl","hash":"d4fefad868498adff03321b9dc38e75c61e08def","modified":1571217327860},{"_id":"themes/nextv6/source/css/_schemes/Mist/outline/outline.styl","hash":"5dc4859c66305f871e56cba78f64bfe3bf1b5f01","modified":1571217327862},{"_id":"themes/nextv6/source/css/_schemes/Mist/sidebar/sidebar-blogroll.styl","hash":"817587e46df49e819858c8ecbafa08b53d5ff040","modified":1571217327862},{"_id":"themes/nextv6/source/css/_schemes/Muse/sidebar/sidebar-blogroll.styl","hash":"817587e46df49e819858c8ecbafa08b53d5ff040","modified":1571217327862},{"_id":"themes/nextv6/source/css/_common/components/highlight/highlight.styl","hash":"2dfa5fde3df69fba8282627e592fe637c2cbac6b","modified":1571217327859},{"_id":"public/search.xml","hash":"a6e4b8665b6f224018865a00de4ff51de68561eb","modified":1572172511335},{"_id":"public/categories/index.html","hash":"146fd107e96616ef66f1bedc19be1032c9f9696a","modified":1572172511373},{"_id":"public/tags/index.html","hash":"8fc9431eebb3679c7c7f5a363ac427c0f6861e02","modified":1572172511373},{"_id":"public/2019/10/24/20-k8s搭建mysql5-7-24主从/index.html","hash":"68b6c35c3ff81ba2e41774d7b2fecb2824df8d37","modified":1572172511373},{"_id":"public/2019/10/17/19-shell中gt和>的区别/index.html","hash":"b311cc90195883d83c81121c99a2d643fabfbf72","modified":1572172511373},{"_id":"public/2019/10/17/18-收藏链接/index.html","hash":"4e28f9537a72825feaf0ba80c232f63dc70b3451","modified":1572172511373},{"_id":"public/2019/10/16/17-markdown一些写法记录/index.html","hash":"556d5da16b2e7c21c2b978cee140cae061d456be","modified":1572172511373},{"_id":"public/2019/10/16/16-dockerfile介绍/index.html","hash":"68a77dbe9096e0f7265f022a6d98beb6b3dfa14d","modified":1572172511373},{"_id":"public/2019/10/16/15-docker简介和使用/index.html","hash":"ed2faf8949ccf6e2137b41b9ea0a0206f6ddcf06","modified":1572172511373},{"_id":"public/2019/10/15/14-mysql目录copy方式迁移/index.html","hash":"e6f42c4d627219021f905b14d05f09f4515a9896","modified":1572172511374},{"_id":"public/2019/10/12/13-云原生博客汇总/index.html","hash":"753ba5321611f93e103d26ee45560f3f7239a71a","modified":1572172511374},{"_id":"public/2019/10/11/12-awk简单记录/index.html","hash":"e2ed47ebb28451148a96b4485286539a532c641a","modified":1572172511374},{"_id":"public/2019/10/10/11-mysql简单记录/index.html","hash":"ab19270a99aca54528472f3646fbc4f7ddda04cc","modified":1572172511374},{"_id":"public/2019/09/27/10-centos6安装nginx1-16-php7-2/index.html","hash":"d6d313e16d41fa1a1bf2858158840e8d4ffbada9","modified":1572172511374},{"_id":"public/2019/09/26/9-linux遇到一些问题统计总结/index.html","hash":"85283870a88edce076da8be5b19d4dcd81d1cb39","modified":1572172511374},{"_id":"public/2019/09/26/8-mysql5-7二进制部署/index.html","hash":"7e5aff1b8740610dbd7df0e3e180f0ad879dc6dc","modified":1572172511374},{"_id":"public/2019/09/26/7-k8s部署storageclass动态创建pv-nfs-rbd/index.html","hash":"deb6eafeb98b87b6f3b0da0df3014af4e54828e8","modified":1572172511374},{"_id":"public/2019/09/26/6-ceph安装部署/index.html","hash":"8cc18ae2c275b8fb1482a201e0878ad41ad9d1af","modified":1572172511374},{"_id":"public/2019/09/24/5-hexo添加看板娘/index.html","hash":"80411f02aa5b2d2855bbe75b350027426dc8efa4","modified":1572172511375},{"_id":"public/2019/09/24/4-hexo鼠标移动和鼠标点击特效/index.html","hash":"6e2366ce642896b76c8daeddf5ce7b54a2fcfe18","modified":1572172511375},{"_id":"public/2019/09/20/3-k8s遇到的一些问题统计总结/index.html","hash":"15ad1b1b847caa35a8fe9fafe55ea6996c36d691","modified":1572172511375},{"_id":"public/2019/09/19/2-部署elk7-2-0/index.html","hash":"e6dba81f1d38b419e16eb969b5ad04ce5f8b81f6","modified":1572172511375},{"_id":"public/2019/09/19/首次搭建hexo博客系统/index.html","hash":"4693653d767499d0a0149eb62b350f1b9091ddc2","modified":1572172511375},{"_id":"public/archives/index.html","hash":"4addea284f45d6557d922aead1a2abd7897d710f","modified":1572172511375},{"_id":"public/index.html","hash":"217fbfca07140b7bc76c11f7df3231f5afbafb4a","modified":1572172511375},{"_id":"public/page/2/index.html","hash":"ad0198f1e6b4d310561f8c0a7f6f82cde1a473a4","modified":1572172511375},{"_id":"public/categories/技术文档/index.html","hash":"f53f147d724680bb889c74d8a5b3abf911be5084","modified":1572172511375},{"_id":"public/categories/linux/index.html","hash":"20a5829d711eff4537eea7a8127b4ad909bdf3ee","modified":1572172511376},{"_id":"public/categories/docker/index.html","hash":"0911e0f410c1ccef0d4c79053eaa630efebd7b46","modified":1572172511376},{"_id":"public/categories/mysql/index.html","hash":"04f38c683111559855c61aa14d88280e662fccb6","modified":1572172511376},{"_id":"public/categories/nginx/index.html","hash":"e450c244b39640c27822db4ad63a50632c9cd509","modified":1572172511376},{"_id":"public/categories/linux/awk/index.html","hash":"ac8c8d49f1ee61a463c7a89fbdde66f4a6518da7","modified":1572172511376},{"_id":"public/categories/markdown/index.html","hash":"726fde5ffebfead82f6a37e61ddc387d2519d4c0","modified":1572172511376},{"_id":"public/categories/网址/index.html","hash":"c6b42925e28ab9943e004bbda2d04287c6ee1dac","modified":1572172511376},{"_id":"public/categories/linux/shell/index.html","hash":"407d2c24bb9ccb916f67b6f287021837c7668ca9","modified":1572172511376},{"_id":"public/categories/k8s/index.html","hash":"564a185dd70870c6ec407ca6adc719cbcb5e32e8","modified":1572172511376},{"_id":"public/categories/有趣/index.html","hash":"288e308561070106d580b238669a27cc0babca18","modified":1572172511376},{"_id":"public/categories/存储/index.html","hash":"dcad8054b6d9e6862b73ad608fb4faba56d984fd","modified":1572172511376},{"_id":"public/categories/docker/Dockerfile/index.html","hash":"e95c345cca16845aa09d54e97013d48b0c49ee89","modified":1572172511376},{"_id":"public/categories/网址/收藏/index.html","hash":"14b6653526868c01f5acd4109ff8fc0359c0f2c1","modified":1572172511377},{"_id":"public/categories/网址/大佬博客/index.html","hash":"989f26d1b138c4a7ec40ec4e15663b1a63521e58","modified":1572172511377},{"_id":"public/categories/k8s/mysql/index.html","hash":"8455ec5670a8a1ad203343e1b003cb2f6e8faaf7","modified":1572172511377},{"_id":"public/categories/博客/index.html","hash":"b989c006921b34ace9350f0fe6a9e59ac74e0366","modified":1572172511377},{"_id":"public/categories/k8s/问题总结/index.html","hash":"765263fddc60732083a4005ca31b765e56cb738c","modified":1572172511377},{"_id":"public/categories/有趣/二次元/index.html","hash":"3ccc761141269cf7023e52b63d7772fc141eae89","modified":1572172511377},{"_id":"public/categories/存储/ceph/index.html","hash":"5f784505cb5b8928c85741581b4cf74ec3ad00e6","modified":1572172511377},{"_id":"public/categories/博客/美化/index.html","hash":"c3f6718f37401c118187cd934b054460592e5447","modified":1572172511377},{"_id":"public/categories/k8s/storageclass/index.html","hash":"56e0ad053adee6cf1c6e20e9ad1e9bf21be11b69","modified":1572172511377},{"_id":"public/categories/k8s/elk7/index.html","hash":"5c06278fc8a115db0a3d986a900089b0fc7e55da","modified":1572172511377},{"_id":"public/categories/linux/问题总结/index.html","hash":"5d0a6f790c22add146b7e04ae595c768b73d9daf","modified":1572172511377},{"_id":"public/categories/存储/nfs/index.html","hash":"cbf800e985f746f3e171edd80393596b4da203c4","modified":1572172511377},{"_id":"public/tags/nginx/index.html","hash":"02111af259b2942677048a20a9dc1312bd942649","modified":1572172511378},{"_id":"public/tags/php7/index.html","hash":"99b38adb5cec2ecf3d955c1e4f839cdbeafefd7c","modified":1572172511378},{"_id":"public/tags/linux/index.html","hash":"3bc9472c504c1771b83ddf789e7baadb1d0dc066","modified":1572172511378},{"_id":"public/tags/awk/index.html","hash":"a63e9d7537653a0f7dc60e140f2225068aa32344","modified":1572172511378},{"_id":"public/tags/mysql/index.html","hash":"ccafd3c179ab132a169a37a822f47381fad43a8e","modified":1572172511378},{"_id":"public/tags/docker/index.html","hash":"da8e6fe4a9dded9a0cd83eff515abeacc6b35dd2","modified":1572172511378},{"_id":"public/tags/markdown/index.html","hash":"a6bc7703c1f319196d21eb9d24e24575ba2042f4","modified":1572172511378},{"_id":"public/tags/云原生/index.html","hash":"bcbe6fd391931b7ab1d71b7d0643278041e14795","modified":1572172511378},{"_id":"public/tags/cloud-native/index.html","hash":"73f1dbbfea32ac9b889726dc6d8b6944b546d64f","modified":1572172511378},{"_id":"public/tags/大佬博客/index.html","hash":"644bc1d0d8c474ec03a6f7a919f013fe0b0f04d9","modified":1572172511378},{"_id":"public/tags/收藏/index.html","hash":"4b34628631d7c3447cf3c9c531c9d7246651fd58","modified":1572172511378},{"_id":"public/tags/网址/index.html","hash":"72d2960b458bfae391da2c421765577906466dcf","modified":1572172511379},{"_id":"public/tags/shell/index.html","hash":"56ebce09ab562ceb3b8f4984906b5dac2eba81b2","modified":1572172511379},{"_id":"public/tags/k8s/index.html","hash":"b680276ccd5de618b61cb1e7a8a7679a3accccac","modified":1572172511379},{"_id":"public/tags/hexo6/index.html","hash":"c5fbf73de8bd29100b317a95f481c9eb70f64b05","modified":1572172511379},{"_id":"public/tags/特效/index.html","hash":"2b09760bb0797883c88155fe7607ed782bdef94a","modified":1572172511379},{"_id":"public/tags/ceph/index.html","hash":"e8bef3f7d008a7f8cfd03b224d82f70f24b2095f","modified":1572172511379},{"_id":"public/tags/cephfs/index.html","hash":"950242607365af454f41a0e644f6efb4c441b5bd","modified":1572172511379},{"_id":"public/tags/k8s存储/index.html","hash":"050e901959bebdc1c89bcdb2fccb8a27e06ecc1d","modified":1572172511379},{"_id":"public/tags/mysql5-7/index.html","hash":"1d891431d824fd1ce111b7e6a62af76c7f4268eb","modified":1572172511379},{"_id":"public/tags/elk/index.html","hash":"05391bc1dc1e1b52c848bafff90834cbb2d2bf9f","modified":1572172511379},{"_id":"public/tags/elk7/index.html","hash":"82a29ce00f906faf5362cba686a820dcf63ae9c1","modified":1572172511379},{"_id":"public/tags/nfs/index.html","hash":"3853b4db1db0a5c108c5f81868126b2d6fb5a6a9","modified":1572172511379},{"_id":"public/tags/storageclass/index.html","hash":"e8c41659e93a6b881899216154814312dc4e5a65","modified":1572172511380},{"_id":"public/tags/hexo美化/index.html","hash":"214a61b03637f0ccf3de29103228588896f351c3","modified":1572172511380},{"_id":"public/images/algolia_logo.svg","hash":"ec119560b382b2624e00144ae01c137186e91621","modified":1572172511389},{"_id":"public/images/apple-touch-icon-next.png","hash":"2959dbc97f31c80283e67104fe0854e2369e40aa","modified":1572172511389},{"_id":"public/images/avatar.gif","hash":"264082bb3a1af70d5499c7d22b0902cb454b6d12","modified":1572172511389},{"_id":"public/images/cc-by-nc-nd.svg","hash":"c6524ece3f8039a5f612feaf865d21ec8a794564","modified":1572172511389},{"_id":"public/images/cc-by-nc-sa.svg","hash":"3031be41e8753c70508aa88e84ed8f4f653f157e","modified":1572172511389},{"_id":"public/images/cc-by-nc.svg","hash":"8d39b39d88f8501c0d27f8df9aae47136ebc59b7","modified":1572172511389},{"_id":"public/images/cc-by-nd.svg","hash":"c563508ce9ced1e66948024ba1153400ac0e0621","modified":1572172511389},{"_id":"public/images/cc-by-sa.svg","hash":"aa4742d733c8af8d38d4c183b8adbdcab045872e","modified":1572172511389},{"_id":"public/images/cc-by.svg","hash":"28a0a4fe355a974a5e42f68031652b76798d4f7e","modified":1572172511389},{"_id":"public/images/cc-zero.svg","hash":"87669bf8ac268a91d027a0a4802c92a1473e9030","modified":1572172511389},{"_id":"public/images/dockerniu.jpeg","hash":"6170dc34beb11064fa08b138c5394fc16863fbe9","modified":1572172511389},{"_id":"public/images/favicon-16x16-next.png","hash":"943a0d67a9cdf8c198109b28f9dbd42f761d11c3","modified":1572172511389},{"_id":"public/images/docker1.jpg","hash":"04236a8756d0fd6c0142a9ce806a34e19c959a65","modified":1572172511390},{"_id":"public/images/favicon-32x32-next.png","hash":"0749d7b24b0d2fae1c8eb7f671ad4646ee1894b1","modified":1572172511390},{"_id":"public/images/loading.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1572172511390},{"_id":"public/images/placeholder.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1572172511390},{"_id":"public/images/logo.svg","hash":"d29cacbae1bdc4bbccb542107ee0524fe55ad6de","modified":1572172511390},{"_id":"public/images/quote-l.svg","hash":"94e870b4c8c48da61d09522196d4dd40e277a98f","modified":1572172511390},{"_id":"public/images/quote-r.svg","hash":"e60ae504f9d99b712c793c3740c6b100d057d4ec","modified":1572172511390},{"_id":"public/images/searchicon.png","hash":"67727a6a969be0b2659b908518fa6706eed307b8","modified":1572172511390},{"_id":"public/images/tcp三次握手图.png","hash":"43d3cc1b2cd77995bf995717c2bf6b8c69ccc266","modified":1572172511390},{"_id":"public/images/title3.jpg","hash":"3f15484731b187942553f65a79ac55d3dab820f2","modified":1572172511390},{"_id":"public/images/title2.jpg","hash":"2fef77971762c0b2375d361de519d0c4c4fd6807","modified":1572172511390},{"_id":"public/sh/master-docker-entrypoint.sh","hash":"0b04dad154a9bdb4f4debff5e8d1ab278e4902e4","modified":1572172511390},{"_id":"public/sh/slave-docker-entrypoint.sh","hash":"12dc8a11240fb688102fa507d06497a65b8c8163","modified":1572172511390},{"_id":"public/images/16/容器的原理-1.webp","hash":"4f9bbb5060c2a051eb08525243507a593056593d","modified":1572172511390},{"_id":"public/images/blog6/rancher-pv.png","hash":"e6fba6597291638b3c07f18ffe82764d5ac6431b","modified":1572172511390},{"_id":"public/images/test1/test1.jpg","hash":"3f786850e387550fdab836ed7e6dc881de23001b","modified":1572172511390},{"_id":"public/live2d-widget/LICENSE","hash":"31a3d460bb3c7d98845187c716a30db81c44b615","modified":1572172511885},{"_id":"public/images/16/容器的原理-1.png","hash":"e66aeed692626c316ee2928497093778c1421ff8","modified":1572172511891},{"_id":"public/live2d-widget/assets/screenshot-1.png","hash":"4bd4d97a1fcaa5deb3cea1c0a102a895a15af32f","modified":1572172511892},{"_id":"public/live2d-widget/assets/screenshot-3.png","hash":"ead66aa3edb390205081a0c8625a49844470a090","modified":1572172511892},{"_id":"public/live2d-widget/autoload.js","hash":"095dc7abf0913058a7da9191ace78460bc3a4d6f","modified":1572172511899},{"_id":"public/live2d-widget/waifu.css","hash":"13a643d57eac9a774d24a045aaea7a4721c25330","modified":1572172511900},{"_id":"public/js/src/affix.js","hash":"a2aab233d99297435a5274bf512c3c753fe08e80","modified":1572172511900},{"_id":"public/js/src/algolia-search.js","hash":"1f7f10c579e7703d0f6acb8b73f3d78a07d0c623","modified":1572172511900},{"_id":"public/js/src/bootstrap.js","hash":"1c41508b83cb0c4512e64b4d63afa1be954ce8ef","modified":1572172511900},{"_id":"public/js/src/js.cookie.js","hash":"9b37973a90fd50e71ea91682265715e45ae82c75","modified":1572172511900},{"_id":"public/js/src/exturl.js","hash":"54825acc8de4793feac415be227b965428f4e97d","modified":1572172511900},{"_id":"public/js/src/instantclick.js","hash":"76b10070628006c82c2e5324fc56a7db0a019112","modified":1572172511900},{"_id":"public/js/src/love.js","hash":"effa770d8085f7e7fb903de217ce521dff163780","modified":1572172511900},{"_id":"public/js/src/love2.js","hash":"856aeabe93ffb22168f467c090bd4c933c823c49","modified":1572172511900},{"_id":"public/js/src/post-details.js","hash":"0dde5e6d4547587662a3256317a9d5d1db507692","modified":1572172511900},{"_id":"public/js/src/scroll-cookie.js","hash":"d07b3776708d4ae79ed2037c4c7391d5c9b06b19","modified":1572172511900},{"_id":"public/js/src/scrollspy.js","hash":"fa3c92968bcdbcb8d95a1729f7659d9753cbd077","modified":1572172511900},{"_id":"public/js/src/live2d.js","hash":"b1c80d906315183a97c05b8c43c3ed29c7374500","modified":1572172511900},{"_id":"public/js/src/schemes/pisces.js","hash":"9eb63cba0327d3d11b6cbfcbe40b88e97a8378a3","modified":1572172511901},{"_id":"public/live2d-widget/README.html","hash":"3485ec01c097c319ad20066e3cee590dcefed911","modified":1572172511901},{"_id":"public/live2d-widget/demo/demo1.html","hash":"3fa5d3cc729134c69cddb7abd50dba37464828d9","modified":1572172511901},{"_id":"public/live2d-widget/demo/demo2.html","hash":"7ebf38b10134699ec3ddc78edcfaf4089fdf4a24","modified":1572172511901},{"_id":"public/css/main.css","hash":"bc018acab74b822dd8dc6d15fae7033423791458","modified":1572172511901},{"_id":"public/images/tcp四次挥手图.png","hash":"856611712188ccef959815fbcce4f2c1a75a7ffd","modified":1572172511901},{"_id":"public/live2d-widget/assets/screenshot-2.png","hash":"e766842b0f064efc148613c41f43a8a905c39557","modified":1572172511901},{"_id":"public/live2d-widget/waifu-tips.js","hash":"38f37f6261bdcde84e3566954b362aba7912de7e","modified":1572172511905},{"_id":"public/live2d-widget/waifu-tips.json","hash":"72daf2b6234384e21469574ce02889a6f8d5a6b1","modified":1572172511905},{"_id":"public/js/src/motion.js","hash":"7933a30382a84b655238f6e78d42ea1b99af4de6","modified":1572172511905},{"_id":"public/js/src/utils.js","hash":"f1394d64977439ec569d2777b1ac304905e043f1","modified":1572172511905},{"_id":"public/lib/velocity/velocity.ui.min.js","hash":"ed5e534cd680a25d8d14429af824f38a2c7d9908","modified":1572172511905},{"_id":"public/images/title4.jpg","hash":"4afe4390599d5addb94fc6bae8f60d74aba73d0a","modified":1572172511908},{"_id":"public/images/jixie-title.jpg","hash":"696ce5b0354f3e40afa16fd26602fb31870b2c25","modified":1572172511908},{"_id":"public/lib/velocity/velocity.min.js","hash":"2f1afadc12e4cf59ef3b405308d21baa97e739c6","modified":1572172511911},{"_id":"public/lib/velocity/velocity.ui.js","hash":"6a1d101eab3de87527bb54fcc8c7b36b79d8f0df","modified":1572172511911},{"_id":"public/images/title1.jpg","hash":"2c0c87be6281c5660fb69280555b557338ce9122","modified":1572172511937},{"_id":"public/lib/jquery/index.js","hash":"41b4bfbaa96be6d1440db6e78004ade1c134e276","modified":1572172511944},{"_id":"public/live2d-widget/live2d.min.js","hash":"22365399514b0729c9b787d6a3e782488f1aac95","modified":1572172511949},{"_id":"public/lib/velocity/velocity.js","hash":"9f08181baea0cc0e906703b7e5df9111b9ef3373","modified":1572172511951}],"Category":[{"name":"技术文档","_id":"ck28uwzmj0006kerwpd6fgd2a"},{"name":"linux","_id":"ck28uwzmo000akerwqboo1kih"},{"name":"docker","_id":"ck28uwzmz000jkerwvgw89qhp"},{"name":"mysql","_id":"ck28uwzn2000nkerw5w07dtmc"},{"name":"nginx","_id":"ck28uwzn6000ukerwpuyhassj"},{"name":"awk","parent":"ck28uwzmo000akerwqboo1kih","_id":"ck28uwznc0015kerwe9kt3gzc"},{"name":"markdown","_id":"ck28uwzne001bkerwx4cc51lb"},{"name":"网址","_id":"ck28uwznf001gkerwyhyyg8qf"},{"name":"shell","parent":"ck28uwzmo000akerwqboo1kih","_id":"ck28uwzni001pkerwvva3gyu5"},{"name":"k8s","_id":"ck28uwznj001tkerw34yodyt7"},{"name":"有趣","_id":"ck28uwznk001ykerwzun94c97"},{"name":"存储","_id":"ck28uwzno002akerwtk4a6bue"},{"name":"Dockerfile","parent":"ck28uwzmz000jkerwvgw89qhp","_id":"ck28uwznq002dkerwfj3p44ut"},{"name":"收藏","parent":"ck28uwznf001gkerwyhyyg8qf","_id":"ck28uwznr002hkerwwyfy0r6s"},{"name":"大佬博客","parent":"ck28uwznf001gkerwyhyyg8qf","_id":"ck28uwzns002jkerweoxdmwkf"},{"name":"mysql","parent":"ck28uwznj001tkerw34yodyt7","_id":"ck28uwznt002pkerwgw4wtvo1"},{"name":"博客","_id":"ck28uwznv002ukerwo56civt8"},{"name":"问题总结","parent":"ck28uwznj001tkerw34yodyt7","_id":"ck28uwznw0030kerwtrv5zc2x"},{"name":"二次元","parent":"ck28uwznk001ykerwzun94c97","_id":"ck28uwzny0034kerw2snmz2sg"},{"name":"ceph","parent":"ck28uwzno002akerwtk4a6bue","_id":"ck28uwznz0038kerw25q14wcw"},{"name":"美化","parent":"ck28uwznv002ukerwo56civt8","_id":"ck28uwzo1003ckerw7cdi2wm1"},{"name":"storageclass","parent":"ck28uwznj001tkerw34yodyt7","_id":"ck28uwzp40040kerw42ubbpml"},{"name":"elk7","parent":"ck28uwznj001tkerw34yodyt7","_id":"ck28uwzp50043kerwfe0w0e8t"},{"name":"问题总结","parent":"ck28uwzmo000akerwqboo1kih","_id":"ck28uwzp60047kerwnc3w3w8g"},{"name":"nfs","parent":"ck28uwzno002akerwtk4a6bue","_id":"ck28uwzp7004dkerwc70ilii3"}],"Data":[],"Page":[{"title":"categories","date":"2019-09-24T02:09:55.000Z","type":"categories","layout":"categories","comments":0,"_content":"","source":"categories/index.md","raw":"---\ntitle: categories\ndate: 2019-09-24 10:09:55\ntype: \"categories\"\nlayout: \"categories\"\ncomments: false\n---\n","updated":"2019-10-16T09:15:27.840Z","path":"categories/index.html","_id":"ck28uwzm30000kerwn3xze6t0","content":"","site":{"data":{}},"length":0,"excerpt":"","more":""},{"title":"tags","date":"2019-09-24T02:08:59.000Z","type":"tags","layout":"tags","comments":0,"_content":"","source":"tags/index.md","raw":"---\ntitle: tags\ndate: 2019-09-24 10:08:59\ntype: \"tags\"\nlayout: \"tags\"\ncomments: false\n---\n","updated":"2019-10-16T09:15:27.840Z","path":"tags/index.html","_id":"ck28uwzmc0002kerwq7ikl96u","content":"","site":{"data":{}},"length":0,"excerpt":"","more":""}],"Post":[{"title":"centos6安装nginx1.16+php7.2","copyright":true,"date":"2019-09-27T06:39:07.000Z","_content":"\n记录简单的安装nginx和php的配置,仅供参考\n\n<!-- more -->\n\n### 先准备环境\n```\n# 更新源\nmv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.bak\ncurl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-6.repo\nyum clean all\nyum makecache\nyum install -y epel-release\n\n# 安装一些依赖包\nyum -y install gcc make cmake ncurses-devel libxml2-devel libtool-ltdl-devel gcc-c++ autoconf automake bison  zlib-devel openssl-devel pcre-devel libxml2 libxml2-devel libcurl libcurl-devel autoconf automake  libtool-ltdl libtool-ltdl-devel libjpeg  libjpeg-turbo-devel libmcrypt-devel libpng-devel\n\n```\n\n\n### centos6编译安装nginx\n```\n#首先官网下载1.16\ncd /usr/local/src/\nwget http://nginx.org/download/nginx-1.16.0.tar.gz\ntar -xvf nginx-1.16.0.tar.gz\n\n# 编译简单的模块\n./configure --prefix=/usr/local/nginx/  --with-http_ssl_module --with-http_stub_status_module  --with-http_stub_status_module\nmake -j4\nmake install\n\n# 通过启动脚本启动\nchmod +x /etc/init.d/nginx\nservice nginx start\n# 开机启动\nchkconfig nginx on\n```\n\n### nginx 启动脚本 /etc/init.d/nginx\n```\n#!/bin/bash\n# nginx Startup script for the Nginx HTTP Server\n# it is v.0.0.2 version.\n# chkconfig: - 85 15\n# description: Nginx is a high-performance web and proxy server.\n#              It has a lot of features, but it's not for everyone.\n# processname: nginx\n# pidfile: /var/run/nginx.pid\n# config: /usr/local/nginx/conf/nginx.conf\n\nnginx=/usr/local/nginx/sbin/nginx\nnginx_config=/usr/local/nginx/conf/nginx.conf\nnginx_pid=/var/run/nginx.pid\n\nRETVAL=0\nprog=\"nginx\"\n# Source function library.\n.  /etc/rc.d/init.d/functions\n# Source networking configuration.\n.  /etc/sysconfig/network\n# Check that networking is up.\n[ ${NETWORKING} = \"no\" ] && exit 0\n[ -x $nginx ] || exit 0\n# Start nginx daemons functions.\nstart() {\nif [ -e $nginx_pid ];then\n   echo \"nginx already running....\"\n   exit 1\nfi\n   echo -n $\"Starting $prog: \"\n   daemon $nginx -c ${nginx_config}\n   RETVAL=$?\n   echo\n   [ $RETVAL = 0 ] && touch /var/lock/subsys/nginx\n   return $RETVAL\n}\n# Stop nginx daemons functions.\nstop() {\n        echo -n $\"Stopping $prog: \"\n        killproc $nginx\n        RETVAL=$?\n        echo\n        [ $RETVAL = 0 ] && rm -f /var/lock/subsys/nginx /usr/local//nginx/logs/nginx.pid\n}\n\nreload() {\n    echo -n $\"Reloading $prog: \"\n    #kill -HUP `cat ${nginx_pid}`\n    killproc $nginx -HUP\n    RETVAL=$?\n    echo\n}\n# See how we were called.\ncase \"$1\" in\nstart)\n        start\n        ;;\nstop)\n        stop\n        ;;\nreload)\n        reload\n        ;;\nrestart)\n        stop\n        start\n        ;;\nstatus)\n        status $prog\n        RETVAL=$?\n        ;;\n*)\n        echo $\"Usage: $prog {start|stop|restart|reload|status|help}\"\n        exit 1\nesac\nexit $RETVAL\n```\n\n### nginx.conf简单配置\n```\nuser  nobody nobody;\nworker_processes  auto;\n\nworker_rlimit_nofile 102400;\npid        /var/run/nginx.pid;\n\nevents {\n    use epoll;\n    worker_connections 102400;\n}\n\n\nhttp {\n    log_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '\n                  '$status $body_bytes_sent \"$http_referer\" '\n                 '\"$http_user_agent\" \"$http_x_forwarded_for\"';\n\n    ###定义一个log_format\n    log_format  main '[ $host $request_time  $upstream_addr $upstream_response_time ] ' '$status ' '$remote_addr - $remote_user [$time_local] \"$request\" '  '$body_bytes_sent \"$http_referer\" \"$http_user_agent\" \"$http_x_forwarded_for \" \"$bytes_sent\" \" $request_body\"' ;\n\n\n    ###日志目录配置\n    #日志全部写入/nginx_logs/access.log 文件中。关闭最后两个server_name的日志\n    access_log  /data/nginx_logs/access.log  server_name_main;\n    error_log /data/nginx_logs/error.log notice;\n\n    ###杂项配置\n    charset utf-8;\n    #server name的hash表，\n    server_names_hash_bucket_size 128;\n    #请求头如果过小，那么会引起400错误。一般如果cookie过大，会引起问题。getconf PAGESIZE系统分页\n    client_header_buffer_size 8k;\n    client_body_buffer_size  512k;\n    large_client_header_buffers 16 16k;\n    client_max_body_size 30m;\n    sendfile on;\n    tcp_nopush     on;\n    keepalive_timeout 60;\n    tcp_nodelay on;\n\n    #fastcgi通用配置\n    fastcgi_connect_timeout 600;\n    fastcgi_send_timeout 600;\n    fastcgi_read_timeout 600;\n    fastcgi_buffer_size 128k;\n    fastcgi_buffers 8 256k;\n    fastcgi_busy_buffers_size 256k;\n    fastcgi_temp_file_write_size 256k;\n\n    ###代理有关的配置\n    proxy_connect_timeout    600;\n    proxy_read_timeout       600;\n    proxy_send_timeout       600;\n    proxy_buffer_size        512k;\n    proxy_buffers            6 512k;\n    proxy_busy_buffers_size 512k;\n    proxy_temp_file_write_size 512k;\n\n    #或许在于测试,代理服务器不主动关闭客户端，防止499错误\n    proxy_ignore_client_abort on;\n\n\n    ###gzip配置\n    gzip on;\n    gzip_min_length  1k;\n    gzip_buffers     4 16k;\n    gzip_http_version 1.0;\n    gzip_comp_level 2;\n    gzip_types       text/plain application/x-javascript text/css application/xml;\n    gzip_vary on;\n\n\n    include             /usr/local/nginx/conf/mime.types;\n    default_type        application/octet-stream;\n\n    # 隐藏nginx版本信息\n    server_tokens off;\n\n    server {\n        listen       80 default_server;\n        server_name  _;\n        #server_name  localhost;\n        index  index.html index.htm;\n        root   html;\n        deny all;\n\n        location / {\n        }\n\n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html {\n            root   html;\n        }\n    }\n\n\n}\n```\n\n### centos6编译安装php7\n```\n# 首先安装freetype2.4\ntar -xvf freetype-2.4.0.tar.gz\ncd freetype-2.4.0\n./configure --prefix=/usr/local/freetype\nmake -j4 && make install\n\n\n# 编译php7(不需要的可以去掉)\ntar -xvf php-7.2.2.tar.gz\ncd php-7.2.2\n./configure    --prefix=/usr/local/php   --with-libxml-dir=/usr/   --with-pdo-mysql=mysqlnd   --with-zlib   --with-libxml-dir   --with-openssl   --enable-mysqlnd   --enable-mbstring   --with-config-file-path=/usr/local/php/etc/   --with-config-file-scan-dir=/usr/local/php/etc/conf.d   --enable-fpm --with-freetype-dir=/usr/local/freetype  --with-jpeg-dir --with-png-dir --with-gd --enable-gd-native-ttf --enable-pdo --enable-mbstring --enable-bcmath\n\nmake -j 4 && make install\n\n# 安装composer\ncurl -sS https://getcomposer.org/installer | php && mv composer.phar /usr/bin/composer\n```\n\n### 配置\n```\n# php.ini配置(具体配置内容自行修改)\ncp php.ini-production /usr/local/php7/etc/php.ini\ncp /usr/local/php7/etc/php-fpm.conf.default /usr/local/php7/etc/php-fpm.conf\ncp /usr/local/php7/etc/php-fpm.d/www.conf.default /usr/local/php7/etc/php-fpm.d/www.conf\n\n# 启动脚本\ncp ./sapi/fpm/init.d.php-fpm /etc/init.d/php-fpm\nchmod +x /etc/init.d/php-fpm\n\n# 创建link\nln -s /usr/local/php7 /usr/local/php\n```\n\n### 启动php-fpm\n```\nservice php-fpm start\nchkconfig php-fpm on\n```\n","source":"_posts/10-centos6安装nginx1-16-php7-2.md","raw":"---\ntitle: centos6安装nginx1.16+php7.2\ncopyright: true\ndate: 2019-09-27 14:39:07\ntags:\n  - nginx\n  - php7\ncategories:\n  - [技术文档]\n  - [nginx]\n---\n\n记录简单的安装nginx和php的配置,仅供参考\n\n<!-- more -->\n\n### 先准备环境\n```\n# 更新源\nmv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.bak\ncurl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-6.repo\nyum clean all\nyum makecache\nyum install -y epel-release\n\n# 安装一些依赖包\nyum -y install gcc make cmake ncurses-devel libxml2-devel libtool-ltdl-devel gcc-c++ autoconf automake bison  zlib-devel openssl-devel pcre-devel libxml2 libxml2-devel libcurl libcurl-devel autoconf automake  libtool-ltdl libtool-ltdl-devel libjpeg  libjpeg-turbo-devel libmcrypt-devel libpng-devel\n\n```\n\n\n### centos6编译安装nginx\n```\n#首先官网下载1.16\ncd /usr/local/src/\nwget http://nginx.org/download/nginx-1.16.0.tar.gz\ntar -xvf nginx-1.16.0.tar.gz\n\n# 编译简单的模块\n./configure --prefix=/usr/local/nginx/  --with-http_ssl_module --with-http_stub_status_module  --with-http_stub_status_module\nmake -j4\nmake install\n\n# 通过启动脚本启动\nchmod +x /etc/init.d/nginx\nservice nginx start\n# 开机启动\nchkconfig nginx on\n```\n\n### nginx 启动脚本 /etc/init.d/nginx\n```\n#!/bin/bash\n# nginx Startup script for the Nginx HTTP Server\n# it is v.0.0.2 version.\n# chkconfig: - 85 15\n# description: Nginx is a high-performance web and proxy server.\n#              It has a lot of features, but it's not for everyone.\n# processname: nginx\n# pidfile: /var/run/nginx.pid\n# config: /usr/local/nginx/conf/nginx.conf\n\nnginx=/usr/local/nginx/sbin/nginx\nnginx_config=/usr/local/nginx/conf/nginx.conf\nnginx_pid=/var/run/nginx.pid\n\nRETVAL=0\nprog=\"nginx\"\n# Source function library.\n.  /etc/rc.d/init.d/functions\n# Source networking configuration.\n.  /etc/sysconfig/network\n# Check that networking is up.\n[ ${NETWORKING} = \"no\" ] && exit 0\n[ -x $nginx ] || exit 0\n# Start nginx daemons functions.\nstart() {\nif [ -e $nginx_pid ];then\n   echo \"nginx already running....\"\n   exit 1\nfi\n   echo -n $\"Starting $prog: \"\n   daemon $nginx -c ${nginx_config}\n   RETVAL=$?\n   echo\n   [ $RETVAL = 0 ] && touch /var/lock/subsys/nginx\n   return $RETVAL\n}\n# Stop nginx daemons functions.\nstop() {\n        echo -n $\"Stopping $prog: \"\n        killproc $nginx\n        RETVAL=$?\n        echo\n        [ $RETVAL = 0 ] && rm -f /var/lock/subsys/nginx /usr/local//nginx/logs/nginx.pid\n}\n\nreload() {\n    echo -n $\"Reloading $prog: \"\n    #kill -HUP `cat ${nginx_pid}`\n    killproc $nginx -HUP\n    RETVAL=$?\n    echo\n}\n# See how we were called.\ncase \"$1\" in\nstart)\n        start\n        ;;\nstop)\n        stop\n        ;;\nreload)\n        reload\n        ;;\nrestart)\n        stop\n        start\n        ;;\nstatus)\n        status $prog\n        RETVAL=$?\n        ;;\n*)\n        echo $\"Usage: $prog {start|stop|restart|reload|status|help}\"\n        exit 1\nesac\nexit $RETVAL\n```\n\n### nginx.conf简单配置\n```\nuser  nobody nobody;\nworker_processes  auto;\n\nworker_rlimit_nofile 102400;\npid        /var/run/nginx.pid;\n\nevents {\n    use epoll;\n    worker_connections 102400;\n}\n\n\nhttp {\n    log_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '\n                  '$status $body_bytes_sent \"$http_referer\" '\n                 '\"$http_user_agent\" \"$http_x_forwarded_for\"';\n\n    ###定义一个log_format\n    log_format  main '[ $host $request_time  $upstream_addr $upstream_response_time ] ' '$status ' '$remote_addr - $remote_user [$time_local] \"$request\" '  '$body_bytes_sent \"$http_referer\" \"$http_user_agent\" \"$http_x_forwarded_for \" \"$bytes_sent\" \" $request_body\"' ;\n\n\n    ###日志目录配置\n    #日志全部写入/nginx_logs/access.log 文件中。关闭最后两个server_name的日志\n    access_log  /data/nginx_logs/access.log  server_name_main;\n    error_log /data/nginx_logs/error.log notice;\n\n    ###杂项配置\n    charset utf-8;\n    #server name的hash表，\n    server_names_hash_bucket_size 128;\n    #请求头如果过小，那么会引起400错误。一般如果cookie过大，会引起问题。getconf PAGESIZE系统分页\n    client_header_buffer_size 8k;\n    client_body_buffer_size  512k;\n    large_client_header_buffers 16 16k;\n    client_max_body_size 30m;\n    sendfile on;\n    tcp_nopush     on;\n    keepalive_timeout 60;\n    tcp_nodelay on;\n\n    #fastcgi通用配置\n    fastcgi_connect_timeout 600;\n    fastcgi_send_timeout 600;\n    fastcgi_read_timeout 600;\n    fastcgi_buffer_size 128k;\n    fastcgi_buffers 8 256k;\n    fastcgi_busy_buffers_size 256k;\n    fastcgi_temp_file_write_size 256k;\n\n    ###代理有关的配置\n    proxy_connect_timeout    600;\n    proxy_read_timeout       600;\n    proxy_send_timeout       600;\n    proxy_buffer_size        512k;\n    proxy_buffers            6 512k;\n    proxy_busy_buffers_size 512k;\n    proxy_temp_file_write_size 512k;\n\n    #或许在于测试,代理服务器不主动关闭客户端，防止499错误\n    proxy_ignore_client_abort on;\n\n\n    ###gzip配置\n    gzip on;\n    gzip_min_length  1k;\n    gzip_buffers     4 16k;\n    gzip_http_version 1.0;\n    gzip_comp_level 2;\n    gzip_types       text/plain application/x-javascript text/css application/xml;\n    gzip_vary on;\n\n\n    include             /usr/local/nginx/conf/mime.types;\n    default_type        application/octet-stream;\n\n    # 隐藏nginx版本信息\n    server_tokens off;\n\n    server {\n        listen       80 default_server;\n        server_name  _;\n        #server_name  localhost;\n        index  index.html index.htm;\n        root   html;\n        deny all;\n\n        location / {\n        }\n\n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html {\n            root   html;\n        }\n    }\n\n\n}\n```\n\n### centos6编译安装php7\n```\n# 首先安装freetype2.4\ntar -xvf freetype-2.4.0.tar.gz\ncd freetype-2.4.0\n./configure --prefix=/usr/local/freetype\nmake -j4 && make install\n\n\n# 编译php7(不需要的可以去掉)\ntar -xvf php-7.2.2.tar.gz\ncd php-7.2.2\n./configure    --prefix=/usr/local/php   --with-libxml-dir=/usr/   --with-pdo-mysql=mysqlnd   --with-zlib   --with-libxml-dir   --with-openssl   --enable-mysqlnd   --enable-mbstring   --with-config-file-path=/usr/local/php/etc/   --with-config-file-scan-dir=/usr/local/php/etc/conf.d   --enable-fpm --with-freetype-dir=/usr/local/freetype  --with-jpeg-dir --with-png-dir --with-gd --enable-gd-native-ttf --enable-pdo --enable-mbstring --enable-bcmath\n\nmake -j 4 && make install\n\n# 安装composer\ncurl -sS https://getcomposer.org/installer | php && mv composer.phar /usr/bin/composer\n```\n\n### 配置\n```\n# php.ini配置(具体配置内容自行修改)\ncp php.ini-production /usr/local/php7/etc/php.ini\ncp /usr/local/php7/etc/php-fpm.conf.default /usr/local/php7/etc/php-fpm.conf\ncp /usr/local/php7/etc/php-fpm.d/www.conf.default /usr/local/php7/etc/php-fpm.d/www.conf\n\n# 启动脚本\ncp ./sapi/fpm/init.d.php-fpm /etc/init.d/php-fpm\nchmod +x /etc/init.d/php-fpm\n\n# 创建link\nln -s /usr/local/php7 /usr/local/php\n```\n\n### 启动php-fpm\n```\nservice php-fpm start\nchkconfig php-fpm on\n```\n","slug":"10-centos6安装nginx1-16-php7-2","published":1,"updated":"2019-10-16T09:15:27.839Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck28uwzm60001kerwcr8xhzq2","content":"<p>记录简单的安装nginx和php的配置,仅供参考</p>\n<a id=\"more\"></a>\n\n<h3 id=\"先准备环境\"><a href=\"#先准备环境\" class=\"headerlink\" title=\"先准备环境\"></a>先准备环境</h3><figure class=\"highlight dts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\"># 更新源</span></span><br><span class=\"line\">mv <span class=\"meta-keyword\">/etc/</span>yum.repos.d/CentOS-Base.repo <span class=\"meta-keyword\">/etc/</span>yum.repos.d/CentOS-Base.repo.bak</span><br><span class=\"line\">curl -o <span class=\"meta-keyword\">/etc/</span>yum.repos.d/CentOS-Base.repo http:<span class=\"comment\">//mirrors.aliyun.com/repo/Centos-6.repo</span></span><br><span class=\"line\">yum clean all</span><br><span class=\"line\">yum makecache</span><br><span class=\"line\">yum install -y epel-release</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\"># 安装一些依赖包</span></span><br><span class=\"line\">yum -y install gcc make cmake ncurses-devel libxml2-devel libtool-ltdl-devel gcc-c++ autoconf automake bison  zlib-devel openssl-devel pcre-devel libxml2 libxml2-devel libcurl libcurl-devel autoconf automake  libtool-ltdl libtool-ltdl-devel libjpeg  libjpeg-turbo-devel libmcrypt-devel libpng-devel</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"centos6编译安装nginx\"><a href=\"#centos6编译安装nginx\" class=\"headerlink\" title=\"centos6编译安装nginx\"></a>centos6编译安装nginx</h3><figure class=\"highlight jboss-cli\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#首先官网下载1.16</span></span><br><span class=\"line\"><span class=\"keyword\">cd</span> <span class=\"string\">/usr/local/src/</span></span><br><span class=\"line\">wget http:<span class=\"string\">//nginx.org/download/nginx-1.16.0.tar.gz</span></span><br><span class=\"line\">tar -xvf nginx-1.16.0.tar.gz</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 编译简单的模块</span></span><br><span class=\"line\"><span class=\"string\">./configure</span> <span class=\"params\">--prefix=/usr/local/nginx/</span>  <span class=\"params\">--with-http_ssl_module</span> <span class=\"params\">--with-http_stub_status_module</span>  <span class=\"params\">--with-http_stub_status_module</span></span><br><span class=\"line\">make -j4</span><br><span class=\"line\">make install</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 通过启动脚本启动</span></span><br><span class=\"line\">chmod +x <span class=\"string\">/etc/init.d/nginx</span></span><br><span class=\"line\">service nginx start</span><br><span class=\"line\"><span class=\"comment\"># 开机启动</span></span><br><span class=\"line\">chkconfig nginx on</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"nginx-启动脚本-etc-init-d-nginx\"><a href=\"#nginx-启动脚本-etc-init-d-nginx\" class=\"headerlink\" title=\"nginx 启动脚本 /etc/init.d/nginx\"></a>nginx 启动脚本 /etc/init.d/nginx</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\"><span class=\"comment\"># nginx Startup script for the Nginx HTTP Server</span></span><br><span class=\"line\"><span class=\"comment\"># it is v.0.0.2 version.</span></span><br><span class=\"line\"><span class=\"comment\"># chkconfig: - 85 15</span></span><br><span class=\"line\"><span class=\"comment\"># description: Nginx is a high-performance web and proxy server.</span></span><br><span class=\"line\"><span class=\"comment\">#              It has a lot of features, but it's not for everyone.</span></span><br><span class=\"line\"><span class=\"comment\"># processname: nginx</span></span><br><span class=\"line\"><span class=\"comment\"># pidfile: /var/run/nginx.pid</span></span><br><span class=\"line\"><span class=\"comment\"># config: /usr/local/nginx/conf/nginx.conf</span></span><br><span class=\"line\"></span><br><span class=\"line\">nginx=/usr/<span class=\"built_in\">local</span>/nginx/sbin/nginx</span><br><span class=\"line\">nginx_config=/usr/<span class=\"built_in\">local</span>/nginx/conf/nginx.conf</span><br><span class=\"line\">nginx_pid=/var/run/nginx.pid</span><br><span class=\"line\"></span><br><span class=\"line\">RETVAL=0</span><br><span class=\"line\">prog=<span class=\"string\">\"nginx\"</span></span><br><span class=\"line\"><span class=\"comment\"># Source function library.</span></span><br><span class=\"line\">.  /etc/rc.d/init.d/<span class=\"built_in\">functions</span></span><br><span class=\"line\"><span class=\"comment\"># Source networking configuration.</span></span><br><span class=\"line\">.  /etc/sysconfig/network</span><br><span class=\"line\"><span class=\"comment\"># Check that networking is up.</span></span><br><span class=\"line\">[ <span class=\"variable\">$&#123;NETWORKING&#125;</span> = <span class=\"string\">\"no\"</span> ] &amp;&amp; <span class=\"built_in\">exit</span> 0</span><br><span class=\"line\">[ -x <span class=\"variable\">$nginx</span> ] || <span class=\"built_in\">exit</span> 0</span><br><span class=\"line\"><span class=\"comment\"># Start nginx daemons functions.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">start</span></span>() &#123;</span><br><span class=\"line\"><span class=\"keyword\">if</span> [ -e <span class=\"variable\">$nginx_pid</span> ];<span class=\"keyword\">then</span></span><br><span class=\"line\">   <span class=\"built_in\">echo</span> <span class=\"string\">\"nginx already running....\"</span></span><br><span class=\"line\">   <span class=\"built_in\">exit</span> 1</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\">   <span class=\"built_in\">echo</span> -n $<span class=\"string\">\"Starting <span class=\"variable\">$prog</span>: \"</span></span><br><span class=\"line\">   daemon <span class=\"variable\">$nginx</span> -c <span class=\"variable\">$&#123;nginx_config&#125;</span></span><br><span class=\"line\">   RETVAL=$?</span><br><span class=\"line\">   <span class=\"built_in\">echo</span></span><br><span class=\"line\">   [ <span class=\"variable\">$RETVAL</span> = 0 ] &amp;&amp; touch /var/lock/subsys/nginx</span><br><span class=\"line\">   <span class=\"built_in\">return</span> <span class=\"variable\">$RETVAL</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\"># Stop nginx daemons functions.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">stop</span></span>() &#123;</span><br><span class=\"line\">        <span class=\"built_in\">echo</span> -n $<span class=\"string\">\"Stopping <span class=\"variable\">$prog</span>: \"</span></span><br><span class=\"line\">        killproc <span class=\"variable\">$nginx</span></span><br><span class=\"line\">        RETVAL=$?</span><br><span class=\"line\">        <span class=\"built_in\">echo</span></span><br><span class=\"line\">        [ <span class=\"variable\">$RETVAL</span> = 0 ] &amp;&amp; rm -f /var/lock/subsys/nginx /usr/<span class=\"built_in\">local</span>//nginx/logs/nginx.pid</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">reload</span></span>() &#123;</span><br><span class=\"line\">    <span class=\"built_in\">echo</span> -n $<span class=\"string\">\"Reloading <span class=\"variable\">$prog</span>: \"</span></span><br><span class=\"line\">    <span class=\"comment\">#kill -HUP `cat $&#123;nginx_pid&#125;`</span></span><br><span class=\"line\">    killproc <span class=\"variable\">$nginx</span> -HUP</span><br><span class=\"line\">    RETVAL=$?</span><br><span class=\"line\">    <span class=\"built_in\">echo</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\"># See how we were called.</span></span><br><span class=\"line\"><span class=\"keyword\">case</span> <span class=\"string\">\"<span class=\"variable\">$1</span>\"</span> <span class=\"keyword\">in</span></span><br><span class=\"line\">start)</span><br><span class=\"line\">        start</span><br><span class=\"line\">        ;;</span><br><span class=\"line\">stop)</span><br><span class=\"line\">        stop</span><br><span class=\"line\">        ;;</span><br><span class=\"line\">reload)</span><br><span class=\"line\">        reload</span><br><span class=\"line\">        ;;</span><br><span class=\"line\">restart)</span><br><span class=\"line\">        stop</span><br><span class=\"line\">        start</span><br><span class=\"line\">        ;;</span><br><span class=\"line\">status)</span><br><span class=\"line\">        status <span class=\"variable\">$prog</span></span><br><span class=\"line\">        RETVAL=$?</span><br><span class=\"line\">        ;;</span><br><span class=\"line\">*)</span><br><span class=\"line\">        <span class=\"built_in\">echo</span> $<span class=\"string\">\"Usage: <span class=\"variable\">$prog</span> &#123;start|stop|restart|reload|status|help&#125;\"</span></span><br><span class=\"line\">        <span class=\"built_in\">exit</span> 1</span><br><span class=\"line\"><span class=\"keyword\">esac</span></span><br><span class=\"line\"><span class=\"built_in\">exit</span> <span class=\"variable\">$RETVAL</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"nginx-conf简单配置\"><a href=\"#nginx-conf简单配置\" class=\"headerlink\" title=\"nginx.conf简单配置\"></a>nginx.conf简单配置</h3><figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">user</span>  nobody nobody;</span><br><span class=\"line\"><span class=\"attribute\">worker_processes</span>  auto;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attribute\">worker_rlimit_nofile</span> <span class=\"number\">102400</span>;</span><br><span class=\"line\"><span class=\"attribute\">pid</span>        /var/run/nginx.pid;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">events</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">use</span> <span class=\"literal\">epoll</span>;</span><br><span class=\"line\">    <span class=\"attribute\">worker_connections</span> <span class=\"number\">102400</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">http</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">log_format</span>  main  <span class=\"string\">'<span class=\"variable\">$remote_addr</span> - <span class=\"variable\">$remote_user</span> [<span class=\"variable\">$time_local</span>] \"<span class=\"variable\">$request</span>\" '</span></span><br><span class=\"line\">                  <span class=\"string\">'<span class=\"variable\">$status</span> <span class=\"variable\">$body_bytes_sent</span> \"<span class=\"variable\">$http_referer</span>\" '</span></span><br><span class=\"line\">                 <span class=\"string\">'\"<span class=\"variable\">$http_user_agent</span>\" \"<span class=\"variable\">$http_x_forwarded_for</span>\"'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">###定义一个log_format</span></span><br><span class=\"line\">    <span class=\"attribute\">log_format</span>  main <span class=\"string\">'[ <span class=\"variable\">$host</span> <span class=\"variable\">$request_time</span>  <span class=\"variable\">$upstream_addr</span> <span class=\"variable\">$upstream_response_time</span> ] '</span> <span class=\"string\">'<span class=\"variable\">$status</span> '</span> <span class=\"string\">'<span class=\"variable\">$remote_addr</span> - <span class=\"variable\">$remote_user</span> [<span class=\"variable\">$time_local</span>] \"<span class=\"variable\">$request</span>\" '</span>  <span class=\"string\">'<span class=\"variable\">$body_bytes_sent</span> \"<span class=\"variable\">$http_referer</span>\" \"<span class=\"variable\">$http_user_agent</span>\" \"<span class=\"variable\">$http_x_forwarded_for</span> \" \"<span class=\"variable\">$bytes_sent</span>\" \" <span class=\"variable\">$request_body</span>\"'</span> ;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">###日志目录配置</span></span><br><span class=\"line\">    <span class=\"comment\">#日志全部写入/nginx_logs/access.log 文件中。关闭最后两个server_name的日志</span></span><br><span class=\"line\">    <span class=\"attribute\">access_log</span>  /data/nginx_logs/access.log  server_name_main;</span><br><span class=\"line\">    <span class=\"attribute\">error_log</span> /data/nginx_logs/error.log <span class=\"literal\">notice</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">###杂项配置</span></span><br><span class=\"line\">    <span class=\"attribute\">charset</span> utf-<span class=\"number\">8</span>;</span><br><span class=\"line\">    <span class=\"comment\">#server name的hash表，</span></span><br><span class=\"line\">    <span class=\"attribute\">server_names_hash_bucket_size</span> <span class=\"number\">128</span>;</span><br><span class=\"line\">    <span class=\"comment\">#请求头如果过小，那么会引起400错误。一般如果cookie过大，会引起问题。getconf PAGESIZE系统分页</span></span><br><span class=\"line\">    <span class=\"attribute\">client_header_buffer_size</span> <span class=\"number\">8k</span>;</span><br><span class=\"line\">    <span class=\"attribute\">client_body_buffer_size</span>  <span class=\"number\">512k</span>;</span><br><span class=\"line\">    <span class=\"attribute\">large_client_header_buffers</span> <span class=\"number\">16</span> <span class=\"number\">16k</span>;</span><br><span class=\"line\">    <span class=\"attribute\">client_max_body_size</span> <span class=\"number\">30m</span>;</span><br><span class=\"line\">    <span class=\"attribute\">sendfile</span> <span class=\"literal\">on</span>;</span><br><span class=\"line\">    <span class=\"attribute\">tcp_nopush</span>     <span class=\"literal\">on</span>;</span><br><span class=\"line\">    <span class=\"attribute\">keepalive_timeout</span> <span class=\"number\">60</span>;</span><br><span class=\"line\">    <span class=\"attribute\">tcp_nodelay</span> <span class=\"literal\">on</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">#fastcgi通用配置</span></span><br><span class=\"line\">    <span class=\"attribute\">fastcgi_connect_timeout</span> <span class=\"number\">600</span>;</span><br><span class=\"line\">    <span class=\"attribute\">fastcgi_send_timeout</span> <span class=\"number\">600</span>;</span><br><span class=\"line\">    <span class=\"attribute\">fastcgi_read_timeout</span> <span class=\"number\">600</span>;</span><br><span class=\"line\">    <span class=\"attribute\">fastcgi_buffer_size</span> <span class=\"number\">128k</span>;</span><br><span class=\"line\">    <span class=\"attribute\">fastcgi_buffers</span> <span class=\"number\">8</span> <span class=\"number\">256k</span>;</span><br><span class=\"line\">    <span class=\"attribute\">fastcgi_busy_buffers_size</span> <span class=\"number\">256k</span>;</span><br><span class=\"line\">    <span class=\"attribute\">fastcgi_temp_file_write_size</span> <span class=\"number\">256k</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">###代理有关的配置</span></span><br><span class=\"line\">    <span class=\"attribute\">proxy_connect_timeout</span>    <span class=\"number\">600</span>;</span><br><span class=\"line\">    <span class=\"attribute\">proxy_read_timeout</span>       <span class=\"number\">600</span>;</span><br><span class=\"line\">    <span class=\"attribute\">proxy_send_timeout</span>       <span class=\"number\">600</span>;</span><br><span class=\"line\">    <span class=\"attribute\">proxy_buffer_size</span>        <span class=\"number\">512k</span>;</span><br><span class=\"line\">    <span class=\"attribute\">proxy_buffers</span>            <span class=\"number\">6</span> <span class=\"number\">512k</span>;</span><br><span class=\"line\">    <span class=\"attribute\">proxy_busy_buffers_size</span> <span class=\"number\">512k</span>;</span><br><span class=\"line\">    <span class=\"attribute\">proxy_temp_file_write_size</span> <span class=\"number\">512k</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">#或许在于测试,代理服务器不主动关闭客户端，防止499错误</span></span><br><span class=\"line\">    <span class=\"attribute\">proxy_ignore_client_abort</span> <span class=\"literal\">on</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">###gzip配置</span></span><br><span class=\"line\">    <span class=\"attribute\">gzip</span> <span class=\"literal\">on</span>;</span><br><span class=\"line\">    <span class=\"attribute\">gzip_min_length</span>  <span class=\"number\">1k</span>;</span><br><span class=\"line\">    <span class=\"attribute\">gzip_buffers</span>     <span class=\"number\">4</span> <span class=\"number\">16k</span>;</span><br><span class=\"line\">    <span class=\"attribute\">gzip_http_version</span> <span class=\"number\">1</span>.<span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"attribute\">gzip_comp_level</span> <span class=\"number\">2</span>;</span><br><span class=\"line\">    <span class=\"attribute\">gzip_types</span>       text/plain application/x-javascript text/css application/xml;</span><br><span class=\"line\">    <span class=\"attribute\">gzip_vary</span> <span class=\"literal\">on</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attribute\">include</span>             /usr/local/nginx/conf/mime.types;</span><br><span class=\"line\">    <span class=\"attribute\">default_type</span>        application/octet-stream;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 隐藏nginx版本信息</span></span><br><span class=\"line\">    <span class=\"attribute\">server_tokens</span> <span class=\"literal\">off</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"section\">server</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">listen</span>       <span class=\"number\">80</span> default_server;</span><br><span class=\"line\">        <span class=\"attribute\">server_name</span>  _;</span><br><span class=\"line\">        <span class=\"comment\">#server_name  localhost;</span></span><br><span class=\"line\">        <span class=\"attribute\">index</span>  index.html index.htm;</span><br><span class=\"line\">        <span class=\"attribute\">root</span>   html;</span><br><span class=\"line\">        <span class=\"attribute\">deny</span> all;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"attribute\">location</span> / &#123;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"attribute\">error_page</span>   <span class=\"number\">500</span> <span class=\"number\">502</span> <span class=\"number\">503</span> <span class=\"number\">504</span>  /50x.html;</span><br><span class=\"line\">        <span class=\"attribute\">location</span> = /50x.html &#123;</span><br><span class=\"line\">            <span class=\"attribute\">root</span>   html;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"centos6编译安装php7\"><a href=\"#centos6编译安装php7\" class=\"headerlink\" title=\"centos6编译安装php7\"></a>centos6编译安装php7</h3><figure class=\"highlight jboss-cli\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 首先安装freetype2.4</span></span><br><span class=\"line\">tar -xvf freetype-2.4.0.tar.gz</span><br><span class=\"line\"><span class=\"keyword\">cd</span> freetype-2.4.0</span><br><span class=\"line\"><span class=\"string\">./configure</span> <span class=\"params\">--prefix=/usr/local/freetype</span></span><br><span class=\"line\">make -j4 &amp;&amp; make install</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 编译php7(不需要的可以去掉)</span></span><br><span class=\"line\">tar -xvf php-7.2.2.tar.gz</span><br><span class=\"line\"><span class=\"keyword\">cd</span> php-7.2.2</span><br><span class=\"line\"><span class=\"string\">./configure</span>    <span class=\"params\">--prefix=/usr/local/php</span>   <span class=\"params\">--with-libxml-dir=/usr/</span>   <span class=\"params\">--with-pdo-mysql=mysqlnd</span>   <span class=\"params\">--with-zlib</span>   <span class=\"params\">--with-libxml-dir</span>   <span class=\"params\">--with-openssl</span>   <span class=\"params\">--enable-mysqlnd</span>   <span class=\"params\">--enable-mbstring</span>   <span class=\"params\">--with-config-file-path=/usr/local/php/etc/</span>   <span class=\"params\">--with-config-file-scan-dir=/usr/local/php/etc/conf</span>.d   <span class=\"params\">--enable-fpm</span> <span class=\"params\">--with-freetype-dir=/usr/local/freetype</span>  <span class=\"params\">--with-jpeg-dir</span> <span class=\"params\">--with-png-dir</span> <span class=\"params\">--with-gd</span> <span class=\"params\">--enable-gd-native-ttf</span> <span class=\"params\">--enable-pdo</span> <span class=\"params\">--enable-mbstring</span> <span class=\"params\">--enable-bcmath</span></span><br><span class=\"line\"></span><br><span class=\"line\">make -j 4 &amp;&amp; make install</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 安装composer</span></span><br><span class=\"line\">curl -sS https:<span class=\"string\">//getcomposer.org/installer</span> | php &amp;&amp; mv composer.phar <span class=\"string\">/usr/bin/composer</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"配置\"><a href=\"#配置\" class=\"headerlink\" title=\"配置\"></a>配置</h3><figure class=\"highlight dts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\"># php.ini配置(具体配置内容自行修改)</span></span><br><span class=\"line\">cp php.ini-production <span class=\"meta-keyword\">/usr/</span>local<span class=\"meta-keyword\">/php7/</span>etc/php.ini</span><br><span class=\"line\">cp <span class=\"meta-keyword\">/usr/</span>local<span class=\"meta-keyword\">/php7/</span>etc/php-fpm.conf.default <span class=\"meta-keyword\">/usr/</span>local<span class=\"meta-keyword\">/php7/</span>etc/php-fpm.conf</span><br><span class=\"line\">cp <span class=\"meta-keyword\">/usr/</span>local<span class=\"meta-keyword\">/php7/</span>etc/php-fpm.d/www.conf.default <span class=\"meta-keyword\">/usr/</span>local<span class=\"meta-keyword\">/php7/</span>etc/php-fpm.d/www.conf</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\"># 启动脚本</span></span><br><span class=\"line\">cp .<span class=\"meta-keyword\">/sapi/</span>fpm/init.d.php-fpm <span class=\"meta-keyword\">/etc/</span>init.d/php-fpm</span><br><span class=\"line\">chmod +x <span class=\"meta-keyword\">/etc/</span>init.d/php-fpm</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\"># 创建link</span></span><br><span class=\"line\">ln -s <span class=\"meta-keyword\">/usr/</span>local/php7 <span class=\"meta-keyword\">/usr/</span>local/php</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"启动php-fpm\"><a href=\"#启动php-fpm\" class=\"headerlink\" title=\"启动php-fpm\"></a>启动php-fpm</h3><figure class=\"highlight livecodeserver\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">service php-fpm <span class=\"built_in\">start</span></span><br><span class=\"line\">chkconfig php-fpm <span class=\"keyword\">on</span></span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"length":6719,"excerpt":"<p>记录简单的安装nginx和php的配置,仅供参考</p>","more":"<h3 id=\"先准备环境\"><a href=\"#先准备环境\" class=\"headerlink\" title=\"先准备环境\"></a>先准备环境</h3><figure class=\"highlight dts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\"># 更新源</span></span><br><span class=\"line\">mv <span class=\"meta-keyword\">/etc/</span>yum.repos.d/CentOS-Base.repo <span class=\"meta-keyword\">/etc/</span>yum.repos.d/CentOS-Base.repo.bak</span><br><span class=\"line\">curl -o <span class=\"meta-keyword\">/etc/</span>yum.repos.d/CentOS-Base.repo http:<span class=\"comment\">//mirrors.aliyun.com/repo/Centos-6.repo</span></span><br><span class=\"line\">yum clean all</span><br><span class=\"line\">yum makecache</span><br><span class=\"line\">yum install -y epel-release</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\"># 安装一些依赖包</span></span><br><span class=\"line\">yum -y install gcc make cmake ncurses-devel libxml2-devel libtool-ltdl-devel gcc-c++ autoconf automake bison  zlib-devel openssl-devel pcre-devel libxml2 libxml2-devel libcurl libcurl-devel autoconf automake  libtool-ltdl libtool-ltdl-devel libjpeg  libjpeg-turbo-devel libmcrypt-devel libpng-devel</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"centos6编译安装nginx\"><a href=\"#centos6编译安装nginx\" class=\"headerlink\" title=\"centos6编译安装nginx\"></a>centos6编译安装nginx</h3><figure class=\"highlight jboss-cli\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#首先官网下载1.16</span></span><br><span class=\"line\"><span class=\"keyword\">cd</span> <span class=\"string\">/usr/local/src/</span></span><br><span class=\"line\">wget http:<span class=\"string\">//nginx.org/download/nginx-1.16.0.tar.gz</span></span><br><span class=\"line\">tar -xvf nginx-1.16.0.tar.gz</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 编译简单的模块</span></span><br><span class=\"line\"><span class=\"string\">./configure</span> <span class=\"params\">--prefix=/usr/local/nginx/</span>  <span class=\"params\">--with-http_ssl_module</span> <span class=\"params\">--with-http_stub_status_module</span>  <span class=\"params\">--with-http_stub_status_module</span></span><br><span class=\"line\">make -j4</span><br><span class=\"line\">make install</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 通过启动脚本启动</span></span><br><span class=\"line\">chmod +x <span class=\"string\">/etc/init.d/nginx</span></span><br><span class=\"line\">service nginx start</span><br><span class=\"line\"><span class=\"comment\"># 开机启动</span></span><br><span class=\"line\">chkconfig nginx on</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"nginx-启动脚本-etc-init-d-nginx\"><a href=\"#nginx-启动脚本-etc-init-d-nginx\" class=\"headerlink\" title=\"nginx 启动脚本 /etc/init.d/nginx\"></a>nginx 启动脚本 /etc/init.d/nginx</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\"><span class=\"comment\"># nginx Startup script for the Nginx HTTP Server</span></span><br><span class=\"line\"><span class=\"comment\"># it is v.0.0.2 version.</span></span><br><span class=\"line\"><span class=\"comment\"># chkconfig: - 85 15</span></span><br><span class=\"line\"><span class=\"comment\"># description: Nginx is a high-performance web and proxy server.</span></span><br><span class=\"line\"><span class=\"comment\">#              It has a lot of features, but it's not for everyone.</span></span><br><span class=\"line\"><span class=\"comment\"># processname: nginx</span></span><br><span class=\"line\"><span class=\"comment\"># pidfile: /var/run/nginx.pid</span></span><br><span class=\"line\"><span class=\"comment\"># config: /usr/local/nginx/conf/nginx.conf</span></span><br><span class=\"line\"></span><br><span class=\"line\">nginx=/usr/<span class=\"built_in\">local</span>/nginx/sbin/nginx</span><br><span class=\"line\">nginx_config=/usr/<span class=\"built_in\">local</span>/nginx/conf/nginx.conf</span><br><span class=\"line\">nginx_pid=/var/run/nginx.pid</span><br><span class=\"line\"></span><br><span class=\"line\">RETVAL=0</span><br><span class=\"line\">prog=<span class=\"string\">\"nginx\"</span></span><br><span class=\"line\"><span class=\"comment\"># Source function library.</span></span><br><span class=\"line\">.  /etc/rc.d/init.d/<span class=\"built_in\">functions</span></span><br><span class=\"line\"><span class=\"comment\"># Source networking configuration.</span></span><br><span class=\"line\">.  /etc/sysconfig/network</span><br><span class=\"line\"><span class=\"comment\"># Check that networking is up.</span></span><br><span class=\"line\">[ <span class=\"variable\">$&#123;NETWORKING&#125;</span> = <span class=\"string\">\"no\"</span> ] &amp;&amp; <span class=\"built_in\">exit</span> 0</span><br><span class=\"line\">[ -x <span class=\"variable\">$nginx</span> ] || <span class=\"built_in\">exit</span> 0</span><br><span class=\"line\"><span class=\"comment\"># Start nginx daemons functions.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">start</span></span>() &#123;</span><br><span class=\"line\"><span class=\"keyword\">if</span> [ -e <span class=\"variable\">$nginx_pid</span> ];<span class=\"keyword\">then</span></span><br><span class=\"line\">   <span class=\"built_in\">echo</span> <span class=\"string\">\"nginx already running....\"</span></span><br><span class=\"line\">   <span class=\"built_in\">exit</span> 1</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\">   <span class=\"built_in\">echo</span> -n $<span class=\"string\">\"Starting <span class=\"variable\">$prog</span>: \"</span></span><br><span class=\"line\">   daemon <span class=\"variable\">$nginx</span> -c <span class=\"variable\">$&#123;nginx_config&#125;</span></span><br><span class=\"line\">   RETVAL=$?</span><br><span class=\"line\">   <span class=\"built_in\">echo</span></span><br><span class=\"line\">   [ <span class=\"variable\">$RETVAL</span> = 0 ] &amp;&amp; touch /var/lock/subsys/nginx</span><br><span class=\"line\">   <span class=\"built_in\">return</span> <span class=\"variable\">$RETVAL</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\"># Stop nginx daemons functions.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">stop</span></span>() &#123;</span><br><span class=\"line\">        <span class=\"built_in\">echo</span> -n $<span class=\"string\">\"Stopping <span class=\"variable\">$prog</span>: \"</span></span><br><span class=\"line\">        killproc <span class=\"variable\">$nginx</span></span><br><span class=\"line\">        RETVAL=$?</span><br><span class=\"line\">        <span class=\"built_in\">echo</span></span><br><span class=\"line\">        [ <span class=\"variable\">$RETVAL</span> = 0 ] &amp;&amp; rm -f /var/lock/subsys/nginx /usr/<span class=\"built_in\">local</span>//nginx/logs/nginx.pid</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">reload</span></span>() &#123;</span><br><span class=\"line\">    <span class=\"built_in\">echo</span> -n $<span class=\"string\">\"Reloading <span class=\"variable\">$prog</span>: \"</span></span><br><span class=\"line\">    <span class=\"comment\">#kill -HUP `cat $&#123;nginx_pid&#125;`</span></span><br><span class=\"line\">    killproc <span class=\"variable\">$nginx</span> -HUP</span><br><span class=\"line\">    RETVAL=$?</span><br><span class=\"line\">    <span class=\"built_in\">echo</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\"># See how we were called.</span></span><br><span class=\"line\"><span class=\"keyword\">case</span> <span class=\"string\">\"<span class=\"variable\">$1</span>\"</span> <span class=\"keyword\">in</span></span><br><span class=\"line\">start)</span><br><span class=\"line\">        start</span><br><span class=\"line\">        ;;</span><br><span class=\"line\">stop)</span><br><span class=\"line\">        stop</span><br><span class=\"line\">        ;;</span><br><span class=\"line\">reload)</span><br><span class=\"line\">        reload</span><br><span class=\"line\">        ;;</span><br><span class=\"line\">restart)</span><br><span class=\"line\">        stop</span><br><span class=\"line\">        start</span><br><span class=\"line\">        ;;</span><br><span class=\"line\">status)</span><br><span class=\"line\">        status <span class=\"variable\">$prog</span></span><br><span class=\"line\">        RETVAL=$?</span><br><span class=\"line\">        ;;</span><br><span class=\"line\">*)</span><br><span class=\"line\">        <span class=\"built_in\">echo</span> $<span class=\"string\">\"Usage: <span class=\"variable\">$prog</span> &#123;start|stop|restart|reload|status|help&#125;\"</span></span><br><span class=\"line\">        <span class=\"built_in\">exit</span> 1</span><br><span class=\"line\"><span class=\"keyword\">esac</span></span><br><span class=\"line\"><span class=\"built_in\">exit</span> <span class=\"variable\">$RETVAL</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"nginx-conf简单配置\"><a href=\"#nginx-conf简单配置\" class=\"headerlink\" title=\"nginx.conf简单配置\"></a>nginx.conf简单配置</h3><figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">user</span>  nobody nobody;</span><br><span class=\"line\"><span class=\"attribute\">worker_processes</span>  auto;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attribute\">worker_rlimit_nofile</span> <span class=\"number\">102400</span>;</span><br><span class=\"line\"><span class=\"attribute\">pid</span>        /var/run/nginx.pid;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">events</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">use</span> <span class=\"literal\">epoll</span>;</span><br><span class=\"line\">    <span class=\"attribute\">worker_connections</span> <span class=\"number\">102400</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">http</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">log_format</span>  main  <span class=\"string\">'<span class=\"variable\">$remote_addr</span> - <span class=\"variable\">$remote_user</span> [<span class=\"variable\">$time_local</span>] \"<span class=\"variable\">$request</span>\" '</span></span><br><span class=\"line\">                  <span class=\"string\">'<span class=\"variable\">$status</span> <span class=\"variable\">$body_bytes_sent</span> \"<span class=\"variable\">$http_referer</span>\" '</span></span><br><span class=\"line\">                 <span class=\"string\">'\"<span class=\"variable\">$http_user_agent</span>\" \"<span class=\"variable\">$http_x_forwarded_for</span>\"'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">###定义一个log_format</span></span><br><span class=\"line\">    <span class=\"attribute\">log_format</span>  main <span class=\"string\">'[ <span class=\"variable\">$host</span> <span class=\"variable\">$request_time</span>  <span class=\"variable\">$upstream_addr</span> <span class=\"variable\">$upstream_response_time</span> ] '</span> <span class=\"string\">'<span class=\"variable\">$status</span> '</span> <span class=\"string\">'<span class=\"variable\">$remote_addr</span> - <span class=\"variable\">$remote_user</span> [<span class=\"variable\">$time_local</span>] \"<span class=\"variable\">$request</span>\" '</span>  <span class=\"string\">'<span class=\"variable\">$body_bytes_sent</span> \"<span class=\"variable\">$http_referer</span>\" \"<span class=\"variable\">$http_user_agent</span>\" \"<span class=\"variable\">$http_x_forwarded_for</span> \" \"<span class=\"variable\">$bytes_sent</span>\" \" <span class=\"variable\">$request_body</span>\"'</span> ;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">###日志目录配置</span></span><br><span class=\"line\">    <span class=\"comment\">#日志全部写入/nginx_logs/access.log 文件中。关闭最后两个server_name的日志</span></span><br><span class=\"line\">    <span class=\"attribute\">access_log</span>  /data/nginx_logs/access.log  server_name_main;</span><br><span class=\"line\">    <span class=\"attribute\">error_log</span> /data/nginx_logs/error.log <span class=\"literal\">notice</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">###杂项配置</span></span><br><span class=\"line\">    <span class=\"attribute\">charset</span> utf-<span class=\"number\">8</span>;</span><br><span class=\"line\">    <span class=\"comment\">#server name的hash表，</span></span><br><span class=\"line\">    <span class=\"attribute\">server_names_hash_bucket_size</span> <span class=\"number\">128</span>;</span><br><span class=\"line\">    <span class=\"comment\">#请求头如果过小，那么会引起400错误。一般如果cookie过大，会引起问题。getconf PAGESIZE系统分页</span></span><br><span class=\"line\">    <span class=\"attribute\">client_header_buffer_size</span> <span class=\"number\">8k</span>;</span><br><span class=\"line\">    <span class=\"attribute\">client_body_buffer_size</span>  <span class=\"number\">512k</span>;</span><br><span class=\"line\">    <span class=\"attribute\">large_client_header_buffers</span> <span class=\"number\">16</span> <span class=\"number\">16k</span>;</span><br><span class=\"line\">    <span class=\"attribute\">client_max_body_size</span> <span class=\"number\">30m</span>;</span><br><span class=\"line\">    <span class=\"attribute\">sendfile</span> <span class=\"literal\">on</span>;</span><br><span class=\"line\">    <span class=\"attribute\">tcp_nopush</span>     <span class=\"literal\">on</span>;</span><br><span class=\"line\">    <span class=\"attribute\">keepalive_timeout</span> <span class=\"number\">60</span>;</span><br><span class=\"line\">    <span class=\"attribute\">tcp_nodelay</span> <span class=\"literal\">on</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">#fastcgi通用配置</span></span><br><span class=\"line\">    <span class=\"attribute\">fastcgi_connect_timeout</span> <span class=\"number\">600</span>;</span><br><span class=\"line\">    <span class=\"attribute\">fastcgi_send_timeout</span> <span class=\"number\">600</span>;</span><br><span class=\"line\">    <span class=\"attribute\">fastcgi_read_timeout</span> <span class=\"number\">600</span>;</span><br><span class=\"line\">    <span class=\"attribute\">fastcgi_buffer_size</span> <span class=\"number\">128k</span>;</span><br><span class=\"line\">    <span class=\"attribute\">fastcgi_buffers</span> <span class=\"number\">8</span> <span class=\"number\">256k</span>;</span><br><span class=\"line\">    <span class=\"attribute\">fastcgi_busy_buffers_size</span> <span class=\"number\">256k</span>;</span><br><span class=\"line\">    <span class=\"attribute\">fastcgi_temp_file_write_size</span> <span class=\"number\">256k</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">###代理有关的配置</span></span><br><span class=\"line\">    <span class=\"attribute\">proxy_connect_timeout</span>    <span class=\"number\">600</span>;</span><br><span class=\"line\">    <span class=\"attribute\">proxy_read_timeout</span>       <span class=\"number\">600</span>;</span><br><span class=\"line\">    <span class=\"attribute\">proxy_send_timeout</span>       <span class=\"number\">600</span>;</span><br><span class=\"line\">    <span class=\"attribute\">proxy_buffer_size</span>        <span class=\"number\">512k</span>;</span><br><span class=\"line\">    <span class=\"attribute\">proxy_buffers</span>            <span class=\"number\">6</span> <span class=\"number\">512k</span>;</span><br><span class=\"line\">    <span class=\"attribute\">proxy_busy_buffers_size</span> <span class=\"number\">512k</span>;</span><br><span class=\"line\">    <span class=\"attribute\">proxy_temp_file_write_size</span> <span class=\"number\">512k</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">#或许在于测试,代理服务器不主动关闭客户端，防止499错误</span></span><br><span class=\"line\">    <span class=\"attribute\">proxy_ignore_client_abort</span> <span class=\"literal\">on</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">###gzip配置</span></span><br><span class=\"line\">    <span class=\"attribute\">gzip</span> <span class=\"literal\">on</span>;</span><br><span class=\"line\">    <span class=\"attribute\">gzip_min_length</span>  <span class=\"number\">1k</span>;</span><br><span class=\"line\">    <span class=\"attribute\">gzip_buffers</span>     <span class=\"number\">4</span> <span class=\"number\">16k</span>;</span><br><span class=\"line\">    <span class=\"attribute\">gzip_http_version</span> <span class=\"number\">1</span>.<span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"attribute\">gzip_comp_level</span> <span class=\"number\">2</span>;</span><br><span class=\"line\">    <span class=\"attribute\">gzip_types</span>       text/plain application/x-javascript text/css application/xml;</span><br><span class=\"line\">    <span class=\"attribute\">gzip_vary</span> <span class=\"literal\">on</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attribute\">include</span>             /usr/local/nginx/conf/mime.types;</span><br><span class=\"line\">    <span class=\"attribute\">default_type</span>        application/octet-stream;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 隐藏nginx版本信息</span></span><br><span class=\"line\">    <span class=\"attribute\">server_tokens</span> <span class=\"literal\">off</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"section\">server</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">listen</span>       <span class=\"number\">80</span> default_server;</span><br><span class=\"line\">        <span class=\"attribute\">server_name</span>  _;</span><br><span class=\"line\">        <span class=\"comment\">#server_name  localhost;</span></span><br><span class=\"line\">        <span class=\"attribute\">index</span>  index.html index.htm;</span><br><span class=\"line\">        <span class=\"attribute\">root</span>   html;</span><br><span class=\"line\">        <span class=\"attribute\">deny</span> all;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"attribute\">location</span> / &#123;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"attribute\">error_page</span>   <span class=\"number\">500</span> <span class=\"number\">502</span> <span class=\"number\">503</span> <span class=\"number\">504</span>  /50x.html;</span><br><span class=\"line\">        <span class=\"attribute\">location</span> = /50x.html &#123;</span><br><span class=\"line\">            <span class=\"attribute\">root</span>   html;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"centos6编译安装php7\"><a href=\"#centos6编译安装php7\" class=\"headerlink\" title=\"centos6编译安装php7\"></a>centos6编译安装php7</h3><figure class=\"highlight jboss-cli\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 首先安装freetype2.4</span></span><br><span class=\"line\">tar -xvf freetype-2.4.0.tar.gz</span><br><span class=\"line\"><span class=\"keyword\">cd</span> freetype-2.4.0</span><br><span class=\"line\"><span class=\"string\">./configure</span> <span class=\"params\">--prefix=/usr/local/freetype</span></span><br><span class=\"line\">make -j4 &amp;&amp; make install</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 编译php7(不需要的可以去掉)</span></span><br><span class=\"line\">tar -xvf php-7.2.2.tar.gz</span><br><span class=\"line\"><span class=\"keyword\">cd</span> php-7.2.2</span><br><span class=\"line\"><span class=\"string\">./configure</span>    <span class=\"params\">--prefix=/usr/local/php</span>   <span class=\"params\">--with-libxml-dir=/usr/</span>   <span class=\"params\">--with-pdo-mysql=mysqlnd</span>   <span class=\"params\">--with-zlib</span>   <span class=\"params\">--with-libxml-dir</span>   <span class=\"params\">--with-openssl</span>   <span class=\"params\">--enable-mysqlnd</span>   <span class=\"params\">--enable-mbstring</span>   <span class=\"params\">--with-config-file-path=/usr/local/php/etc/</span>   <span class=\"params\">--with-config-file-scan-dir=/usr/local/php/etc/conf</span>.d   <span class=\"params\">--enable-fpm</span> <span class=\"params\">--with-freetype-dir=/usr/local/freetype</span>  <span class=\"params\">--with-jpeg-dir</span> <span class=\"params\">--with-png-dir</span> <span class=\"params\">--with-gd</span> <span class=\"params\">--enable-gd-native-ttf</span> <span class=\"params\">--enable-pdo</span> <span class=\"params\">--enable-mbstring</span> <span class=\"params\">--enable-bcmath</span></span><br><span class=\"line\"></span><br><span class=\"line\">make -j 4 &amp;&amp; make install</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 安装composer</span></span><br><span class=\"line\">curl -sS https:<span class=\"string\">//getcomposer.org/installer</span> | php &amp;&amp; mv composer.phar <span class=\"string\">/usr/bin/composer</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"配置\"><a href=\"#配置\" class=\"headerlink\" title=\"配置\"></a>配置</h3><figure class=\"highlight dts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\"># php.ini配置(具体配置内容自行修改)</span></span><br><span class=\"line\">cp php.ini-production <span class=\"meta-keyword\">/usr/</span>local<span class=\"meta-keyword\">/php7/</span>etc/php.ini</span><br><span class=\"line\">cp <span class=\"meta-keyword\">/usr/</span>local<span class=\"meta-keyword\">/php7/</span>etc/php-fpm.conf.default <span class=\"meta-keyword\">/usr/</span>local<span class=\"meta-keyword\">/php7/</span>etc/php-fpm.conf</span><br><span class=\"line\">cp <span class=\"meta-keyword\">/usr/</span>local<span class=\"meta-keyword\">/php7/</span>etc/php-fpm.d/www.conf.default <span class=\"meta-keyword\">/usr/</span>local<span class=\"meta-keyword\">/php7/</span>etc/php-fpm.d/www.conf</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\"># 启动脚本</span></span><br><span class=\"line\">cp .<span class=\"meta-keyword\">/sapi/</span>fpm/init.d.php-fpm <span class=\"meta-keyword\">/etc/</span>init.d/php-fpm</span><br><span class=\"line\">chmod +x <span class=\"meta-keyword\">/etc/</span>init.d/php-fpm</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\"># 创建link</span></span><br><span class=\"line\">ln -s <span class=\"meta-keyword\">/usr/</span>local/php7 <span class=\"meta-keyword\">/usr/</span>local/php</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"启动php-fpm\"><a href=\"#启动php-fpm\" class=\"headerlink\" title=\"启动php-fpm\"></a>启动php-fpm</h3><figure class=\"highlight livecodeserver\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">service php-fpm <span class=\"built_in\">start</span></span><br><span class=\"line\">chkconfig php-fpm <span class=\"keyword\">on</span></span><br></pre></td></tr></table></figure>"},{"title":"awk简单记录","copyright":true,"date":"2019-10-11T07:23:48.000Z","_content":"\n记录一些简单使用\n<!-- more -->\n\n\n### 实例1: 计算nginx日志中某个接口的次数和平均响应时间\n#### 例如我的a.txt nginx日志格式如下\n\n```\na.b.com 1.1.1.1 [08/Sep/2019:23:57:01 +0800] \"GET /v1/actionname?xxxx HTTP/1.1\" 200 386 \"-\" \"Mozilla/5.0 (Linux; Android 9; V1831A Build/P00610; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/68.0.3440.91 Mobile Safari/537.36\" \"-\" \"0.023\"\na.b.com 1.1.1.1 [08/Sep/2019:23:57:01 +0800] \"GET /v1/actionname2?xxxx HTTP/1.1\" 200 386 \"-\" \"Mozilla/5.0 (Linux; Android 9; V1831A Build/P00610; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/68.0.3440.91 Mobile Safari/537.36\" \"-\" \"0.016\"\n```\n\n> 这里我只想取出接口名: /v1/actionname 和 0.023 响应时间\n\n#### 首先我取出这两列\n```\ncat a.txt|awk -F '\"' '{print $(NF-1),$2}'|awk -F '?' '{print $1}'|awk '{print $1\" \"$3}' > b.txt\n\n\ncat b.txt\n0.023 /v1/actionname\n0.016 /v1/actionname2\n...\n```\n\n\n#### 命令详解\n```\n> 第一步 响应时间求和\n{s[$2]+=$1}: 每遇到一个$2,比如遇到/v1/actionname,记录一个数组s[/v1/actionname] = 所有$1的值的总和\n> 第二步 算接口的次数\n{m[$2]++}:  每遇到一个$2,比如遇到/v1/actionname,记录一个数组m[/v1/actionname] = 所有$1的个数\n> 第三步 取平均值\n\n# 这里输出csv文件\ncat b.txt|awk '{m[$2]++} {s[$2]+=$1} ; END {for(i in m) {print s[i]/m[i] \",\" m[i] \",\" i}}'|awk -F \",\" '$2 > 20'|sort -k2nr > test.csv\n```\n\n","source":"_posts/12-awk简单记录.md","raw":"---\ntitle: awk简单记录\ncopyright: true\ndate: 2019-10-11 15:23:48\ntags:\n  - linux\n  - awk \ncategories:\n  - [linux,awk]\n---\n\n记录一些简单使用\n<!-- more -->\n\n\n### 实例1: 计算nginx日志中某个接口的次数和平均响应时间\n#### 例如我的a.txt nginx日志格式如下\n\n```\na.b.com 1.1.1.1 [08/Sep/2019:23:57:01 +0800] \"GET /v1/actionname?xxxx HTTP/1.1\" 200 386 \"-\" \"Mozilla/5.0 (Linux; Android 9; V1831A Build/P00610; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/68.0.3440.91 Mobile Safari/537.36\" \"-\" \"0.023\"\na.b.com 1.1.1.1 [08/Sep/2019:23:57:01 +0800] \"GET /v1/actionname2?xxxx HTTP/1.1\" 200 386 \"-\" \"Mozilla/5.0 (Linux; Android 9; V1831A Build/P00610; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/68.0.3440.91 Mobile Safari/537.36\" \"-\" \"0.016\"\n```\n\n> 这里我只想取出接口名: /v1/actionname 和 0.023 响应时间\n\n#### 首先我取出这两列\n```\ncat a.txt|awk -F '\"' '{print $(NF-1),$2}'|awk -F '?' '{print $1}'|awk '{print $1\" \"$3}' > b.txt\n\n\ncat b.txt\n0.023 /v1/actionname\n0.016 /v1/actionname2\n...\n```\n\n\n#### 命令详解\n```\n> 第一步 响应时间求和\n{s[$2]+=$1}: 每遇到一个$2,比如遇到/v1/actionname,记录一个数组s[/v1/actionname] = 所有$1的值的总和\n> 第二步 算接口的次数\n{m[$2]++}:  每遇到一个$2,比如遇到/v1/actionname,记录一个数组m[/v1/actionname] = 所有$1的个数\n> 第三步 取平均值\n\n# 这里输出csv文件\ncat b.txt|awk '{m[$2]++} {s[$2]+=$1} ; END {for(i in m) {print s[i]/m[i] \",\" m[i] \",\" i}}'|awk -F \",\" '$2 > 20'|sort -k2nr > test.csv\n```\n\n","slug":"12-awk简单记录","published":1,"updated":"2019-10-16T09:15:27.839Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck28uwzmc0003kerws6m9w78u","content":"<p>记录一些简单使用</p>\n<a id=\"more\"></a>\n\n\n<h3 id=\"实例1-计算nginx日志中某个接口的次数和平均响应时间\"><a href=\"#实例1-计算nginx日志中某个接口的次数和平均响应时间\" class=\"headerlink\" title=\"实例1: 计算nginx日志中某个接口的次数和平均响应时间\"></a>实例1: 计算nginx日志中某个接口的次数和平均响应时间</h3><h4 id=\"例如我的a-txt-nginx日志格式如下\"><a href=\"#例如我的a-txt-nginx日志格式如下\" class=\"headerlink\" title=\"例如我的a.txt nginx日志格式如下\"></a>例如我的a.txt nginx日志格式如下</h4><figure class=\"highlight accesslog\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a.b.com <span class=\"number\">1.1.1.1</span> <span class=\"string\">[08/Sep/2019:23:57:01 +0800]</span> <span class=\"string\">\"<span class=\"keyword\">GET</span> /v1/actionname?xxxx HTTP/1.1\"</span> <span class=\"number\">200</span> <span class=\"number\">386</span> <span class=\"string\">\"-\"</span> <span class=\"string\">\"Mozilla/5.0 (Linux; Android 9; V1831A Build/P00610; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/68.0.3440.91 Mobile Safari/537.36\"</span> <span class=\"string\">\"-\"</span> <span class=\"string\">\"0.023\"</span></span><br><span class=\"line\">a.b.com <span class=\"number\">1.1.1.1</span> <span class=\"string\">[08/Sep/2019:23:57:01 +0800]</span> <span class=\"string\">\"<span class=\"keyword\">GET</span> /v1/actionname2?xxxx HTTP/1.1\"</span> <span class=\"number\">200</span> <span class=\"number\">386</span> <span class=\"string\">\"-\"</span> <span class=\"string\">\"Mozilla/5.0 (Linux; Android 9; V1831A Build/P00610; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/68.0.3440.91 Mobile Safari/537.36\"</span> <span class=\"string\">\"-\"</span> <span class=\"string\">\"0.016\"</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>这里我只想取出接口名: /v1/actionname 和 0.023 响应时间</p>\n</blockquote>\n<h4 id=\"首先我取出这两列\"><a href=\"#首先我取出这两列\" class=\"headerlink\" title=\"首先我取出这两列\"></a>首先我取出这两列</h4><figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">cat</span> a.txt|awk -F <span class=\"string\">'\"'</span> <span class=\"string\">'&#123;print $(NF-1),<span class=\"variable\">$2</span>&#125;'</span>|awk -F <span class=\"string\">'?'</span> <span class=\"string\">'&#123;print <span class=\"variable\">$1</span>&#125;'</span>|awk <span class=\"string\">'&#123;print <span class=\"variable\">$1</span>\" \"<span class=\"variable\">$3</span>&#125;'</span> &gt; b.txt</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">cat b.txt</span><br><span class=\"line\"><span class=\"number\">0</span>.<span class=\"number\">023</span> /v1/actionname</span><br><span class=\"line\"><span class=\"number\">0</span>.<span class=\"number\">016</span> /v1/actionname2</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"命令详解\"><a href=\"#命令详解\" class=\"headerlink\" title=\"命令详解\"></a>命令详解</h4><figure class=\"highlight stata\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt; 第一步 响应时间求和</span><br><span class=\"line\">&#123;s[<span class=\"variable\">$2</span>]+=<span class=\"variable\">$1&#125;</span>: 每遇到一个<span class=\"variable\">$2</span>,比如遇到/v1/actionname,记录一个数组s[/v1/actionname] = 所有<span class=\"variable\">$1</span>的值的总和</span><br><span class=\"line\">&gt; 第二步 算接口的次数</span><br><span class=\"line\">&#123;<span class=\"keyword\">m</span>[<span class=\"variable\">$2</span>]++&#125;:  每遇到一个<span class=\"variable\">$2</span>,比如遇到/v1/actionname,记录一个数组<span class=\"keyword\">m</span>[/v1/actionname] = 所有<span class=\"variable\">$1</span>的个数</span><br><span class=\"line\">&gt; 第三步 取平均值</span><br><span class=\"line\"></span><br><span class=\"line\"># 这里输出csv文件</span><br><span class=\"line\"><span class=\"keyword\">cat</span> b.txt|awk '&#123;<span class=\"keyword\">m</span>[<span class=\"variable\">$2</span>]++&#125; &#123;s[<span class=\"variable\">$2</span>]+=<span class=\"variable\">$1&#125;</span> ; END &#123;<span class=\"keyword\">for</span>(i <span class=\"keyword\">in</span> <span class=\"keyword\">m</span>) &#123;<span class=\"keyword\">print</span> s[i]/<span class=\"keyword\">m</span>[i] <span class=\"string\">\",\"</span> <span class=\"keyword\">m</span>[i] <span class=\"string\">\",\"</span> i&#125;&#125;'|awk -F <span class=\"string\">\",\"</span> '<span class=\"variable\">$2</span> &gt; 20'|<span class=\"keyword\">sort</span> -k2nr &gt; <span class=\"keyword\">test</span>.csv</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"length":1214,"excerpt":"<p>记录一些简单使用</p>","more":"<h3 id=\"实例1-计算nginx日志中某个接口的次数和平均响应时间\"><a href=\"#实例1-计算nginx日志中某个接口的次数和平均响应时间\" class=\"headerlink\" title=\"实例1: 计算nginx日志中某个接口的次数和平均响应时间\"></a>实例1: 计算nginx日志中某个接口的次数和平均响应时间</h3><h4 id=\"例如我的a-txt-nginx日志格式如下\"><a href=\"#例如我的a-txt-nginx日志格式如下\" class=\"headerlink\" title=\"例如我的a.txt nginx日志格式如下\"></a>例如我的a.txt nginx日志格式如下</h4><figure class=\"highlight accesslog\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a.b.com <span class=\"number\">1.1.1.1</span> <span class=\"string\">[08/Sep/2019:23:57:01 +0800]</span> <span class=\"string\">\"<span class=\"keyword\">GET</span> /v1/actionname?xxxx HTTP/1.1\"</span> <span class=\"number\">200</span> <span class=\"number\">386</span> <span class=\"string\">\"-\"</span> <span class=\"string\">\"Mozilla/5.0 (Linux; Android 9; V1831A Build/P00610; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/68.0.3440.91 Mobile Safari/537.36\"</span> <span class=\"string\">\"-\"</span> <span class=\"string\">\"0.023\"</span></span><br><span class=\"line\">a.b.com <span class=\"number\">1.1.1.1</span> <span class=\"string\">[08/Sep/2019:23:57:01 +0800]</span> <span class=\"string\">\"<span class=\"keyword\">GET</span> /v1/actionname2?xxxx HTTP/1.1\"</span> <span class=\"number\">200</span> <span class=\"number\">386</span> <span class=\"string\">\"-\"</span> <span class=\"string\">\"Mozilla/5.0 (Linux; Android 9; V1831A Build/P00610; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/68.0.3440.91 Mobile Safari/537.36\"</span> <span class=\"string\">\"-\"</span> <span class=\"string\">\"0.016\"</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>这里我只想取出接口名: /v1/actionname 和 0.023 响应时间</p>\n</blockquote>\n<h4 id=\"首先我取出这两列\"><a href=\"#首先我取出这两列\" class=\"headerlink\" title=\"首先我取出这两列\"></a>首先我取出这两列</h4><figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">cat</span> a.txt|awk -F <span class=\"string\">'\"'</span> <span class=\"string\">'&#123;print $(NF-1),<span class=\"variable\">$2</span>&#125;'</span>|awk -F <span class=\"string\">'?'</span> <span class=\"string\">'&#123;print <span class=\"variable\">$1</span>&#125;'</span>|awk <span class=\"string\">'&#123;print <span class=\"variable\">$1</span>\" \"<span class=\"variable\">$3</span>&#125;'</span> &gt; b.txt</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">cat b.txt</span><br><span class=\"line\"><span class=\"number\">0</span>.<span class=\"number\">023</span> /v1/actionname</span><br><span class=\"line\"><span class=\"number\">0</span>.<span class=\"number\">016</span> /v1/actionname2</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"命令详解\"><a href=\"#命令详解\" class=\"headerlink\" title=\"命令详解\"></a>命令详解</h4><figure class=\"highlight stata\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt; 第一步 响应时间求和</span><br><span class=\"line\">&#123;s[<span class=\"variable\">$2</span>]+=<span class=\"variable\">$1&#125;</span>: 每遇到一个<span class=\"variable\">$2</span>,比如遇到/v1/actionname,记录一个数组s[/v1/actionname] = 所有<span class=\"variable\">$1</span>的值的总和</span><br><span class=\"line\">&gt; 第二步 算接口的次数</span><br><span class=\"line\">&#123;<span class=\"keyword\">m</span>[<span class=\"variable\">$2</span>]++&#125;:  每遇到一个<span class=\"variable\">$2</span>,比如遇到/v1/actionname,记录一个数组<span class=\"keyword\">m</span>[/v1/actionname] = 所有<span class=\"variable\">$1</span>的个数</span><br><span class=\"line\">&gt; 第三步 取平均值</span><br><span class=\"line\"></span><br><span class=\"line\"># 这里输出csv文件</span><br><span class=\"line\"><span class=\"keyword\">cat</span> b.txt|awk '&#123;<span class=\"keyword\">m</span>[<span class=\"variable\">$2</span>]++&#125; &#123;s[<span class=\"variable\">$2</span>]+=<span class=\"variable\">$1&#125;</span> ; END &#123;<span class=\"keyword\">for</span>(i <span class=\"keyword\">in</span> <span class=\"keyword\">m</span>) &#123;<span class=\"keyword\">print</span> s[i]/<span class=\"keyword\">m</span>[i] <span class=\"string\">\",\"</span> <span class=\"keyword\">m</span>[i] <span class=\"string\">\",\"</span> i&#125;&#125;'|awk -F <span class=\"string\">\",\"</span> '<span class=\"variable\">$2</span> &gt; 20'|<span class=\"keyword\">sort</span> -k2nr &gt; <span class=\"keyword\">test</span>.csv</span><br></pre></td></tr></table></figure>"},{"title":"mysql简单记录","copyright":true,"date":"2019-10-10T02:40:20.000Z","top":10,"_content":"简单记录一些mysql知识点\n<!-- more -->\n\n### mysql命令\n#### 1. 清空表\n```\n删除表信息的方式有两种 :\ntruncate table table_name;\ndelete * from table_name;\n注 : truncate操作中的table可以省略，delete操作中的*可以省略\n\ntruncate、delete 清空表数据的区别 :\n1> truncate 是整体删除 (速度较快)，delete是逐条删除 (速度较慢)\n2> truncate 不写服务器 log，delete 写服务器 log，也就是 truncate 效率比 delete高的原因\n3> truncate 不激活trigger (触发器)，但是会重置Identity (标识列、自增字段)，相当于自增列会被置为初始值，又重新从1开始记录，而不是接着原来的 ID数。而 delete 删除以后，identity 依旧是接着被删除的最近的那一条记录ID加1后进行记录。如果只需删除表中的部分记录，只能使用 DELETE语句配合 where条件\n\n```\n\n#### 2. 备份\n```\n# 全量锁表备份(不可写)\nmysqldump --lock-all-tables --all-databases > ALLDB.sql\n\n# 仅导出所有表的结构\nmysqldump --opt -d 数据库名 -u root -p > xxx.sql\n\n\n```\n\n#### 3. slave 中修改master_host\n```\n# 查看 master.info中信息\n\n# 查看 show slave status\\G 中 Master_Host \n\n# 修改的步骤需要先停止slave\n1 stop slave ;\n2 change master to master_host='xxx.xxx.xxx';\n  首次配置主库:\n  CHANGE MASTER TO MASTER_HOST='a_master.b.com',MASTER_PORT=3306,MASTER_USER='repl_user',MASTER_PASSWORD='xxxx',MASTER_LOG_FILE='m1-master-bin.000001',MASTER_LOG_POS=88;\n3 start slave ;\n```\n\n\n### 4. mysql5.7 错误总结-ERROR 1067 (42000): Invalid default value for TIMESTAMP\n```\nshow variables like 'sql_mode';\n+---------------+-------------------------------------------------------------------------------------------------------------------------------------------+\n| Variable_name | Value                                                                                                                                     |\n+---------------+-------------------------------------------------------------------------------------------------------------------------------------------+\n| sql_mode      | ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION |\n+---------------+-------------------------------------------------------------------------------------------------------------------------------------------+\n```\n这是因为sql_mode中的NO_ZEROR_DATE导制的，在strict mode中不允许'0000-00-00'作为合法日期\n\n将上面的NO_ZERO_DATE改为下面的 ALLOW_INVALID_DATES\n```\nset sql_mode='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,ALLOW_INVALID_DATES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION';\nset session  sql_mode='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION';\n\n```\n上面的设置是临时设置，在重新登陆后，该设置又恢复为NO_ZERO_DATE\n\n\n","source":"_posts/11-mysql简单记录.md","raw":"---\ntitle: mysql简单记录\ncopyright: true\ndate: 2019-10-10 10:40:20\ntags:\n  - mysql\ncategories:\n  - [技术文档]\n  - [mysql]\ntop: 10\n---\n简单记录一些mysql知识点\n<!-- more -->\n\n### mysql命令\n#### 1. 清空表\n```\n删除表信息的方式有两种 :\ntruncate table table_name;\ndelete * from table_name;\n注 : truncate操作中的table可以省略，delete操作中的*可以省略\n\ntruncate、delete 清空表数据的区别 :\n1> truncate 是整体删除 (速度较快)，delete是逐条删除 (速度较慢)\n2> truncate 不写服务器 log，delete 写服务器 log，也就是 truncate 效率比 delete高的原因\n3> truncate 不激活trigger (触发器)，但是会重置Identity (标识列、自增字段)，相当于自增列会被置为初始值，又重新从1开始记录，而不是接着原来的 ID数。而 delete 删除以后，identity 依旧是接着被删除的最近的那一条记录ID加1后进行记录。如果只需删除表中的部分记录，只能使用 DELETE语句配合 where条件\n\n```\n\n#### 2. 备份\n```\n# 全量锁表备份(不可写)\nmysqldump --lock-all-tables --all-databases > ALLDB.sql\n\n# 仅导出所有表的结构\nmysqldump --opt -d 数据库名 -u root -p > xxx.sql\n\n\n```\n\n#### 3. slave 中修改master_host\n```\n# 查看 master.info中信息\n\n# 查看 show slave status\\G 中 Master_Host \n\n# 修改的步骤需要先停止slave\n1 stop slave ;\n2 change master to master_host='xxx.xxx.xxx';\n  首次配置主库:\n  CHANGE MASTER TO MASTER_HOST='a_master.b.com',MASTER_PORT=3306,MASTER_USER='repl_user',MASTER_PASSWORD='xxxx',MASTER_LOG_FILE='m1-master-bin.000001',MASTER_LOG_POS=88;\n3 start slave ;\n```\n\n\n### 4. mysql5.7 错误总结-ERROR 1067 (42000): Invalid default value for TIMESTAMP\n```\nshow variables like 'sql_mode';\n+---------------+-------------------------------------------------------------------------------------------------------------------------------------------+\n| Variable_name | Value                                                                                                                                     |\n+---------------+-------------------------------------------------------------------------------------------------------------------------------------------+\n| sql_mode      | ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION |\n+---------------+-------------------------------------------------------------------------------------------------------------------------------------------+\n```\n这是因为sql_mode中的NO_ZEROR_DATE导制的，在strict mode中不允许'0000-00-00'作为合法日期\n\n将上面的NO_ZERO_DATE改为下面的 ALLOW_INVALID_DATES\n```\nset sql_mode='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,ALLOW_INVALID_DATES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION';\nset session  sql_mode='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION';\n\n```\n上面的设置是临时设置，在重新登陆后，该设置又恢复为NO_ZERO_DATE\n\n\n","slug":"11-mysql简单记录","published":1,"updated":"2019-10-25T03:32:48.972Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck28uwzmi0005kerwaxtcwx5c","content":"<p>简单记录一些mysql知识点</p>\n<a id=\"more\"></a>\n\n<h3 id=\"mysql命令\"><a href=\"#mysql命令\" class=\"headerlink\" title=\"mysql命令\"></a>mysql命令</h3><h4 id=\"1-清空表\"><a href=\"#1-清空表\" class=\"headerlink\" title=\"1. 清空表\"></a>1. 清空表</h4><figure class=\"highlight erlang-repl\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">删除表信息的方式有两种 :</span><br><span class=\"line\">truncate table table_name;</span><br><span class=\"line\">delete * from table_name;</span><br><span class=\"line\">注 : truncate操作中的table可以省略，delete操作中的*可以省略</span><br><span class=\"line\"></span><br><span class=\"line\">truncate、delete 清空表数据的区别 :</span><br><span class=\"line\"><span class=\"meta\">1&gt; </span>truncate 是整体删除 (速度较快)，delete是逐条删除 (速度较慢)</span><br><span class=\"line\"><span class=\"meta\">2&gt; </span>truncate 不写服务器 log，delete 写服务器 log，也就是 truncate 效率比 delete高的原因</span><br><span class=\"line\"><span class=\"meta\">3&gt; </span>truncate 不激活trigger (触发器)，但是会重置Identity (标识列、自增字段)，相当于自增列会被置为初始值，又重新从<span class=\"number\">1</span>开始记录，而不是接着原来的 ID数。而 delete 删除以后，identity 依旧是接着被删除的最近的那一条记录ID加<span class=\"number\">1</span>后进行记录。如果只需删除表中的部分记录，只能使用 DELETE语句配合 where条件</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"2-备份\"><a href=\"#2-备份\" class=\"headerlink\" title=\"2. 备份\"></a>2. 备份</h4><figure class=\"highlight dsconfig\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 全量锁表备份(不可写)</span></span><br><span class=\"line\"><span class=\"string\">mysqldump </span><span class=\"built_in\">--lock-all-tables</span> <span class=\"built_in\">--all-databases</span> &gt; <span class=\"string\">ALLDB.</span><span class=\"string\">sql</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">#</span> 仅导出所有表的结构</span><br><span class=\"line\"><span class=\"string\">mysqldump </span><span class=\"built_in\">--opt</span> -d 数据库名 -u <span class=\"string\">root </span>-p &gt; <span class=\"string\">xxx.</span><span class=\"string\">sql</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"3-slave-中修改master-host\"><a href=\"#3-slave-中修改master-host\" class=\"headerlink\" title=\"3. slave 中修改master_host\"></a>3. slave 中修改master_host</h4><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 查看 master.info中信息</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 查看 show slave status\\G 中 Master_Host </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 修改的步骤需要先停止slave</span></span><br><span class=\"line\">1 <span class=\"keyword\">stop</span> <span class=\"keyword\">slave</span> ;</span><br><span class=\"line\">2 <span class=\"keyword\">change</span> <span class=\"keyword\">master</span> <span class=\"keyword\">to</span> master_host=<span class=\"string\">'xxx.xxx.xxx'</span>;</span><br><span class=\"line\">  首次配置主库:</span><br><span class=\"line\">  <span class=\"keyword\">CHANGE</span> <span class=\"keyword\">MASTER</span> <span class=\"keyword\">TO</span> MASTER_HOST=<span class=\"string\">'a_master.b.com'</span>,MASTER_PORT=<span class=\"number\">3306</span>,MASTER_USER=<span class=\"string\">'repl_user'</span>,MASTER_PASSWORD=<span class=\"string\">'xxxx'</span>,MASTER_LOG_FILE=<span class=\"string\">'m1-master-bin.000001'</span>,MASTER_LOG_POS=<span class=\"number\">88</span>;</span><br><span class=\"line\">3 <span class=\"keyword\">start</span> <span class=\"keyword\">slave</span> ;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4-mysql5-7-错误总结-ERROR-1067-42000-Invalid-default-value-for-TIMESTAMP\"><a href=\"#4-mysql5-7-错误总结-ERROR-1067-42000-Invalid-default-value-for-TIMESTAMP\" class=\"headerlink\" title=\"4. mysql5.7 错误总结-ERROR 1067 (42000): Invalid default value for TIMESTAMP\"></a>4. mysql5.7 错误总结-ERROR 1067 (42000): Invalid default value for TIMESTAMP</h3><figure class=\"highlight asciidoc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">show variables like <span class=\"emphasis\">'sql_mode'</span>;</span><br><span class=\"line\"><span class=\"code\">+---------------+</span>-------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class=\"line\">| Variable<span class=\"emphasis\">_name | Value                                                                                                                                     |</span></span><br><span class=\"line\"><span class=\"emphasis\">+---------------+-------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class=\"line\"><span class=\"emphasis\">| sql_</span>mode      | ONLY<span class=\"emphasis\">_FULL_</span>GROUP<span class=\"emphasis\">_BY,STRICT_</span>TRANS<span class=\"emphasis\">_TABLES,NO_</span>ZERO<span class=\"emphasis\">_IN_</span>DATE,NO<span class=\"emphasis\">_ZERO_</span>DATE,ERROR<span class=\"emphasis\">_FOR_</span>DIVISION<span class=\"emphasis\">_BY_</span>ZERO,NO<span class=\"emphasis\">_AUTO_</span>CREATE<span class=\"emphasis\">_USER,NO_</span>ENGINE<span class=\"emphasis\">_SUBSTITUTION |</span></span><br><span class=\"line\"><span class=\"emphasis\">+---------------+-------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br></pre></td></tr></table></figure>\n\n<p>这是因为sql_mode中的NO_ZEROR_DATE导制的，在strict mode中不允许’0000-00-00’作为合法日期</p>\n<p>将上面的NO_ZERO_DATE改为下面的 ALLOW_INVALID_DATES</p>\n<figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"builtin-name\">set</span> <span class=\"attribute\">sql_mode</span>=<span class=\"string\">'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,ALLOW_INVALID_DATES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION'</span>;</span><br><span class=\"line\"><span class=\"builtin-name\">set</span> session  <span class=\"attribute\">sql_mode</span>=<span class=\"string\">'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION'</span>;</span><br></pre></td></tr></table></figure>\n\n<p>上面的设置是临时设置，在重新登陆后，该设置又恢复为NO_ZERO_DATE</p>\n","site":{"data":{}},"length":2294,"excerpt":"<p>简单记录一些mysql知识点</p>","more":"<h3 id=\"mysql命令\"><a href=\"#mysql命令\" class=\"headerlink\" title=\"mysql命令\"></a>mysql命令</h3><h4 id=\"1-清空表\"><a href=\"#1-清空表\" class=\"headerlink\" title=\"1. 清空表\"></a>1. 清空表</h4><figure class=\"highlight erlang-repl\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">删除表信息的方式有两种 :</span><br><span class=\"line\">truncate table table_name;</span><br><span class=\"line\">delete * from table_name;</span><br><span class=\"line\">注 : truncate操作中的table可以省略，delete操作中的*可以省略</span><br><span class=\"line\"></span><br><span class=\"line\">truncate、delete 清空表数据的区别 :</span><br><span class=\"line\"><span class=\"meta\">1&gt; </span>truncate 是整体删除 (速度较快)，delete是逐条删除 (速度较慢)</span><br><span class=\"line\"><span class=\"meta\">2&gt; </span>truncate 不写服务器 log，delete 写服务器 log，也就是 truncate 效率比 delete高的原因</span><br><span class=\"line\"><span class=\"meta\">3&gt; </span>truncate 不激活trigger (触发器)，但是会重置Identity (标识列、自增字段)，相当于自增列会被置为初始值，又重新从<span class=\"number\">1</span>开始记录，而不是接着原来的 ID数。而 delete 删除以后，identity 依旧是接着被删除的最近的那一条记录ID加<span class=\"number\">1</span>后进行记录。如果只需删除表中的部分记录，只能使用 DELETE语句配合 where条件</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"2-备份\"><a href=\"#2-备份\" class=\"headerlink\" title=\"2. 备份\"></a>2. 备份</h4><figure class=\"highlight dsconfig\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 全量锁表备份(不可写)</span></span><br><span class=\"line\"><span class=\"string\">mysqldump </span><span class=\"built_in\">--lock-all-tables</span> <span class=\"built_in\">--all-databases</span> &gt; <span class=\"string\">ALLDB.</span><span class=\"string\">sql</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">#</span> 仅导出所有表的结构</span><br><span class=\"line\"><span class=\"string\">mysqldump </span><span class=\"built_in\">--opt</span> -d 数据库名 -u <span class=\"string\">root </span>-p &gt; <span class=\"string\">xxx.</span><span class=\"string\">sql</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"3-slave-中修改master-host\"><a href=\"#3-slave-中修改master-host\" class=\"headerlink\" title=\"3. slave 中修改master_host\"></a>3. slave 中修改master_host</h4><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 查看 master.info中信息</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 查看 show slave status\\G 中 Master_Host </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 修改的步骤需要先停止slave</span></span><br><span class=\"line\">1 <span class=\"keyword\">stop</span> <span class=\"keyword\">slave</span> ;</span><br><span class=\"line\">2 <span class=\"keyword\">change</span> <span class=\"keyword\">master</span> <span class=\"keyword\">to</span> master_host=<span class=\"string\">'xxx.xxx.xxx'</span>;</span><br><span class=\"line\">  首次配置主库:</span><br><span class=\"line\">  <span class=\"keyword\">CHANGE</span> <span class=\"keyword\">MASTER</span> <span class=\"keyword\">TO</span> MASTER_HOST=<span class=\"string\">'a_master.b.com'</span>,MASTER_PORT=<span class=\"number\">3306</span>,MASTER_USER=<span class=\"string\">'repl_user'</span>,MASTER_PASSWORD=<span class=\"string\">'xxxx'</span>,MASTER_LOG_FILE=<span class=\"string\">'m1-master-bin.000001'</span>,MASTER_LOG_POS=<span class=\"number\">88</span>;</span><br><span class=\"line\">3 <span class=\"keyword\">start</span> <span class=\"keyword\">slave</span> ;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4-mysql5-7-错误总结-ERROR-1067-42000-Invalid-default-value-for-TIMESTAMP\"><a href=\"#4-mysql5-7-错误总结-ERROR-1067-42000-Invalid-default-value-for-TIMESTAMP\" class=\"headerlink\" title=\"4. mysql5.7 错误总结-ERROR 1067 (42000): Invalid default value for TIMESTAMP\"></a>4. mysql5.7 错误总结-ERROR 1067 (42000): Invalid default value for TIMESTAMP</h3><figure class=\"highlight asciidoc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">show variables like <span class=\"emphasis\">'sql_mode'</span>;</span><br><span class=\"line\"><span class=\"code\">+---------------+</span>-------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class=\"line\">| Variable<span class=\"emphasis\">_name | Value                                                                                                                                     |</span></span><br><span class=\"line\"><span class=\"emphasis\">+---------------+-------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class=\"line\"><span class=\"emphasis\">| sql_</span>mode      | ONLY<span class=\"emphasis\">_FULL_</span>GROUP<span class=\"emphasis\">_BY,STRICT_</span>TRANS<span class=\"emphasis\">_TABLES,NO_</span>ZERO<span class=\"emphasis\">_IN_</span>DATE,NO<span class=\"emphasis\">_ZERO_</span>DATE,ERROR<span class=\"emphasis\">_FOR_</span>DIVISION<span class=\"emphasis\">_BY_</span>ZERO,NO<span class=\"emphasis\">_AUTO_</span>CREATE<span class=\"emphasis\">_USER,NO_</span>ENGINE<span class=\"emphasis\">_SUBSTITUTION |</span></span><br><span class=\"line\"><span class=\"emphasis\">+---------------+-------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br></pre></td></tr></table></figure>\n\n<p>这是因为sql_mode中的NO_ZEROR_DATE导制的，在strict mode中不允许’0000-00-00’作为合法日期</p>\n<p>将上面的NO_ZERO_DATE改为下面的 ALLOW_INVALID_DATES</p>\n<figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"builtin-name\">set</span> <span class=\"attribute\">sql_mode</span>=<span class=\"string\">'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,ALLOW_INVALID_DATES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION'</span>;</span><br><span class=\"line\"><span class=\"builtin-name\">set</span> session  <span class=\"attribute\">sql_mode</span>=<span class=\"string\">'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION'</span>;</span><br></pre></td></tr></table></figure>\n\n<p>上面的设置是临时设置，在重新登陆后，该设置又恢复为NO_ZERO_DATE</p>"},{"title":"mysql5.5目录copy方式迁移","copyright":true,"date":"2019-10-15T02:44:27.000Z","_content":"从现有的一台 从库 全copy data目录到2台新机器上, 再配置mysql主从\n<!--more-->\n\n\n### 目录copy方式迁移\n\n>  注意\n\n- 不要删除ibdata1,会导致innodb表不存在\n- 可以不删除ib_logfile0,ib_logfile1, 但my.cnf配置大小一致\n- 区别目录权限为mysql,tmp目录存在\n- 请自行安装好mysql5.5\n\n```\n1 首先停止mysql\n/etc/init.d/mysqld stop\n\n2 同步数据目录到新机器\n/data/u01\n\n3 确认新机器上mysql版本并配置/etc/my.cof\n4 完整迁移时不需要删除内容(innodb_log_file_size = 256M 配置要一致)\n5 启动mysql\n\n```\n\n### 配置主从\n- 1 首先 目录copy方式 同步某个从库到2台新机器并启动完成, 此时两个mysql都开启了slave\n\n- 2 暂停同步，并设置读写；\n\n```\nstop slave;\n# 该执行仅主库上执行(配置可写)\nSET GLOBAL read_only=0;\nreset slave all;\n-- RESET SLAVE ALL是清除从库的同步复制信息、包括连接信息和二进制文件名、位置\n-- 从库上执行这个命令后，使用show slave status将不会有输出。\n```\n\n- 3 2台新的mysql中修改从库slave配置, 连接到新的主库地址(我这里通过域名解析)\n\n```\nCHANGE MASTER TO \nMASTER_HOST='a_master.b.com',MASTER_PORT=3306,MASTER_USER='repl_user',MASTER_PASSWORD='xxxx',MASTER_LOG_FILE='m1-master-bin.000001',MASTER_LOG_POS=88;\n```\n\n\n- 4 由于本机需要安装mysql5.5和mysql5.7所以注意一下\n\n```\n# 初始化指定配置文件\n/usr/local/mysql57/bin/mysqld --defaults-file=/etc/my57.cnf --initialize-insecure --user=mysql --basedir=/usr/local/mysql57 --datadir=/data/u001\n\n# 修改/etc/init.d/mysqld57\nparse_server_arguments `$print_defaults -c /etc/my57.cnf mysqld server mysql_server mysql.server`\n$bindir/mysqld_safe --defaults-file=/etc/my57.cnf --pid-file=\"$mysqld_pid_file_path\" $other_args >/dev/null &\n```\n\n### 报错统计\n- ERROR 1840 (HY000) at line 24: @@GLOBAL.GTID_PURGED can only be set when @@GLOBAL.GTID_EXECUTED is empty.\n\n```\n执行reset master; \n```\n\n- The MySQL server is running with the--read-only option so it cannot execute this statement\n\n```\n执行 set global read_only=0;\n```\n\n\n","source":"_posts/14-mysql目录copy方式迁移.md","raw":"---\ntitle: mysql5.5目录copy方式迁移\ncopyright: true\ndate: 2019-10-15 10:44:27\ntags:\n  - mysql\ncategories:\n  - [技术文档]\n  - [mysql]\n---\n从现有的一台 从库 全copy data目录到2台新机器上, 再配置mysql主从\n<!--more-->\n\n\n### 目录copy方式迁移\n\n>  注意\n\n- 不要删除ibdata1,会导致innodb表不存在\n- 可以不删除ib_logfile0,ib_logfile1, 但my.cnf配置大小一致\n- 区别目录权限为mysql,tmp目录存在\n- 请自行安装好mysql5.5\n\n```\n1 首先停止mysql\n/etc/init.d/mysqld stop\n\n2 同步数据目录到新机器\n/data/u01\n\n3 确认新机器上mysql版本并配置/etc/my.cof\n4 完整迁移时不需要删除内容(innodb_log_file_size = 256M 配置要一致)\n5 启动mysql\n\n```\n\n### 配置主从\n- 1 首先 目录copy方式 同步某个从库到2台新机器并启动完成, 此时两个mysql都开启了slave\n\n- 2 暂停同步，并设置读写；\n\n```\nstop slave;\n# 该执行仅主库上执行(配置可写)\nSET GLOBAL read_only=0;\nreset slave all;\n-- RESET SLAVE ALL是清除从库的同步复制信息、包括连接信息和二进制文件名、位置\n-- 从库上执行这个命令后，使用show slave status将不会有输出。\n```\n\n- 3 2台新的mysql中修改从库slave配置, 连接到新的主库地址(我这里通过域名解析)\n\n```\nCHANGE MASTER TO \nMASTER_HOST='a_master.b.com',MASTER_PORT=3306,MASTER_USER='repl_user',MASTER_PASSWORD='xxxx',MASTER_LOG_FILE='m1-master-bin.000001',MASTER_LOG_POS=88;\n```\n\n\n- 4 由于本机需要安装mysql5.5和mysql5.7所以注意一下\n\n```\n# 初始化指定配置文件\n/usr/local/mysql57/bin/mysqld --defaults-file=/etc/my57.cnf --initialize-insecure --user=mysql --basedir=/usr/local/mysql57 --datadir=/data/u001\n\n# 修改/etc/init.d/mysqld57\nparse_server_arguments `$print_defaults -c /etc/my57.cnf mysqld server mysql_server mysql.server`\n$bindir/mysqld_safe --defaults-file=/etc/my57.cnf --pid-file=\"$mysqld_pid_file_path\" $other_args >/dev/null &\n```\n\n### 报错统计\n- ERROR 1840 (HY000) at line 24: @@GLOBAL.GTID_PURGED can only be set when @@GLOBAL.GTID_EXECUTED is empty.\n\n```\n执行reset master; \n```\n\n- The MySQL server is running with the--read-only option so it cannot execute this statement\n\n```\n执行 set global read_only=0;\n```\n\n\n","slug":"14-mysql目录copy方式迁移","published":1,"updated":"2019-10-16T09:15:27.839Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck28uwzml0007kerwcpe96snb","content":"<p>从现有的一台 从库 全copy data目录到2台新机器上, 再配置mysql主从</p>\n<a id=\"more\"></a>\n\n\n<h3 id=\"目录copy方式迁移\"><a href=\"#目录copy方式迁移\" class=\"headerlink\" title=\"目录copy方式迁移\"></a>目录copy方式迁移</h3><blockquote>\n<p> 注意</p>\n</blockquote>\n<ul>\n<li>不要删除ibdata1,会导致innodb表不存在</li>\n<li>可以不删除ib_logfile0,ib_logfile1, 但my.cnf配置大小一致</li>\n<li>区别目录权限为mysql,tmp目录存在</li>\n<li>请自行安装好mysql5.5</li>\n</ul>\n<figure class=\"highlight lsl\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">1</span> 首先停止mysql</span><br><span class=\"line\">/etc/init.d/mysqld stop</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">2</span> 同步数据目录到新机器</span><br><span class=\"line\">/data/u01</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">3</span> 确认新机器上mysql版本并配置/etc/my.cof</span><br><span class=\"line\"><span class=\"number\">4</span> 完整迁移时不需要删除内容(innodb_log_file_size = <span class=\"number\">256</span>M 配置要一致)</span><br><span class=\"line\"><span class=\"number\">5</span> 启动mysql</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"配置主从\"><a href=\"#配置主从\" class=\"headerlink\" title=\"配置主从\"></a>配置主从</h3><ul>\n<li><p>1 首先 目录copy方式 同步某个从库到2台新机器并启动完成, 此时两个mysql都开启了slave</p>\n</li>\n<li><p>2 暂停同步，并设置读写；</p>\n</li>\n</ul>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">stop</span> <span class=\"keyword\">slave</span>;</span><br><span class=\"line\"><span class=\"comment\"># 该执行仅主库上执行(配置可写)</span></span><br><span class=\"line\"><span class=\"keyword\">SET</span> <span class=\"keyword\">GLOBAL</span> read_only=<span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"keyword\">reset</span> <span class=\"keyword\">slave</span> <span class=\"keyword\">all</span>;</span><br><span class=\"line\"><span class=\"comment\">-- RESET SLAVE ALL是清除从库的同步复制信息、包括连接信息和二进制文件名、位置</span></span><br><span class=\"line\"><span class=\"comment\">-- 从库上执行这个命令后，使用show slave status将不会有输出。</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>3 2台新的mysql中修改从库slave配置, 连接到新的主库地址(我这里通过域名解析)</li>\n</ul>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CHANGE</span> <span class=\"keyword\">MASTER</span> <span class=\"keyword\">TO</span> </span><br><span class=\"line\">MASTER_HOST=<span class=\"string\">'a_master.b.com'</span>,MASTER_PORT=<span class=\"number\">3306</span>,MASTER_USER=<span class=\"string\">'repl_user'</span>,MASTER_PASSWORD=<span class=\"string\">'xxxx'</span>,MASTER_LOG_FILE=<span class=\"string\">'m1-master-bin.000001'</span>,MASTER_LOG_POS=<span class=\"number\">88</span>;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>4 由于本机需要安装mysql5.5和mysql5.7所以注意一下</li>\n</ul>\n<figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 初始化指定配置文件</span></span><br><span class=\"line\">/usr/local/mysql57/bin/mysqld <span class=\"attribute\">--defaults-file</span>=/etc/my57.cnf --initialize-insecure <span class=\"attribute\">--user</span>=mysql <span class=\"attribute\">--basedir</span>=/usr/local/mysql57 <span class=\"attribute\">--datadir</span>=/data/u001</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 修改/etc/init.d/mysqld57</span></span><br><span class=\"line\">parse_server_arguments `<span class=\"variable\">$print_defaults</span> -c /etc/my57.cnf mysqld<span class=\"built_in\"> server </span>mysql_server mysql.server`</span><br><span class=\"line\"><span class=\"variable\">$bindir</span>/mysqld_safe <span class=\"attribute\">--defaults-file</span>=/etc/my57.cnf <span class=\"attribute\">--pid-file</span>=<span class=\"string\">\"<span class=\"variable\">$mysqld_pid_file_path</span>\"</span> <span class=\"variable\">$other_args</span> &gt;/dev/<span class=\"literal\">null</span> &amp;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"报错统计\"><a href=\"#报错统计\" class=\"headerlink\" title=\"报错统计\"></a>报错统计</h3><ul>\n<li>ERROR 1840 (HY000) at line 24: @@GLOBAL.GTID_PURGED can only be set when @@GLOBAL.GTID_EXECUTED is empty.</li>\n</ul>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">执行<span class=\"keyword\">reset</span> <span class=\"keyword\">master</span>;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>The MySQL server is running with the–read-only option so it cannot execute this statement</li>\n</ul>\n<figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">执行 <span class=\"builtin-name\">set</span> global <span class=\"attribute\">read_only</span>=0;</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"length":1421,"excerpt":"<p>从现有的一台 从库 全copy data目录到2台新机器上, 再配置mysql主从</p>","more":"<h3 id=\"目录copy方式迁移\"><a href=\"#目录copy方式迁移\" class=\"headerlink\" title=\"目录copy方式迁移\"></a>目录copy方式迁移</h3><blockquote>\n<p> 注意</p>\n</blockquote>\n<ul>\n<li>不要删除ibdata1,会导致innodb表不存在</li>\n<li>可以不删除ib_logfile0,ib_logfile1, 但my.cnf配置大小一致</li>\n<li>区别目录权限为mysql,tmp目录存在</li>\n<li>请自行安装好mysql5.5</li>\n</ul>\n<figure class=\"highlight lsl\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">1</span> 首先停止mysql</span><br><span class=\"line\">/etc/init.d/mysqld stop</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">2</span> 同步数据目录到新机器</span><br><span class=\"line\">/data/u01</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">3</span> 确认新机器上mysql版本并配置/etc/my.cof</span><br><span class=\"line\"><span class=\"number\">4</span> 完整迁移时不需要删除内容(innodb_log_file_size = <span class=\"number\">256</span>M 配置要一致)</span><br><span class=\"line\"><span class=\"number\">5</span> 启动mysql</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"配置主从\"><a href=\"#配置主从\" class=\"headerlink\" title=\"配置主从\"></a>配置主从</h3><ul>\n<li><p>1 首先 目录copy方式 同步某个从库到2台新机器并启动完成, 此时两个mysql都开启了slave</p>\n</li>\n<li><p>2 暂停同步，并设置读写；</p>\n</li>\n</ul>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">stop</span> <span class=\"keyword\">slave</span>;</span><br><span class=\"line\"><span class=\"comment\"># 该执行仅主库上执行(配置可写)</span></span><br><span class=\"line\"><span class=\"keyword\">SET</span> <span class=\"keyword\">GLOBAL</span> read_only=<span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"keyword\">reset</span> <span class=\"keyword\">slave</span> <span class=\"keyword\">all</span>;</span><br><span class=\"line\"><span class=\"comment\">-- RESET SLAVE ALL是清除从库的同步复制信息、包括连接信息和二进制文件名、位置</span></span><br><span class=\"line\"><span class=\"comment\">-- 从库上执行这个命令后，使用show slave status将不会有输出。</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>3 2台新的mysql中修改从库slave配置, 连接到新的主库地址(我这里通过域名解析)</li>\n</ul>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CHANGE</span> <span class=\"keyword\">MASTER</span> <span class=\"keyword\">TO</span> </span><br><span class=\"line\">MASTER_HOST=<span class=\"string\">'a_master.b.com'</span>,MASTER_PORT=<span class=\"number\">3306</span>,MASTER_USER=<span class=\"string\">'repl_user'</span>,MASTER_PASSWORD=<span class=\"string\">'xxxx'</span>,MASTER_LOG_FILE=<span class=\"string\">'m1-master-bin.000001'</span>,MASTER_LOG_POS=<span class=\"number\">88</span>;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>4 由于本机需要安装mysql5.5和mysql5.7所以注意一下</li>\n</ul>\n<figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 初始化指定配置文件</span></span><br><span class=\"line\">/usr/local/mysql57/bin/mysqld <span class=\"attribute\">--defaults-file</span>=/etc/my57.cnf --initialize-insecure <span class=\"attribute\">--user</span>=mysql <span class=\"attribute\">--basedir</span>=/usr/local/mysql57 <span class=\"attribute\">--datadir</span>=/data/u001</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 修改/etc/init.d/mysqld57</span></span><br><span class=\"line\">parse_server_arguments `<span class=\"variable\">$print_defaults</span> -c /etc/my57.cnf mysqld<span class=\"built_in\"> server </span>mysql_server mysql.server`</span><br><span class=\"line\"><span class=\"variable\">$bindir</span>/mysqld_safe <span class=\"attribute\">--defaults-file</span>=/etc/my57.cnf <span class=\"attribute\">--pid-file</span>=<span class=\"string\">\"<span class=\"variable\">$mysqld_pid_file_path</span>\"</span> <span class=\"variable\">$other_args</span> &gt;/dev/<span class=\"literal\">null</span> &amp;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"报错统计\"><a href=\"#报错统计\" class=\"headerlink\" title=\"报错统计\"></a>报错统计</h3><ul>\n<li>ERROR 1840 (HY000) at line 24: @@GLOBAL.GTID_PURGED can only be set when @@GLOBAL.GTID_EXECUTED is empty.</li>\n</ul>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">执行<span class=\"keyword\">reset</span> <span class=\"keyword\">master</span>;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>The MySQL server is running with the–read-only option so it cannot execute this statement</li>\n</ul>\n<figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">执行 <span class=\"builtin-name\">set</span> global <span class=\"attribute\">read_only</span>=0;</span><br></pre></td></tr></table></figure>"},{"title":"docker简介和使用","copyright":true,"date":"2019-10-16T07:31:08.000Z","_content":"\n简单介绍docker \n\n<!-- more -->\n\n### docker\n","source":"_posts/15-docker简介和使用.md","raw":"---\ntitle: docker简介和使用\ncopyright: true\ndate: 2019-10-16 15:31:08\ntags:\n  - docker\ncategories:\n  - [docker]\n\n---\n\n简单介绍docker \n\n<!-- more -->\n\n### docker\n","slug":"15-docker简介和使用","published":1,"updated":"2019-10-16T09:15:27.839Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck28uwzmn0008kerw1k8gzeat","content":"<p>简单介绍docker </p>\n<a id=\"more\"></a>\n\n<h3 id=\"docker\"><a href=\"#docker\" class=\"headerlink\" title=\"docker\"></a>docker</h3>","site":{"data":{}},"length":17,"excerpt":"<p>简单介绍docker </p>","more":"<h3 id=\"docker\"><a href=\"#docker\" class=\"headerlink\" title=\"docker\"></a>docker</h3>"},{"title":"Dockerfile介绍","copyright":true,"date":"2019-10-16T07:33:17.000Z","_content":"\n\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width = \"100\" height = \"100\" style=\"border: 0\"/>\n<font  face=\"黑体\" size=5> Dockerfile </font>\n</center>\n\n<!-- more -->\n\n本文摘录于: [如何快速将容器云镜像大小精简98%？](https://mp.weixin.qq.com/s/LOXNMYtZbnYeDR2lBI56fw)\n\n\n### Dockerfile 文件有自己的书写格式和支持的命令，常用的Dockerfile 指令有：\n\n- FROM  指定基镜像。\n- MAINTAINER  设置镜像的作者信息，如作者姓名、邮箱等。\n- COPY  将文件从本地复制到镜像，拷贝前需要保证本地源文件存在。\n- ADD  与 COPY 类似，复制文件到镜像。不同的是，如果文件是归档文件（tar, zip, tgz, xz 等），会被自动解压。\n- ENV  设置环境变量，格式: ENV key=value或ENV key value，运行容器后，可直接在容器中使用。\n- EXPOSE  暴露容器中指定的端口，只是一个声明，主要用户了解应用监听的端口。\n- VOLUME  挂载卷到容器，需要注意的是，保存镜像时不会保存卷中的数据。\n- WORKDIR  设置当前工作目录，后续各层的当前目录都被指定。\n- RUN  在容器中运行指定的命令。\n- CMD  容器启动时运行的命令。Dockerfile 中可以有多个 CMD 指令，但只有最后一个生效。CMD 可以被 docker run 之后的参数替换。\n- ENTRYPOINT  设置容器启动时运行的命令。Dockerfile 中可以有多个 ENTRYPOINT 指令，但只有最后一个生效。CMD 或 docker run 之后的参数会被当做参数传递给 ENTRYPOINT，这个是与CMD的区别。\n\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width = \"100\" height = \"100\" style=\"border: 0\"/>\n<font  face=\"黑体\" size=5> 容器的原理 </font>\n</center>\n\n\n容器镜像中最重要的概念就是layers，即镜像层。\n\n> 容器的原理\n\n![容器的原理](/images/16/容器的原理-1.png)\n\n镜像层依赖于一系列的底层技术，比如文件系统(filesystems)、写时复制(copy-on-write)、联合挂载(union mounts)等技术\n查看Docker 官方文档[https://docs.docker.com/storage/storagedriver/](https://docs.docker.com/storage/storagedriver/)进行学习。\n\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width = \"100\" height = \"100\" style=\"border: 0\"/>\n<font  face=\"黑体\" size=5> 每条指令都创建一个镜像层，会增加镜像的大小 </font>\n</center>\n\n### 下面看个例子\n\n这里我有一个1.2M的镜像\n```\ndocker images|grep busybox\nbusybox                 latest              19485c79a9bb        5 weeks ago         1.22MB\n```\n\n我们基于busybox写一个Dockerfile来build\n```\n#cat Dockerfile\nfrom busybox:latest\n\nrun mkdir /tmp/dir \\\n    && dd if=/dev/zero of=/tmp/dir/file1 bs=1M count=10\n\nrun rm -f /tmp/dir/file1\n\n```\n\n执行build\n```\ndocker build -t busybox-test .\nSending build context to Docker daemon  2.048kB\nStep 1/3 : from busybox:latest\n ---> 19485c79a9bb\nStep 2/3 : run mkdir /tmp/dir     && dd if=/dev/zero of=/tmp/dir/file1 bs=1M count=10\n ---> Running in 0426f92c77ed\n10+0 records in\n10+0 records out\n10485760 bytes (10.0MB) copied, 0.003785 seconds, 2.6GB/s\nRemoving intermediate container 0426f92c77ed\n ---> 5ec75db090c9\nStep 3/3 : run rm -f /tmp/dir/file1\n ---> Running in 540e7d0a5aea\nRemoving intermediate container 540e7d0a5aea\n ---> 00041489cc0e\nSuccessfully built 00041489cc0e\nSuccessfully tagged busybox-test:latest\n```\n\n查看image大小\n```\ndocker images|grep busybox\nbusybox-test            latest              00041489cc0e        10 minutes ago      11.7MB\nbusybox                 latest              19485c79a9bb        5 weeks ago         1.22MB\n```\n\n??? 我不是rm删除了创建的/tmp/dir/file1 文件吗? 难道它还在? 来,我们测试一下\n```\n# 查看目录下是否有文件\ndocker run -ti busybox-test ls /tmp/dir\n```\n\n结果显然是空...\n\n喔,,, 因为\"在Dockerfile中，每条指令都会创建一个镜像层，继而会增加镜像整体的大小\", 在看我们写的Dockerfile,\n我们第一个run 执行的时候, 这里假装叫 (run1层), 我们生成了file1文件\n当执行第二个run的时候, 我们处在了 (run2层), (run1层)已经是父层,是个只读层了,只有当前层可写, 虽然我们在 (run2层)删除了这个文件,但删除的仅仅是份拷贝而已, 这就是写时复制.\n\n所以以上的优化应该是: 写成一条run\n```\n#cat Dockerfile\nfrom busybox:latest\n\nrun mkdir /tmp/dir \\\n    && dd if=/dev/zero of=/tmp/dir/file1 bs=1M count=10 \\\n    && rm -f /tmp/dir/file1\n\n# build\ndocker build -t busybox-test2 .\n```\n\n结果显然\n```\ndocker images|grep busybox\nbusybox-test2           latest              faf8b7d4f140        3 seconds ago       1.22MB\nbusybox-test            latest              00041489cc0e        10 minutes ago      11.7MB\nbusybox                 latest              19485c79a9bb        5 weeks ago         1.22MB\n```\n\n虽然说这里的测试没有干任何事情, 但我们在写Dockerfile的时候需要注意, 两个run之间是两个不同的 可写层!\n\n简单总结精简镜像大小的方法:\n```\n1 使用更小的基础镜像,注意一些很小的镜像可能缺少很多依赖库,例如查看redis依赖库 ldd /usr/bin/redis-cli\n2 合并Dockerfilec指令精简(可以的话写成一条run)\n```\n\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width = \"100\" height = \"100\" style=\"border: 0\"/>\n<font face=\"黑体\" size=5> 一些小的镜像 </font>\n</center>\n\n- 1 scratch: 一个空的镜像, 无法pull -.-!!! , 写在Dockerfile是可以的\n\n- 2 alpine: 5M的linux镜像,有包管理工具apk\n```\nFROM scratch\nADD alpine-minirootfs-3.10.2-x86_64.tar.gz /\nCMD [\"/bin/sh\"]\n```\n\n- 3 busybox: 1M多的镜像,称为嵌入式linux的瑞士军刀, Linux和unix一些常用的命令\n\n\n","source":"_posts/16-dockerfile介绍.md","raw":"---\ntitle: Dockerfile介绍\ncopyright: true\ndate: 2019-10-16 15:33:17\ntags:\n  - docker\ncategories:\n  - [docker,Dockerfile]\n---\n\n\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width = \"100\" height = \"100\" style=\"border: 0\"/>\n<font  face=\"黑体\" size=5> Dockerfile </font>\n</center>\n\n<!-- more -->\n\n本文摘录于: [如何快速将容器云镜像大小精简98%？](https://mp.weixin.qq.com/s/LOXNMYtZbnYeDR2lBI56fw)\n\n\n### Dockerfile 文件有自己的书写格式和支持的命令，常用的Dockerfile 指令有：\n\n- FROM  指定基镜像。\n- MAINTAINER  设置镜像的作者信息，如作者姓名、邮箱等。\n- COPY  将文件从本地复制到镜像，拷贝前需要保证本地源文件存在。\n- ADD  与 COPY 类似，复制文件到镜像。不同的是，如果文件是归档文件（tar, zip, tgz, xz 等），会被自动解压。\n- ENV  设置环境变量，格式: ENV key=value或ENV key value，运行容器后，可直接在容器中使用。\n- EXPOSE  暴露容器中指定的端口，只是一个声明，主要用户了解应用监听的端口。\n- VOLUME  挂载卷到容器，需要注意的是，保存镜像时不会保存卷中的数据。\n- WORKDIR  设置当前工作目录，后续各层的当前目录都被指定。\n- RUN  在容器中运行指定的命令。\n- CMD  容器启动时运行的命令。Dockerfile 中可以有多个 CMD 指令，但只有最后一个生效。CMD 可以被 docker run 之后的参数替换。\n- ENTRYPOINT  设置容器启动时运行的命令。Dockerfile 中可以有多个 ENTRYPOINT 指令，但只有最后一个生效。CMD 或 docker run 之后的参数会被当做参数传递给 ENTRYPOINT，这个是与CMD的区别。\n\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width = \"100\" height = \"100\" style=\"border: 0\"/>\n<font  face=\"黑体\" size=5> 容器的原理 </font>\n</center>\n\n\n容器镜像中最重要的概念就是layers，即镜像层。\n\n> 容器的原理\n\n![容器的原理](/images/16/容器的原理-1.png)\n\n镜像层依赖于一系列的底层技术，比如文件系统(filesystems)、写时复制(copy-on-write)、联合挂载(union mounts)等技术\n查看Docker 官方文档[https://docs.docker.com/storage/storagedriver/](https://docs.docker.com/storage/storagedriver/)进行学习。\n\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width = \"100\" height = \"100\" style=\"border: 0\"/>\n<font  face=\"黑体\" size=5> 每条指令都创建一个镜像层，会增加镜像的大小 </font>\n</center>\n\n### 下面看个例子\n\n这里我有一个1.2M的镜像\n```\ndocker images|grep busybox\nbusybox                 latest              19485c79a9bb        5 weeks ago         1.22MB\n```\n\n我们基于busybox写一个Dockerfile来build\n```\n#cat Dockerfile\nfrom busybox:latest\n\nrun mkdir /tmp/dir \\\n    && dd if=/dev/zero of=/tmp/dir/file1 bs=1M count=10\n\nrun rm -f /tmp/dir/file1\n\n```\n\n执行build\n```\ndocker build -t busybox-test .\nSending build context to Docker daemon  2.048kB\nStep 1/3 : from busybox:latest\n ---> 19485c79a9bb\nStep 2/3 : run mkdir /tmp/dir     && dd if=/dev/zero of=/tmp/dir/file1 bs=1M count=10\n ---> Running in 0426f92c77ed\n10+0 records in\n10+0 records out\n10485760 bytes (10.0MB) copied, 0.003785 seconds, 2.6GB/s\nRemoving intermediate container 0426f92c77ed\n ---> 5ec75db090c9\nStep 3/3 : run rm -f /tmp/dir/file1\n ---> Running in 540e7d0a5aea\nRemoving intermediate container 540e7d0a5aea\n ---> 00041489cc0e\nSuccessfully built 00041489cc0e\nSuccessfully tagged busybox-test:latest\n```\n\n查看image大小\n```\ndocker images|grep busybox\nbusybox-test            latest              00041489cc0e        10 minutes ago      11.7MB\nbusybox                 latest              19485c79a9bb        5 weeks ago         1.22MB\n```\n\n??? 我不是rm删除了创建的/tmp/dir/file1 文件吗? 难道它还在? 来,我们测试一下\n```\n# 查看目录下是否有文件\ndocker run -ti busybox-test ls /tmp/dir\n```\n\n结果显然是空...\n\n喔,,, 因为\"在Dockerfile中，每条指令都会创建一个镜像层，继而会增加镜像整体的大小\", 在看我们写的Dockerfile,\n我们第一个run 执行的时候, 这里假装叫 (run1层), 我们生成了file1文件\n当执行第二个run的时候, 我们处在了 (run2层), (run1层)已经是父层,是个只读层了,只有当前层可写, 虽然我们在 (run2层)删除了这个文件,但删除的仅仅是份拷贝而已, 这就是写时复制.\n\n所以以上的优化应该是: 写成一条run\n```\n#cat Dockerfile\nfrom busybox:latest\n\nrun mkdir /tmp/dir \\\n    && dd if=/dev/zero of=/tmp/dir/file1 bs=1M count=10 \\\n    && rm -f /tmp/dir/file1\n\n# build\ndocker build -t busybox-test2 .\n```\n\n结果显然\n```\ndocker images|grep busybox\nbusybox-test2           latest              faf8b7d4f140        3 seconds ago       1.22MB\nbusybox-test            latest              00041489cc0e        10 minutes ago      11.7MB\nbusybox                 latest              19485c79a9bb        5 weeks ago         1.22MB\n```\n\n虽然说这里的测试没有干任何事情, 但我们在写Dockerfile的时候需要注意, 两个run之间是两个不同的 可写层!\n\n简单总结精简镜像大小的方法:\n```\n1 使用更小的基础镜像,注意一些很小的镜像可能缺少很多依赖库,例如查看redis依赖库 ldd /usr/bin/redis-cli\n2 合并Dockerfilec指令精简(可以的话写成一条run)\n```\n\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width = \"100\" height = \"100\" style=\"border: 0\"/>\n<font face=\"黑体\" size=5> 一些小的镜像 </font>\n</center>\n\n- 1 scratch: 一个空的镜像, 无法pull -.-!!! , 写在Dockerfile是可以的\n\n- 2 alpine: 5M的linux镜像,有包管理工具apk\n```\nFROM scratch\nADD alpine-minirootfs-3.10.2-x86_64.tar.gz /\nCMD [\"/bin/sh\"]\n```\n\n- 3 busybox: 1M多的镜像,称为嵌入式linux的瑞士军刀, Linux和unix一些常用的命令\n\n\n","slug":"16-dockerfile介绍","published":1,"updated":"2019-10-16T10:20:17.143Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck28uwzmp000bkerwgnlcajc7","content":"<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width=\"100\" height=\"100\" style=\"border: 0\">\n<font face=\"黑体\" size=\"5\"> Dockerfile </font>\n</center>\n\n<a id=\"more\"></a>\n\n<p>本文摘录于: <a href=\"https://mp.weixin.qq.com/s/LOXNMYtZbnYeDR2lBI56fw\" target=\"_blank\" rel=\"noopener\">如何快速将容器云镜像大小精简98%？</a></p>\n<h3 id=\"Dockerfile-文件有自己的书写格式和支持的命令，常用的Dockerfile-指令有：\"><a href=\"#Dockerfile-文件有自己的书写格式和支持的命令，常用的Dockerfile-指令有：\" class=\"headerlink\" title=\"Dockerfile 文件有自己的书写格式和支持的命令，常用的Dockerfile 指令有：\"></a>Dockerfile 文件有自己的书写格式和支持的命令，常用的Dockerfile 指令有：</h3><ul>\n<li>FROM  指定基镜像。</li>\n<li>MAINTAINER  设置镜像的作者信息，如作者姓名、邮箱等。</li>\n<li>COPY  将文件从本地复制到镜像，拷贝前需要保证本地源文件存在。</li>\n<li>ADD  与 COPY 类似，复制文件到镜像。不同的是，如果文件是归档文件（tar, zip, tgz, xz 等），会被自动解压。</li>\n<li>ENV  设置环境变量，格式: ENV key=value或ENV key value，运行容器后，可直接在容器中使用。</li>\n<li>EXPOSE  暴露容器中指定的端口，只是一个声明，主要用户了解应用监听的端口。</li>\n<li>VOLUME  挂载卷到容器，需要注意的是，保存镜像时不会保存卷中的数据。</li>\n<li>WORKDIR  设置当前工作目录，后续各层的当前目录都被指定。</li>\n<li>RUN  在容器中运行指定的命令。</li>\n<li>CMD  容器启动时运行的命令。Dockerfile 中可以有多个 CMD 指令，但只有最后一个生效。CMD 可以被 docker run 之后的参数替换。</li>\n<li>ENTRYPOINT  设置容器启动时运行的命令。Dockerfile 中可以有多个 ENTRYPOINT 指令，但只有最后一个生效。CMD 或 docker run 之后的参数会被当做参数传递给 ENTRYPOINT，这个是与CMD的区别。</li>\n</ul>\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width=\"100\" height=\"100\" style=\"border: 0\">\n<font face=\"黑体\" size=\"5\"> 容器的原理 </font>\n</center>\n\n\n<p>容器镜像中最重要的概念就是layers，即镜像层。</p>\n<blockquote>\n<p>容器的原理</p>\n</blockquote>\n<p><img src=\"/images/16/%E5%AE%B9%E5%99%A8%E7%9A%84%E5%8E%9F%E7%90%86-1.png\" alt=\"容器的原理\"></p>\n<p>镜像层依赖于一系列的底层技术，比如文件系统(filesystems)、写时复制(copy-on-write)、联合挂载(union mounts)等技术<br>查看Docker 官方文档<a href=\"https://docs.docker.com/storage/storagedriver/\" target=\"_blank\" rel=\"noopener\">https://docs.docker.com/storage/storagedriver/</a>进行学习。</p>\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width=\"100\" height=\"100\" style=\"border: 0\">\n<font face=\"黑体\" size=\"5\"> 每条指令都创建一个镜像层，会增加镜像的大小 </font>\n</center>\n\n<h3 id=\"下面看个例子\"><a href=\"#下面看个例子\" class=\"headerlink\" title=\"下面看个例子\"></a>下面看个例子</h3><p>这里我有一个1.2M的镜像</p>\n<figure class=\"highlight lsl\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker images|grep busybox</span><br><span class=\"line\">busybox                 latest              <span class=\"number\">19485</span>c79a9bb        <span class=\"number\">5</span> weeks ago         <span class=\"number\">1.22</span>MB</span><br></pre></td></tr></table></figure>\n\n<p>我们基于busybox写一个Dockerfile来build</p>\n<figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#cat Dockerfile</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> busybox:latest</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"builtin-name\">run</span> mkdir /tmp/dir \\</span><br><span class=\"line\">    &amp;&amp; dd <span class=\"attribute\">if</span>=/dev/zero <span class=\"attribute\">of</span>=/tmp/dir/file1 <span class=\"attribute\">bs</span>=1M <span class=\"attribute\">count</span>=10</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"builtin-name\">run</span> rm -f /tmp/dir/file1</span><br></pre></td></tr></table></figure>\n\n<p>执行build</p>\n<figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker build -t busybox-test .</span><br><span class=\"line\">Sending build context <span class=\"keyword\">to</span> Docker daemon  2.048kB</span><br><span class=\"line\"><span class=\"keyword\">Step</span> 1/3 : <span class=\"keyword\">from</span> busybox:latest</span><br><span class=\"line\"> ---&gt; 19485c79a9bb</span><br><span class=\"line\"><span class=\"keyword\">Step</span> 2/3 : <span class=\"builtin-name\">run</span> mkdir /tmp/dir     &amp;&amp; dd <span class=\"attribute\">if</span>=/dev/zero <span class=\"attribute\">of</span>=/tmp/dir/file1 <span class=\"attribute\">bs</span>=1M <span class=\"attribute\">count</span>=10</span><br><span class=\"line\"> ---&gt; Running <span class=\"keyword\">in</span> 0426f92c77ed</span><br><span class=\"line\">10+0 records <span class=\"keyword\">in</span></span><br><span class=\"line\">10+0 records out</span><br><span class=\"line\">10485760 bytes (10.0MB) copied, 0.003785 seconds, 2.6GB/s</span><br><span class=\"line\">Removing intermediate container 0426f92c77ed</span><br><span class=\"line\"> ---&gt; 5ec75db090c9</span><br><span class=\"line\"><span class=\"keyword\">Step</span> 3/3 : <span class=\"builtin-name\">run</span> rm -f /tmp/dir/file1</span><br><span class=\"line\"> ---&gt; Running <span class=\"keyword\">in</span> 540e7d0a5aea</span><br><span class=\"line\">Removing intermediate container 540e7d0a5aea</span><br><span class=\"line\"> ---&gt; 00041489cc0e</span><br><span class=\"line\">Successfully built 00041489cc0e</span><br><span class=\"line\">Successfully tagged busybox-test:latest</span><br></pre></td></tr></table></figure>\n\n<p>查看image大小</p>\n<figure class=\"highlight lsl\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker images|grep busybox</span><br><span class=\"line\">busybox-test            latest              <span class=\"number\">00041489</span>cc0e        <span class=\"number\">10</span> minutes ago      <span class=\"number\">11.7</span>MB</span><br><span class=\"line\">busybox                 latest              <span class=\"number\">19485</span>c79a9bb        <span class=\"number\">5</span> weeks ago         <span class=\"number\">1.22</span>MB</span><br></pre></td></tr></table></figure>\n\n<p>??? 我不是rm删除了创建的/tmp/dir/file1 文件吗? 难道它还在? 来,我们测试一下</p>\n<figure class=\"highlight stata\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 查看目录下是否有文件</span><br><span class=\"line\">docker <span class=\"keyword\">run</span> -ti busybox-<span class=\"keyword\">test</span> <span class=\"keyword\">ls</span> /tmp/<span class=\"keyword\">dir</span></span><br></pre></td></tr></table></figure>\n\n<p>结果显然是空…</p>\n<p>喔,,, 因为”在Dockerfile中，每条指令都会创建一个镜像层，继而会增加镜像整体的大小”, 在看我们写的Dockerfile,<br>我们第一个run 执行的时候, 这里假装叫 (run1层), 我们生成了file1文件<br>当执行第二个run的时候, 我们处在了 (run2层), (run1层)已经是父层,是个只读层了,只有当前层可写, 虽然我们在 (run2层)删除了这个文件,但删除的仅仅是份拷贝而已, 这就是写时复制.</p>\n<p>所以以上的优化应该是: 写成一条run</p>\n<figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#cat Dockerfile</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> busybox:latest</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"builtin-name\">run</span> mkdir /tmp/dir \\</span><br><span class=\"line\">    &amp;&amp; dd <span class=\"attribute\">if</span>=/dev/zero <span class=\"attribute\">of</span>=/tmp/dir/file1 <span class=\"attribute\">bs</span>=1M <span class=\"attribute\">count</span>=10 \\</span><br><span class=\"line\">    &amp;&amp; rm -f /tmp/dir/file1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># build</span></span><br><span class=\"line\">docker build -t busybox-test2 .</span><br></pre></td></tr></table></figure>\n\n<p>结果显然</p>\n<figure class=\"highlight lsl\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker images|grep busybox</span><br><span class=\"line\">busybox-test2           latest              faf8b7d4f140        <span class=\"number\">3</span> seconds ago       <span class=\"number\">1.22</span>MB</span><br><span class=\"line\">busybox-test            latest              <span class=\"number\">00041489</span>cc0e        <span class=\"number\">10</span> minutes ago      <span class=\"number\">11.7</span>MB</span><br><span class=\"line\">busybox                 latest              <span class=\"number\">19485</span>c79a9bb        <span class=\"number\">5</span> weeks ago         <span class=\"number\">1.22</span>MB</span><br></pre></td></tr></table></figure>\n\n<p>虽然说这里的测试没有干任何事情, 但我们在写Dockerfile的时候需要注意, 两个run之间是两个不同的 可写层!</p>\n<p>简单总结精简镜像大小的方法:</p>\n<figure class=\"highlight basic\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"symbol\">1 </span>使用更小的基础镜像,注意一些很小的镜像可能缺少很多依赖库,例如查看redis依赖库 ldd /<span class=\"keyword\">usr</span>/bin/redis-cli</span><br><span class=\"line\"><span class=\"symbol\">2 </span>合并Dockerfilec指令精简(可以的话写成一条<span class=\"keyword\">run</span>)</span><br></pre></td></tr></table></figure>\n\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width=\"100\" height=\"100\" style=\"border: 0\">\n<font face=\"黑体\" size=\"5\"> 一些小的镜像 </font>\n</center>\n\n<ul>\n<li><p>1 scratch: 一个空的镜像, 无法pull -.-!!! , 写在Dockerfile是可以的</p>\n</li>\n<li><p>2 alpine: 5M的linux镜像,有包管理工具apk</p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">FROM</span> scratch</span><br><span class=\"line\"><span class=\"keyword\">ADD</span><span class=\"bash\"> alpine-minirootfs-3.10.2-x86_64.tar.gz /</span></span><br><span class=\"line\"><span class=\"keyword\">CMD</span><span class=\"bash\"> [<span class=\"string\">\"/bin/sh\"</span>]</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>3 busybox: 1M多的镜像,称为嵌入式linux的瑞士军刀, Linux和unix一些常用的命令</p>\n</li>\n</ul>\n","site":{"data":{}},"length":3217,"excerpt":"<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width=\"100\" height=\"100\" style=\"border: 0\">\n<font face=\"黑体\" size=\"5\"> Dockerfile </font>\n</center>","more":"<p>本文摘录于: <a href=\"https://mp.weixin.qq.com/s/LOXNMYtZbnYeDR2lBI56fw\" target=\"_blank\" rel=\"noopener\">如何快速将容器云镜像大小精简98%？</a></p>\n<h3 id=\"Dockerfile-文件有自己的书写格式和支持的命令，常用的Dockerfile-指令有：\"><a href=\"#Dockerfile-文件有自己的书写格式和支持的命令，常用的Dockerfile-指令有：\" class=\"headerlink\" title=\"Dockerfile 文件有自己的书写格式和支持的命令，常用的Dockerfile 指令有：\"></a>Dockerfile 文件有自己的书写格式和支持的命令，常用的Dockerfile 指令有：</h3><ul>\n<li>FROM  指定基镜像。</li>\n<li>MAINTAINER  设置镜像的作者信息，如作者姓名、邮箱等。</li>\n<li>COPY  将文件从本地复制到镜像，拷贝前需要保证本地源文件存在。</li>\n<li>ADD  与 COPY 类似，复制文件到镜像。不同的是，如果文件是归档文件（tar, zip, tgz, xz 等），会被自动解压。</li>\n<li>ENV  设置环境变量，格式: ENV key=value或ENV key value，运行容器后，可直接在容器中使用。</li>\n<li>EXPOSE  暴露容器中指定的端口，只是一个声明，主要用户了解应用监听的端口。</li>\n<li>VOLUME  挂载卷到容器，需要注意的是，保存镜像时不会保存卷中的数据。</li>\n<li>WORKDIR  设置当前工作目录，后续各层的当前目录都被指定。</li>\n<li>RUN  在容器中运行指定的命令。</li>\n<li>CMD  容器启动时运行的命令。Dockerfile 中可以有多个 CMD 指令，但只有最后一个生效。CMD 可以被 docker run 之后的参数替换。</li>\n<li>ENTRYPOINT  设置容器启动时运行的命令。Dockerfile 中可以有多个 ENTRYPOINT 指令，但只有最后一个生效。CMD 或 docker run 之后的参数会被当做参数传递给 ENTRYPOINT，这个是与CMD的区别。</li>\n</ul>\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width=\"100\" height=\"100\" style=\"border: 0\">\n<font face=\"黑体\" size=\"5\"> 容器的原理 </font>\n</center>\n\n\n<p>容器镜像中最重要的概念就是layers，即镜像层。</p>\n<blockquote>\n<p>容器的原理</p>\n</blockquote>\n<p><img src=\"/images/16/%E5%AE%B9%E5%99%A8%E7%9A%84%E5%8E%9F%E7%90%86-1.png\" alt=\"容器的原理\"></p>\n<p>镜像层依赖于一系列的底层技术，比如文件系统(filesystems)、写时复制(copy-on-write)、联合挂载(union mounts)等技术<br>查看Docker 官方文档<a href=\"https://docs.docker.com/storage/storagedriver/\" target=\"_blank\" rel=\"noopener\">https://docs.docker.com/storage/storagedriver/</a>进行学习。</p>\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width=\"100\" height=\"100\" style=\"border: 0\">\n<font face=\"黑体\" size=\"5\"> 每条指令都创建一个镜像层，会增加镜像的大小 </font>\n</center>\n\n<h3 id=\"下面看个例子\"><a href=\"#下面看个例子\" class=\"headerlink\" title=\"下面看个例子\"></a>下面看个例子</h3><p>这里我有一个1.2M的镜像</p>\n<figure class=\"highlight lsl\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker images|grep busybox</span><br><span class=\"line\">busybox                 latest              <span class=\"number\">19485</span>c79a9bb        <span class=\"number\">5</span> weeks ago         <span class=\"number\">1.22</span>MB</span><br></pre></td></tr></table></figure>\n\n<p>我们基于busybox写一个Dockerfile来build</p>\n<figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#cat Dockerfile</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> busybox:latest</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"builtin-name\">run</span> mkdir /tmp/dir \\</span><br><span class=\"line\">    &amp;&amp; dd <span class=\"attribute\">if</span>=/dev/zero <span class=\"attribute\">of</span>=/tmp/dir/file1 <span class=\"attribute\">bs</span>=1M <span class=\"attribute\">count</span>=10</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"builtin-name\">run</span> rm -f /tmp/dir/file1</span><br></pre></td></tr></table></figure>\n\n<p>执行build</p>\n<figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker build -t busybox-test .</span><br><span class=\"line\">Sending build context <span class=\"keyword\">to</span> Docker daemon  2.048kB</span><br><span class=\"line\"><span class=\"keyword\">Step</span> 1/3 : <span class=\"keyword\">from</span> busybox:latest</span><br><span class=\"line\"> ---&gt; 19485c79a9bb</span><br><span class=\"line\"><span class=\"keyword\">Step</span> 2/3 : <span class=\"builtin-name\">run</span> mkdir /tmp/dir     &amp;&amp; dd <span class=\"attribute\">if</span>=/dev/zero <span class=\"attribute\">of</span>=/tmp/dir/file1 <span class=\"attribute\">bs</span>=1M <span class=\"attribute\">count</span>=10</span><br><span class=\"line\"> ---&gt; Running <span class=\"keyword\">in</span> 0426f92c77ed</span><br><span class=\"line\">10+0 records <span class=\"keyword\">in</span></span><br><span class=\"line\">10+0 records out</span><br><span class=\"line\">10485760 bytes (10.0MB) copied, 0.003785 seconds, 2.6GB/s</span><br><span class=\"line\">Removing intermediate container 0426f92c77ed</span><br><span class=\"line\"> ---&gt; 5ec75db090c9</span><br><span class=\"line\"><span class=\"keyword\">Step</span> 3/3 : <span class=\"builtin-name\">run</span> rm -f /tmp/dir/file1</span><br><span class=\"line\"> ---&gt; Running <span class=\"keyword\">in</span> 540e7d0a5aea</span><br><span class=\"line\">Removing intermediate container 540e7d0a5aea</span><br><span class=\"line\"> ---&gt; 00041489cc0e</span><br><span class=\"line\">Successfully built 00041489cc0e</span><br><span class=\"line\">Successfully tagged busybox-test:latest</span><br></pre></td></tr></table></figure>\n\n<p>查看image大小</p>\n<figure class=\"highlight lsl\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker images|grep busybox</span><br><span class=\"line\">busybox-test            latest              <span class=\"number\">00041489</span>cc0e        <span class=\"number\">10</span> minutes ago      <span class=\"number\">11.7</span>MB</span><br><span class=\"line\">busybox                 latest              <span class=\"number\">19485</span>c79a9bb        <span class=\"number\">5</span> weeks ago         <span class=\"number\">1.22</span>MB</span><br></pre></td></tr></table></figure>\n\n<p>??? 我不是rm删除了创建的/tmp/dir/file1 文件吗? 难道它还在? 来,我们测试一下</p>\n<figure class=\"highlight stata\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 查看目录下是否有文件</span><br><span class=\"line\">docker <span class=\"keyword\">run</span> -ti busybox-<span class=\"keyword\">test</span> <span class=\"keyword\">ls</span> /tmp/<span class=\"keyword\">dir</span></span><br></pre></td></tr></table></figure>\n\n<p>结果显然是空…</p>\n<p>喔,,, 因为”在Dockerfile中，每条指令都会创建一个镜像层，继而会增加镜像整体的大小”, 在看我们写的Dockerfile,<br>我们第一个run 执行的时候, 这里假装叫 (run1层), 我们生成了file1文件<br>当执行第二个run的时候, 我们处在了 (run2层), (run1层)已经是父层,是个只读层了,只有当前层可写, 虽然我们在 (run2层)删除了这个文件,但删除的仅仅是份拷贝而已, 这就是写时复制.</p>\n<p>所以以上的优化应该是: 写成一条run</p>\n<figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#cat Dockerfile</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> busybox:latest</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"builtin-name\">run</span> mkdir /tmp/dir \\</span><br><span class=\"line\">    &amp;&amp; dd <span class=\"attribute\">if</span>=/dev/zero <span class=\"attribute\">of</span>=/tmp/dir/file1 <span class=\"attribute\">bs</span>=1M <span class=\"attribute\">count</span>=10 \\</span><br><span class=\"line\">    &amp;&amp; rm -f /tmp/dir/file1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># build</span></span><br><span class=\"line\">docker build -t busybox-test2 .</span><br></pre></td></tr></table></figure>\n\n<p>结果显然</p>\n<figure class=\"highlight lsl\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker images|grep busybox</span><br><span class=\"line\">busybox-test2           latest              faf8b7d4f140        <span class=\"number\">3</span> seconds ago       <span class=\"number\">1.22</span>MB</span><br><span class=\"line\">busybox-test            latest              <span class=\"number\">00041489</span>cc0e        <span class=\"number\">10</span> minutes ago      <span class=\"number\">11.7</span>MB</span><br><span class=\"line\">busybox                 latest              <span class=\"number\">19485</span>c79a9bb        <span class=\"number\">5</span> weeks ago         <span class=\"number\">1.22</span>MB</span><br></pre></td></tr></table></figure>\n\n<p>虽然说这里的测试没有干任何事情, 但我们在写Dockerfile的时候需要注意, 两个run之间是两个不同的 可写层!</p>\n<p>简单总结精简镜像大小的方法:</p>\n<figure class=\"highlight basic\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"symbol\">1 </span>使用更小的基础镜像,注意一些很小的镜像可能缺少很多依赖库,例如查看redis依赖库 ldd /<span class=\"keyword\">usr</span>/bin/redis-cli</span><br><span class=\"line\"><span class=\"symbol\">2 </span>合并Dockerfilec指令精简(可以的话写成一条<span class=\"keyword\">run</span>)</span><br></pre></td></tr></table></figure>\n\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width=\"100\" height=\"100\" style=\"border: 0\">\n<font face=\"黑体\" size=\"5\"> 一些小的镜像 </font>\n</center>\n\n<ul>\n<li><p>1 scratch: 一个空的镜像, 无法pull -.-!!! , 写在Dockerfile是可以的</p>\n</li>\n<li><p>2 alpine: 5M的linux镜像,有包管理工具apk</p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">FROM</span> scratch</span><br><span class=\"line\"><span class=\"keyword\">ADD</span><span class=\"bash\"> alpine-minirootfs-3.10.2-x86_64.tar.gz /</span></span><br><span class=\"line\"><span class=\"keyword\">CMD</span><span class=\"bash\"> [<span class=\"string\">\"/bin/sh\"</span>]</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>3 busybox: 1M多的镜像,称为嵌入式linux的瑞士军刀, Linux和unix一些常用的命令</p>\n</li>\n</ul>"},{"title":"markdown一些写法记录","copyright":true,"date":"2019-10-16T07:56:27.000Z","_content":"\n记录一些需要注意的写法,markdown 是支持html语法的\n<!--more-->\n\n### 这里想写一个居中的标题和图片\n\n```\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width = \"100\" height = \"100\" style=\"border: 0\"/>\n<font color=\"blue\" face=\"黑体\" size=5> Dockerfile </font>\n</center>\n```\n[效果点击查看](https://zhangzw001.github.io/2019/10/16/16-dockerfile介绍/)\n\n","source":"_posts/17-markdown一些写法记录.md","raw":"---\ntitle: markdown一些写法记录\ncopyright: true\ndate: 2019-10-16 15:56:27\ntags:\n  - markdown\ncategories:\n  - [markdown]\n---\n\n记录一些需要注意的写法,markdown 是支持html语法的\n<!--more-->\n\n### 这里想写一个居中的标题和图片\n\n```\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width = \"100\" height = \"100\" style=\"border: 0\"/>\n<font color=\"blue\" face=\"黑体\" size=5> Dockerfile </font>\n</center>\n```\n[效果点击查看](https://zhangzw001.github.io/2019/10/16/16-dockerfile介绍/)\n\n","slug":"17-markdown一些写法记录","published":1,"updated":"2019-10-16T09:58:06.956Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck28uwzmr000ckerwotj6yy7l","content":"<p>记录一些需要注意的写法,markdown 是支持html语法的</p>\n<a id=\"more\"></a>\n\n<h3 id=\"这里想写一个居中的标题和图片\"><a href=\"#这里想写一个居中的标题和图片\" class=\"headerlink\" title=\"这里想写一个居中的标题和图片\"></a>这里想写一个居中的标题和图片</h3><figure class=\"highlight maxima\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;<span class=\"built_in\">center</span>&gt;</span><br><span class=\"line\">&lt;img src=<span class=\"string\">\"http://zhangzw001.github.io/images/dockerniu.jpeg\"</span> <span class=\"built_in\">width</span> = <span class=\"string\">\"100\"</span> <span class=\"built_in\">height</span> = <span class=\"string\">\"100\"</span> <span class=\"built_in\">style</span>=<span class=\"string\">\"border: 0\"</span>/&gt;</span><br><span class=\"line\">&lt;<span class=\"built_in\">font</span> <span class=\"built_in\">color</span>=<span class=\"string\">\"blue\"</span> face=<span class=\"string\">\"黑体\"</span> size=<span class=\"number\">5</span>&gt; Dockerfile &lt;/<span class=\"built_in\">font</span>&gt;</span><br><span class=\"line\">&lt;/<span class=\"built_in\">center</span>&gt;</span><br></pre></td></tr></table></figure>\n\n<p><a href=\"https://zhangzw001.github.io/2019/10/16/16-dockerfile介绍/\">效果点击查看</a></p>\n","site":{"data":{}},"length":266,"excerpt":"<p>记录一些需要注意的写法,markdown 是支持html语法的</p>","more":"<h3 id=\"这里想写一个居中的标题和图片\"><a href=\"#这里想写一个居中的标题和图片\" class=\"headerlink\" title=\"这里想写一个居中的标题和图片\"></a>这里想写一个居中的标题和图片</h3><figure class=\"highlight maxima\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;<span class=\"built_in\">center</span>&gt;</span><br><span class=\"line\">&lt;img src=<span class=\"string\">\"http://zhangzw001.github.io/images/dockerniu.jpeg\"</span> <span class=\"built_in\">width</span> = <span class=\"string\">\"100\"</span> <span class=\"built_in\">height</span> = <span class=\"string\">\"100\"</span> <span class=\"built_in\">style</span>=<span class=\"string\">\"border: 0\"</span>/&gt;</span><br><span class=\"line\">&lt;<span class=\"built_in\">font</span> <span class=\"built_in\">color</span>=<span class=\"string\">\"blue\"</span> face=<span class=\"string\">\"黑体\"</span> size=<span class=\"number\">5</span>&gt; Dockerfile &lt;/<span class=\"built_in\">font</span>&gt;</span><br><span class=\"line\">&lt;/<span class=\"built_in\">center</span>&gt;</span><br></pre></td></tr></table></figure>\n\n<p><a href=\"https://zhangzw001.github.io/2019/10/16/16-dockerfile介绍/\">效果点击查看</a></p>"},{"title":"云原生博客汇总","copyright":true,"date":"2019-10-12T08:35:21.000Z","_content":"\n记录一些云原生技术博客\n<!--more-->\n\n### 来自ServiceMesher[8] 群\n\n[KaiRen's Blog](https://k2r2bai.com/)\n\n[Zlatan Eevee](https://ieevee.com/)\n\n[国南之境](https://hansedong.github.io/)\n\n[博客 | 高策](http://gaocegege.com/Blog/)\n\n[Kakashi's Blog](https://kkc.github.io/)\n\n[Alex Wu's blog | THINK BIG, START SMALL, DELIVER VALUE TO THE BUSINESS](https://blog.yaodataking.com/)\n\n[开元DevOps知识库 - 知识管理，时间管理，自我管理](https://nicksors.cc/)\n\n[起风了](https://xuchao918.github.io/)\n\n[茶歇驿站 \\- Gopher, OpenSource Fans, 成长之路有我相伴。](https://maiyang.me/)\n\n[Polar Snow Documentation](https://docs.lvrui.io/)\n\n[云原生实验室 \\- 米开朗基杨的博客](https://www.yangcs.net/)\n\n[Jimmy Song - 宋净超的博客|Cloud Native|云原生布道师](https://jimmysong.io/)\n\n[漠然的博客 | mritd Blog](https://mritd.me/)\n\n[DevOps – 成长之路](http://www.rhca.me/)\n\n[birdben](https://birdben.github.io/)\n\n[浮生若梦](https://fs.tn/)\n\n[CNCF Cloud Native Interactive Landscape](https://landscape.cncf.io/)\n\n[杜屹东的博客 | 学无止境](https://www.duyidong.com/)\n\n[梦旭随想](https://blog.ihypo.net/index.html)\n\n[ictfox blog](http://www.yangguanjun.com/)\n\n[CloudNative 架构](http://team.jiunile.com/)\n\n[我爱西红柿](https://www.bladewan.com/)\n\n[Doublemine](https://notes.doublemine.me/)\n\n[Bingo Huang](https://bingohuang.com/)\n\n[Arthur Chunqi Li's Blog](http://chunqi.li/)\n\n[Archive | Arthur Chunqi Li's Blog](http://chunqi.li/archives/)\n\n[IT技术工作学习折腾笔记 李佶澳的博客](https://www.lijiaocn.com/)\n\n[墨荷琼林官网-编程日志](http://moheqionglin.com/site/blogs/1/list.html)\n\n[Archive - Nolla](https://cmgs.me/archive)\n\n[Tomoya's Blog](https://tomoyadeng.github.io/blog/)\n\n[君无止境](https://youendless.com/)\n\n[Jamin Zhang](https://jaminzhang.github.io/)\n\n[roc - imroc.io|roc的博客|Cloud Native|Kubernetes|Go|Golang](https://imroc.io/)\n\n[Blog | Sysdig](https://sysdig.com/blog/)\n\n[sleele的博客](https://sleele.com/)\n\n[TauCeti blog · TauCeti blog](https://www.tauceti.blog/)\n\n[水晶命匣 | 生命在于折腾，折腾万岁！](http://ghoulich.xninja.org/)\n\n[苏洋博客](https://soulteary.com/)\n\n[LinuxTOY](https://linuxtoy.org/)\n\n[Infvie's Blog | 运维SRE社区博客](https://www.infvie.com/)\n\n[Solar](https://zhangchenchen.github.io/)\n\n[MoeLove](https://moelove.info/)\n\n[Hwchiu Learning Notekubernetes/SDN/DevOps](https://www.hwchiu.com/)\n\n[存储领域 yangguanjun](http://www.yangguanjun.com)\n","source":"_posts/13-云原生博客汇总.md","raw":"---\ntitle: 云原生博客汇总\ncopyright: true\ndate: 2019-10-12 16:35:21\ntags:\n  - 云原生\n  - cloud native\n  - 大佬博客\ncategories:\n  - [技术文档]\n  - [网址,大佬博客]\n---\n\n记录一些云原生技术博客\n<!--more-->\n\n### 来自ServiceMesher[8] 群\n\n[KaiRen's Blog](https://k2r2bai.com/)\n\n[Zlatan Eevee](https://ieevee.com/)\n\n[国南之境](https://hansedong.github.io/)\n\n[博客 | 高策](http://gaocegege.com/Blog/)\n\n[Kakashi's Blog](https://kkc.github.io/)\n\n[Alex Wu's blog | THINK BIG, START SMALL, DELIVER VALUE TO THE BUSINESS](https://blog.yaodataking.com/)\n\n[开元DevOps知识库 - 知识管理，时间管理，自我管理](https://nicksors.cc/)\n\n[起风了](https://xuchao918.github.io/)\n\n[茶歇驿站 \\- Gopher, OpenSource Fans, 成长之路有我相伴。](https://maiyang.me/)\n\n[Polar Snow Documentation](https://docs.lvrui.io/)\n\n[云原生实验室 \\- 米开朗基杨的博客](https://www.yangcs.net/)\n\n[Jimmy Song - 宋净超的博客|Cloud Native|云原生布道师](https://jimmysong.io/)\n\n[漠然的博客 | mritd Blog](https://mritd.me/)\n\n[DevOps – 成长之路](http://www.rhca.me/)\n\n[birdben](https://birdben.github.io/)\n\n[浮生若梦](https://fs.tn/)\n\n[CNCF Cloud Native Interactive Landscape](https://landscape.cncf.io/)\n\n[杜屹东的博客 | 学无止境](https://www.duyidong.com/)\n\n[梦旭随想](https://blog.ihypo.net/index.html)\n\n[ictfox blog](http://www.yangguanjun.com/)\n\n[CloudNative 架构](http://team.jiunile.com/)\n\n[我爱西红柿](https://www.bladewan.com/)\n\n[Doublemine](https://notes.doublemine.me/)\n\n[Bingo Huang](https://bingohuang.com/)\n\n[Arthur Chunqi Li's Blog](http://chunqi.li/)\n\n[Archive | Arthur Chunqi Li's Blog](http://chunqi.li/archives/)\n\n[IT技术工作学习折腾笔记 李佶澳的博客](https://www.lijiaocn.com/)\n\n[墨荷琼林官网-编程日志](http://moheqionglin.com/site/blogs/1/list.html)\n\n[Archive - Nolla](https://cmgs.me/archive)\n\n[Tomoya's Blog](https://tomoyadeng.github.io/blog/)\n\n[君无止境](https://youendless.com/)\n\n[Jamin Zhang](https://jaminzhang.github.io/)\n\n[roc - imroc.io|roc的博客|Cloud Native|Kubernetes|Go|Golang](https://imroc.io/)\n\n[Blog | Sysdig](https://sysdig.com/blog/)\n\n[sleele的博客](https://sleele.com/)\n\n[TauCeti blog · TauCeti blog](https://www.tauceti.blog/)\n\n[水晶命匣 | 生命在于折腾，折腾万岁！](http://ghoulich.xninja.org/)\n\n[苏洋博客](https://soulteary.com/)\n\n[LinuxTOY](https://linuxtoy.org/)\n\n[Infvie's Blog | 运维SRE社区博客](https://www.infvie.com/)\n\n[Solar](https://zhangchenchen.github.io/)\n\n[MoeLove](https://moelove.info/)\n\n[Hwchiu Learning Notekubernetes/SDN/DevOps](https://www.hwchiu.com/)\n\n[存储领域 yangguanjun](http://www.yangguanjun.com)\n","slug":"13-云原生博客汇总","published":1,"updated":"2019-10-17T03:28:05.602Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck28uwzmu000fkerwhyqi6cku","content":"<p>记录一些云原生技术博客</p>\n<a id=\"more\"></a>\n\n<h3 id=\"来自ServiceMesher-8-群\"><a href=\"#来自ServiceMesher-8-群\" class=\"headerlink\" title=\"来自ServiceMesher[8] 群\"></a>来自ServiceMesher[8] 群</h3><p><a href=\"https://k2r2bai.com/\" target=\"_blank\" rel=\"noopener\">KaiRen’s Blog</a></p>\n<p><a href=\"https://ieevee.com/\" target=\"_blank\" rel=\"noopener\">Zlatan Eevee</a></p>\n<p><a href=\"https://hansedong.github.io/\" target=\"_blank\" rel=\"noopener\">国南之境</a></p>\n<p><a href=\"http://gaocegege.com/Blog/\" target=\"_blank\" rel=\"noopener\">博客 | 高策</a></p>\n<p><a href=\"https://kkc.github.io/\" target=\"_blank\" rel=\"noopener\">Kakashi’s Blog</a></p>\n<p><a href=\"https://blog.yaodataking.com/\" target=\"_blank\" rel=\"noopener\">Alex Wu’s blog | THINK BIG, START SMALL, DELIVER VALUE TO THE BUSINESS</a></p>\n<p><a href=\"https://nicksors.cc/\" target=\"_blank\" rel=\"noopener\">开元DevOps知识库 - 知识管理，时间管理，自我管理</a></p>\n<p><a href=\"https://xuchao918.github.io/\" target=\"_blank\" rel=\"noopener\">起风了</a></p>\n<p><a href=\"https://maiyang.me/\" target=\"_blank\" rel=\"noopener\">茶歇驿站 - Gopher, OpenSource Fans, 成长之路有我相伴。</a></p>\n<p><a href=\"https://docs.lvrui.io/\" target=\"_blank\" rel=\"noopener\">Polar Snow Documentation</a></p>\n<p><a href=\"https://www.yangcs.net/\" target=\"_blank\" rel=\"noopener\">云原生实验室 - 米开朗基杨的博客</a></p>\n<p><a href=\"https://jimmysong.io/\" target=\"_blank\" rel=\"noopener\">Jimmy Song - 宋净超的博客|Cloud Native|云原生布道师</a></p>\n<p><a href=\"https://mritd.me/\" target=\"_blank\" rel=\"noopener\">漠然的博客 | mritd Blog</a></p>\n<p><a href=\"http://www.rhca.me/\" target=\"_blank\" rel=\"noopener\">DevOps – 成长之路</a></p>\n<p><a href=\"https://birdben.github.io/\" target=\"_blank\" rel=\"noopener\">birdben</a></p>\n<p><a href=\"https://fs.tn/\" target=\"_blank\" rel=\"noopener\">浮生若梦</a></p>\n<p><a href=\"https://landscape.cncf.io/\" target=\"_blank\" rel=\"noopener\">CNCF Cloud Native Interactive Landscape</a></p>\n<p><a href=\"https://www.duyidong.com/\" target=\"_blank\" rel=\"noopener\">杜屹东的博客 | 学无止境</a></p>\n<p><a href=\"https://blog.ihypo.net/index.html\" target=\"_blank\" rel=\"noopener\">梦旭随想</a></p>\n<p><a href=\"http://www.yangguanjun.com/\" target=\"_blank\" rel=\"noopener\">ictfox blog</a></p>\n<p><a href=\"http://team.jiunile.com/\" target=\"_blank\" rel=\"noopener\">CloudNative 架构</a></p>\n<p><a href=\"https://www.bladewan.com/\" target=\"_blank\" rel=\"noopener\">我爱西红柿</a></p>\n<p><a href=\"https://notes.doublemine.me/\" target=\"_blank\" rel=\"noopener\">Doublemine</a></p>\n<p><a href=\"https://bingohuang.com/\" target=\"_blank\" rel=\"noopener\">Bingo Huang</a></p>\n<p><a href=\"http://chunqi.li/\" target=\"_blank\" rel=\"noopener\">Arthur Chunqi Li’s Blog</a></p>\n<p><a href=\"http://chunqi.li/archives/\" target=\"_blank\" rel=\"noopener\">Archive | Arthur Chunqi Li’s Blog</a></p>\n<p><a href=\"https://www.lijiaocn.com/\" target=\"_blank\" rel=\"noopener\">IT技术工作学习折腾笔记 李佶澳的博客</a></p>\n<p><a href=\"http://moheqionglin.com/site/blogs/1/list.html\" target=\"_blank\" rel=\"noopener\">墨荷琼林官网-编程日志</a></p>\n<p><a href=\"https://cmgs.me/archive\" target=\"_blank\" rel=\"noopener\">Archive - Nolla</a></p>\n<p><a href=\"https://tomoyadeng.github.io/blog/\" target=\"_blank\" rel=\"noopener\">Tomoya’s Blog</a></p>\n<p><a href=\"https://youendless.com/\" target=\"_blank\" rel=\"noopener\">君无止境</a></p>\n<p><a href=\"https://jaminzhang.github.io/\" target=\"_blank\" rel=\"noopener\">Jamin Zhang</a></p>\n<p><a href=\"https://imroc.io/\" target=\"_blank\" rel=\"noopener\">roc - imroc.io|roc的博客|Cloud Native|Kubernetes|Go|Golang</a></p>\n<p><a href=\"https://sysdig.com/blog/\" target=\"_blank\" rel=\"noopener\">Blog | Sysdig</a></p>\n<p><a href=\"https://sleele.com/\" target=\"_blank\" rel=\"noopener\">sleele的博客</a></p>\n<p><a href=\"https://www.tauceti.blog/\" target=\"_blank\" rel=\"noopener\">TauCeti blog · TauCeti blog</a></p>\n<p><a href=\"http://ghoulich.xninja.org/\" target=\"_blank\" rel=\"noopener\">水晶命匣 | 生命在于折腾，折腾万岁！</a></p>\n<p><a href=\"https://soulteary.com/\" target=\"_blank\" rel=\"noopener\">苏洋博客</a></p>\n<p><a href=\"https://linuxtoy.org/\" target=\"_blank\" rel=\"noopener\">LinuxTOY</a></p>\n<p><a href=\"https://www.infvie.com/\" target=\"_blank\" rel=\"noopener\">Infvie’s Blog | 运维SRE社区博客</a></p>\n<p><a href=\"https://zhangchenchen.github.io/\" target=\"_blank\" rel=\"noopener\">Solar</a></p>\n<p><a href=\"https://moelove.info/\" target=\"_blank\" rel=\"noopener\">MoeLove</a></p>\n<p><a href=\"https://www.hwchiu.com/\" target=\"_blank\" rel=\"noopener\">Hwchiu Learning Notekubernetes/SDN/DevOps</a></p>\n<p><a href=\"http://www.yangguanjun.com\" target=\"_blank\" rel=\"noopener\">存储领域 yangguanjun</a></p>\n","site":{"data":{}},"length":810,"excerpt":"<p>记录一些云原生技术博客</p>","more":"<h3 id=\"来自ServiceMesher-8-群\"><a href=\"#来自ServiceMesher-8-群\" class=\"headerlink\" title=\"来自ServiceMesher[8] 群\"></a>来自ServiceMesher[8] 群</h3><p><a href=\"https://k2r2bai.com/\" target=\"_blank\" rel=\"noopener\">KaiRen’s Blog</a></p>\n<p><a href=\"https://ieevee.com/\" target=\"_blank\" rel=\"noopener\">Zlatan Eevee</a></p>\n<p><a href=\"https://hansedong.github.io/\" target=\"_blank\" rel=\"noopener\">国南之境</a></p>\n<p><a href=\"http://gaocegege.com/Blog/\" target=\"_blank\" rel=\"noopener\">博客 | 高策</a></p>\n<p><a href=\"https://kkc.github.io/\" target=\"_blank\" rel=\"noopener\">Kakashi’s Blog</a></p>\n<p><a href=\"https://blog.yaodataking.com/\" target=\"_blank\" rel=\"noopener\">Alex Wu’s blog | THINK BIG, START SMALL, DELIVER VALUE TO THE BUSINESS</a></p>\n<p><a href=\"https://nicksors.cc/\" target=\"_blank\" rel=\"noopener\">开元DevOps知识库 - 知识管理，时间管理，自我管理</a></p>\n<p><a href=\"https://xuchao918.github.io/\" target=\"_blank\" rel=\"noopener\">起风了</a></p>\n<p><a href=\"https://maiyang.me/\" target=\"_blank\" rel=\"noopener\">茶歇驿站 - Gopher, OpenSource Fans, 成长之路有我相伴。</a></p>\n<p><a href=\"https://docs.lvrui.io/\" target=\"_blank\" rel=\"noopener\">Polar Snow Documentation</a></p>\n<p><a href=\"https://www.yangcs.net/\" target=\"_blank\" rel=\"noopener\">云原生实验室 - 米开朗基杨的博客</a></p>\n<p><a href=\"https://jimmysong.io/\" target=\"_blank\" rel=\"noopener\">Jimmy Song - 宋净超的博客|Cloud Native|云原生布道师</a></p>\n<p><a href=\"https://mritd.me/\" target=\"_blank\" rel=\"noopener\">漠然的博客 | mritd Blog</a></p>\n<p><a href=\"http://www.rhca.me/\" target=\"_blank\" rel=\"noopener\">DevOps – 成长之路</a></p>\n<p><a href=\"https://birdben.github.io/\" target=\"_blank\" rel=\"noopener\">birdben</a></p>\n<p><a href=\"https://fs.tn/\" target=\"_blank\" rel=\"noopener\">浮生若梦</a></p>\n<p><a href=\"https://landscape.cncf.io/\" target=\"_blank\" rel=\"noopener\">CNCF Cloud Native Interactive Landscape</a></p>\n<p><a href=\"https://www.duyidong.com/\" target=\"_blank\" rel=\"noopener\">杜屹东的博客 | 学无止境</a></p>\n<p><a href=\"https://blog.ihypo.net/index.html\" target=\"_blank\" rel=\"noopener\">梦旭随想</a></p>\n<p><a href=\"http://www.yangguanjun.com/\" target=\"_blank\" rel=\"noopener\">ictfox blog</a></p>\n<p><a href=\"http://team.jiunile.com/\" target=\"_blank\" rel=\"noopener\">CloudNative 架构</a></p>\n<p><a href=\"https://www.bladewan.com/\" target=\"_blank\" rel=\"noopener\">我爱西红柿</a></p>\n<p><a href=\"https://notes.doublemine.me/\" target=\"_blank\" rel=\"noopener\">Doublemine</a></p>\n<p><a href=\"https://bingohuang.com/\" target=\"_blank\" rel=\"noopener\">Bingo Huang</a></p>\n<p><a href=\"http://chunqi.li/\" target=\"_blank\" rel=\"noopener\">Arthur Chunqi Li’s Blog</a></p>\n<p><a href=\"http://chunqi.li/archives/\" target=\"_blank\" rel=\"noopener\">Archive | Arthur Chunqi Li’s Blog</a></p>\n<p><a href=\"https://www.lijiaocn.com/\" target=\"_blank\" rel=\"noopener\">IT技术工作学习折腾笔记 李佶澳的博客</a></p>\n<p><a href=\"http://moheqionglin.com/site/blogs/1/list.html\" target=\"_blank\" rel=\"noopener\">墨荷琼林官网-编程日志</a></p>\n<p><a href=\"https://cmgs.me/archive\" target=\"_blank\" rel=\"noopener\">Archive - Nolla</a></p>\n<p><a href=\"https://tomoyadeng.github.io/blog/\" target=\"_blank\" rel=\"noopener\">Tomoya’s Blog</a></p>\n<p><a href=\"https://youendless.com/\" target=\"_blank\" rel=\"noopener\">君无止境</a></p>\n<p><a href=\"https://jaminzhang.github.io/\" target=\"_blank\" rel=\"noopener\">Jamin Zhang</a></p>\n<p><a href=\"https://imroc.io/\" target=\"_blank\" rel=\"noopener\">roc - imroc.io|roc的博客|Cloud Native|Kubernetes|Go|Golang</a></p>\n<p><a href=\"https://sysdig.com/blog/\" target=\"_blank\" rel=\"noopener\">Blog | Sysdig</a></p>\n<p><a href=\"https://sleele.com/\" target=\"_blank\" rel=\"noopener\">sleele的博客</a></p>\n<p><a href=\"https://www.tauceti.blog/\" target=\"_blank\" rel=\"noopener\">TauCeti blog · TauCeti blog</a></p>\n<p><a href=\"http://ghoulich.xninja.org/\" target=\"_blank\" rel=\"noopener\">水晶命匣 | 生命在于折腾，折腾万岁！</a></p>\n<p><a href=\"https://soulteary.com/\" target=\"_blank\" rel=\"noopener\">苏洋博客</a></p>\n<p><a href=\"https://linuxtoy.org/\" target=\"_blank\" rel=\"noopener\">LinuxTOY</a></p>\n<p><a href=\"https://www.infvie.com/\" target=\"_blank\" rel=\"noopener\">Infvie’s Blog | 运维SRE社区博客</a></p>\n<p><a href=\"https://zhangchenchen.github.io/\" target=\"_blank\" rel=\"noopener\">Solar</a></p>\n<p><a href=\"https://moelove.info/\" target=\"_blank\" rel=\"noopener\">MoeLove</a></p>\n<p><a href=\"https://www.hwchiu.com/\" target=\"_blank\" rel=\"noopener\">Hwchiu Learning Notekubernetes/SDN/DevOps</a></p>\n<p><a href=\"http://www.yangguanjun.com\" target=\"_blank\" rel=\"noopener\">存储领域 yangguanjun</a></p>"},{"title":"收藏链接","copyright":true,"date":"2019-10-17T03:19:42.000Z","top":10,"_content":"记录一些好的网址\n<!-- more -->\n   \n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width = \"100\" height = \"100\" style=\"border: 0\"/>\n<font color=\"blue\" face=\"黑体\" size=5> 云原生 </font>\n</center>\n\n- [云原生图书编年史](https://jimmysong.io/cloud-native/memo/books/)\n- [云原生大佬博客汇总](https://zhangzw001.github.io/2019/10/12/13-%E4%BA%91%E5%8E%9F%E7%94%9F%E5%8D%9A%E5%AE%A2%E6%B1%87%E6%80%BB/)\n\n","source":"_posts/18-收藏链接.md","raw":"---\ntitle: 收藏链接\ncopyright: true\ndate: 2019-10-17 11:19:42\ntags:\n  - 收藏\n  - 网址\ncategories:\n  - [网址,收藏]\ntop: 10\n---\n记录一些好的网址\n<!-- more -->\n   \n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width = \"100\" height = \"100\" style=\"border: 0\"/>\n<font color=\"blue\" face=\"黑体\" size=5> 云原生 </font>\n</center>\n\n- [云原生图书编年史](https://jimmysong.io/cloud-native/memo/books/)\n- [云原生大佬博客汇总](https://zhangzw001.github.io/2019/10/12/13-%E4%BA%91%E5%8E%9F%E7%94%9F%E5%8D%9A%E5%AE%A2%E6%B1%87%E6%80%BB/)\n\n","slug":"18-收藏链接","published":1,"updated":"2019-10-17T03:29:05.978Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck28uwzmy000hkerw6m5rural","content":"<p>记录一些好的网址</p>\n<a id=\"more\"></a>\n\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width=\"100\" height=\"100\" style=\"border: 0\">\n<font color=\"blue\" face=\"黑体\" size=\"5\"> 云原生 </font>\n</center>\n\n<ul>\n<li><a href=\"https://jimmysong.io/cloud-native/memo/books/\" target=\"_blank\" rel=\"noopener\">云原生图书编年史</a></li>\n<li><a href=\"https://zhangzw001.github.io/2019/10/12/13-%E4%BA%91%E5%8E%9F%E7%94%9F%E5%8D%9A%E5%AE%A2%E6%B1%87%E6%80%BB/\">云原生大佬博客汇总</a></li>\n</ul>\n","site":{"data":{}},"length":30,"excerpt":"<p>记录一些好的网址</p>","more":"<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width=\"100\" height=\"100\" style=\"border: 0\">\n<font color=\"blue\" face=\"黑体\" size=\"5\"> 云原生 </font>\n</center>\n\n<ul>\n<li><a href=\"https://jimmysong.io/cloud-native/memo/books/\" target=\"_blank\" rel=\"noopener\">云原生图书编年史</a></li>\n<li><a href=\"https://zhangzw001.github.io/2019/10/12/13-%E4%BA%91%E5%8E%9F%E7%94%9F%E5%8D%9A%E5%AE%A2%E6%B1%87%E6%80%BB/\">云原生大佬博客汇总</a></li>\n</ul>"},{"title":"shell中gt和>的区别","copyright":true,"date":"2019-10-17T03:48:22.000Z","_content":"shell中 gt 和 > 的一些相关问题介绍和测试\n<!-- more-->\n\n\n> 以下是bash的测试, 注意如果你是zsh可能会不同喔😯\n\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width = \"100\" height = \"100\" style=\"border: 0\"/>\n<font  face=\"黑体\" size=4> [[]] , [] 和test比较 </font>\n</center>\n\n[] 和test:\t两者是一样的，在命令行里test expr和[ expr ]的效果相同。test中可用的比较运算符只有==和!=，两者都是用于字符串比较的，不可用于整数比较，整数比较只能使用-eq, -gt这种形式。\n通过which [ 和which test 可以看到是命令\n\n> [] 和test 例子\n\n```\n[root@dk-centos6 ~]# a=\"abcdef\"\n[root@dk-centos6 ~]# test \"$a\" = \"abcdef\"\n[root@dk-centos6 ~]# echo $?\n0\n[root@dk-centos6 ~]# [ \"$a\" = \"abcdef\" ]\n[root@dk-centos6 ~]# echo $?\n0\n```\n\n[[ ]]具体功能:\t\n- [[是 bash 程序语言的关键字。并不是一个命令，[[ ]] 结构比[ ]结构更加通用。在[[和]]之间所有的字符都不会发生文件名扩展或者单词分割，但是会发生参数扩展和命令替换。\n\n- 支持字符串的模式匹配（使用=~操作符时甚至支持shell的正则表达 式）,右边的字符串不加双引号的情况,可以把右边作为模式. 比如[[ hello == hell? ]]，结果为真。当然加引号就是文本字符串比较.\n\n- 使用[[ ... ]]条件判断结构，而不是[ ... ]，能够防止脚本中的许多逻辑错误。比如，&&、||、<和> 操作符能够正常存在于[[ ]]条件判断结构中，但是如果出现在[ ]结构中的话，会报错。比如可以直接使用if [[ $a != 1 && $a != 2 ]], 如果不适用双括号, 则为if [ $a -ne 1] && [ $a != 2 ]或者if [ $a -ne 1 -a $a != 2 ]。\n\n\n---\n\n\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width = \"100\" height = \"100\" style=\"border: 0\"/>\n<font  face=\"黑体\" size=4> 纯数字比较 </font>\n</center>\n\n### > 通过比较ASCII值,gt仅能比较数字\n\n```\n[root@dk-centos6 ~]# [ 2 \\> 1 ]\n[root@dk-centos6 ~]# echo $?\n0\n[root@dk-centos6 ~]# [ 2 -gt 1 ]\n[root@dk-centos6 ~]# echo $?\n0\n[root@dk-centos6 ~]# [[ 2 > 1 ]]\n[root@dk-centos6 ~]# echo $?\n0\n[root@dk-centos6 ~]# [[ 2 -gt 1 ]]\n[root@dk-centos6 ~]# echo $?\n0\n```\n\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width = \"100\" height = \"100\" style=\"border: 0\"/>\n<font  face=\"黑体\" size=4> 字符串比较 </font>\n</center>\n\n### 单括号中如果要比较符号 \"<\" \">\", 需要转义, 否则判断结果错误\n\n```\n[root@dk-centos6 ~]# [ \"b\" > \"a\" ]\n[root@dk-centos6 ~]# echo $?\n0\n[root@dk-centos6 ~]# [ \"b\" < \"a\" ]\n[root@dk-centos6 ~]# echo $?\n0\n[root@dk-centos6 ~]# [ \"b\" \\< \"a\" ]\n[root@dk-centos6 ~]# echo $?\n1\n```\n\n### 双括号不用转义 , 直接执行即可\n\n```\n[root@dk-centos6 ~]# [[ \"b\" > \"a\" ]]\n[root@dk-centos6 ~]# echo $?\n0\n[root@dk-centos6 ~]# [[ \"b\" < \"a\" ]]\n[root@dk-centos6 ~]# echo $?\n1\n```\n","source":"_posts/19-shell中gt和>的区别.md","raw":"---\ntitle: shell中gt和>的区别\ncopyright: true\ndate: 2019-10-17 11:48:22\ntags:\n  - linux\n  - shell\ncategories:\n  - [linux,shell]\n---\nshell中 gt 和 > 的一些相关问题介绍和测试\n<!-- more-->\n\n\n> 以下是bash的测试, 注意如果你是zsh可能会不同喔😯\n\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width = \"100\" height = \"100\" style=\"border: 0\"/>\n<font  face=\"黑体\" size=4> [[]] , [] 和test比较 </font>\n</center>\n\n[] 和test:\t两者是一样的，在命令行里test expr和[ expr ]的效果相同。test中可用的比较运算符只有==和!=，两者都是用于字符串比较的，不可用于整数比较，整数比较只能使用-eq, -gt这种形式。\n通过which [ 和which test 可以看到是命令\n\n> [] 和test 例子\n\n```\n[root@dk-centos6 ~]# a=\"abcdef\"\n[root@dk-centos6 ~]# test \"$a\" = \"abcdef\"\n[root@dk-centos6 ~]# echo $?\n0\n[root@dk-centos6 ~]# [ \"$a\" = \"abcdef\" ]\n[root@dk-centos6 ~]# echo $?\n0\n```\n\n[[ ]]具体功能:\t\n- [[是 bash 程序语言的关键字。并不是一个命令，[[ ]] 结构比[ ]结构更加通用。在[[和]]之间所有的字符都不会发生文件名扩展或者单词分割，但是会发生参数扩展和命令替换。\n\n- 支持字符串的模式匹配（使用=~操作符时甚至支持shell的正则表达 式）,右边的字符串不加双引号的情况,可以把右边作为模式. 比如[[ hello == hell? ]]，结果为真。当然加引号就是文本字符串比较.\n\n- 使用[[ ... ]]条件判断结构，而不是[ ... ]，能够防止脚本中的许多逻辑错误。比如，&&、||、<和> 操作符能够正常存在于[[ ]]条件判断结构中，但是如果出现在[ ]结构中的话，会报错。比如可以直接使用if [[ $a != 1 && $a != 2 ]], 如果不适用双括号, 则为if [ $a -ne 1] && [ $a != 2 ]或者if [ $a -ne 1 -a $a != 2 ]。\n\n\n---\n\n\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width = \"100\" height = \"100\" style=\"border: 0\"/>\n<font  face=\"黑体\" size=4> 纯数字比较 </font>\n</center>\n\n### > 通过比较ASCII值,gt仅能比较数字\n\n```\n[root@dk-centos6 ~]# [ 2 \\> 1 ]\n[root@dk-centos6 ~]# echo $?\n0\n[root@dk-centos6 ~]# [ 2 -gt 1 ]\n[root@dk-centos6 ~]# echo $?\n0\n[root@dk-centos6 ~]# [[ 2 > 1 ]]\n[root@dk-centos6 ~]# echo $?\n0\n[root@dk-centos6 ~]# [[ 2 -gt 1 ]]\n[root@dk-centos6 ~]# echo $?\n0\n```\n\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width = \"100\" height = \"100\" style=\"border: 0\"/>\n<font  face=\"黑体\" size=4> 字符串比较 </font>\n</center>\n\n### 单括号中如果要比较符号 \"<\" \">\", 需要转义, 否则判断结果错误\n\n```\n[root@dk-centos6 ~]# [ \"b\" > \"a\" ]\n[root@dk-centos6 ~]# echo $?\n0\n[root@dk-centos6 ~]# [ \"b\" < \"a\" ]\n[root@dk-centos6 ~]# echo $?\n0\n[root@dk-centos6 ~]# [ \"b\" \\< \"a\" ]\n[root@dk-centos6 ~]# echo $?\n1\n```\n\n### 双括号不用转义 , 直接执行即可\n\n```\n[root@dk-centos6 ~]# [[ \"b\" > \"a\" ]]\n[root@dk-centos6 ~]# echo $?\n0\n[root@dk-centos6 ~]# [[ \"b\" < \"a\" ]]\n[root@dk-centos6 ~]# echo $?\n1\n```\n","slug":"19-shell中gt和>的区别","published":1,"updated":"2019-10-17T06:26:12.086Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck28uwzmz000lkerwjsu2ffba","content":"<p>shell中 gt 和 &gt; 的一些相关问题介绍和测试</p>\n<a id=\"more\"></a>\n\n\n<blockquote>\n<p>以下是bash的测试, 注意如果你是zsh可能会不同喔😯</p>\n</blockquote>\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width=\"100\" height=\"100\" style=\"border: 0\">\n<font face=\"黑体\" size=\"4\"> [[]] , [] 和test比较 </font>\n</center>\n\n<p>[] 和test:    两者是一样的，在命令行里test expr和[ expr ]的效果相同。test中可用的比较运算符只有==和!=，两者都是用于字符串比较的，不可用于整数比较，整数比较只能使用-eq, -gt这种形式。<br>通过which [ 和which test 可以看到是命令</p>\n<blockquote>\n<p>[] 和test 例子</p>\n</blockquote>\n<figure class=\"highlight autoit\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root<span class=\"symbol\">@dk</span>-centos6 ~]<span class=\"meta\"># a=<span class=\"string\">\"abcdef\"</span></span></span><br><span class=\"line\">[root<span class=\"symbol\">@dk</span>-centos6 ~]<span class=\"meta\"># test <span class=\"string\">\"$a\"</span> = <span class=\"string\">\"abcdef\"</span></span></span><br><span class=\"line\">[root<span class=\"symbol\">@dk</span>-centos6 ~]<span class=\"meta\"># echo $?</span></span><br><span class=\"line\"><span class=\"number\">0</span></span><br><span class=\"line\">[root<span class=\"symbol\">@dk</span>-centos6 ~]<span class=\"meta\"># [ <span class=\"string\">\"$a\"</span> = <span class=\"string\">\"abcdef\"</span> ]</span></span><br><span class=\"line\">[root<span class=\"symbol\">@dk</span>-centos6 ~]<span class=\"meta\"># echo $?</span></span><br><span class=\"line\"><span class=\"number\">0</span></span><br></pre></td></tr></table></figure>\n\n<p>[[ ]]具体功能:    </p>\n<ul>\n<li><p>[[是 bash 程序语言的关键字。并不是一个命令，[[ ]] 结构比[ ]结构更加通用。在[[和]]之间所有的字符都不会发生文件名扩展或者单词分割，但是会发生参数扩展和命令替换。</p>\n</li>\n<li><p>支持字符串的模式匹配（使用=~操作符时甚至支持shell的正则表达 式）,右边的字符串不加双引号的情况,可以把右边作为模式. 比如[[ hello == hell? ]]，结果为真。当然加引号就是文本字符串比较.</p>\n</li>\n<li><p>使用[[ … ]]条件判断结构，而不是[ … ]，能够防止脚本中的许多逻辑错误。比如，&amp;&amp;、||、&lt;和&gt; 操作符能够正常存在于[[ ]]条件判断结构中，但是如果出现在[ ]结构中的话，会报错。比如可以直接使用if [[ $a != 1 &amp;&amp; $a != 2 ]], 如果不适用双括号, 则为if [ $a -ne 1] &amp;&amp; [ $a != 2 ]或者if [ $a -ne 1 -a $a != 2 ]。</p>\n</li>\n</ul>\n<hr>\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width=\"100\" height=\"100\" style=\"border: 0\">\n<font face=\"黑体\" size=\"4\"> 纯数字比较 </font>\n</center>\n\n<h3 id=\"gt-通过比较ASCII值-gt仅能比较数字\"><a href=\"#gt-通过比较ASCII值-gt仅能比较数字\" class=\"headerlink\" title=\"&gt; 通过比较ASCII值,gt仅能比较数字\"></a>&gt; 通过比较ASCII值,gt仅能比较数字</h3><figure class=\"highlight gcode\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@dk-ce<span class=\"symbol\">ntos6</span> ~]<span class=\"attr\"># [ 2</span> \\&gt; <span class=\"number\">1</span> ]</span><br><span class=\"line\">[root@dk-ce<span class=\"symbol\">ntos6</span> ~]<span class=\"attr\"># echo $?</span></span><br><span class=\"line\"><span class=\"attr\">0</span></span><br><span class=\"line\">[root@dk-ce<span class=\"symbol\">ntos6</span> ~]<span class=\"attr\"># [ 2</span> -<span class=\"keyword\">gt</span> <span class=\"number\">1</span> ]</span><br><span class=\"line\">[root@dk-ce<span class=\"symbol\">ntos6</span> ~]<span class=\"attr\"># echo $?</span></span><br><span class=\"line\"><span class=\"attr\">0</span></span><br><span class=\"line\">[root@dk-ce<span class=\"symbol\">ntos6</span> ~]<span class=\"attr\"># [[ 2</span> &gt; <span class=\"number\">1</span> ]]</span><br><span class=\"line\">[root@dk-ce<span class=\"symbol\">ntos6</span> ~]<span class=\"attr\"># echo $?</span></span><br><span class=\"line\"><span class=\"attr\">0</span></span><br><span class=\"line\">[root@dk-ce<span class=\"symbol\">ntos6</span> ~]<span class=\"attr\"># [[ 2</span> -<span class=\"keyword\">gt</span> <span class=\"number\">1</span> ]]</span><br><span class=\"line\">[root@dk-ce<span class=\"symbol\">ntos6</span> ~]<span class=\"attr\"># echo $?</span></span><br><span class=\"line\"><span class=\"attr\">0</span></span><br></pre></td></tr></table></figure>\n\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width=\"100\" height=\"100\" style=\"border: 0\">\n<font face=\"黑体\" size=\"4\"> 字符串比较 </font>\n</center>\n\n<h3 id=\"单括号中如果要比较符号-“-lt-”-“-gt-”-需要转义-否则判断结果错误\"><a href=\"#单括号中如果要比较符号-“-lt-”-“-gt-”-需要转义-否则判断结果错误\" class=\"headerlink\" title=\"单括号中如果要比较符号 “&lt;” “&gt;”, 需要转义, 否则判断结果错误\"></a>单括号中如果要比较符号 “&lt;” “&gt;”, 需要转义, 否则判断结果错误</h3><figure class=\"highlight autoit\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root<span class=\"symbol\">@dk</span>-centos6 ~]<span class=\"meta\"># [ <span class=\"string\">\"b\"</span> &gt; <span class=\"string\">\"a\"</span> ]</span></span><br><span class=\"line\">[root<span class=\"symbol\">@dk</span>-centos6 ~]<span class=\"meta\"># echo $?</span></span><br><span class=\"line\"><span class=\"number\">0</span></span><br><span class=\"line\">[root<span class=\"symbol\">@dk</span>-centos6 ~]<span class=\"meta\"># [ <span class=\"string\">\"b\"</span> &lt; <span class=\"string\">\"a\"</span> ]</span></span><br><span class=\"line\">[root<span class=\"symbol\">@dk</span>-centos6 ~]<span class=\"meta\"># echo $?</span></span><br><span class=\"line\"><span class=\"number\">0</span></span><br><span class=\"line\">[root<span class=\"symbol\">@dk</span>-centos6 ~]<span class=\"meta\"># [ <span class=\"string\">\"b\"</span> \\&lt; <span class=\"string\">\"a\"</span> ]</span></span><br><span class=\"line\">[root<span class=\"symbol\">@dk</span>-centos6 ~]<span class=\"meta\"># echo $?</span></span><br><span class=\"line\"><span class=\"number\">1</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"双括号不用转义-直接执行即可\"><a href=\"#双括号不用转义-直接执行即可\" class=\"headerlink\" title=\"双括号不用转义 , 直接执行即可\"></a>双括号不用转义 , 直接执行即可</h3><figure class=\"highlight autoit\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root<span class=\"symbol\">@dk</span>-centos6 ~]<span class=\"meta\"># [[ <span class=\"string\">\"b\"</span> &gt; <span class=\"string\">\"a\"</span> ]]</span></span><br><span class=\"line\">[root<span class=\"symbol\">@dk</span>-centos6 ~]<span class=\"meta\"># echo $?</span></span><br><span class=\"line\"><span class=\"number\">0</span></span><br><span class=\"line\">[root<span class=\"symbol\">@dk</span>-centos6 ~]<span class=\"meta\"># [[ <span class=\"string\">\"b\"</span> &lt; <span class=\"string\">\"a\"</span> ]]</span></span><br><span class=\"line\">[root<span class=\"symbol\">@dk</span>-centos6 ~]<span class=\"meta\"># echo $?</span></span><br><span class=\"line\"><span class=\"number\">1</span></span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"length":1561,"excerpt":"<p>shell中 gt 和 &gt; 的一些相关问题介绍和测试</p>","more":"<blockquote>\n<p>以下是bash的测试, 注意如果你是zsh可能会不同喔😯</p>\n</blockquote>\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width=\"100\" height=\"100\" style=\"border: 0\">\n<font face=\"黑体\" size=\"4\"> [[]] , [] 和test比较 </font>\n</center>\n\n<p>[] 和test:    两者是一样的，在命令行里test expr和[ expr ]的效果相同。test中可用的比较运算符只有==和!=，两者都是用于字符串比较的，不可用于整数比较，整数比较只能使用-eq, -gt这种形式。<br>通过which [ 和which test 可以看到是命令</p>\n<blockquote>\n<p>[] 和test 例子</p>\n</blockquote>\n<figure class=\"highlight autoit\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root<span class=\"symbol\">@dk</span>-centos6 ~]<span class=\"meta\"># a=<span class=\"string\">\"abcdef\"</span></span></span><br><span class=\"line\">[root<span class=\"symbol\">@dk</span>-centos6 ~]<span class=\"meta\"># test <span class=\"string\">\"$a\"</span> = <span class=\"string\">\"abcdef\"</span></span></span><br><span class=\"line\">[root<span class=\"symbol\">@dk</span>-centos6 ~]<span class=\"meta\"># echo $?</span></span><br><span class=\"line\"><span class=\"number\">0</span></span><br><span class=\"line\">[root<span class=\"symbol\">@dk</span>-centos6 ~]<span class=\"meta\"># [ <span class=\"string\">\"$a\"</span> = <span class=\"string\">\"abcdef\"</span> ]</span></span><br><span class=\"line\">[root<span class=\"symbol\">@dk</span>-centos6 ~]<span class=\"meta\"># echo $?</span></span><br><span class=\"line\"><span class=\"number\">0</span></span><br></pre></td></tr></table></figure>\n\n<p>[[ ]]具体功能:    </p>\n<ul>\n<li><p>[[是 bash 程序语言的关键字。并不是一个命令，[[ ]] 结构比[ ]结构更加通用。在[[和]]之间所有的字符都不会发生文件名扩展或者单词分割，但是会发生参数扩展和命令替换。</p>\n</li>\n<li><p>支持字符串的模式匹配（使用=~操作符时甚至支持shell的正则表达 式）,右边的字符串不加双引号的情况,可以把右边作为模式. 比如[[ hello == hell? ]]，结果为真。当然加引号就是文本字符串比较.</p>\n</li>\n<li><p>使用[[ … ]]条件判断结构，而不是[ … ]，能够防止脚本中的许多逻辑错误。比如，&amp;&amp;、||、&lt;和&gt; 操作符能够正常存在于[[ ]]条件判断结构中，但是如果出现在[ ]结构中的话，会报错。比如可以直接使用if [[ $a != 1 &amp;&amp; $a != 2 ]], 如果不适用双括号, 则为if [ $a -ne 1] &amp;&amp; [ $a != 2 ]或者if [ $a -ne 1 -a $a != 2 ]。</p>\n</li>\n</ul>\n<hr>\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width=\"100\" height=\"100\" style=\"border: 0\">\n<font face=\"黑体\" size=\"4\"> 纯数字比较 </font>\n</center>\n\n<h3 id=\"gt-通过比较ASCII值-gt仅能比较数字\"><a href=\"#gt-通过比较ASCII值-gt仅能比较数字\" class=\"headerlink\" title=\"&gt; 通过比较ASCII值,gt仅能比较数字\"></a>&gt; 通过比较ASCII值,gt仅能比较数字</h3><figure class=\"highlight gcode\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@dk-ce<span class=\"symbol\">ntos6</span> ~]<span class=\"attr\"># [ 2</span> \\&gt; <span class=\"number\">1</span> ]</span><br><span class=\"line\">[root@dk-ce<span class=\"symbol\">ntos6</span> ~]<span class=\"attr\"># echo $?</span></span><br><span class=\"line\"><span class=\"attr\">0</span></span><br><span class=\"line\">[root@dk-ce<span class=\"symbol\">ntos6</span> ~]<span class=\"attr\"># [ 2</span> -<span class=\"keyword\">gt</span> <span class=\"number\">1</span> ]</span><br><span class=\"line\">[root@dk-ce<span class=\"symbol\">ntos6</span> ~]<span class=\"attr\"># echo $?</span></span><br><span class=\"line\"><span class=\"attr\">0</span></span><br><span class=\"line\">[root@dk-ce<span class=\"symbol\">ntos6</span> ~]<span class=\"attr\"># [[ 2</span> &gt; <span class=\"number\">1</span> ]]</span><br><span class=\"line\">[root@dk-ce<span class=\"symbol\">ntos6</span> ~]<span class=\"attr\"># echo $?</span></span><br><span class=\"line\"><span class=\"attr\">0</span></span><br><span class=\"line\">[root@dk-ce<span class=\"symbol\">ntos6</span> ~]<span class=\"attr\"># [[ 2</span> -<span class=\"keyword\">gt</span> <span class=\"number\">1</span> ]]</span><br><span class=\"line\">[root@dk-ce<span class=\"symbol\">ntos6</span> ~]<span class=\"attr\"># echo $?</span></span><br><span class=\"line\"><span class=\"attr\">0</span></span><br></pre></td></tr></table></figure>\n\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width=\"100\" height=\"100\" style=\"border: 0\">\n<font face=\"黑体\" size=\"4\"> 字符串比较 </font>\n</center>\n\n<h3 id=\"单括号中如果要比较符号-“-lt-”-“-gt-”-需要转义-否则判断结果错误\"><a href=\"#单括号中如果要比较符号-“-lt-”-“-gt-”-需要转义-否则判断结果错误\" class=\"headerlink\" title=\"单括号中如果要比较符号 “&lt;” “&gt;”, 需要转义, 否则判断结果错误\"></a>单括号中如果要比较符号 “&lt;” “&gt;”, 需要转义, 否则判断结果错误</h3><figure class=\"highlight autoit\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root<span class=\"symbol\">@dk</span>-centos6 ~]<span class=\"meta\"># [ <span class=\"string\">\"b\"</span> &gt; <span class=\"string\">\"a\"</span> ]</span></span><br><span class=\"line\">[root<span class=\"symbol\">@dk</span>-centos6 ~]<span class=\"meta\"># echo $?</span></span><br><span class=\"line\"><span class=\"number\">0</span></span><br><span class=\"line\">[root<span class=\"symbol\">@dk</span>-centos6 ~]<span class=\"meta\"># [ <span class=\"string\">\"b\"</span> &lt; <span class=\"string\">\"a\"</span> ]</span></span><br><span class=\"line\">[root<span class=\"symbol\">@dk</span>-centos6 ~]<span class=\"meta\"># echo $?</span></span><br><span class=\"line\"><span class=\"number\">0</span></span><br><span class=\"line\">[root<span class=\"symbol\">@dk</span>-centos6 ~]<span class=\"meta\"># [ <span class=\"string\">\"b\"</span> \\&lt; <span class=\"string\">\"a\"</span> ]</span></span><br><span class=\"line\">[root<span class=\"symbol\">@dk</span>-centos6 ~]<span class=\"meta\"># echo $?</span></span><br><span class=\"line\"><span class=\"number\">1</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"双括号不用转义-直接执行即可\"><a href=\"#双括号不用转义-直接执行即可\" class=\"headerlink\" title=\"双括号不用转义 , 直接执行即可\"></a>双括号不用转义 , 直接执行即可</h3><figure class=\"highlight autoit\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root<span class=\"symbol\">@dk</span>-centos6 ~]<span class=\"meta\"># [[ <span class=\"string\">\"b\"</span> &gt; <span class=\"string\">\"a\"</span> ]]</span></span><br><span class=\"line\">[root<span class=\"symbol\">@dk</span>-centos6 ~]<span class=\"meta\"># echo $?</span></span><br><span class=\"line\"><span class=\"number\">0</span></span><br><span class=\"line\">[root<span class=\"symbol\">@dk</span>-centos6 ~]<span class=\"meta\"># [[ <span class=\"string\">\"b\"</span> &lt; <span class=\"string\">\"a\"</span> ]]</span></span><br><span class=\"line\">[root<span class=\"symbol\">@dk</span>-centos6 ~]<span class=\"meta\"># echo $?</span></span><br><span class=\"line\"><span class=\"number\">1</span></span><br></pre></td></tr></table></figure>"},{"title":"k8s搭建mysql5.7.24主从","copyright":true,"date":"2019-10-24T10:35:00.000Z","_content":"k8s上简单部署mysql5.7.24主从 \n<!-- more -->\n\n\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width = \"100\" height = \"100\" style=\"border: 0\"/>\n<font color=\"blue\" face=\"黑体\" size=5> k8s搭建mysql5.7.24主从 </font>\n</center>\n\n\n参考文档\n[利用Kubernetes搭建mysql主从复制集群](https://www.jianshu.com/p/509b65e9a4f5)\n[官方dockerfile](https://github.com/docker-library/mysql)\n\n### 从hub.docker.com拉取官方镜像\n```\ndocker pull mysql:5.7.24\n```\n\n\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width = \"100\" height = \"100\" style=\"border: 0\"/>\n<font color=\"blue\" face=\"黑体\" size=5> build镜像 </font>\n</center>\n\n### 主库master的Dockerfile\n```\nfrom mysql:5.7.24\n\nrun sed -i '/\\[mysqld\\]/a server-id=1\\nlog-bin' /etc/mysql/mysql.conf.d/mysqld.cnf\n\nCOPY docker-entrypoint.sh /usr/local/bin/\n```\n\n### 主库的docker-entrypoint.sh\n- 先从初始镜像取 或者从github对应版本上\n\n```\ndocker run -dti mysql:5.7.24 /bin/bash\n\ndocker cp 2bfa6209d120c23:/usr/local/bin/docker-entrypoint.sh .\n```\n\n- 修改docker-entrypoint.sh\n\n```\nfi\n# 添加以下内容\necho \"CREATE USER '$MYSQL_REPLICATION_USER'@'%' IDENTIFIED BY '$MYSQL_REPLICATION_PASSWORD' ;\" | \"${mysql[@]}\"\necho \"GRANT REPLICATION SLAVE ON *.* TO '$MYSQL_REPLICATION_USER'@'%' IDENTIFIED BY '$MYSQL_REPLICATION_PASSWORD' ;\" | \"${mysql[@]}\"\necho \"FLUSH PRIVILEGES ;\" | \"${mysql[@]}\"\n# 添加以上内容\necho\n  ls /docker-entrypoint-initdb.d/ > /dev/null\n```\n\n- build主库镜像\n\n```\ndocker build -t hub.boqii.com/bq/mysql-master:5.7.24 .\ndocker push hub.boqii.com/bq/mysql-master:5.7.24\n```\n\n\n### 从库的docker-entrypoint.sh\n\n- 同上先从初始镜像取 或者从github对应版本上 或复制上面的文件\n- 修改docker-entrypoint.sh\n\n```\nfi\n# 添加以下内容\n echo \"STOP SLAVE;\" | \"${mysql[@]}\"\n echo \"CHANGE MASTER TO master_host='$MYSQL_MASTER_SERVICE_HOST', master_user='$MYSQL_REPLICATION_USER', master_password='$MYSQL_REPLICATION_PASSWORD' ;\" |  \"${mysql[@]}\"\n echo \"START SLAVE;\" | \"${mysql[@]}\"\n # 添加以上内容\necho\n  ls /docker-entrypoint-initdb.d/ > /dev/null\n\n```\n\n- build从库镜像\n\n```\ndocker build -t hub.boqii.com/bq/mysql-slave:5.7.24 .\ndocker push hub.boqii.com/bq/mysql-slave:5.7.24\n```\n\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width = \"100\" height = \"100\" style=\"border: 0\"/>\n<font color=\"blue\" face=\"黑体\" size=5> 开始部署 </font>\n</center>\n\n\n- k8s-master-mysql_5.7.24.yml\n\n```\n---\napiVersion: apps/v1beta1\nkind: StatefulSet\nmetadata:\n  labels:\n    app: php-mysql-master-dev\n  name: php-mysql-master-dev\n  namespace: db\nspec:\n  serviceName: \"php-mysql-master-dev\"\n  replicas: 1\n  selector:\n    matchLabels:\n      app: php-mysql-master-dev\n  template:\n    metadata:\n      labels:\n        app: php-mysql-master-dev\n    spec:\n      containers:\n       - name: php-mysql-master-dev\n         image: hub.boqii.com/bq/mysql-master:5.7.24\n         ports:\n         - containerPort: 3306\n           name: db-port\n         resources:\n           requests:\n             cpu: \"50m\"\n           limits:\n             cpu: \"1000m\"\n         env:\n         - name: MYSQL_ROOT_PASSWORD\n           value: \"Boqii.123\"\n         - name: MYSQL_REPLICATION_USER\n           value: \"repl\"\n         - name: MYSQL_REPLICATION_PASSWORD\n           value: \"7a5b21ac65712bd95e39d3c1\"\n         volumeMounts:\n         - name: order-master-dev-data\n           mountPath: /var/lib/mysql\n         - name: order-master-dev-cfg\n           mountPath: /etc/mysql\n      volumes:\n        - name: order-master-dev-data\n          hostPath:\n            path: /data/k8s-container/php-mysql-dev/master/data\n        - name: order-master-dev-cfg\n          hostPath:\n            path: /data/k8s-container/php-mysql-dev/master/etc-mysql\n\n---\n\nkind: Service\napiVersion: v1\nmetadata:\n  labels:\n    app: php-mysql-master-dev\n  name: php-mysql-master-dev-service\n  namespace: db\nspec:\n  type: NodePort\n  ports:\n    - port: 3306\n      name: db-port\n      targetPort: 3306\n      nodePort: 23306\n      protocol: TCP\n  selector:\n    app: php-mysql-master-dev\n```\n\n- k8s-slave-mysql_5.7.24.yml\n\n```\n---\napiVersion: apps/v1beta1\nkind: StatefulSet\nmetadata:\n  labels:\n    app: php-mysql-slave-dev\n  name: php-mysql-slave-dev\n  namespace: db\nspec:\n  serviceName: \"php-mysql-slave-dev\"\n  replicas: 1\n  selector:\n    matchLabels:\n      app: php-mysql-slave-dev\n  template:\n    metadata:\n      labels:\n        app: php-mysql-slave-dev\n    spec:\n      containers:\n       - name: php-mysql-slave-dev\n         image: hub.boqii.com/bq/mysql-slave:5.7.24\n         ports:\n         - containerPort: 3306\n           name: db-port\n         resources:\n           requests:\n             cpu: \"50m\"\n           limits:\n             cpu: \"1000m\"\n         env:\n         - name: MYSQL_ROOT_PASSWORD\n           value: \"Boqii.123\"\n         - name: MYSQL_REPLICATION_USER\n           value: \"repl\"\n         - name: MYSQL_REPLICATION_PASSWORD\n           value: \"7a5b21ac65712bd95e39d3c1\"\n         - name: MYSQL_MASTER_SERVICE_HOST\n           value: \"php-mysql-master-dev-service\"\n         volumeMounts:\n         - name: order-slave-dev-data\n           mountPath: /var/lib/mysql\n         - name: order-slave-dev-cfg\n           mountPath: /etc/mysql\n      volumes:\n        - name: order-slave-dev-data\n          hostPath:\n            path: /data/k8s-container/php-mysql-dev/slave/data\n        - name: order-slave-dev-cfg\n          hostPath:\n            path: /data/k8s-container/php-mysql-dev/slave/etc-mysql\n\n\n---\n\nkind: Service\napiVersion: v1\nmetadata:\n  labels:\n    app: php-mysql-slave-dev\n  name: php-mysql-slave-dev-service\n  namespace: db\nspec:\n  type: NodePort\n  ports:\n    - port: 3306\n      name: db-port\n      targetPort: 3306\n      nodePort: 23307\n      protocol: TCP\n  selector:\n    app: php-mysql-slave-dev\n```\n\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width = \"100\" height = \"100\" style=\"border: 0\"/>\n<font color=\"blue\" face=\"黑体\" size=5> 问题总结 </font>\n</center>\n\n\n- 从库的replay log名字会根据docker主机名变化, 也可以写在配置文件\n \n```\n# Dockerfile中可以添加\nrun sed -i '/\\[mysqld\\]/a relay-log-index=php-mysql-shoporder-slave-dev-relay-bin.index' /etc/mysql/mysql.conf.d/mysqld.cnf\n```\n\n- 注意MYSQL_MASTER_SERVICE_HOST 变量的配置, 根据你master的service变化\n\n- 其次我docker-entrypoint.sh 文件几次手动从页面复制粘贴下来的导致各种语法错误,这里建议找到对的版本从github克隆, 或者从mysql:5.7.24镜像中cp\n\n\n\n### 附录\n[master配置docker-entrypoint.sh](http://zhangzw001.github.io/sh/master-docker-entrypoint.sh)\n[slave配置docker-entrypoint.sh](http://zhangzw001.github.io/sh/slave-docker-entrypoint.sh)\n","source":"_posts/20-k8s搭建mysql5-7-24主从.md","raw":"---\ntitle: k8s搭建mysql5.7.24主从\ncopyright: true\ndate: 2019-10-24 18:35:00\ntags:\n  - k8s\n  - mysql\ncategories:\n  - [k8s,mysql]\n  - [mysql]\n---\nk8s上简单部署mysql5.7.24主从 \n<!-- more -->\n\n\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width = \"100\" height = \"100\" style=\"border: 0\"/>\n<font color=\"blue\" face=\"黑体\" size=5> k8s搭建mysql5.7.24主从 </font>\n</center>\n\n\n参考文档\n[利用Kubernetes搭建mysql主从复制集群](https://www.jianshu.com/p/509b65e9a4f5)\n[官方dockerfile](https://github.com/docker-library/mysql)\n\n### 从hub.docker.com拉取官方镜像\n```\ndocker pull mysql:5.7.24\n```\n\n\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width = \"100\" height = \"100\" style=\"border: 0\"/>\n<font color=\"blue\" face=\"黑体\" size=5> build镜像 </font>\n</center>\n\n### 主库master的Dockerfile\n```\nfrom mysql:5.7.24\n\nrun sed -i '/\\[mysqld\\]/a server-id=1\\nlog-bin' /etc/mysql/mysql.conf.d/mysqld.cnf\n\nCOPY docker-entrypoint.sh /usr/local/bin/\n```\n\n### 主库的docker-entrypoint.sh\n- 先从初始镜像取 或者从github对应版本上\n\n```\ndocker run -dti mysql:5.7.24 /bin/bash\n\ndocker cp 2bfa6209d120c23:/usr/local/bin/docker-entrypoint.sh .\n```\n\n- 修改docker-entrypoint.sh\n\n```\nfi\n# 添加以下内容\necho \"CREATE USER '$MYSQL_REPLICATION_USER'@'%' IDENTIFIED BY '$MYSQL_REPLICATION_PASSWORD' ;\" | \"${mysql[@]}\"\necho \"GRANT REPLICATION SLAVE ON *.* TO '$MYSQL_REPLICATION_USER'@'%' IDENTIFIED BY '$MYSQL_REPLICATION_PASSWORD' ;\" | \"${mysql[@]}\"\necho \"FLUSH PRIVILEGES ;\" | \"${mysql[@]}\"\n# 添加以上内容\necho\n  ls /docker-entrypoint-initdb.d/ > /dev/null\n```\n\n- build主库镜像\n\n```\ndocker build -t hub.boqii.com/bq/mysql-master:5.7.24 .\ndocker push hub.boqii.com/bq/mysql-master:5.7.24\n```\n\n\n### 从库的docker-entrypoint.sh\n\n- 同上先从初始镜像取 或者从github对应版本上 或复制上面的文件\n- 修改docker-entrypoint.sh\n\n```\nfi\n# 添加以下内容\n echo \"STOP SLAVE;\" | \"${mysql[@]}\"\n echo \"CHANGE MASTER TO master_host='$MYSQL_MASTER_SERVICE_HOST', master_user='$MYSQL_REPLICATION_USER', master_password='$MYSQL_REPLICATION_PASSWORD' ;\" |  \"${mysql[@]}\"\n echo \"START SLAVE;\" | \"${mysql[@]}\"\n # 添加以上内容\necho\n  ls /docker-entrypoint-initdb.d/ > /dev/null\n\n```\n\n- build从库镜像\n\n```\ndocker build -t hub.boqii.com/bq/mysql-slave:5.7.24 .\ndocker push hub.boqii.com/bq/mysql-slave:5.7.24\n```\n\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width = \"100\" height = \"100\" style=\"border: 0\"/>\n<font color=\"blue\" face=\"黑体\" size=5> 开始部署 </font>\n</center>\n\n\n- k8s-master-mysql_5.7.24.yml\n\n```\n---\napiVersion: apps/v1beta1\nkind: StatefulSet\nmetadata:\n  labels:\n    app: php-mysql-master-dev\n  name: php-mysql-master-dev\n  namespace: db\nspec:\n  serviceName: \"php-mysql-master-dev\"\n  replicas: 1\n  selector:\n    matchLabels:\n      app: php-mysql-master-dev\n  template:\n    metadata:\n      labels:\n        app: php-mysql-master-dev\n    spec:\n      containers:\n       - name: php-mysql-master-dev\n         image: hub.boqii.com/bq/mysql-master:5.7.24\n         ports:\n         - containerPort: 3306\n           name: db-port\n         resources:\n           requests:\n             cpu: \"50m\"\n           limits:\n             cpu: \"1000m\"\n         env:\n         - name: MYSQL_ROOT_PASSWORD\n           value: \"Boqii.123\"\n         - name: MYSQL_REPLICATION_USER\n           value: \"repl\"\n         - name: MYSQL_REPLICATION_PASSWORD\n           value: \"7a5b21ac65712bd95e39d3c1\"\n         volumeMounts:\n         - name: order-master-dev-data\n           mountPath: /var/lib/mysql\n         - name: order-master-dev-cfg\n           mountPath: /etc/mysql\n      volumes:\n        - name: order-master-dev-data\n          hostPath:\n            path: /data/k8s-container/php-mysql-dev/master/data\n        - name: order-master-dev-cfg\n          hostPath:\n            path: /data/k8s-container/php-mysql-dev/master/etc-mysql\n\n---\n\nkind: Service\napiVersion: v1\nmetadata:\n  labels:\n    app: php-mysql-master-dev\n  name: php-mysql-master-dev-service\n  namespace: db\nspec:\n  type: NodePort\n  ports:\n    - port: 3306\n      name: db-port\n      targetPort: 3306\n      nodePort: 23306\n      protocol: TCP\n  selector:\n    app: php-mysql-master-dev\n```\n\n- k8s-slave-mysql_5.7.24.yml\n\n```\n---\napiVersion: apps/v1beta1\nkind: StatefulSet\nmetadata:\n  labels:\n    app: php-mysql-slave-dev\n  name: php-mysql-slave-dev\n  namespace: db\nspec:\n  serviceName: \"php-mysql-slave-dev\"\n  replicas: 1\n  selector:\n    matchLabels:\n      app: php-mysql-slave-dev\n  template:\n    metadata:\n      labels:\n        app: php-mysql-slave-dev\n    spec:\n      containers:\n       - name: php-mysql-slave-dev\n         image: hub.boqii.com/bq/mysql-slave:5.7.24\n         ports:\n         - containerPort: 3306\n           name: db-port\n         resources:\n           requests:\n             cpu: \"50m\"\n           limits:\n             cpu: \"1000m\"\n         env:\n         - name: MYSQL_ROOT_PASSWORD\n           value: \"Boqii.123\"\n         - name: MYSQL_REPLICATION_USER\n           value: \"repl\"\n         - name: MYSQL_REPLICATION_PASSWORD\n           value: \"7a5b21ac65712bd95e39d3c1\"\n         - name: MYSQL_MASTER_SERVICE_HOST\n           value: \"php-mysql-master-dev-service\"\n         volumeMounts:\n         - name: order-slave-dev-data\n           mountPath: /var/lib/mysql\n         - name: order-slave-dev-cfg\n           mountPath: /etc/mysql\n      volumes:\n        - name: order-slave-dev-data\n          hostPath:\n            path: /data/k8s-container/php-mysql-dev/slave/data\n        - name: order-slave-dev-cfg\n          hostPath:\n            path: /data/k8s-container/php-mysql-dev/slave/etc-mysql\n\n\n---\n\nkind: Service\napiVersion: v1\nmetadata:\n  labels:\n    app: php-mysql-slave-dev\n  name: php-mysql-slave-dev-service\n  namespace: db\nspec:\n  type: NodePort\n  ports:\n    - port: 3306\n      name: db-port\n      targetPort: 3306\n      nodePort: 23307\n      protocol: TCP\n  selector:\n    app: php-mysql-slave-dev\n```\n\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width = \"100\" height = \"100\" style=\"border: 0\"/>\n<font color=\"blue\" face=\"黑体\" size=5> 问题总结 </font>\n</center>\n\n\n- 从库的replay log名字会根据docker主机名变化, 也可以写在配置文件\n \n```\n# Dockerfile中可以添加\nrun sed -i '/\\[mysqld\\]/a relay-log-index=php-mysql-shoporder-slave-dev-relay-bin.index' /etc/mysql/mysql.conf.d/mysqld.cnf\n```\n\n- 注意MYSQL_MASTER_SERVICE_HOST 变量的配置, 根据你master的service变化\n\n- 其次我docker-entrypoint.sh 文件几次手动从页面复制粘贴下来的导致各种语法错误,这里建议找到对的版本从github克隆, 或者从mysql:5.7.24镜像中cp\n\n\n\n### 附录\n[master配置docker-entrypoint.sh](http://zhangzw001.github.io/sh/master-docker-entrypoint.sh)\n[slave配置docker-entrypoint.sh](http://zhangzw001.github.io/sh/slave-docker-entrypoint.sh)\n","slug":"20-k8s搭建mysql5-7-24主从","published":1,"updated":"2019-10-25T07:07:29.576Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck28uwzn1000mkerwgf3we2lk","content":"<p>k8s上简单部署mysql5.7.24主从 </p>\n<a id=\"more\"></a>\n\n\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width=\"100\" height=\"100\" style=\"border: 0\">\n<font color=\"blue\" face=\"黑体\" size=\"5\"> k8s搭建mysql5.7.24主从 </font>\n</center>\n\n\n<p>参考文档<br><a href=\"https://www.jianshu.com/p/509b65e9a4f5\" target=\"_blank\" rel=\"noopener\">利用Kubernetes搭建mysql主从复制集群</a><br><a href=\"https://github.com/docker-library/mysql\" target=\"_blank\" rel=\"noopener\">官方dockerfile</a></p>\n<h3 id=\"从hub-docker-com拉取官方镜像\"><a href=\"#从hub-docker-com拉取官方镜像\" class=\"headerlink\" title=\"从hub.docker.com拉取官方镜像\"></a>从hub.docker.com拉取官方镜像</h3><figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">docker</span> <span class=\"selector-tag\">pull</span> <span class=\"selector-tag\">mysql</span><span class=\"selector-pseudo\">:5.7.24</span></span><br></pre></td></tr></table></figure>\n\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width=\"100\" height=\"100\" style=\"border: 0\">\n<font color=\"blue\" face=\"黑体\" size=\"5\"> build镜像 </font>\n</center>\n\n<h3 id=\"主库master的Dockerfile\"><a href=\"#主库master的Dockerfile\" class=\"headerlink\" title=\"主库master的Dockerfile\"></a>主库master的Dockerfile</h3><figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">from mysql:<span class=\"number\">5.7</span>.<span class=\"number\">24</span></span><br><span class=\"line\"></span><br><span class=\"line\">run sed -<span class=\"selector-tag\">i</span> <span class=\"string\">'/\\[mysqld\\]/a server-id=1\\nlog-bin'</span> /etc/mysql/mysql<span class=\"selector-class\">.conf</span><span class=\"selector-class\">.d</span>/mysqld.cnf</span><br><span class=\"line\"></span><br><span class=\"line\">COPY docker-entrypoint<span class=\"selector-class\">.sh</span> /usr/local/bin/</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"主库的docker-entrypoint-sh\"><a href=\"#主库的docker-entrypoint-sh\" class=\"headerlink\" title=\"主库的docker-entrypoint.sh\"></a>主库的docker-entrypoint.sh</h3><ul>\n<li>先从初始镜像取 或者从github对应版本上</li>\n</ul>\n<figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -dti <span class=\"string\">mysql:</span><span class=\"number\">5.7</span><span class=\"number\">.24</span> <span class=\"regexp\">/bin/</span>bash</span><br><span class=\"line\"></span><br><span class=\"line\">docker cp <span class=\"number\">2</span><span class=\"string\">bfa6209d120c23:</span><span class=\"regexp\">/usr/</span>local<span class=\"regexp\">/bin/</span>docker-entrypoint.sh .</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>修改docker-entrypoint.sh</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"comment\"># 添加以下内容</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"CREATE USER '<span class=\"variable\">$MYSQL_REPLICATION_USER</span>'@'%' IDENTIFIED BY '<span class=\"variable\">$MYSQL_REPLICATION_PASSWORD</span>' ;\"</span> | <span class=\"string\">\"<span class=\"variable\">$&#123;mysql[@]&#125;</span>\"</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"GRANT REPLICATION SLAVE ON *.* TO '<span class=\"variable\">$MYSQL_REPLICATION_USER</span>'@'%' IDENTIFIED BY '<span class=\"variable\">$MYSQL_REPLICATION_PASSWORD</span>' ;\"</span> | <span class=\"string\">\"<span class=\"variable\">$&#123;mysql[@]&#125;</span>\"</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"FLUSH PRIVILEGES ;\"</span> | <span class=\"string\">\"<span class=\"variable\">$&#123;mysql[@]&#125;</span>\"</span></span><br><span class=\"line\"><span class=\"comment\"># 添加以上内容</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span></span><br><span class=\"line\">  ls /docker-entrypoint-initdb.d/ &gt; /dev/null</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>build主库镜像</li>\n</ul>\n<figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker build -t hub<span class=\"selector-class\">.boqii</span><span class=\"selector-class\">.com</span>/bq/mysql-master:<span class=\"number\">5.7</span>.<span class=\"number\">24</span> .</span><br><span class=\"line\">docker push hub<span class=\"selector-class\">.boqii</span><span class=\"selector-class\">.com</span>/bq/mysql-master:<span class=\"number\">5.7</span>.<span class=\"number\">24</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"从库的docker-entrypoint-sh\"><a href=\"#从库的docker-entrypoint-sh\" class=\"headerlink\" title=\"从库的docker-entrypoint.sh\"></a>从库的docker-entrypoint.sh</h3><ul>\n<li>同上先从初始镜像取 或者从github对应版本上 或复制上面的文件</li>\n<li>修改docker-entrypoint.sh</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"comment\"># 添加以下内容</span></span><br><span class=\"line\"> <span class=\"built_in\">echo</span> <span class=\"string\">\"STOP SLAVE;\"</span> | <span class=\"string\">\"<span class=\"variable\">$&#123;mysql[@]&#125;</span>\"</span></span><br><span class=\"line\"> <span class=\"built_in\">echo</span> <span class=\"string\">\"CHANGE MASTER TO master_host='<span class=\"variable\">$MYSQL_MASTER_SERVICE_HOST</span>', master_user='<span class=\"variable\">$MYSQL_REPLICATION_USER</span>', master_password='<span class=\"variable\">$MYSQL_REPLICATION_PASSWORD</span>' ;\"</span> |  <span class=\"string\">\"<span class=\"variable\">$&#123;mysql[@]&#125;</span>\"</span></span><br><span class=\"line\"> <span class=\"built_in\">echo</span> <span class=\"string\">\"START SLAVE;\"</span> | <span class=\"string\">\"<span class=\"variable\">$&#123;mysql[@]&#125;</span>\"</span></span><br><span class=\"line\"> <span class=\"comment\"># 添加以上内容</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span></span><br><span class=\"line\">  ls /docker-entrypoint-initdb.d/ &gt; /dev/null</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>build从库镜像</li>\n</ul>\n<figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker build -t hub<span class=\"selector-class\">.boqii</span><span class=\"selector-class\">.com</span>/bq/mysql-slave:<span class=\"number\">5.7</span>.<span class=\"number\">24</span> .</span><br><span class=\"line\">docker push hub<span class=\"selector-class\">.boqii</span><span class=\"selector-class\">.com</span>/bq/mysql-slave:<span class=\"number\">5.7</span>.<span class=\"number\">24</span></span><br></pre></td></tr></table></figure>\n\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width=\"100\" height=\"100\" style=\"border: 0\">\n<font color=\"blue\" face=\"黑体\" size=\"5\"> 开始部署 </font>\n</center>\n\n\n<ul>\n<li>k8s-master-mysql_5.7.24.yml</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1beta1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">StatefulSet</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  labels:</span></span><br><span class=\"line\"><span class=\"attr\">    app:</span> <span class=\"string\">php-mysql-master-dev</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">php-mysql-master-dev</span></span><br><span class=\"line\"><span class=\"attr\">  namespace:</span> <span class=\"string\">db</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\">  serviceName:</span> <span class=\"string\">\"php-mysql-master-dev\"</span></span><br><span class=\"line\"><span class=\"attr\">  replicas:</span> <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"attr\">  selector:</span></span><br><span class=\"line\"><span class=\"attr\">    matchLabels:</span></span><br><span class=\"line\"><span class=\"attr\">      app:</span> <span class=\"string\">php-mysql-master-dev</span></span><br><span class=\"line\"><span class=\"attr\">  template:</span></span><br><span class=\"line\"><span class=\"attr\">    metadata:</span></span><br><span class=\"line\"><span class=\"attr\">      labels:</span></span><br><span class=\"line\"><span class=\"attr\">        app:</span> <span class=\"string\">php-mysql-master-dev</span></span><br><span class=\"line\"><span class=\"attr\">    spec:</span></span><br><span class=\"line\"><span class=\"attr\">      containers:</span></span><br><span class=\"line\"><span class=\"attr\">       - name:</span> <span class=\"string\">php-mysql-master-dev</span></span><br><span class=\"line\"><span class=\"attr\">         image:</span> <span class=\"string\">hub.boqii.com/bq/mysql-master:5.7.24</span></span><br><span class=\"line\"><span class=\"attr\">         ports:</span></span><br><span class=\"line\"><span class=\"attr\">         - containerPort:</span> <span class=\"number\">3306</span></span><br><span class=\"line\"><span class=\"attr\">           name:</span> <span class=\"string\">db-port</span></span><br><span class=\"line\"><span class=\"attr\">         resources:</span></span><br><span class=\"line\"><span class=\"attr\">           requests:</span></span><br><span class=\"line\"><span class=\"attr\">             cpu:</span> <span class=\"string\">\"50m\"</span></span><br><span class=\"line\"><span class=\"attr\">           limits:</span></span><br><span class=\"line\"><span class=\"attr\">             cpu:</span> <span class=\"string\">\"1000m\"</span></span><br><span class=\"line\"><span class=\"attr\">         env:</span></span><br><span class=\"line\"><span class=\"attr\">         - name:</span> <span class=\"string\">MYSQL_ROOT_PASSWORD</span></span><br><span class=\"line\"><span class=\"attr\">           value:</span> <span class=\"string\">\"Boqii.123\"</span></span><br><span class=\"line\"><span class=\"attr\">         - name:</span> <span class=\"string\">MYSQL_REPLICATION_USER</span></span><br><span class=\"line\"><span class=\"attr\">           value:</span> <span class=\"string\">\"repl\"</span></span><br><span class=\"line\"><span class=\"attr\">         - name:</span> <span class=\"string\">MYSQL_REPLICATION_PASSWORD</span></span><br><span class=\"line\"><span class=\"attr\">           value:</span> <span class=\"string\">\"7a5b21ac65712bd95e39d3c1\"</span></span><br><span class=\"line\"><span class=\"attr\">         volumeMounts:</span></span><br><span class=\"line\"><span class=\"attr\">         - name:</span> <span class=\"string\">order-master-dev-data</span></span><br><span class=\"line\"><span class=\"attr\">           mountPath:</span> <span class=\"string\">/var/lib/mysql</span></span><br><span class=\"line\"><span class=\"attr\">         - name:</span> <span class=\"string\">order-master-dev-cfg</span></span><br><span class=\"line\"><span class=\"attr\">           mountPath:</span> <span class=\"string\">/etc/mysql</span></span><br><span class=\"line\"><span class=\"attr\">      volumes:</span></span><br><span class=\"line\"><span class=\"attr\">        - name:</span> <span class=\"string\">order-master-dev-data</span></span><br><span class=\"line\"><span class=\"attr\">          hostPath:</span></span><br><span class=\"line\"><span class=\"attr\">            path:</span> <span class=\"string\">/data/k8s-container/php-mysql-dev/master/data</span></span><br><span class=\"line\"><span class=\"attr\">        - name:</span> <span class=\"string\">order-master-dev-cfg</span></span><br><span class=\"line\"><span class=\"attr\">          hostPath:</span></span><br><span class=\"line\"><span class=\"attr\">            path:</span> <span class=\"string\">/data/k8s-container/php-mysql-dev/master/etc-mysql</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Service</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  labels:</span></span><br><span class=\"line\"><span class=\"attr\">    app:</span> <span class=\"string\">php-mysql-master-dev</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">php-mysql-master-dev-service</span></span><br><span class=\"line\"><span class=\"attr\">  namespace:</span> <span class=\"string\">db</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\">  type:</span> <span class=\"string\">NodePort</span></span><br><span class=\"line\"><span class=\"attr\">  ports:</span></span><br><span class=\"line\"><span class=\"attr\">    - port:</span> <span class=\"number\">3306</span></span><br><span class=\"line\"><span class=\"attr\">      name:</span> <span class=\"string\">db-port</span></span><br><span class=\"line\"><span class=\"attr\">      targetPort:</span> <span class=\"number\">3306</span></span><br><span class=\"line\"><span class=\"attr\">      nodePort:</span> <span class=\"number\">23306</span></span><br><span class=\"line\"><span class=\"attr\">      protocol:</span> <span class=\"string\">TCP</span></span><br><span class=\"line\"><span class=\"attr\">  selector:</span></span><br><span class=\"line\"><span class=\"attr\">    app:</span> <span class=\"string\">php-mysql-master-dev</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>k8s-slave-mysql_5.7.24.yml</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1beta1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">StatefulSet</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  labels:</span></span><br><span class=\"line\"><span class=\"attr\">    app:</span> <span class=\"string\">php-mysql-slave-dev</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">php-mysql-slave-dev</span></span><br><span class=\"line\"><span class=\"attr\">  namespace:</span> <span class=\"string\">db</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\">  serviceName:</span> <span class=\"string\">\"php-mysql-slave-dev\"</span></span><br><span class=\"line\"><span class=\"attr\">  replicas:</span> <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"attr\">  selector:</span></span><br><span class=\"line\"><span class=\"attr\">    matchLabels:</span></span><br><span class=\"line\"><span class=\"attr\">      app:</span> <span class=\"string\">php-mysql-slave-dev</span></span><br><span class=\"line\"><span class=\"attr\">  template:</span></span><br><span class=\"line\"><span class=\"attr\">    metadata:</span></span><br><span class=\"line\"><span class=\"attr\">      labels:</span></span><br><span class=\"line\"><span class=\"attr\">        app:</span> <span class=\"string\">php-mysql-slave-dev</span></span><br><span class=\"line\"><span class=\"attr\">    spec:</span></span><br><span class=\"line\"><span class=\"attr\">      containers:</span></span><br><span class=\"line\"><span class=\"attr\">       - name:</span> <span class=\"string\">php-mysql-slave-dev</span></span><br><span class=\"line\"><span class=\"attr\">         image:</span> <span class=\"string\">hub.boqii.com/bq/mysql-slave:5.7.24</span></span><br><span class=\"line\"><span class=\"attr\">         ports:</span></span><br><span class=\"line\"><span class=\"attr\">         - containerPort:</span> <span class=\"number\">3306</span></span><br><span class=\"line\"><span class=\"attr\">           name:</span> <span class=\"string\">db-port</span></span><br><span class=\"line\"><span class=\"attr\">         resources:</span></span><br><span class=\"line\"><span class=\"attr\">           requests:</span></span><br><span class=\"line\"><span class=\"attr\">             cpu:</span> <span class=\"string\">\"50m\"</span></span><br><span class=\"line\"><span class=\"attr\">           limits:</span></span><br><span class=\"line\"><span class=\"attr\">             cpu:</span> <span class=\"string\">\"1000m\"</span></span><br><span class=\"line\"><span class=\"attr\">         env:</span></span><br><span class=\"line\"><span class=\"attr\">         - name:</span> <span class=\"string\">MYSQL_ROOT_PASSWORD</span></span><br><span class=\"line\"><span class=\"attr\">           value:</span> <span class=\"string\">\"Boqii.123\"</span></span><br><span class=\"line\"><span class=\"attr\">         - name:</span> <span class=\"string\">MYSQL_REPLICATION_USER</span></span><br><span class=\"line\"><span class=\"attr\">           value:</span> <span class=\"string\">\"repl\"</span></span><br><span class=\"line\"><span class=\"attr\">         - name:</span> <span class=\"string\">MYSQL_REPLICATION_PASSWORD</span></span><br><span class=\"line\"><span class=\"attr\">           value:</span> <span class=\"string\">\"7a5b21ac65712bd95e39d3c1\"</span></span><br><span class=\"line\"><span class=\"attr\">         - name:</span> <span class=\"string\">MYSQL_MASTER_SERVICE_HOST</span></span><br><span class=\"line\"><span class=\"attr\">           value:</span> <span class=\"string\">\"php-mysql-master-dev-service\"</span></span><br><span class=\"line\"><span class=\"attr\">         volumeMounts:</span></span><br><span class=\"line\"><span class=\"attr\">         - name:</span> <span class=\"string\">order-slave-dev-data</span></span><br><span class=\"line\"><span class=\"attr\">           mountPath:</span> <span class=\"string\">/var/lib/mysql</span></span><br><span class=\"line\"><span class=\"attr\">         - name:</span> <span class=\"string\">order-slave-dev-cfg</span></span><br><span class=\"line\"><span class=\"attr\">           mountPath:</span> <span class=\"string\">/etc/mysql</span></span><br><span class=\"line\"><span class=\"attr\">      volumes:</span></span><br><span class=\"line\"><span class=\"attr\">        - name:</span> <span class=\"string\">order-slave-dev-data</span></span><br><span class=\"line\"><span class=\"attr\">          hostPath:</span></span><br><span class=\"line\"><span class=\"attr\">            path:</span> <span class=\"string\">/data/k8s-container/php-mysql-dev/slave/data</span></span><br><span class=\"line\"><span class=\"attr\">        - name:</span> <span class=\"string\">order-slave-dev-cfg</span></span><br><span class=\"line\"><span class=\"attr\">          hostPath:</span></span><br><span class=\"line\"><span class=\"attr\">            path:</span> <span class=\"string\">/data/k8s-container/php-mysql-dev/slave/etc-mysql</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Service</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  labels:</span></span><br><span class=\"line\"><span class=\"attr\">    app:</span> <span class=\"string\">php-mysql-slave-dev</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">php-mysql-slave-dev-service</span></span><br><span class=\"line\"><span class=\"attr\">  namespace:</span> <span class=\"string\">db</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\">  type:</span> <span class=\"string\">NodePort</span></span><br><span class=\"line\"><span class=\"attr\">  ports:</span></span><br><span class=\"line\"><span class=\"attr\">    - port:</span> <span class=\"number\">3306</span></span><br><span class=\"line\"><span class=\"attr\">      name:</span> <span class=\"string\">db-port</span></span><br><span class=\"line\"><span class=\"attr\">      targetPort:</span> <span class=\"number\">3306</span></span><br><span class=\"line\"><span class=\"attr\">      nodePort:</span> <span class=\"number\">23307</span></span><br><span class=\"line\"><span class=\"attr\">      protocol:</span> <span class=\"string\">TCP</span></span><br><span class=\"line\"><span class=\"attr\">  selector:</span></span><br><span class=\"line\"><span class=\"attr\">    app:</span> <span class=\"string\">php-mysql-slave-dev</span></span><br></pre></td></tr></table></figure>\n\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width=\"100\" height=\"100\" style=\"border: 0\">\n<font color=\"blue\" face=\"黑体\" size=\"5\"> 问题总结 </font>\n</center>\n\n\n<ul>\n<li>从库的replay log名字会根据docker主机名变化, 也可以写在配置文件</li>\n</ul>\n<figure class=\"highlight awk\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Dockerfile中可以添加</span></span><br><span class=\"line\">run sed -i <span class=\"string\">'/\\[mysqld\\]/a relay-log-index=php-mysql-shoporder-slave-dev-relay-bin.index'</span> <span class=\"regexp\">/etc/my</span>sql<span class=\"regexp\">/mysql.conf.d/my</span>sqld.cnf</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>注意MYSQL_MASTER_SERVICE_HOST 变量的配置, 根据你master的service变化</p>\n</li>\n<li><p>其次我docker-entrypoint.sh 文件几次手动从页面复制粘贴下来的导致各种语法错误,这里建议找到对的版本从github克隆, 或者从mysql:5.7.24镜像中cp</p>\n</li>\n</ul>\n<h3 id=\"附录\"><a href=\"#附录\" class=\"headerlink\" title=\"附录\"></a>附录</h3><p><a href=\"http://zhangzw001.github.io/sh/master-docker-entrypoint.sh\">master配置docker-entrypoint.sh</a><br><a href=\"http://zhangzw001.github.io/sh/slave-docker-entrypoint.sh\">slave配置docker-entrypoint.sh</a></p>\n","site":{"data":{}},"length":5396,"excerpt":"<p>k8s上简单部署mysql5.7.24主从 </p>","more":"<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width=\"100\" height=\"100\" style=\"border: 0\">\n<font color=\"blue\" face=\"黑体\" size=\"5\"> k8s搭建mysql5.7.24主从 </font>\n</center>\n\n\n<p>参考文档<br><a href=\"https://www.jianshu.com/p/509b65e9a4f5\" target=\"_blank\" rel=\"noopener\">利用Kubernetes搭建mysql主从复制集群</a><br><a href=\"https://github.com/docker-library/mysql\" target=\"_blank\" rel=\"noopener\">官方dockerfile</a></p>\n<h3 id=\"从hub-docker-com拉取官方镜像\"><a href=\"#从hub-docker-com拉取官方镜像\" class=\"headerlink\" title=\"从hub.docker.com拉取官方镜像\"></a>从hub.docker.com拉取官方镜像</h3><figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">docker</span> <span class=\"selector-tag\">pull</span> <span class=\"selector-tag\">mysql</span><span class=\"selector-pseudo\">:5.7.24</span></span><br></pre></td></tr></table></figure>\n\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width=\"100\" height=\"100\" style=\"border: 0\">\n<font color=\"blue\" face=\"黑体\" size=\"5\"> build镜像 </font>\n</center>\n\n<h3 id=\"主库master的Dockerfile\"><a href=\"#主库master的Dockerfile\" class=\"headerlink\" title=\"主库master的Dockerfile\"></a>主库master的Dockerfile</h3><figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">from mysql:<span class=\"number\">5.7</span>.<span class=\"number\">24</span></span><br><span class=\"line\"></span><br><span class=\"line\">run sed -<span class=\"selector-tag\">i</span> <span class=\"string\">'/\\[mysqld\\]/a server-id=1\\nlog-bin'</span> /etc/mysql/mysql<span class=\"selector-class\">.conf</span><span class=\"selector-class\">.d</span>/mysqld.cnf</span><br><span class=\"line\"></span><br><span class=\"line\">COPY docker-entrypoint<span class=\"selector-class\">.sh</span> /usr/local/bin/</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"主库的docker-entrypoint-sh\"><a href=\"#主库的docker-entrypoint-sh\" class=\"headerlink\" title=\"主库的docker-entrypoint.sh\"></a>主库的docker-entrypoint.sh</h3><ul>\n<li>先从初始镜像取 或者从github对应版本上</li>\n</ul>\n<figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -dti <span class=\"string\">mysql:</span><span class=\"number\">5.7</span><span class=\"number\">.24</span> <span class=\"regexp\">/bin/</span>bash</span><br><span class=\"line\"></span><br><span class=\"line\">docker cp <span class=\"number\">2</span><span class=\"string\">bfa6209d120c23:</span><span class=\"regexp\">/usr/</span>local<span class=\"regexp\">/bin/</span>docker-entrypoint.sh .</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>修改docker-entrypoint.sh</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"comment\"># 添加以下内容</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"CREATE USER '<span class=\"variable\">$MYSQL_REPLICATION_USER</span>'@'%' IDENTIFIED BY '<span class=\"variable\">$MYSQL_REPLICATION_PASSWORD</span>' ;\"</span> | <span class=\"string\">\"<span class=\"variable\">$&#123;mysql[@]&#125;</span>\"</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"GRANT REPLICATION SLAVE ON *.* TO '<span class=\"variable\">$MYSQL_REPLICATION_USER</span>'@'%' IDENTIFIED BY '<span class=\"variable\">$MYSQL_REPLICATION_PASSWORD</span>' ;\"</span> | <span class=\"string\">\"<span class=\"variable\">$&#123;mysql[@]&#125;</span>\"</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"FLUSH PRIVILEGES ;\"</span> | <span class=\"string\">\"<span class=\"variable\">$&#123;mysql[@]&#125;</span>\"</span></span><br><span class=\"line\"><span class=\"comment\"># 添加以上内容</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span></span><br><span class=\"line\">  ls /docker-entrypoint-initdb.d/ &gt; /dev/null</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>build主库镜像</li>\n</ul>\n<figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker build -t hub<span class=\"selector-class\">.boqii</span><span class=\"selector-class\">.com</span>/bq/mysql-master:<span class=\"number\">5.7</span>.<span class=\"number\">24</span> .</span><br><span class=\"line\">docker push hub<span class=\"selector-class\">.boqii</span><span class=\"selector-class\">.com</span>/bq/mysql-master:<span class=\"number\">5.7</span>.<span class=\"number\">24</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"从库的docker-entrypoint-sh\"><a href=\"#从库的docker-entrypoint-sh\" class=\"headerlink\" title=\"从库的docker-entrypoint.sh\"></a>从库的docker-entrypoint.sh</h3><ul>\n<li>同上先从初始镜像取 或者从github对应版本上 或复制上面的文件</li>\n<li>修改docker-entrypoint.sh</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"comment\"># 添加以下内容</span></span><br><span class=\"line\"> <span class=\"built_in\">echo</span> <span class=\"string\">\"STOP SLAVE;\"</span> | <span class=\"string\">\"<span class=\"variable\">$&#123;mysql[@]&#125;</span>\"</span></span><br><span class=\"line\"> <span class=\"built_in\">echo</span> <span class=\"string\">\"CHANGE MASTER TO master_host='<span class=\"variable\">$MYSQL_MASTER_SERVICE_HOST</span>', master_user='<span class=\"variable\">$MYSQL_REPLICATION_USER</span>', master_password='<span class=\"variable\">$MYSQL_REPLICATION_PASSWORD</span>' ;\"</span> |  <span class=\"string\">\"<span class=\"variable\">$&#123;mysql[@]&#125;</span>\"</span></span><br><span class=\"line\"> <span class=\"built_in\">echo</span> <span class=\"string\">\"START SLAVE;\"</span> | <span class=\"string\">\"<span class=\"variable\">$&#123;mysql[@]&#125;</span>\"</span></span><br><span class=\"line\"> <span class=\"comment\"># 添加以上内容</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span></span><br><span class=\"line\">  ls /docker-entrypoint-initdb.d/ &gt; /dev/null</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>build从库镜像</li>\n</ul>\n<figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker build -t hub<span class=\"selector-class\">.boqii</span><span class=\"selector-class\">.com</span>/bq/mysql-slave:<span class=\"number\">5.7</span>.<span class=\"number\">24</span> .</span><br><span class=\"line\">docker push hub<span class=\"selector-class\">.boqii</span><span class=\"selector-class\">.com</span>/bq/mysql-slave:<span class=\"number\">5.7</span>.<span class=\"number\">24</span></span><br></pre></td></tr></table></figure>\n\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width=\"100\" height=\"100\" style=\"border: 0\">\n<font color=\"blue\" face=\"黑体\" size=\"5\"> 开始部署 </font>\n</center>\n\n\n<ul>\n<li>k8s-master-mysql_5.7.24.yml</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1beta1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">StatefulSet</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  labels:</span></span><br><span class=\"line\"><span class=\"attr\">    app:</span> <span class=\"string\">php-mysql-master-dev</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">php-mysql-master-dev</span></span><br><span class=\"line\"><span class=\"attr\">  namespace:</span> <span class=\"string\">db</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\">  serviceName:</span> <span class=\"string\">\"php-mysql-master-dev\"</span></span><br><span class=\"line\"><span class=\"attr\">  replicas:</span> <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"attr\">  selector:</span></span><br><span class=\"line\"><span class=\"attr\">    matchLabels:</span></span><br><span class=\"line\"><span class=\"attr\">      app:</span> <span class=\"string\">php-mysql-master-dev</span></span><br><span class=\"line\"><span class=\"attr\">  template:</span></span><br><span class=\"line\"><span class=\"attr\">    metadata:</span></span><br><span class=\"line\"><span class=\"attr\">      labels:</span></span><br><span class=\"line\"><span class=\"attr\">        app:</span> <span class=\"string\">php-mysql-master-dev</span></span><br><span class=\"line\"><span class=\"attr\">    spec:</span></span><br><span class=\"line\"><span class=\"attr\">      containers:</span></span><br><span class=\"line\"><span class=\"attr\">       - name:</span> <span class=\"string\">php-mysql-master-dev</span></span><br><span class=\"line\"><span class=\"attr\">         image:</span> <span class=\"string\">hub.boqii.com/bq/mysql-master:5.7.24</span></span><br><span class=\"line\"><span class=\"attr\">         ports:</span></span><br><span class=\"line\"><span class=\"attr\">         - containerPort:</span> <span class=\"number\">3306</span></span><br><span class=\"line\"><span class=\"attr\">           name:</span> <span class=\"string\">db-port</span></span><br><span class=\"line\"><span class=\"attr\">         resources:</span></span><br><span class=\"line\"><span class=\"attr\">           requests:</span></span><br><span class=\"line\"><span class=\"attr\">             cpu:</span> <span class=\"string\">\"50m\"</span></span><br><span class=\"line\"><span class=\"attr\">           limits:</span></span><br><span class=\"line\"><span class=\"attr\">             cpu:</span> <span class=\"string\">\"1000m\"</span></span><br><span class=\"line\"><span class=\"attr\">         env:</span></span><br><span class=\"line\"><span class=\"attr\">         - name:</span> <span class=\"string\">MYSQL_ROOT_PASSWORD</span></span><br><span class=\"line\"><span class=\"attr\">           value:</span> <span class=\"string\">\"Boqii.123\"</span></span><br><span class=\"line\"><span class=\"attr\">         - name:</span> <span class=\"string\">MYSQL_REPLICATION_USER</span></span><br><span class=\"line\"><span class=\"attr\">           value:</span> <span class=\"string\">\"repl\"</span></span><br><span class=\"line\"><span class=\"attr\">         - name:</span> <span class=\"string\">MYSQL_REPLICATION_PASSWORD</span></span><br><span class=\"line\"><span class=\"attr\">           value:</span> <span class=\"string\">\"7a5b21ac65712bd95e39d3c1\"</span></span><br><span class=\"line\"><span class=\"attr\">         volumeMounts:</span></span><br><span class=\"line\"><span class=\"attr\">         - name:</span> <span class=\"string\">order-master-dev-data</span></span><br><span class=\"line\"><span class=\"attr\">           mountPath:</span> <span class=\"string\">/var/lib/mysql</span></span><br><span class=\"line\"><span class=\"attr\">         - name:</span> <span class=\"string\">order-master-dev-cfg</span></span><br><span class=\"line\"><span class=\"attr\">           mountPath:</span> <span class=\"string\">/etc/mysql</span></span><br><span class=\"line\"><span class=\"attr\">      volumes:</span></span><br><span class=\"line\"><span class=\"attr\">        - name:</span> <span class=\"string\">order-master-dev-data</span></span><br><span class=\"line\"><span class=\"attr\">          hostPath:</span></span><br><span class=\"line\"><span class=\"attr\">            path:</span> <span class=\"string\">/data/k8s-container/php-mysql-dev/master/data</span></span><br><span class=\"line\"><span class=\"attr\">        - name:</span> <span class=\"string\">order-master-dev-cfg</span></span><br><span class=\"line\"><span class=\"attr\">          hostPath:</span></span><br><span class=\"line\"><span class=\"attr\">            path:</span> <span class=\"string\">/data/k8s-container/php-mysql-dev/master/etc-mysql</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Service</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  labels:</span></span><br><span class=\"line\"><span class=\"attr\">    app:</span> <span class=\"string\">php-mysql-master-dev</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">php-mysql-master-dev-service</span></span><br><span class=\"line\"><span class=\"attr\">  namespace:</span> <span class=\"string\">db</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\">  type:</span> <span class=\"string\">NodePort</span></span><br><span class=\"line\"><span class=\"attr\">  ports:</span></span><br><span class=\"line\"><span class=\"attr\">    - port:</span> <span class=\"number\">3306</span></span><br><span class=\"line\"><span class=\"attr\">      name:</span> <span class=\"string\">db-port</span></span><br><span class=\"line\"><span class=\"attr\">      targetPort:</span> <span class=\"number\">3306</span></span><br><span class=\"line\"><span class=\"attr\">      nodePort:</span> <span class=\"number\">23306</span></span><br><span class=\"line\"><span class=\"attr\">      protocol:</span> <span class=\"string\">TCP</span></span><br><span class=\"line\"><span class=\"attr\">  selector:</span></span><br><span class=\"line\"><span class=\"attr\">    app:</span> <span class=\"string\">php-mysql-master-dev</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>k8s-slave-mysql_5.7.24.yml</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1beta1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">StatefulSet</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  labels:</span></span><br><span class=\"line\"><span class=\"attr\">    app:</span> <span class=\"string\">php-mysql-slave-dev</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">php-mysql-slave-dev</span></span><br><span class=\"line\"><span class=\"attr\">  namespace:</span> <span class=\"string\">db</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\">  serviceName:</span> <span class=\"string\">\"php-mysql-slave-dev\"</span></span><br><span class=\"line\"><span class=\"attr\">  replicas:</span> <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"attr\">  selector:</span></span><br><span class=\"line\"><span class=\"attr\">    matchLabels:</span></span><br><span class=\"line\"><span class=\"attr\">      app:</span> <span class=\"string\">php-mysql-slave-dev</span></span><br><span class=\"line\"><span class=\"attr\">  template:</span></span><br><span class=\"line\"><span class=\"attr\">    metadata:</span></span><br><span class=\"line\"><span class=\"attr\">      labels:</span></span><br><span class=\"line\"><span class=\"attr\">        app:</span> <span class=\"string\">php-mysql-slave-dev</span></span><br><span class=\"line\"><span class=\"attr\">    spec:</span></span><br><span class=\"line\"><span class=\"attr\">      containers:</span></span><br><span class=\"line\"><span class=\"attr\">       - name:</span> <span class=\"string\">php-mysql-slave-dev</span></span><br><span class=\"line\"><span class=\"attr\">         image:</span> <span class=\"string\">hub.boqii.com/bq/mysql-slave:5.7.24</span></span><br><span class=\"line\"><span class=\"attr\">         ports:</span></span><br><span class=\"line\"><span class=\"attr\">         - containerPort:</span> <span class=\"number\">3306</span></span><br><span class=\"line\"><span class=\"attr\">           name:</span> <span class=\"string\">db-port</span></span><br><span class=\"line\"><span class=\"attr\">         resources:</span></span><br><span class=\"line\"><span class=\"attr\">           requests:</span></span><br><span class=\"line\"><span class=\"attr\">             cpu:</span> <span class=\"string\">\"50m\"</span></span><br><span class=\"line\"><span class=\"attr\">           limits:</span></span><br><span class=\"line\"><span class=\"attr\">             cpu:</span> <span class=\"string\">\"1000m\"</span></span><br><span class=\"line\"><span class=\"attr\">         env:</span></span><br><span class=\"line\"><span class=\"attr\">         - name:</span> <span class=\"string\">MYSQL_ROOT_PASSWORD</span></span><br><span class=\"line\"><span class=\"attr\">           value:</span> <span class=\"string\">\"Boqii.123\"</span></span><br><span class=\"line\"><span class=\"attr\">         - name:</span> <span class=\"string\">MYSQL_REPLICATION_USER</span></span><br><span class=\"line\"><span class=\"attr\">           value:</span> <span class=\"string\">\"repl\"</span></span><br><span class=\"line\"><span class=\"attr\">         - name:</span> <span class=\"string\">MYSQL_REPLICATION_PASSWORD</span></span><br><span class=\"line\"><span class=\"attr\">           value:</span> <span class=\"string\">\"7a5b21ac65712bd95e39d3c1\"</span></span><br><span class=\"line\"><span class=\"attr\">         - name:</span> <span class=\"string\">MYSQL_MASTER_SERVICE_HOST</span></span><br><span class=\"line\"><span class=\"attr\">           value:</span> <span class=\"string\">\"php-mysql-master-dev-service\"</span></span><br><span class=\"line\"><span class=\"attr\">         volumeMounts:</span></span><br><span class=\"line\"><span class=\"attr\">         - name:</span> <span class=\"string\">order-slave-dev-data</span></span><br><span class=\"line\"><span class=\"attr\">           mountPath:</span> <span class=\"string\">/var/lib/mysql</span></span><br><span class=\"line\"><span class=\"attr\">         - name:</span> <span class=\"string\">order-slave-dev-cfg</span></span><br><span class=\"line\"><span class=\"attr\">           mountPath:</span> <span class=\"string\">/etc/mysql</span></span><br><span class=\"line\"><span class=\"attr\">      volumes:</span></span><br><span class=\"line\"><span class=\"attr\">        - name:</span> <span class=\"string\">order-slave-dev-data</span></span><br><span class=\"line\"><span class=\"attr\">          hostPath:</span></span><br><span class=\"line\"><span class=\"attr\">            path:</span> <span class=\"string\">/data/k8s-container/php-mysql-dev/slave/data</span></span><br><span class=\"line\"><span class=\"attr\">        - name:</span> <span class=\"string\">order-slave-dev-cfg</span></span><br><span class=\"line\"><span class=\"attr\">          hostPath:</span></span><br><span class=\"line\"><span class=\"attr\">            path:</span> <span class=\"string\">/data/k8s-container/php-mysql-dev/slave/etc-mysql</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Service</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  labels:</span></span><br><span class=\"line\"><span class=\"attr\">    app:</span> <span class=\"string\">php-mysql-slave-dev</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">php-mysql-slave-dev-service</span></span><br><span class=\"line\"><span class=\"attr\">  namespace:</span> <span class=\"string\">db</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\">  type:</span> <span class=\"string\">NodePort</span></span><br><span class=\"line\"><span class=\"attr\">  ports:</span></span><br><span class=\"line\"><span class=\"attr\">    - port:</span> <span class=\"number\">3306</span></span><br><span class=\"line\"><span class=\"attr\">      name:</span> <span class=\"string\">db-port</span></span><br><span class=\"line\"><span class=\"attr\">      targetPort:</span> <span class=\"number\">3306</span></span><br><span class=\"line\"><span class=\"attr\">      nodePort:</span> <span class=\"number\">23307</span></span><br><span class=\"line\"><span class=\"attr\">      protocol:</span> <span class=\"string\">TCP</span></span><br><span class=\"line\"><span class=\"attr\">  selector:</span></span><br><span class=\"line\"><span class=\"attr\">    app:</span> <span class=\"string\">php-mysql-slave-dev</span></span><br></pre></td></tr></table></figure>\n\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width=\"100\" height=\"100\" style=\"border: 0\">\n<font color=\"blue\" face=\"黑体\" size=\"5\"> 问题总结 </font>\n</center>\n\n\n<ul>\n<li>从库的replay log名字会根据docker主机名变化, 也可以写在配置文件</li>\n</ul>\n<figure class=\"highlight awk\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Dockerfile中可以添加</span></span><br><span class=\"line\">run sed -i <span class=\"string\">'/\\[mysqld\\]/a relay-log-index=php-mysql-shoporder-slave-dev-relay-bin.index'</span> <span class=\"regexp\">/etc/my</span>sql<span class=\"regexp\">/mysql.conf.d/my</span>sqld.cnf</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>注意MYSQL_MASTER_SERVICE_HOST 变量的配置, 根据你master的service变化</p>\n</li>\n<li><p>其次我docker-entrypoint.sh 文件几次手动从页面复制粘贴下来的导致各种语法错误,这里建议找到对的版本从github克隆, 或者从mysql:5.7.24镜像中cp</p>\n</li>\n</ul>\n<h3 id=\"附录\"><a href=\"#附录\" class=\"headerlink\" title=\"附录\"></a>附录</h3><p><a href=\"http://zhangzw001.github.io/sh/master-docker-entrypoint.sh\">master配置docker-entrypoint.sh</a><br><a href=\"http://zhangzw001.github.io/sh/slave-docker-entrypoint.sh\">slave配置docker-entrypoint.sh</a></p>"},{"title":"k8s遇到的一些问题统计总结","date":"2019-09-20T01:20:39.000Z","copyright":true,"top":10,"_content":"\n 不定时更新,文章可能比较散乱,>_<\n\n<!-- more -->\n\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width = \"100\" height = \"100\" style=\"border: 0\"/>\n</center>\n\n### 1. 单机版k8s pod一直是pending的问题\n> describe一下pod会发现错误: 1 node(s) had taints that the pod didn't tolerate.\n> 这是因为master上存在污点,pod不会再改节点上创建\n> 两种办法:\n\n\n- deploy 的时候加上 容忍该污点\n- 直接取消master上的污点 \n\n```\n# 取消master上污点\n  kubectl taint nodes --all node-role.kubernetes.io/master-\n\n# 查看taint\nkubectl describe node node1\n```\n\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width = \"100\" height = \"100\" style=\"border: 0\"/>\n</center>\n\n### 2. 修改service-node-port-range\n\n> 由于traefik部署需要对外开放80端口, 但默认仅允许30000以上端口\n\n```\n# kubeadm 1.14 配置\napiServer:\n  extraArgs:\n    authorization-mode: Node,RBAC\n    service-node-port-range: 79-33000\n\n# kubeadm 1.10配置\napiServerExtraArgs:\n  service-node-port-range: 79-33000\n```\n\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width = \"100\" height = \"100\" style=\"border: 0\"/>\n</center>\n\n### 3. traefik断电后重新启动报错 command traefik error: field not found, node: redirect\n\n```\n看到这个错误猜测可能是用的latest镜像问题, 从hub.docker.com 查看更新了v2.0+的版本\n\n将traefik的deployment配置中 image改成 traefik:1.7\n\n重新部署后 问题解\n```\n\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width = \"100\" height = \"100\" style=\"border: 0\"/>\n</center>\n\n### 4. 查看当前集群的(CustomResourceDefinition)\n```\n# 查看k8s有哪些api\nkubectl api-versions\n\n# 查看当前crd\nkubectl get crd\n\n# 其次查看该api是什么版本\nkubectl describe crd destinationrules.networking.istio.io\n\n```\n","source":"_posts/3-k8s遇到的一些问题统计总结.md","raw":"---\ntitle: k8s遇到的一些问题统计总结\ndate: 2019-09-20 09:20:39\ncopyright: true\ntags:\n  - k8s\ncategories:\n  - [技术文档]\n  - [k8s,问题总结]\ntop: 10\n---\n\n 不定时更新,文章可能比较散乱,>_<\n\n<!-- more -->\n\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width = \"100\" height = \"100\" style=\"border: 0\"/>\n</center>\n\n### 1. 单机版k8s pod一直是pending的问题\n> describe一下pod会发现错误: 1 node(s) had taints that the pod didn't tolerate.\n> 这是因为master上存在污点,pod不会再改节点上创建\n> 两种办法:\n\n\n- deploy 的时候加上 容忍该污点\n- 直接取消master上的污点 \n\n```\n# 取消master上污点\n  kubectl taint nodes --all node-role.kubernetes.io/master-\n\n# 查看taint\nkubectl describe node node1\n```\n\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width = \"100\" height = \"100\" style=\"border: 0\"/>\n</center>\n\n### 2. 修改service-node-port-range\n\n> 由于traefik部署需要对外开放80端口, 但默认仅允许30000以上端口\n\n```\n# kubeadm 1.14 配置\napiServer:\n  extraArgs:\n    authorization-mode: Node,RBAC\n    service-node-port-range: 79-33000\n\n# kubeadm 1.10配置\napiServerExtraArgs:\n  service-node-port-range: 79-33000\n```\n\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width = \"100\" height = \"100\" style=\"border: 0\"/>\n</center>\n\n### 3. traefik断电后重新启动报错 command traefik error: field not found, node: redirect\n\n```\n看到这个错误猜测可能是用的latest镜像问题, 从hub.docker.com 查看更新了v2.0+的版本\n\n将traefik的deployment配置中 image改成 traefik:1.7\n\n重新部署后 问题解\n```\n\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width = \"100\" height = \"100\" style=\"border: 0\"/>\n</center>\n\n### 4. 查看当前集群的(CustomResourceDefinition)\n```\n# 查看k8s有哪些api\nkubectl api-versions\n\n# 查看当前crd\nkubectl get crd\n\n# 其次查看该api是什么版本\nkubectl describe crd destinationrules.networking.istio.io\n\n```\n","slug":"3-k8s遇到的一些问题统计总结","published":1,"updated":"2019-10-17T02:25:58.878Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck28uwzn3000pkerwoocywfph","content":"<p> 不定时更新,文章可能比较散乱,&gt;_&lt;</p>\n<a id=\"more\"></a>\n\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width=\"100\" height=\"100\" style=\"border: 0\">\n</center>\n\n<h3 id=\"1-单机版k8s-pod一直是pending的问题\"><a href=\"#1-单机版k8s-pod一直是pending的问题\" class=\"headerlink\" title=\"1. 单机版k8s pod一直是pending的问题\"></a>1. 单机版k8s pod一直是pending的问题</h3><blockquote>\n<p>describe一下pod会发现错误: 1 node(s) had taints that the pod didn’t tolerate.<br>这是因为master上存在污点,pod不会再改节点上创建<br>两种办法:</p>\n</blockquote>\n<ul>\n<li>deploy 的时候加上 容忍该污点</li>\n<li>直接取消master上的污点 </li>\n</ul>\n<figure class=\"highlight crmsh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 取消master上污点</span></span><br><span class=\"line\">  kubectl taint nodes --all <span class=\"keyword\">node</span><span class=\"title\">-role</span>.kubernetes.io/<span class=\"literal\">master</span>-</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 查看taint</span></span><br><span class=\"line\">kubectl describe <span class=\"keyword\">node</span> <span class=\"title\">node1</span></span><br></pre></td></tr></table></figure>\n\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width=\"100\" height=\"100\" style=\"border: 0\">\n</center>\n\n<h3 id=\"2-修改service-node-port-range\"><a href=\"#2-修改service-node-port-range\" class=\"headerlink\" title=\"2. 修改service-node-port-range\"></a>2. 修改service-node-port-range</h3><blockquote>\n<p>由于traefik部署需要对外开放80端口, 但默认仅允许30000以上端口</p>\n</blockquote>\n<figure class=\"highlight crmsh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># kubeadm 1.14 配置</span></span><br><span class=\"line\">apiServer:</span><br><span class=\"line\">  extraArgs:</span><br><span class=\"line\">    authorization-mode: <span class=\"keyword\">Node</span><span class=\"title\">,RBAC</span></span><br><span class=\"line\">    service-<span class=\"keyword\">node</span>-port-range:<span class=\"title\"> 79-33000</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># kubeadm 1.10配置</span></span><br><span class=\"line\">apiServerExtraArgs:</span><br><span class=\"line\">  service-<span class=\"keyword\">node</span>-port-range:<span class=\"title\"> 79-33000</span></span><br></pre></td></tr></table></figure>\n\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width=\"100\" height=\"100\" style=\"border: 0\">\n</center>\n\n<h3 id=\"3-traefik断电后重新启动报错-command-traefik-error-field-not-found-node-redirect\"><a href=\"#3-traefik断电后重新启动报错-command-traefik-error-field-not-found-node-redirect\" class=\"headerlink\" title=\"3. traefik断电后重新启动报错 command traefik error: field not found, node: redirect\"></a>3. traefik断电后重新启动报错 command traefik error: field not found, node: redirect</h3><figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">看到这个错误猜测可能是用的<span class=\"selector-tag\">latest</span>镜像问题, 从<span class=\"selector-tag\">hub</span><span class=\"selector-class\">.docker</span><span class=\"selector-class\">.com</span> 查看更新了<span class=\"selector-tag\">v2</span><span class=\"selector-class\">.0</span>+的版本</span><br><span class=\"line\"></span><br><span class=\"line\">将<span class=\"selector-tag\">traefik</span>的<span class=\"selector-tag\">deployment</span>配置中 <span class=\"selector-tag\">image</span>改成 <span class=\"selector-tag\">traefik</span><span class=\"selector-pseudo\">:1.7</span></span><br><span class=\"line\"></span><br><span class=\"line\">重新部署后 问题解</span><br></pre></td></tr></table></figure>\n\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width=\"100\" height=\"100\" style=\"border: 0\">\n</center>\n\n<h3 id=\"4-查看当前集群的-CustomResourceDefinition\"><a href=\"#4-查看当前集群的-CustomResourceDefinition\" class=\"headerlink\" title=\"4. 查看当前集群的(CustomResourceDefinition)\"></a>4. 查看当前集群的(CustomResourceDefinition)</h3><figure class=\"highlight vala\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\"># 查看k8s有哪些api</span></span><br><span class=\"line\">kubectl api-versions</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\"># 查看当前crd</span></span><br><span class=\"line\">kubectl <span class=\"keyword\">get</span> crd</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\"># 其次查看该api是什么版本</span></span><br><span class=\"line\">kubectl describe crd destinationrules.networking.istio.io</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"length":911,"excerpt":"<p> 不定时更新,文章可能比较散乱,&gt;_&lt;</p>","more":"<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width=\"100\" height=\"100\" style=\"border: 0\">\n</center>\n\n<h3 id=\"1-单机版k8s-pod一直是pending的问题\"><a href=\"#1-单机版k8s-pod一直是pending的问题\" class=\"headerlink\" title=\"1. 单机版k8s pod一直是pending的问题\"></a>1. 单机版k8s pod一直是pending的问题</h3><blockquote>\n<p>describe一下pod会发现错误: 1 node(s) had taints that the pod didn’t tolerate.<br>这是因为master上存在污点,pod不会再改节点上创建<br>两种办法:</p>\n</blockquote>\n<ul>\n<li>deploy 的时候加上 容忍该污点</li>\n<li>直接取消master上的污点 </li>\n</ul>\n<figure class=\"highlight crmsh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 取消master上污点</span></span><br><span class=\"line\">  kubectl taint nodes --all <span class=\"keyword\">node</span><span class=\"title\">-role</span>.kubernetes.io/<span class=\"literal\">master</span>-</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 查看taint</span></span><br><span class=\"line\">kubectl describe <span class=\"keyword\">node</span> <span class=\"title\">node1</span></span><br></pre></td></tr></table></figure>\n\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width=\"100\" height=\"100\" style=\"border: 0\">\n</center>\n\n<h3 id=\"2-修改service-node-port-range\"><a href=\"#2-修改service-node-port-range\" class=\"headerlink\" title=\"2. 修改service-node-port-range\"></a>2. 修改service-node-port-range</h3><blockquote>\n<p>由于traefik部署需要对外开放80端口, 但默认仅允许30000以上端口</p>\n</blockquote>\n<figure class=\"highlight crmsh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># kubeadm 1.14 配置</span></span><br><span class=\"line\">apiServer:</span><br><span class=\"line\">  extraArgs:</span><br><span class=\"line\">    authorization-mode: <span class=\"keyword\">Node</span><span class=\"title\">,RBAC</span></span><br><span class=\"line\">    service-<span class=\"keyword\">node</span>-port-range:<span class=\"title\"> 79-33000</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># kubeadm 1.10配置</span></span><br><span class=\"line\">apiServerExtraArgs:</span><br><span class=\"line\">  service-<span class=\"keyword\">node</span>-port-range:<span class=\"title\"> 79-33000</span></span><br></pre></td></tr></table></figure>\n\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width=\"100\" height=\"100\" style=\"border: 0\">\n</center>\n\n<h3 id=\"3-traefik断电后重新启动报错-command-traefik-error-field-not-found-node-redirect\"><a href=\"#3-traefik断电后重新启动报错-command-traefik-error-field-not-found-node-redirect\" class=\"headerlink\" title=\"3. traefik断电后重新启动报错 command traefik error: field not found, node: redirect\"></a>3. traefik断电后重新启动报错 command traefik error: field not found, node: redirect</h3><figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">看到这个错误猜测可能是用的<span class=\"selector-tag\">latest</span>镜像问题, 从<span class=\"selector-tag\">hub</span><span class=\"selector-class\">.docker</span><span class=\"selector-class\">.com</span> 查看更新了<span class=\"selector-tag\">v2</span><span class=\"selector-class\">.0</span>+的版本</span><br><span class=\"line\"></span><br><span class=\"line\">将<span class=\"selector-tag\">traefik</span>的<span class=\"selector-tag\">deployment</span>配置中 <span class=\"selector-tag\">image</span>改成 <span class=\"selector-tag\">traefik</span><span class=\"selector-pseudo\">:1.7</span></span><br><span class=\"line\"></span><br><span class=\"line\">重新部署后 问题解</span><br></pre></td></tr></table></figure>\n\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width=\"100\" height=\"100\" style=\"border: 0\">\n</center>\n\n<h3 id=\"4-查看当前集群的-CustomResourceDefinition\"><a href=\"#4-查看当前集群的-CustomResourceDefinition\" class=\"headerlink\" title=\"4. 查看当前集群的(CustomResourceDefinition)\"></a>4. 查看当前集群的(CustomResourceDefinition)</h3><figure class=\"highlight vala\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\"># 查看k8s有哪些api</span></span><br><span class=\"line\">kubectl api-versions</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\"># 查看当前crd</span></span><br><span class=\"line\">kubectl <span class=\"keyword\">get</span> crd</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\"># 其次查看该api是什么版本</span></span><br><span class=\"line\">kubectl describe crd destinationrules.networking.istio.io</span><br></pre></td></tr></table></figure>"},{"title":"hexo鼠标移动和鼠标点击特效","copyright":true,"date":"2019-09-24T08:34:36.000Z","_content":"\n### hexo6 鼠标添加点击出现桃心的特效\n <!-- more -->\n\n来自: [Next主题个性化](https://www.writebug.site/2019/01/02/Next%E4%B8%BB%E9%A2%98%E4%B8%AA%E6%80%A7%E5%8C%96/)\n\n#### 所需要的js文件\n- 未压缩\n```\n! function(e, t, a) {\n    function n() {\n        c(\n            \".heart{width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);}.heart:after,.heart:before{content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: fixed;}.heart:after{top: -5px;}.heart:before{left: -5px;}\"), o(), r()\n    }\n    \n    function r() {\n        for (var e = 0; e < d.length; e++) d[e].alpha <= 0 ? (t.body.removeChild(d[e].el), d.splice(e, 1)) : (d[e].y--, d[e].scale += .004, d[e].alpha -= .013, d[e].el.style.cssText = \"left:\" + d[e].x + \"px;top:\" + d[e].y + \"px;opacity:\" + d[e].alpha + \";transform:scale(\" + d[e].scale + \",\" + d[e].scale + \") rotate(45deg);background:\" + d[e].color + \";z-index:99999\");\n        requestAnimationFrame(r)\n    }\n    \n    function o() {\n        var t = \"function\" == typeof e.onclick && e.onclick;\n        e.onclick = function(e) {\n            t && t(), i(e)\n        }\n    }\n    \n    function i(e) {\n        var a = t.createElement(\"div\");\n        a.className = \"heart\", d.push({\n            el: a,\n            x: e.clientX - 5,\n            y: e.clientY - 5,\n            scale: 1,\n            alpha: 1,\n            color: s()\n        }), t.body.appendChild(a)\n    }\n\n    function c(e) {\n        var a = t.createElement(\"style\");\n        a.type = \"text/css\";\n        try {\n            a.appendChild(t.createTextNode(e))\n        } catch (t) {\n            a.styleSheet.cssText = e\n        }\n        t.getElementsByTagName(\"head\")[0].appendChild(a)\n    }\n\n    function s() {\n        return \"rgb(\" + ~~(255 * Math.random()) + \",\" + ~~(255 * Math.random()) + \",\" + ~~(255 * Math.random()) + \")\"\n    }\n    var d = [];\n    e.requestAnimationFrame = function() {\n        return e.requestAnimationFrame || e.webkitRequestAnimationFrame || e.mozRequestAnimationFrame || e.oRequestAnimationFrame || e.msRequestAnimationFrame || function(e) {\n            setTimeout(e, 1e3 / 60)\n        }\n    }(), n()\n}(window, document);\n```\n\n- 压缩后\n```\n!function(e,t,a){function n(){c(\".heart{width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);}.heart:after,.heart:before{content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: fixed;}.heart:after{top: -5px;}.heart:before{left: -5px;}\"),o(),r()}function r(){for(var e=0;e<d.length;e++)d[e].alpha<=0?(t.body.removeChild(d[e].el),d.splice(e,1)):(d[e].y--,d[e].scale+=.004,d[e].alpha-=.013,d[e].el.style.cssText=\"left:\"+d[e].x+\"px;top:\"+d[e].y+\"px;opacity:\"+d[e].alpha+\";transform:scale(\"+d[e].scale+\",\"+d[e].scale+\") rotate(45deg);background:\"+d[e].color+\";z-index:99999\");requestAnimationFrame(r)}function o(){var t=\"function\"==typeof e.onclick&&e.onclick;e.onclick=function(e){t&&t(),i(e)}}function i(e){var a=t.createElement(\"div\");a.className=\"heart\",d.push({el:a,x:e.clientX-5,y:e.clientY-5,scale:1,alpha:1,color:s()}),t.body.appendChild(a)}function c(e){var a=t.createElement(\"style\");a.type=\"text/css\";try{a.appendChild(t.createTextNode(e))}catch(t){a.styleSheet.cssText=e}t.getElementsByTagName(\"head\")[0].appendChild(a)}function s(){return\"rgb(\"+~~(255*Math.random())+\",\"+~~(255*Math.random())+\",\"+~~(255*Math.random())+\")\"}var d=[];e.requestAnimationFrame=function(){return e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame||function(e){setTimeout(e,1e3/60)}}(),n()}(window,document);\n```\n\n#### 将上面的内容贴到新增的themes/nextv6/source/js/src/love.js 文件中\n\n#### 修改themes/nextv6/layout/_layout.swig文件, 末尾添加如下内容\n```\n<!-- 鼠标桃心动画 -->\n<script type=\"text/javascript\" src=\"/js/src/love.js\"></script>\n```\n\n\n### hexo6 鼠标移动添加星星特效\n来自: [愚人节鼠标跟随特效](https://blog.csdn.net/a201577F0546/article/details/89060017)\n\n#### 新增js文件 themes/nextv6/source/js/src/love2.js\n```\n\n/*!\n * Fairy Dust Cursor.js\n * - 90's cursors collection\n * -- https://github.com/tholman/90s-cursor-effects\n * -- http://codepen.io/tholman/full/jWmZxZ/\n */\n\n(function fairyDustCursor() {\n  \n  var possibleColors = [\"#D61C59\", \"#E7D84B\", \"#1B8798\"]\n  var width = window.innerWidth;\n  var height = window.innerHeight;\n  var cursor = {x: width/2, y: width/2};\n  var particles = [];\n  \n  function init() {\n    bindEvents();\n    loop();\n  }\n  \n  // Bind events that are needed\n  function bindEvents() {\n    document.addEventListener('mousemove', onMouseMove);\n    document.addEventListener('touchmove', onTouchMove);\n    document.addEventListener('touchstart', onTouchMove);\n    \n    window.addEventListener('resize', onWindowResize);\n  }\n  \n  function onWindowResize(e) {\n    width = window.innerWidth;\n    height = window.innerHeight;\n  }\n  \n  function onTouchMove(e) {\n    if( e.touches.length > 0 ) {\n      for( var i = 0; i < e.touches.length; i++ ) {\n        addParticle( e.touches[i].clientX, e.touches[i].clientY, possibleColors[Math.floor(Math.random()*possibleColors.length)]);\n      }\n    }\n  }\n  \n  function onMouseMove(e) {    \n    cursor.x = e.clientX;\n    cursor.y = e.clientY;\n    \n    addParticle( cursor.x, cursor.y, possibleColors[Math.floor(Math.random()*possibleColors.length)]);\n  }\n  \n  function addParticle(x, y, color) {\n    var particle = new Particle();\n    particle.init(x, y, color);\n    particles.push(particle);\n  }\n  \n  function updateParticles() {\n    \n    // Updated\n    for( var i = 0; i < particles.length; i++ ) {\n      particles[i].update();\n    }\n    \n    // Remove dead particles\n    for( var i = particles.length -1; i >= 0; i-- ) {\n      if( particles[i].lifeSpan < 0 ) {\n        particles[i].die();\n        particles.splice(i, 1);\n      }\n    }\n    \n  }\n  \n  function loop() {\n    requestAnimationFrame(loop);\n    updateParticles();\n  }\n  \n  /**\n   * Particles\n   */\n  \n  function Particle() {\n\n    this.character = \"*\";\n    this.lifeSpan = 120; //ms\n    this.initialStyles ={\n      \"position\": \"fixed\",\n      \"top\": \"0\", //必须加\n      \"display\": \"block\",\n      \"pointerEvents\": \"none\",\n      \"z-index\": \"10000000\",\n      \"fontSize\": \"20px\",\n      \"will-change\": \"transform\"\n    };\n\n    // Init, and set properties\n    this.init = function(x, y, color) {\n\n      this.velocity = {\n        x:  (Math.random() < 0.5 ? -1 : 1) * (Math.random() / 2),\n        y: 1\n      };\n      \n      this.position = {x: x - 10, y: y - 20};\n      this.initialStyles.color = color;\n      console.log(color);\n\n      this.element = document.createElement('span');\n      this.element.innerHTML = this.character;\n      applyProperties(this.element, this.initialStyles);\n      this.update();\n      \n      document.body.appendChild(this.element);\n    };\n    \n    this.update = function() {\n      this.position.x += this.velocity.x;\n      this.position.y += this.velocity.y;\n      this.lifeSpan--;\n      \n      this.element.style.transform = \"translate3d(\" + this.position.x + \"px,\" + this.position.y + \"px,0) scale(\" + (this.lifeSpan / 120) + \")\";\n    }\n    \n    this.die = function() {\n      this.element.parentNode.removeChild(this.element);\n    }\n    \n  }\n  \n  /**\n   * Utils\n   */\n  \n  // Applies css `properties` to an element.\n  function applyProperties( target, properties ) {\n    for( var key in properties ) {\n      target.style[ key ] = properties[ key ];\n    }\n  }\n  \n  init();\n})();\n```\n\n#### 修改themes/nextv6/layout/_layout.swig文件, 末尾添加如下内容\n```\n<!-- 鼠标移动星星特效 -->\n<script type=\"text/javascript\" src=\"/js/src/love2.js\"></script>\n```\n","source":"_posts/4-hexo鼠标移动和鼠标点击特效.md","raw":"---\ntitle: hexo鼠标移动和鼠标点击特效\ncopyright: true\ndate: 2019-09-24 16:34:36\ntags:\n  - hexo6\n  - 特效\ncategories:\n  - [有趣]\n  - [博客,美化]\n---\n\n### hexo6 鼠标添加点击出现桃心的特效\n <!-- more -->\n\n来自: [Next主题个性化](https://www.writebug.site/2019/01/02/Next%E4%B8%BB%E9%A2%98%E4%B8%AA%E6%80%A7%E5%8C%96/)\n\n#### 所需要的js文件\n- 未压缩\n```\n! function(e, t, a) {\n    function n() {\n        c(\n            \".heart{width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);}.heart:after,.heart:before{content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: fixed;}.heart:after{top: -5px;}.heart:before{left: -5px;}\"), o(), r()\n    }\n    \n    function r() {\n        for (var e = 0; e < d.length; e++) d[e].alpha <= 0 ? (t.body.removeChild(d[e].el), d.splice(e, 1)) : (d[e].y--, d[e].scale += .004, d[e].alpha -= .013, d[e].el.style.cssText = \"left:\" + d[e].x + \"px;top:\" + d[e].y + \"px;opacity:\" + d[e].alpha + \";transform:scale(\" + d[e].scale + \",\" + d[e].scale + \") rotate(45deg);background:\" + d[e].color + \";z-index:99999\");\n        requestAnimationFrame(r)\n    }\n    \n    function o() {\n        var t = \"function\" == typeof e.onclick && e.onclick;\n        e.onclick = function(e) {\n            t && t(), i(e)\n        }\n    }\n    \n    function i(e) {\n        var a = t.createElement(\"div\");\n        a.className = \"heart\", d.push({\n            el: a,\n            x: e.clientX - 5,\n            y: e.clientY - 5,\n            scale: 1,\n            alpha: 1,\n            color: s()\n        }), t.body.appendChild(a)\n    }\n\n    function c(e) {\n        var a = t.createElement(\"style\");\n        a.type = \"text/css\";\n        try {\n            a.appendChild(t.createTextNode(e))\n        } catch (t) {\n            a.styleSheet.cssText = e\n        }\n        t.getElementsByTagName(\"head\")[0].appendChild(a)\n    }\n\n    function s() {\n        return \"rgb(\" + ~~(255 * Math.random()) + \",\" + ~~(255 * Math.random()) + \",\" + ~~(255 * Math.random()) + \")\"\n    }\n    var d = [];\n    e.requestAnimationFrame = function() {\n        return e.requestAnimationFrame || e.webkitRequestAnimationFrame || e.mozRequestAnimationFrame || e.oRequestAnimationFrame || e.msRequestAnimationFrame || function(e) {\n            setTimeout(e, 1e3 / 60)\n        }\n    }(), n()\n}(window, document);\n```\n\n- 压缩后\n```\n!function(e,t,a){function n(){c(\".heart{width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);}.heart:after,.heart:before{content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: fixed;}.heart:after{top: -5px;}.heart:before{left: -5px;}\"),o(),r()}function r(){for(var e=0;e<d.length;e++)d[e].alpha<=0?(t.body.removeChild(d[e].el),d.splice(e,1)):(d[e].y--,d[e].scale+=.004,d[e].alpha-=.013,d[e].el.style.cssText=\"left:\"+d[e].x+\"px;top:\"+d[e].y+\"px;opacity:\"+d[e].alpha+\";transform:scale(\"+d[e].scale+\",\"+d[e].scale+\") rotate(45deg);background:\"+d[e].color+\";z-index:99999\");requestAnimationFrame(r)}function o(){var t=\"function\"==typeof e.onclick&&e.onclick;e.onclick=function(e){t&&t(),i(e)}}function i(e){var a=t.createElement(\"div\");a.className=\"heart\",d.push({el:a,x:e.clientX-5,y:e.clientY-5,scale:1,alpha:1,color:s()}),t.body.appendChild(a)}function c(e){var a=t.createElement(\"style\");a.type=\"text/css\";try{a.appendChild(t.createTextNode(e))}catch(t){a.styleSheet.cssText=e}t.getElementsByTagName(\"head\")[0].appendChild(a)}function s(){return\"rgb(\"+~~(255*Math.random())+\",\"+~~(255*Math.random())+\",\"+~~(255*Math.random())+\")\"}var d=[];e.requestAnimationFrame=function(){return e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame||function(e){setTimeout(e,1e3/60)}}(),n()}(window,document);\n```\n\n#### 将上面的内容贴到新增的themes/nextv6/source/js/src/love.js 文件中\n\n#### 修改themes/nextv6/layout/_layout.swig文件, 末尾添加如下内容\n```\n<!-- 鼠标桃心动画 -->\n<script type=\"text/javascript\" src=\"/js/src/love.js\"></script>\n```\n\n\n### hexo6 鼠标移动添加星星特效\n来自: [愚人节鼠标跟随特效](https://blog.csdn.net/a201577F0546/article/details/89060017)\n\n#### 新增js文件 themes/nextv6/source/js/src/love2.js\n```\n\n/*!\n * Fairy Dust Cursor.js\n * - 90's cursors collection\n * -- https://github.com/tholman/90s-cursor-effects\n * -- http://codepen.io/tholman/full/jWmZxZ/\n */\n\n(function fairyDustCursor() {\n  \n  var possibleColors = [\"#D61C59\", \"#E7D84B\", \"#1B8798\"]\n  var width = window.innerWidth;\n  var height = window.innerHeight;\n  var cursor = {x: width/2, y: width/2};\n  var particles = [];\n  \n  function init() {\n    bindEvents();\n    loop();\n  }\n  \n  // Bind events that are needed\n  function bindEvents() {\n    document.addEventListener('mousemove', onMouseMove);\n    document.addEventListener('touchmove', onTouchMove);\n    document.addEventListener('touchstart', onTouchMove);\n    \n    window.addEventListener('resize', onWindowResize);\n  }\n  \n  function onWindowResize(e) {\n    width = window.innerWidth;\n    height = window.innerHeight;\n  }\n  \n  function onTouchMove(e) {\n    if( e.touches.length > 0 ) {\n      for( var i = 0; i < e.touches.length; i++ ) {\n        addParticle( e.touches[i].clientX, e.touches[i].clientY, possibleColors[Math.floor(Math.random()*possibleColors.length)]);\n      }\n    }\n  }\n  \n  function onMouseMove(e) {    \n    cursor.x = e.clientX;\n    cursor.y = e.clientY;\n    \n    addParticle( cursor.x, cursor.y, possibleColors[Math.floor(Math.random()*possibleColors.length)]);\n  }\n  \n  function addParticle(x, y, color) {\n    var particle = new Particle();\n    particle.init(x, y, color);\n    particles.push(particle);\n  }\n  \n  function updateParticles() {\n    \n    // Updated\n    for( var i = 0; i < particles.length; i++ ) {\n      particles[i].update();\n    }\n    \n    // Remove dead particles\n    for( var i = particles.length -1; i >= 0; i-- ) {\n      if( particles[i].lifeSpan < 0 ) {\n        particles[i].die();\n        particles.splice(i, 1);\n      }\n    }\n    \n  }\n  \n  function loop() {\n    requestAnimationFrame(loop);\n    updateParticles();\n  }\n  \n  /**\n   * Particles\n   */\n  \n  function Particle() {\n\n    this.character = \"*\";\n    this.lifeSpan = 120; //ms\n    this.initialStyles ={\n      \"position\": \"fixed\",\n      \"top\": \"0\", //必须加\n      \"display\": \"block\",\n      \"pointerEvents\": \"none\",\n      \"z-index\": \"10000000\",\n      \"fontSize\": \"20px\",\n      \"will-change\": \"transform\"\n    };\n\n    // Init, and set properties\n    this.init = function(x, y, color) {\n\n      this.velocity = {\n        x:  (Math.random() < 0.5 ? -1 : 1) * (Math.random() / 2),\n        y: 1\n      };\n      \n      this.position = {x: x - 10, y: y - 20};\n      this.initialStyles.color = color;\n      console.log(color);\n\n      this.element = document.createElement('span');\n      this.element.innerHTML = this.character;\n      applyProperties(this.element, this.initialStyles);\n      this.update();\n      \n      document.body.appendChild(this.element);\n    };\n    \n    this.update = function() {\n      this.position.x += this.velocity.x;\n      this.position.y += this.velocity.y;\n      this.lifeSpan--;\n      \n      this.element.style.transform = \"translate3d(\" + this.position.x + \"px,\" + this.position.y + \"px,0) scale(\" + (this.lifeSpan / 120) + \")\";\n    }\n    \n    this.die = function() {\n      this.element.parentNode.removeChild(this.element);\n    }\n    \n  }\n  \n  /**\n   * Utils\n   */\n  \n  // Applies css `properties` to an element.\n  function applyProperties( target, properties ) {\n    for( var key in properties ) {\n      target.style[ key ] = properties[ key ];\n    }\n  }\n  \n  init();\n})();\n```\n\n#### 修改themes/nextv6/layout/_layout.swig文件, 末尾添加如下内容\n```\n<!-- 鼠标移动星星特效 -->\n<script type=\"text/javascript\" src=\"/js/src/love2.js\"></script>\n```\n","slug":"4-hexo鼠标移动和鼠标点击特效","published":1,"updated":"2019-10-16T09:15:27.840Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck28uwzn4000rkerwskdd47h9","content":"<h3 id=\"hexo6-鼠标添加点击出现桃心的特效\"><a href=\"#hexo6-鼠标添加点击出现桃心的特效\" class=\"headerlink\" title=\"hexo6 鼠标添加点击出现桃心的特效\"></a>hexo6 鼠标添加点击出现桃心的特效</h3> <a id=\"more\"></a>\n\n<p>来自: <a href=\"https://www.writebug.site/2019/01/02/Next%E4%B8%BB%E9%A2%98%E4%B8%AA%E6%80%A7%E5%8C%96/\" target=\"_blank\" rel=\"noopener\">Next主题个性化</a></p>\n<h4 id=\"所需要的js文件\"><a href=\"#所需要的js文件\" class=\"headerlink\" title=\"所需要的js文件\"></a>所需要的js文件</h4><ul>\n<li><p>未压缩</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">! <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e, t, a</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">n</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        c(</span><br><span class=\"line\">            <span class=\"string\">\".heart&#123;width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);&#125;.heart:after,.heart:before&#123;content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: fixed;&#125;.heart:after&#123;top: -5px;&#125;.heart:before&#123;left: -5px;&#125;\"</span>), o(), r()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">r</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> e = <span class=\"number\">0</span>; e &lt; d.length; e++) d[e].alpha &lt;= <span class=\"number\">0</span> ? (t.body.removeChild(d[e].el), d.splice(e, <span class=\"number\">1</span>)) : (d[e].y--, d[e].scale += <span class=\"number\">.004</span>, d[e].alpha -= <span class=\"number\">.013</span>, d[e].el.style.cssText = <span class=\"string\">\"left:\"</span> + d[e].x + <span class=\"string\">\"px;top:\"</span> + d[e].y + <span class=\"string\">\"px;opacity:\"</span> + d[e].alpha + <span class=\"string\">\";transform:scale(\"</span> + d[e].scale + <span class=\"string\">\",\"</span> + d[e].scale + <span class=\"string\">\") rotate(45deg);background:\"</span> + d[e].color + <span class=\"string\">\";z-index:99999\"</span>);</span><br><span class=\"line\">        requestAnimationFrame(r)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">o</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> t = <span class=\"string\">\"function\"</span> == <span class=\"keyword\">typeof</span> e.onclick &amp;&amp; e.onclick;</span><br><span class=\"line\">        e.onclick = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">            t &amp;&amp; t(), i(e)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">i</span>(<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> a = t.createElement(<span class=\"string\">\"div\"</span>);</span><br><span class=\"line\">        a.className = <span class=\"string\">\"heart\"</span>, d.push(&#123;</span><br><span class=\"line\">            el: a,</span><br><span class=\"line\">            x: e.clientX - <span class=\"number\">5</span>,</span><br><span class=\"line\">            y: e.clientY - <span class=\"number\">5</span>,</span><br><span class=\"line\">            scale: <span class=\"number\">1</span>,</span><br><span class=\"line\">            alpha: <span class=\"number\">1</span>,</span><br><span class=\"line\">            color: s()</span><br><span class=\"line\">        &#125;), t.body.appendChild(a)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">c</span>(<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> a = t.createElement(<span class=\"string\">\"style\"</span>);</span><br><span class=\"line\">        a.type = <span class=\"string\">\"text/css\"</span>;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            a.appendChild(t.createTextNode(e))</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (t) &#123;</span><br><span class=\"line\">            a.styleSheet.cssText = e</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        t.getElementsByTagName(<span class=\"string\">\"head\"</span>)[<span class=\"number\">0</span>].appendChild(a)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">s</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">\"rgb(\"</span> + ~~(<span class=\"number\">255</span> * <span class=\"built_in\">Math</span>.random()) + <span class=\"string\">\",\"</span> + ~~(<span class=\"number\">255</span> * <span class=\"built_in\">Math</span>.random()) + <span class=\"string\">\",\"</span> + ~~(<span class=\"number\">255</span> * <span class=\"built_in\">Math</span>.random()) + <span class=\"string\">\")\"</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> d = [];</span><br><span class=\"line\">    e.requestAnimationFrame = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> e.requestAnimationFrame || e.webkitRequestAnimationFrame || e.mozRequestAnimationFrame || e.oRequestAnimationFrame || e.msRequestAnimationFrame || <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">            setTimeout(e, <span class=\"number\">1e3</span> / <span class=\"number\">60</span>)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;(), n()</span><br><span class=\"line\">&#125;(<span class=\"built_in\">window</span>, <span class=\"built_in\">document</span>);</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>压缩后</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">!<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e,t,a</span>)</span>&#123;<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">n</span>(<span class=\"params\"></span>)</span>&#123;c(<span class=\"string\">\".heart&#123;width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);&#125;.heart:after,.heart:before&#123;content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: fixed;&#125;.heart:after&#123;top: -5px;&#125;.heart:before&#123;left: -5px;&#125;\"</span>),o(),r()&#125;<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">r</span>(<span class=\"params\"></span>)</span>&#123;<span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> e=<span class=\"number\">0</span>;e&lt;d.length;e++)d[e].alpha&lt;=<span class=\"number\">0</span>?(t.body.removeChild(d[e].el),d.splice(e,<span class=\"number\">1</span>)):(d[e].y--,d[e].scale+=<span class=\"number\">.004</span>,d[e].alpha-=<span class=\"number\">.013</span>,d[e].el.style.cssText=<span class=\"string\">\"left:\"</span>+d[e].x+<span class=\"string\">\"px;top:\"</span>+d[e].y+<span class=\"string\">\"px;opacity:\"</span>+d[e].alpha+<span class=\"string\">\";transform:scale(\"</span>+d[e].scale+<span class=\"string\">\",\"</span>+d[e].scale+<span class=\"string\">\") rotate(45deg);background:\"</span>+d[e].color+<span class=\"string\">\";z-index:99999\"</span>);requestAnimationFrame(r)&#125;<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">o</span>(<span class=\"params\"></span>)</span>&#123;<span class=\"keyword\">var</span> t=<span class=\"string\">\"function\"</span>==<span class=\"keyword\">typeof</span> e.onclick&amp;&amp;e.onclick;e.onclick=<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>)</span>&#123;t&amp;&amp;t(),i(e)&#125;&#125;<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">i</span>(<span class=\"params\">e</span>)</span>&#123;<span class=\"keyword\">var</span> a=t.createElement(<span class=\"string\">\"div\"</span>);a.className=<span class=\"string\">\"heart\"</span>,d.push(&#123;<span class=\"attr\">el</span>:a,<span class=\"attr\">x</span>:e.clientX<span class=\"number\">-5</span>,<span class=\"attr\">y</span>:e.clientY<span class=\"number\">-5</span>,<span class=\"attr\">scale</span>:<span class=\"number\">1</span>,<span class=\"attr\">alpha</span>:<span class=\"number\">1</span>,<span class=\"attr\">color</span>:s()&#125;),t.body.appendChild(a)&#125;<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">c</span>(<span class=\"params\">e</span>)</span>&#123;<span class=\"keyword\">var</span> a=t.createElement(<span class=\"string\">\"style\"</span>);a.type=<span class=\"string\">\"text/css\"</span>;<span class=\"keyword\">try</span>&#123;a.appendChild(t.createTextNode(e))&#125;<span class=\"keyword\">catch</span>(t)&#123;a.styleSheet.cssText=e&#125;t.getElementsByTagName(<span class=\"string\">\"head\"</span>)[<span class=\"number\">0</span>].appendChild(a)&#125;<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">s</span>(<span class=\"params\"></span>)</span>&#123;<span class=\"keyword\">return</span><span class=\"string\">\"rgb(\"</span>+~~(<span class=\"number\">255</span>*<span class=\"built_in\">Math</span>.random())+<span class=\"string\">\",\"</span>+~~(<span class=\"number\">255</span>*<span class=\"built_in\">Math</span>.random())+<span class=\"string\">\",\"</span>+~~(<span class=\"number\">255</span>*<span class=\"built_in\">Math</span>.random())+<span class=\"string\">\")\"</span>&#125;<span class=\"keyword\">var</span> d=[];e.requestAnimationFrame=<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;<span class=\"keyword\">return</span> e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame||<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>)</span>&#123;setTimeout(e,<span class=\"number\">1e3</span>/<span class=\"number\">60</span>)&#125;&#125;(),n()&#125;(<span class=\"built_in\">window</span>,<span class=\"built_in\">document</span>);</span><br></pre></td></tr></table></figure>\n\n</li>\n</ul>\n<h4 id=\"将上面的内容贴到新增的themes-nextv6-source-js-src-love-js-文件中\"><a href=\"#将上面的内容贴到新增的themes-nextv6-source-js-src-love-js-文件中\" class=\"headerlink\" title=\"将上面的内容贴到新增的themes/nextv6/source/js/src/love.js 文件中\"></a>将上面的内容贴到新增的themes/nextv6/source/js/src/love.js 文件中</h4><h4 id=\"修改themes-nextv6-layout-layout-swig文件-末尾添加如下内容\"><a href=\"#修改themes-nextv6-layout-layout-swig文件-末尾添加如下内容\" class=\"headerlink\" title=\"修改themes/nextv6/layout/_layout.swig文件, 末尾添加如下内容\"></a>修改themes/nextv6/layout/_layout.swig文件, 末尾添加如下内容</h4><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 鼠标桃心动画 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text/javascript\"</span> <span class=\"attr\">src</span>=<span class=\"string\">\"/js/src/love.js\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"hexo6-鼠标移动添加星星特效\"><a href=\"#hexo6-鼠标移动添加星星特效\" class=\"headerlink\" title=\"hexo6 鼠标移动添加星星特效\"></a>hexo6 鼠标移动添加星星特效</h3><p>来自: <a href=\"https://blog.csdn.net/a201577F0546/article/details/89060017\" target=\"_blank\" rel=\"noopener\">愚人节鼠标跟随特效</a></p>\n<h4 id=\"新增js文件-themes-nextv6-source-js-src-love2-js\"><a href=\"#新增js文件-themes-nextv6-source-js-src-love2-js\" class=\"headerlink\" title=\"新增js文件 themes/nextv6/source/js/src/love2.js\"></a>新增js文件 themes/nextv6/source/js/src/love2.js</h4><figure class=\"highlight qml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*!</span></span><br><span class=\"line\"><span class=\"comment\"> * Fairy Dust Cursor.js</span></span><br><span class=\"line\"><span class=\"comment\"> * - 90's cursors collection</span></span><br><span class=\"line\"><span class=\"comment\"> * -- https://github.com/tholman/90s-cursor-effects</span></span><br><span class=\"line\"><span class=\"comment\"> * -- http://codepen.io/tholman/full/jWmZxZ/</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"></span><br><span class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fairyDustCursor</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"keyword\">var</span> possibleColors = [<span class=\"string\">\"#D61C59\"</span>, <span class=\"string\">\"#E7D84B\"</span>, <span class=\"string\">\"#1B8798\"</span>]</span><br><span class=\"line\">  <span class=\"keyword\">var</span> width = <span class=\"built_in\">window</span>.innerWidth;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> height = <span class=\"built_in\">window</span>.innerHeight;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> cursor = &#123;<span class=\"attribute\">x</span>: width/<span class=\"number\">2</span>, <span class=\"attribute\">y</span>: width/<span class=\"number\">2</span>&#125;;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> particles = [];</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">init</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    bindEvents();</span><br><span class=\"line\">    loop();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\">// Bind events that are needed</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">bindEvents</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.addEventListener(<span class=\"string\">'mousemove'</span>, onMouseMove);</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.addEventListener(<span class=\"string\">'touchmove'</span>, onTouchMove);</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.addEventListener(<span class=\"string\">'touchstart'</span>, onTouchMove);</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"built_in\">window</span>.addEventListener(<span class=\"string\">'resize'</span>, onWindowResize);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">onWindowResize</span>(<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">    width = <span class=\"built_in\">window</span>.innerWidth;</span><br><span class=\"line\">    height = <span class=\"built_in\">window</span>.innerHeight;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">onTouchMove</span>(<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>( e.touches.length &gt; <span class=\"number\">0</span> ) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">for</span>( <span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; e.touches.length; i++ ) &#123;</span><br><span class=\"line\">        addParticle( e.touches[i].clientX, e.touches[i].clientY, possibleColors[<span class=\"built_in\">Math</span>.floor(<span class=\"built_in\">Math</span>.random()*possibleColors.length)]);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">onMouseMove</span>(<span class=\"params\">e</span>) </span>&#123;    </span><br><span class=\"line\">    cursor.x = e.clientX;</span><br><span class=\"line\">    cursor.y = e.clientY;</span><br><span class=\"line\">    </span><br><span class=\"line\">    addParticle( cursor.x, cursor.y, possibleColors[<span class=\"built_in\">Math</span>.floor(<span class=\"built_in\">Math</span>.random()*possibleColors.length)]);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">addParticle</span>(<span class=\"params\">x, y, color</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> particle = <span class=\"keyword\">new</span> Particle();</span><br><span class=\"line\">    particle.init(x, y, <span class=\"built_in\">color</span>);</span><br><span class=\"line\">    particles.push(particle);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">updateParticles</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// Updated</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span>( <span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; particles.length; i++ ) &#123;</span><br><span class=\"line\">      particles[i].update();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// Remove dead particles</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span>( <span class=\"keyword\">var</span> i = particles.length <span class=\"number\">-1</span>; i &gt;= <span class=\"number\">0</span>; i-- ) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span>( particles[i].lifeSpan &lt; <span class=\"number\">0</span> ) &#123;</span><br><span class=\"line\">        particles[i].die();</span><br><span class=\"line\">        particles.splice(i, <span class=\"number\">1</span>);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">loop</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    requestAnimationFrame(loop);</span><br><span class=\"line\">    updateParticles();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * Particles</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Particle</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.character = <span class=\"string\">\"*\"</span>;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.lifeSpan = <span class=\"number\">120</span>; <span class=\"comment\">//ms</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.initialStyles =&#123;</span><br><span class=\"line\">      <span class=\"string\">\"position\"</span>: <span class=\"string\">\"fixed\"</span>,</span><br><span class=\"line\">      <span class=\"string\">\"top\"</span>: <span class=\"string\">\"0\"</span>, <span class=\"comment\">//必须加</span></span><br><span class=\"line\">      <span class=\"string\">\"display\"</span>: <span class=\"string\">\"block\"</span>,</span><br><span class=\"line\">      <span class=\"string\">\"pointerEvents\"</span>: <span class=\"string\">\"none\"</span>,</span><br><span class=\"line\">      <span class=\"string\">\"z-index\"</span>: <span class=\"string\">\"10000000\"</span>,</span><br><span class=\"line\">      <span class=\"string\">\"fontSize\"</span>: <span class=\"string\">\"20px\"</span>,</span><br><span class=\"line\">      <span class=\"string\">\"will-change\"</span>: <span class=\"string\">\"transform\"</span></span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Init, and set properties</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.init = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">x, y, color</span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">this</span>.velocity = &#123;</span><br><span class=\"line\">        <span class=\"attribute\">x</span>:  (<span class=\"built_in\">Math</span>.random() &lt; <span class=\"number\">0.5</span> ? <span class=\"number\">-1</span> : <span class=\"number\">1</span>) * (<span class=\"built_in\">Math</span>.random() / <span class=\"number\">2</span>),</span><br><span class=\"line\">        <span class=\"attribute\">y</span>: <span class=\"number\">1</span></span><br><span class=\"line\">      &#125;;</span><br><span class=\"line\">      </span><br><span class=\"line\">      <span class=\"keyword\">this</span>.position = &#123;<span class=\"attribute\">x</span>: x - <span class=\"number\">10</span>, <span class=\"attribute\">y</span>: y - <span class=\"number\">20</span>&#125;;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.initialStyles.color = <span class=\"built_in\">color</span>;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(<span class=\"built_in\">color</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">this</span>.element = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'span'</span>);</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.element.innerHTML = <span class=\"keyword\">this</span>.character;</span><br><span class=\"line\">      applyProperties(<span class=\"keyword\">this</span>.element, <span class=\"keyword\">this</span>.initialStyles);</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.update();</span><br><span class=\"line\">      </span><br><span class=\"line\">      <span class=\"built_in\">document</span>.body.appendChild(<span class=\"keyword\">this</span>.element);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">this</span>.update = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.position.x += <span class=\"keyword\">this</span>.velocity.x;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.position.y += <span class=\"keyword\">this</span>.velocity.y;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.lifeSpan--;</span><br><span class=\"line\">      </span><br><span class=\"line\">      <span class=\"keyword\">this</span>.element.style.transform = <span class=\"string\">\"translate3d(\"</span> + <span class=\"keyword\">this</span>.position.x + <span class=\"string\">\"px,\"</span> + <span class=\"keyword\">this</span>.position.y + <span class=\"string\">\"px,0) scale(\"</span> + (<span class=\"keyword\">this</span>.lifeSpan / <span class=\"number\">120</span>) + <span class=\"string\">\")\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">this</span>.die = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.element.parentNode.removeChild(<span class=\"keyword\">this</span>.element);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * Utils</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\">// Applies css `properties` to an element.</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">applyProperties</span>(<span class=\"params\"> target, properties </span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>( <span class=\"keyword\">var</span> key <span class=\"keyword\">in</span> properties ) &#123;</span><br><span class=\"line\">      target.style[ key ] = properties[ key ];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  init();</span><br><span class=\"line\">&#125;)();</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"修改themes-nextv6-layout-layout-swig文件-末尾添加如下内容-1\"><a href=\"#修改themes-nextv6-layout-layout-swig文件-末尾添加如下内容-1\" class=\"headerlink\" title=\"修改themes/nextv6/layout/_layout.swig文件, 末尾添加如下内容\"></a>修改themes/nextv6/layout/_layout.swig文件, 末尾添加如下内容</h4><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 鼠标移动星星特效 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text/javascript\"</span> <span class=\"attr\">src</span>=<span class=\"string\">\"/js/src/love2.js\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"length":8383,"excerpt":"<h3 id=\"hexo6-鼠标添加点击出现桃心的特效\"><a href=\"#hexo6-鼠标添加点击出现桃心的特效\" class=\"headerlink\" title=\"hexo6 鼠标添加点击出现桃心的特效\"></a>hexo6 鼠标添加点击出现桃心的特效</h3>","more":"<p>来自: <a href=\"https://www.writebug.site/2019/01/02/Next%E4%B8%BB%E9%A2%98%E4%B8%AA%E6%80%A7%E5%8C%96/\" target=\"_blank\" rel=\"noopener\">Next主题个性化</a></p>\n<h4 id=\"所需要的js文件\"><a href=\"#所需要的js文件\" class=\"headerlink\" title=\"所需要的js文件\"></a>所需要的js文件</h4><ul>\n<li><p>未压缩</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">! <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e, t, a</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">n</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        c(</span><br><span class=\"line\">            <span class=\"string\">\".heart&#123;width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);&#125;.heart:after,.heart:before&#123;content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: fixed;&#125;.heart:after&#123;top: -5px;&#125;.heart:before&#123;left: -5px;&#125;\"</span>), o(), r()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">r</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> e = <span class=\"number\">0</span>; e &lt; d.length; e++) d[e].alpha &lt;= <span class=\"number\">0</span> ? (t.body.removeChild(d[e].el), d.splice(e, <span class=\"number\">1</span>)) : (d[e].y--, d[e].scale += <span class=\"number\">.004</span>, d[e].alpha -= <span class=\"number\">.013</span>, d[e].el.style.cssText = <span class=\"string\">\"left:\"</span> + d[e].x + <span class=\"string\">\"px;top:\"</span> + d[e].y + <span class=\"string\">\"px;opacity:\"</span> + d[e].alpha + <span class=\"string\">\";transform:scale(\"</span> + d[e].scale + <span class=\"string\">\",\"</span> + d[e].scale + <span class=\"string\">\") rotate(45deg);background:\"</span> + d[e].color + <span class=\"string\">\";z-index:99999\"</span>);</span><br><span class=\"line\">        requestAnimationFrame(r)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">o</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> t = <span class=\"string\">\"function\"</span> == <span class=\"keyword\">typeof</span> e.onclick &amp;&amp; e.onclick;</span><br><span class=\"line\">        e.onclick = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">            t &amp;&amp; t(), i(e)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">i</span>(<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> a = t.createElement(<span class=\"string\">\"div\"</span>);</span><br><span class=\"line\">        a.className = <span class=\"string\">\"heart\"</span>, d.push(&#123;</span><br><span class=\"line\">            el: a,</span><br><span class=\"line\">            x: e.clientX - <span class=\"number\">5</span>,</span><br><span class=\"line\">            y: e.clientY - <span class=\"number\">5</span>,</span><br><span class=\"line\">            scale: <span class=\"number\">1</span>,</span><br><span class=\"line\">            alpha: <span class=\"number\">1</span>,</span><br><span class=\"line\">            color: s()</span><br><span class=\"line\">        &#125;), t.body.appendChild(a)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">c</span>(<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> a = t.createElement(<span class=\"string\">\"style\"</span>);</span><br><span class=\"line\">        a.type = <span class=\"string\">\"text/css\"</span>;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            a.appendChild(t.createTextNode(e))</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (t) &#123;</span><br><span class=\"line\">            a.styleSheet.cssText = e</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        t.getElementsByTagName(<span class=\"string\">\"head\"</span>)[<span class=\"number\">0</span>].appendChild(a)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">s</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">\"rgb(\"</span> + ~~(<span class=\"number\">255</span> * <span class=\"built_in\">Math</span>.random()) + <span class=\"string\">\",\"</span> + ~~(<span class=\"number\">255</span> * <span class=\"built_in\">Math</span>.random()) + <span class=\"string\">\",\"</span> + ~~(<span class=\"number\">255</span> * <span class=\"built_in\">Math</span>.random()) + <span class=\"string\">\")\"</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> d = [];</span><br><span class=\"line\">    e.requestAnimationFrame = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> e.requestAnimationFrame || e.webkitRequestAnimationFrame || e.mozRequestAnimationFrame || e.oRequestAnimationFrame || e.msRequestAnimationFrame || <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">            setTimeout(e, <span class=\"number\">1e3</span> / <span class=\"number\">60</span>)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;(), n()</span><br><span class=\"line\">&#125;(<span class=\"built_in\">window</span>, <span class=\"built_in\">document</span>);</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>压缩后</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">!<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e,t,a</span>)</span>&#123;<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">n</span>(<span class=\"params\"></span>)</span>&#123;c(<span class=\"string\">\".heart&#123;width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);&#125;.heart:after,.heart:before&#123;content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: fixed;&#125;.heart:after&#123;top: -5px;&#125;.heart:before&#123;left: -5px;&#125;\"</span>),o(),r()&#125;<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">r</span>(<span class=\"params\"></span>)</span>&#123;<span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> e=<span class=\"number\">0</span>;e&lt;d.length;e++)d[e].alpha&lt;=<span class=\"number\">0</span>?(t.body.removeChild(d[e].el),d.splice(e,<span class=\"number\">1</span>)):(d[e].y--,d[e].scale+=<span class=\"number\">.004</span>,d[e].alpha-=<span class=\"number\">.013</span>,d[e].el.style.cssText=<span class=\"string\">\"left:\"</span>+d[e].x+<span class=\"string\">\"px;top:\"</span>+d[e].y+<span class=\"string\">\"px;opacity:\"</span>+d[e].alpha+<span class=\"string\">\";transform:scale(\"</span>+d[e].scale+<span class=\"string\">\",\"</span>+d[e].scale+<span class=\"string\">\") rotate(45deg);background:\"</span>+d[e].color+<span class=\"string\">\";z-index:99999\"</span>);requestAnimationFrame(r)&#125;<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">o</span>(<span class=\"params\"></span>)</span>&#123;<span class=\"keyword\">var</span> t=<span class=\"string\">\"function\"</span>==<span class=\"keyword\">typeof</span> e.onclick&amp;&amp;e.onclick;e.onclick=<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>)</span>&#123;t&amp;&amp;t(),i(e)&#125;&#125;<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">i</span>(<span class=\"params\">e</span>)</span>&#123;<span class=\"keyword\">var</span> a=t.createElement(<span class=\"string\">\"div\"</span>);a.className=<span class=\"string\">\"heart\"</span>,d.push(&#123;<span class=\"attr\">el</span>:a,<span class=\"attr\">x</span>:e.clientX<span class=\"number\">-5</span>,<span class=\"attr\">y</span>:e.clientY<span class=\"number\">-5</span>,<span class=\"attr\">scale</span>:<span class=\"number\">1</span>,<span class=\"attr\">alpha</span>:<span class=\"number\">1</span>,<span class=\"attr\">color</span>:s()&#125;),t.body.appendChild(a)&#125;<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">c</span>(<span class=\"params\">e</span>)</span>&#123;<span class=\"keyword\">var</span> a=t.createElement(<span class=\"string\">\"style\"</span>);a.type=<span class=\"string\">\"text/css\"</span>;<span class=\"keyword\">try</span>&#123;a.appendChild(t.createTextNode(e))&#125;<span class=\"keyword\">catch</span>(t)&#123;a.styleSheet.cssText=e&#125;t.getElementsByTagName(<span class=\"string\">\"head\"</span>)[<span class=\"number\">0</span>].appendChild(a)&#125;<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">s</span>(<span class=\"params\"></span>)</span>&#123;<span class=\"keyword\">return</span><span class=\"string\">\"rgb(\"</span>+~~(<span class=\"number\">255</span>*<span class=\"built_in\">Math</span>.random())+<span class=\"string\">\",\"</span>+~~(<span class=\"number\">255</span>*<span class=\"built_in\">Math</span>.random())+<span class=\"string\">\",\"</span>+~~(<span class=\"number\">255</span>*<span class=\"built_in\">Math</span>.random())+<span class=\"string\">\")\"</span>&#125;<span class=\"keyword\">var</span> d=[];e.requestAnimationFrame=<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;<span class=\"keyword\">return</span> e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame||<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>)</span>&#123;setTimeout(e,<span class=\"number\">1e3</span>/<span class=\"number\">60</span>)&#125;&#125;(),n()&#125;(<span class=\"built_in\">window</span>,<span class=\"built_in\">document</span>);</span><br></pre></td></tr></table></figure>\n\n</li>\n</ul>\n<h4 id=\"将上面的内容贴到新增的themes-nextv6-source-js-src-love-js-文件中\"><a href=\"#将上面的内容贴到新增的themes-nextv6-source-js-src-love-js-文件中\" class=\"headerlink\" title=\"将上面的内容贴到新增的themes/nextv6/source/js/src/love.js 文件中\"></a>将上面的内容贴到新增的themes/nextv6/source/js/src/love.js 文件中</h4><h4 id=\"修改themes-nextv6-layout-layout-swig文件-末尾添加如下内容\"><a href=\"#修改themes-nextv6-layout-layout-swig文件-末尾添加如下内容\" class=\"headerlink\" title=\"修改themes/nextv6/layout/_layout.swig文件, 末尾添加如下内容\"></a>修改themes/nextv6/layout/_layout.swig文件, 末尾添加如下内容</h4><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 鼠标桃心动画 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text/javascript\"</span> <span class=\"attr\">src</span>=<span class=\"string\">\"/js/src/love.js\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"hexo6-鼠标移动添加星星特效\"><a href=\"#hexo6-鼠标移动添加星星特效\" class=\"headerlink\" title=\"hexo6 鼠标移动添加星星特效\"></a>hexo6 鼠标移动添加星星特效</h3><p>来自: <a href=\"https://blog.csdn.net/a201577F0546/article/details/89060017\" target=\"_blank\" rel=\"noopener\">愚人节鼠标跟随特效</a></p>\n<h4 id=\"新增js文件-themes-nextv6-source-js-src-love2-js\"><a href=\"#新增js文件-themes-nextv6-source-js-src-love2-js\" class=\"headerlink\" title=\"新增js文件 themes/nextv6/source/js/src/love2.js\"></a>新增js文件 themes/nextv6/source/js/src/love2.js</h4><figure class=\"highlight qml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*!</span></span><br><span class=\"line\"><span class=\"comment\"> * Fairy Dust Cursor.js</span></span><br><span class=\"line\"><span class=\"comment\"> * - 90's cursors collection</span></span><br><span class=\"line\"><span class=\"comment\"> * -- https://github.com/tholman/90s-cursor-effects</span></span><br><span class=\"line\"><span class=\"comment\"> * -- http://codepen.io/tholman/full/jWmZxZ/</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"></span><br><span class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fairyDustCursor</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"keyword\">var</span> possibleColors = [<span class=\"string\">\"#D61C59\"</span>, <span class=\"string\">\"#E7D84B\"</span>, <span class=\"string\">\"#1B8798\"</span>]</span><br><span class=\"line\">  <span class=\"keyword\">var</span> width = <span class=\"built_in\">window</span>.innerWidth;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> height = <span class=\"built_in\">window</span>.innerHeight;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> cursor = &#123;<span class=\"attribute\">x</span>: width/<span class=\"number\">2</span>, <span class=\"attribute\">y</span>: width/<span class=\"number\">2</span>&#125;;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> particles = [];</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">init</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    bindEvents();</span><br><span class=\"line\">    loop();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\">// Bind events that are needed</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">bindEvents</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.addEventListener(<span class=\"string\">'mousemove'</span>, onMouseMove);</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.addEventListener(<span class=\"string\">'touchmove'</span>, onTouchMove);</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.addEventListener(<span class=\"string\">'touchstart'</span>, onTouchMove);</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"built_in\">window</span>.addEventListener(<span class=\"string\">'resize'</span>, onWindowResize);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">onWindowResize</span>(<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">    width = <span class=\"built_in\">window</span>.innerWidth;</span><br><span class=\"line\">    height = <span class=\"built_in\">window</span>.innerHeight;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">onTouchMove</span>(<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>( e.touches.length &gt; <span class=\"number\">0</span> ) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">for</span>( <span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; e.touches.length; i++ ) &#123;</span><br><span class=\"line\">        addParticle( e.touches[i].clientX, e.touches[i].clientY, possibleColors[<span class=\"built_in\">Math</span>.floor(<span class=\"built_in\">Math</span>.random()*possibleColors.length)]);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">onMouseMove</span>(<span class=\"params\">e</span>) </span>&#123;    </span><br><span class=\"line\">    cursor.x = e.clientX;</span><br><span class=\"line\">    cursor.y = e.clientY;</span><br><span class=\"line\">    </span><br><span class=\"line\">    addParticle( cursor.x, cursor.y, possibleColors[<span class=\"built_in\">Math</span>.floor(<span class=\"built_in\">Math</span>.random()*possibleColors.length)]);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">addParticle</span>(<span class=\"params\">x, y, color</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> particle = <span class=\"keyword\">new</span> Particle();</span><br><span class=\"line\">    particle.init(x, y, <span class=\"built_in\">color</span>);</span><br><span class=\"line\">    particles.push(particle);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">updateParticles</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// Updated</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span>( <span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; particles.length; i++ ) &#123;</span><br><span class=\"line\">      particles[i].update();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// Remove dead particles</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span>( <span class=\"keyword\">var</span> i = particles.length <span class=\"number\">-1</span>; i &gt;= <span class=\"number\">0</span>; i-- ) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span>( particles[i].lifeSpan &lt; <span class=\"number\">0</span> ) &#123;</span><br><span class=\"line\">        particles[i].die();</span><br><span class=\"line\">        particles.splice(i, <span class=\"number\">1</span>);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">loop</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    requestAnimationFrame(loop);</span><br><span class=\"line\">    updateParticles();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * Particles</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Particle</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.character = <span class=\"string\">\"*\"</span>;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.lifeSpan = <span class=\"number\">120</span>; <span class=\"comment\">//ms</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.initialStyles =&#123;</span><br><span class=\"line\">      <span class=\"string\">\"position\"</span>: <span class=\"string\">\"fixed\"</span>,</span><br><span class=\"line\">      <span class=\"string\">\"top\"</span>: <span class=\"string\">\"0\"</span>, <span class=\"comment\">//必须加</span></span><br><span class=\"line\">      <span class=\"string\">\"display\"</span>: <span class=\"string\">\"block\"</span>,</span><br><span class=\"line\">      <span class=\"string\">\"pointerEvents\"</span>: <span class=\"string\">\"none\"</span>,</span><br><span class=\"line\">      <span class=\"string\">\"z-index\"</span>: <span class=\"string\">\"10000000\"</span>,</span><br><span class=\"line\">      <span class=\"string\">\"fontSize\"</span>: <span class=\"string\">\"20px\"</span>,</span><br><span class=\"line\">      <span class=\"string\">\"will-change\"</span>: <span class=\"string\">\"transform\"</span></span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Init, and set properties</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.init = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">x, y, color</span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">this</span>.velocity = &#123;</span><br><span class=\"line\">        <span class=\"attribute\">x</span>:  (<span class=\"built_in\">Math</span>.random() &lt; <span class=\"number\">0.5</span> ? <span class=\"number\">-1</span> : <span class=\"number\">1</span>) * (<span class=\"built_in\">Math</span>.random() / <span class=\"number\">2</span>),</span><br><span class=\"line\">        <span class=\"attribute\">y</span>: <span class=\"number\">1</span></span><br><span class=\"line\">      &#125;;</span><br><span class=\"line\">      </span><br><span class=\"line\">      <span class=\"keyword\">this</span>.position = &#123;<span class=\"attribute\">x</span>: x - <span class=\"number\">10</span>, <span class=\"attribute\">y</span>: y - <span class=\"number\">20</span>&#125;;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.initialStyles.color = <span class=\"built_in\">color</span>;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(<span class=\"built_in\">color</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">this</span>.element = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'span'</span>);</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.element.innerHTML = <span class=\"keyword\">this</span>.character;</span><br><span class=\"line\">      applyProperties(<span class=\"keyword\">this</span>.element, <span class=\"keyword\">this</span>.initialStyles);</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.update();</span><br><span class=\"line\">      </span><br><span class=\"line\">      <span class=\"built_in\">document</span>.body.appendChild(<span class=\"keyword\">this</span>.element);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">this</span>.update = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.position.x += <span class=\"keyword\">this</span>.velocity.x;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.position.y += <span class=\"keyword\">this</span>.velocity.y;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.lifeSpan--;</span><br><span class=\"line\">      </span><br><span class=\"line\">      <span class=\"keyword\">this</span>.element.style.transform = <span class=\"string\">\"translate3d(\"</span> + <span class=\"keyword\">this</span>.position.x + <span class=\"string\">\"px,\"</span> + <span class=\"keyword\">this</span>.position.y + <span class=\"string\">\"px,0) scale(\"</span> + (<span class=\"keyword\">this</span>.lifeSpan / <span class=\"number\">120</span>) + <span class=\"string\">\")\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">this</span>.die = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.element.parentNode.removeChild(<span class=\"keyword\">this</span>.element);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * Utils</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\">// Applies css `properties` to an element.</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">applyProperties</span>(<span class=\"params\"> target, properties </span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>( <span class=\"keyword\">var</span> key <span class=\"keyword\">in</span> properties ) &#123;</span><br><span class=\"line\">      target.style[ key ] = properties[ key ];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  init();</span><br><span class=\"line\">&#125;)();</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"修改themes-nextv6-layout-layout-swig文件-末尾添加如下内容-1\"><a href=\"#修改themes-nextv6-layout-layout-swig文件-末尾添加如下内容-1\" class=\"headerlink\" title=\"修改themes/nextv6/layout/_layout.swig文件, 末尾添加如下内容\"></a>修改themes/nextv6/layout/_layout.swig文件, 末尾添加如下内容</h4><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 鼠标移动星星特效 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text/javascript\"</span> <span class=\"attr\">src</span>=<span class=\"string\">\"/js/src/love2.js\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>"},{"title":"hexo添加看板娘","copyright":true,"date":"2019-09-24T09:46:17.000Z","_content":"\n### hexo6 左下角添加看板娘\n<!--more-->\n\ngithub地址: [张书樵大神](https://github.com/stevenjoezhang/live2d-widget)\n\n### 下载大神项目 (会说话,换人物,小游戏等功能)\n```\ncd themes/nextv6/source\ngit clone https://github.com/stevenjoezhang/live2d-widget.git\n```\n\n#### github说明比较详细, 这里简单说明\n> 由于这里是克隆到了source目录, hexo d -g的时候会生成到public目录, 相当于站点根目录了\n```\n# 直接开启autoload.js注释\nconst live2d_path = \"/live2d-widget/\";\n\n# 修改 themes/nextv6/layout/_layout.swig, 最后一行添加如下\n<!-- 看板娘 -->\n<script src=\"/live2d-widget/autoload.js\"></script>\n```\n\n\n### 一般小白简单教程(只有看鼠标方向功能)\n\n> hexo 官方支持版\n#### 需要安装模板\n```\nnpm install --save hexo-helper-live2d\n```\n\n#### 修改主题配置文件\n[各种宠物预览](https://blog.csdn.net/wang_123_zy/article/details/87181892#live2dwidgetmodelchitose_12)\n```\n# Live2D\n## https://github.com/EYHN/hexo-helper-live2d\nlive2d:\n  enable: true\n  # enable: false\n  scriptFrom: local # 默认\n  pluginRootPath: live2dw/ # 插件在站点上的根目录(相对路径)\n  pluginJsPath: lib/ # 脚本文件相对与插件根目录路径\n  pluginModelPath: assets/ # 模型文件相对与插件根目录路径\n  # scriptFrom: jsdelivr # jsdelivr CDN\n  # scriptFrom: unpkg # unpkg CDN\n  # scriptFrom: https://cdn.jsdelivr.net/npm/live2d-widget@3.x/lib/L2Dwidget.min.js # 你的自定义 url\n  tagMode: false # 标签模式, 是否仅替换 live2d tag标签而非插入到所有页面中\n  debug: false # 调试, 是否在控制台输出日志\n  model:\n    use: live2d-widget-model-haruto # npm-module package name\n    # use: wanko # 博客根目录/live2d_models/ 下的目录名\n    # use: ./wives/wanko # 相对于博客根目录的路径\n    # use: https://cdn.jsdelivr.net/npm/live2d-widget-model-wanko@1.0.5/assets/wanko.model.json # 你的自定义 url\n  display:\n    position: left\n    width: 150\n    height: 300\n  mobile:\n    show: true # 手机中是否展示\n```\n","source":"_posts/5-hexo添加看板娘.md","raw":"---\ntitle: hexo添加看板娘\ncopyright: true\ndate: 2019-09-24 17:46:17\ntags:\n  - hexo6\n  - 特效\ncategories:\n  - [有趣,二次元]\n  - [博客,美化]\n---\n\n### hexo6 左下角添加看板娘\n<!--more-->\n\ngithub地址: [张书樵大神](https://github.com/stevenjoezhang/live2d-widget)\n\n### 下载大神项目 (会说话,换人物,小游戏等功能)\n```\ncd themes/nextv6/source\ngit clone https://github.com/stevenjoezhang/live2d-widget.git\n```\n\n#### github说明比较详细, 这里简单说明\n> 由于这里是克隆到了source目录, hexo d -g的时候会生成到public目录, 相当于站点根目录了\n```\n# 直接开启autoload.js注释\nconst live2d_path = \"/live2d-widget/\";\n\n# 修改 themes/nextv6/layout/_layout.swig, 最后一行添加如下\n<!-- 看板娘 -->\n<script src=\"/live2d-widget/autoload.js\"></script>\n```\n\n\n### 一般小白简单教程(只有看鼠标方向功能)\n\n> hexo 官方支持版\n#### 需要安装模板\n```\nnpm install --save hexo-helper-live2d\n```\n\n#### 修改主题配置文件\n[各种宠物预览](https://blog.csdn.net/wang_123_zy/article/details/87181892#live2dwidgetmodelchitose_12)\n```\n# Live2D\n## https://github.com/EYHN/hexo-helper-live2d\nlive2d:\n  enable: true\n  # enable: false\n  scriptFrom: local # 默认\n  pluginRootPath: live2dw/ # 插件在站点上的根目录(相对路径)\n  pluginJsPath: lib/ # 脚本文件相对与插件根目录路径\n  pluginModelPath: assets/ # 模型文件相对与插件根目录路径\n  # scriptFrom: jsdelivr # jsdelivr CDN\n  # scriptFrom: unpkg # unpkg CDN\n  # scriptFrom: https://cdn.jsdelivr.net/npm/live2d-widget@3.x/lib/L2Dwidget.min.js # 你的自定义 url\n  tagMode: false # 标签模式, 是否仅替换 live2d tag标签而非插入到所有页面中\n  debug: false # 调试, 是否在控制台输出日志\n  model:\n    use: live2d-widget-model-haruto # npm-module package name\n    # use: wanko # 博客根目录/live2d_models/ 下的目录名\n    # use: ./wives/wanko # 相对于博客根目录的路径\n    # use: https://cdn.jsdelivr.net/npm/live2d-widget-model-wanko@1.0.5/assets/wanko.model.json # 你的自定义 url\n  display:\n    position: left\n    width: 150\n    height: 300\n  mobile:\n    show: true # 手机中是否展示\n```\n","slug":"5-hexo添加看板娘","published":1,"updated":"2019-10-16T09:15:27.840Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck28uwzn5000tkerwo0lz3tm1","content":"<h3 id=\"hexo6-左下角添加看板娘\"><a href=\"#hexo6-左下角添加看板娘\" class=\"headerlink\" title=\"hexo6 左下角添加看板娘\"></a>hexo6 左下角添加看板娘</h3><a id=\"more\"></a>\n\n<p>github地址: <a href=\"https://github.com/stevenjoezhang/live2d-widget\" target=\"_blank\" rel=\"noopener\">张书樵大神</a></p>\n<h3 id=\"下载大神项目-会说话-换人物-小游戏等功能\"><a href=\"#下载大神项目-会说话-换人物-小游戏等功能\" class=\"headerlink\" title=\"下载大神项目 (会说话,换人物,小游戏等功能)\"></a>下载大神项目 (会说话,换人物,小游戏等功能)</h3><figure class=\"highlight vim\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">cd</span> themes/nextv6/<span class=\"keyword\">source</span></span><br><span class=\"line\">git clone http<span class=\"variable\">s:</span>//github.<span class=\"keyword\">com</span>/stevenjoezhang/live2d-widget.git</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"github说明比较详细-这里简单说明\"><a href=\"#github说明比较详细-这里简单说明\" class=\"headerlink\" title=\"github说明比较详细, 这里简单说明\"></a>github说明比较详细, 这里简单说明</h4><blockquote>\n<p>由于这里是克隆到了source目录, hexo d -g的时候会生成到public目录, 相当于站点根目录了</p>\n</blockquote>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 直接开启autoload.js注释</span><br><span class=\"line\">const live2d_path = \"/live2d-widget/\";</span><br><span class=\"line\"></span><br><span class=\"line\"># 修改 themes/nextv6/layout/_layout.swig, 最后一行添加如下</span><br><span class=\"line\"><span class=\"comment\">&lt;!-- 看板娘 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"/live2d-widget/autoload.js\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"一般小白简单教程-只有看鼠标方向功能\"><a href=\"#一般小白简单教程-只有看鼠标方向功能\" class=\"headerlink\" title=\"一般小白简单教程(只有看鼠标方向功能)\"></a>一般小白简单教程(只有看鼠标方向功能)</h3><blockquote>\n<p>hexo 官方支持版</p>\n</blockquote>\n<h4 id=\"需要安装模板\"><a href=\"#需要安装模板\" class=\"headerlink\" title=\"需要安装模板\"></a>需要安装模板</h4><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm <span class=\"keyword\">install</span> <span class=\"comment\">--save hexo-helper-live2d</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"修改主题配置文件\"><a href=\"#修改主题配置文件\" class=\"headerlink\" title=\"修改主题配置文件\"></a>修改主题配置文件</h4><p><a href=\"https://blog.csdn.net/wang_123_zy/article/details/87181892#live2dwidgetmodelchitose_12\" target=\"_blank\" rel=\"noopener\">各种宠物预览</a></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Live2D</span></span><br><span class=\"line\"><span class=\"comment\">## https://github.com/EYHN/hexo-helper-live2d</span></span><br><span class=\"line\"><span class=\"attr\">live2d:</span></span><br><span class=\"line\"><span class=\"attr\">  enable:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"comment\"># enable: false</span></span><br><span class=\"line\"><span class=\"attr\">  scriptFrom:</span> <span class=\"string\">local</span> <span class=\"comment\"># 默认</span></span><br><span class=\"line\"><span class=\"attr\">  pluginRootPath:</span> <span class=\"string\">live2dw/</span> <span class=\"comment\"># 插件在站点上的根目录(相对路径)</span></span><br><span class=\"line\"><span class=\"attr\">  pluginJsPath:</span> <span class=\"string\">lib/</span> <span class=\"comment\"># 脚本文件相对与插件根目录路径</span></span><br><span class=\"line\"><span class=\"attr\">  pluginModelPath:</span> <span class=\"string\">assets/</span> <span class=\"comment\"># 模型文件相对与插件根目录路径</span></span><br><span class=\"line\">  <span class=\"comment\"># scriptFrom: jsdelivr # jsdelivr CDN</span></span><br><span class=\"line\">  <span class=\"comment\"># scriptFrom: unpkg # unpkg CDN</span></span><br><span class=\"line\">  <span class=\"comment\"># scriptFrom: https://cdn.jsdelivr.net/npm/live2d-widget@3.x/lib/L2Dwidget.min.js # 你的自定义 url</span></span><br><span class=\"line\"><span class=\"attr\">  tagMode:</span> <span class=\"literal\">false</span> <span class=\"comment\"># 标签模式, 是否仅替换 live2d tag标签而非插入到所有页面中</span></span><br><span class=\"line\"><span class=\"attr\">  debug:</span> <span class=\"literal\">false</span> <span class=\"comment\"># 调试, 是否在控制台输出日志</span></span><br><span class=\"line\"><span class=\"attr\">  model:</span></span><br><span class=\"line\"><span class=\"attr\">    use:</span> <span class=\"string\">live2d-widget-model-haruto</span> <span class=\"comment\"># npm-module package name</span></span><br><span class=\"line\">    <span class=\"comment\"># use: wanko # 博客根目录/live2d_models/ 下的目录名</span></span><br><span class=\"line\">    <span class=\"comment\"># use: ./wives/wanko # 相对于博客根目录的路径</span></span><br><span class=\"line\">    <span class=\"comment\"># use: https://cdn.jsdelivr.net/npm/live2d-widget-model-wanko@1.0.5/assets/wanko.model.json # 你的自定义 url</span></span><br><span class=\"line\"><span class=\"attr\">  display:</span></span><br><span class=\"line\"><span class=\"attr\">    position:</span> <span class=\"string\">left</span></span><br><span class=\"line\"><span class=\"attr\">    width:</span> <span class=\"number\">150</span></span><br><span class=\"line\"><span class=\"attr\">    height:</span> <span class=\"number\">300</span></span><br><span class=\"line\"><span class=\"attr\">  mobile:</span></span><br><span class=\"line\"><span class=\"attr\">    show:</span> <span class=\"literal\">true</span> <span class=\"comment\"># 手机中是否展示</span></span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"length":1371,"excerpt":"<h3 id=\"hexo6-左下角添加看板娘\"><a href=\"#hexo6-左下角添加看板娘\" class=\"headerlink\" title=\"hexo6 左下角添加看板娘\"></a>hexo6 左下角添加看板娘</h3>","more":"<p>github地址: <a href=\"https://github.com/stevenjoezhang/live2d-widget\" target=\"_blank\" rel=\"noopener\">张书樵大神</a></p>\n<h3 id=\"下载大神项目-会说话-换人物-小游戏等功能\"><a href=\"#下载大神项目-会说话-换人物-小游戏等功能\" class=\"headerlink\" title=\"下载大神项目 (会说话,换人物,小游戏等功能)\"></a>下载大神项目 (会说话,换人物,小游戏等功能)</h3><figure class=\"highlight vim\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">cd</span> themes/nextv6/<span class=\"keyword\">source</span></span><br><span class=\"line\">git clone http<span class=\"variable\">s:</span>//github.<span class=\"keyword\">com</span>/stevenjoezhang/live2d-widget.git</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"github说明比较详细-这里简单说明\"><a href=\"#github说明比较详细-这里简单说明\" class=\"headerlink\" title=\"github说明比较详细, 这里简单说明\"></a>github说明比较详细, 这里简单说明</h4><blockquote>\n<p>由于这里是克隆到了source目录, hexo d -g的时候会生成到public目录, 相当于站点根目录了</p>\n</blockquote>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 直接开启autoload.js注释</span><br><span class=\"line\">const live2d_path = \"/live2d-widget/\";</span><br><span class=\"line\"></span><br><span class=\"line\"># 修改 themes/nextv6/layout/_layout.swig, 最后一行添加如下</span><br><span class=\"line\"><span class=\"comment\">&lt;!-- 看板娘 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"/live2d-widget/autoload.js\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"一般小白简单教程-只有看鼠标方向功能\"><a href=\"#一般小白简单教程-只有看鼠标方向功能\" class=\"headerlink\" title=\"一般小白简单教程(只有看鼠标方向功能)\"></a>一般小白简单教程(只有看鼠标方向功能)</h3><blockquote>\n<p>hexo 官方支持版</p>\n</blockquote>\n<h4 id=\"需要安装模板\"><a href=\"#需要安装模板\" class=\"headerlink\" title=\"需要安装模板\"></a>需要安装模板</h4><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm <span class=\"keyword\">install</span> <span class=\"comment\">--save hexo-helper-live2d</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"修改主题配置文件\"><a href=\"#修改主题配置文件\" class=\"headerlink\" title=\"修改主题配置文件\"></a>修改主题配置文件</h4><p><a href=\"https://blog.csdn.net/wang_123_zy/article/details/87181892#live2dwidgetmodelchitose_12\" target=\"_blank\" rel=\"noopener\">各种宠物预览</a></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Live2D</span></span><br><span class=\"line\"><span class=\"comment\">## https://github.com/EYHN/hexo-helper-live2d</span></span><br><span class=\"line\"><span class=\"attr\">live2d:</span></span><br><span class=\"line\"><span class=\"attr\">  enable:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"comment\"># enable: false</span></span><br><span class=\"line\"><span class=\"attr\">  scriptFrom:</span> <span class=\"string\">local</span> <span class=\"comment\"># 默认</span></span><br><span class=\"line\"><span class=\"attr\">  pluginRootPath:</span> <span class=\"string\">live2dw/</span> <span class=\"comment\"># 插件在站点上的根目录(相对路径)</span></span><br><span class=\"line\"><span class=\"attr\">  pluginJsPath:</span> <span class=\"string\">lib/</span> <span class=\"comment\"># 脚本文件相对与插件根目录路径</span></span><br><span class=\"line\"><span class=\"attr\">  pluginModelPath:</span> <span class=\"string\">assets/</span> <span class=\"comment\"># 模型文件相对与插件根目录路径</span></span><br><span class=\"line\">  <span class=\"comment\"># scriptFrom: jsdelivr # jsdelivr CDN</span></span><br><span class=\"line\">  <span class=\"comment\"># scriptFrom: unpkg # unpkg CDN</span></span><br><span class=\"line\">  <span class=\"comment\"># scriptFrom: https://cdn.jsdelivr.net/npm/live2d-widget@3.x/lib/L2Dwidget.min.js # 你的自定义 url</span></span><br><span class=\"line\"><span class=\"attr\">  tagMode:</span> <span class=\"literal\">false</span> <span class=\"comment\"># 标签模式, 是否仅替换 live2d tag标签而非插入到所有页面中</span></span><br><span class=\"line\"><span class=\"attr\">  debug:</span> <span class=\"literal\">false</span> <span class=\"comment\"># 调试, 是否在控制台输出日志</span></span><br><span class=\"line\"><span class=\"attr\">  model:</span></span><br><span class=\"line\"><span class=\"attr\">    use:</span> <span class=\"string\">live2d-widget-model-haruto</span> <span class=\"comment\"># npm-module package name</span></span><br><span class=\"line\">    <span class=\"comment\"># use: wanko # 博客根目录/live2d_models/ 下的目录名</span></span><br><span class=\"line\">    <span class=\"comment\"># use: ./wives/wanko # 相对于博客根目录的路径</span></span><br><span class=\"line\">    <span class=\"comment\"># use: https://cdn.jsdelivr.net/npm/live2d-widget-model-wanko@1.0.5/assets/wanko.model.json # 你的自定义 url</span></span><br><span class=\"line\"><span class=\"attr\">  display:</span></span><br><span class=\"line\"><span class=\"attr\">    position:</span> <span class=\"string\">left</span></span><br><span class=\"line\"><span class=\"attr\">    width:</span> <span class=\"number\">150</span></span><br><span class=\"line\"><span class=\"attr\">    height:</span> <span class=\"number\">300</span></span><br><span class=\"line\"><span class=\"attr\">  mobile:</span></span><br><span class=\"line\"><span class=\"attr\">    show:</span> <span class=\"literal\">true</span> <span class=\"comment\"># 手机中是否展示</span></span><br></pre></td></tr></table></figure>"},{"title":"ceph安装部署","copyright":true,"date":"2019-09-26T03:13:40.000Z","_content":"\nCeph是一个统一的分布式存储系统，设计初衷是提供较好的性能、可靠性和可扩展性。\n\n<!-- more-->\n\n### 简单了解什么是块存储/对象存储/文件系统存储？\n\nceph 目前提供对象存储（RADOSGW）、块存储RDB以及 CephFS 文件系统这 3 种功能。对于这3种功能介绍，分别如下：\n\n1. 对象存储，也就是通常意义的键值存储，其接口就是简单的GET、PUT、DEL 和其他扩展，代表主要有 Swift 、S3 以及 Gluster 等；\n\n2. 块存储，这种接口通常以 QEMU Driver 或者 Kernel Module 的方式存在，这种接口需要实现 Linux 的 Block Device 的接口或者 QEMU 提供的 Block Driver 接口，如 Sheepdog，AWS 的 EBS，青云的云硬盘和阿里云的盘古系统，还有 Ceph 的 RBD（RBD是Ceph面向块存储的接口）。在常见的存储中 DAS、SAN 提供的也是块存储；\n\n3. 文件存储，通常意义是支持 POSIX 接口，它跟传统的文件系统如 Ext4 是一个类型的，但区别在于分布式存储提供了并行化的能力，如 Ceph 的 CephFS (CephFS是Ceph面向文件存储的接口)，但是有时候又会把 GlusterFS ，HDFS 这种非POSIX接口的类文件存储接口归入此类。当然 NFS、NAS也是属于文件系统存储；\n\n\n### 参考教程\n[Kubernetes 集成 Ceph 后端存储教程](https://blog.csdn.net/shida_csdn/article/details/78579043)\n[centos7安装ceph集群](https://blog.csdn.net/zcc_heu/article/details/79017624)\n\n###  准备\n#### 配置源\n```\ncat >/etc/yum.repos.d/ceph.repo<<EOF\n[ceph]\nname=ceph\nbaseurl=http://mirrors.aliyun.com/ceph/rpm-jewel/el7/x86_64/\ngpgcheck=0\npriority=1\n\n[ceph-noarch]\nname=cephnoarch\nbaseurl=http://mirrors.aliyun.com/ceph/rpm-jewel/el7/noarch/\ngpgcheck=0\npriority=1\n\n[ceph-source]\nname=Ceph source packages\nbaseurl=http://mirrors.163.com/ceph/rpm-jewel/el7/SRPMS\nenabled=0\ngpgcheck=1\ntype=rpm-md\ngpgkey=http://mirrors.163.com/ceph/keys/release.asc\npriority=1\nEOF\n\n```\n\n\n#### 安装过卸载\n```\nceph-deploy purge dk1-t dk2-t\nceph-deploy purgedata dk1-t dk2-t\nceph-deploy forgetkeys\n\n```\n\n\n### 在dk2-t节点创建集群 mon模块\n```\nyum install ceph-deploy -y\nceph-deploy --version\n\nmkdir /data/ceph\ncd /data/ceph\nceph-deploy new dk2-t\n\n# 查看配置文件\nls -l\n\n# 配置ceph.conf\n[global]\n...\n# 如果有多个网卡，应该配置如下选项，\n# public network是公共网络，负责集群对外提供服务的流量\n# cluster network是集群网络，负载集群中数据复制传输通信等\n# 本次实验使用同一块网卡，生境环境建议分别使用一块网卡\npublic network = 172.16.76.0/22\ncluster network = 172.16.76.0/22\nosd pool default size = 2\n\n\n# 安装 ceph 包\n# 如果按照官方文档安装方法 会重新配置安装官方ceph源\n# 由于网络问题，安装可能会出错，需要多次执行\n# ceph-deploy install 其实只是会安装 ceph ceph-radosgw 两个包\n# ceph-deploy install lab1 lab2 lab3\n# 推荐使用阿里源安装，因为使用ceph-deploy安装会很慢\n# 使用如下命令手动安装包，替代官方的 ceph-deploy install 命令\n# 如下操作在所有node节点上执行\nexport CEPH_DEPLOY_REPO_URL=http://mirrors.163.com/ceph/rpm-luminous/el7\nexport CEPH_DEPLOY_GPG_URL=http://mirrors.163.com/ceph/keys/release.asc\n\n# 先执行是因为 ceph-deploy install太慢\nyum install -y ceph ceph-radosgw\nceph-deploy install dk2-t\n\n\n# 部署monitor和生成keys\nceph-deploy mon create-initial\nls -l *.keyring\n\n# 复制文件到node节点\nceph-deploy dk1-t dk2-t\n\n# 额外mon节点，mon节点也需要高可用\nceph-deploy mon add dk1-t\n```\n\n\n### 在dk2-t节点创建集群 mgr模块\n```\n# 部署manager （luminous+）12及以后的版本需要部署\n# 本次部署 jewel 版本 ，不需要执行如下命令\n ceph-deploy mgr create dk2-t\n```\n\n### 在dk2-t节点创建集群 osd模块\n```\n# 12的版本(这里挂载一个 10G的磁盘 /dev/sdb)\n# create 命令一次完成准备 OSD 、部署到 OSD 节点、并激活它。 create 命令是依次执行 prepare 和 activate 命令的捷径。\nceph-deploy osd create --data /dev/sdb dk2-t\nceph-deploy osd create --data /dev/sdc dk1-t\n```\n\n\n### 如何卸载osd\n```\n# 查看\nceph osd tree\n\n# 节点状态标记为out\nceph osd out osd.0\n\n# 从crush中移除节点\nceph osd crush remove osd.0\n\n# 删除节点\nceph osd rm osd.0\n\n# 删除节点认证（不删除编号会占住）\nceph auth del osd.0\n```\n\n\n#### 查看 mon 信息\n\n```\nceph mon dump\n\ndumped monmap epoch 1\nepoch 1\nfsid 4620d0c7-4458-4ff9-9296-d1318058bafc\nlast_changed 2019-06-19 14:44:41.361005\ncreated 2019-06-19 14:44:41.361005\n0: 172.16.76.134:6789/0 mon.dk2-t\n```\n\n#### 配置文件内容 /etc/ceph/ceph.conf\n```\n[global]\npublic network = 172.16.76.0/22\ncluster network = 172.16.76.0/22\nosd pool default size = 2\nfsid = 4620d0c7-4458-4ff9-9296-d1318058bafc\nmon_initial_members = dk2-t\nmon_host = 172.16.76.134\nauth_cluster_required = cephx\nauth_service_required = cephx\nauth_client_required = cephx\nmon_max_pg_per_osd = 1000\n```\n\n\n\n### ceph 一些测试命令\n\n####  创建 rbd pool，名字叫做 kube\n```\nceph osd pool create kube 256 256\n```\n\n#### 如何取得admin的密钥\n\n```\nceph auth get client.admin 2>&1 |grep \"key = \" |awk '{print  $3}'\nAQAn/19bbb21GBAA1kc0HRWoGjeoPTRQziA03A==\n```\n\n#### 测试ceph是否正常\n\n```\nrbd create kube/test --size 1024 --image-format 2\nrbd ls kube\nrbd map kube/test\n    # 如果报错, 警用\n    rbd info kube/test\n    rbd feature disable kube/test exclusive-lock object-map fast-diff deep-flatten\n\nrbd map kube/test\nrbd showmapped\nmkfs.ext4 /dev/rbd0\nmkdir /data/rbd0\nmount /dev/rbd0 /data/rbd0\ncd /data/rbd0 && echo test > test.txt\n\n```\n\n\n---\n\n\n\n\n### 在k8s 手动创建存储类\n#### 创建ceph pg\n```\n# Total PGs = (Total_number_of_OSD * 100) / max_replication_count\n# pg = 1 * 100 /2 ~ 64(取2的次方数)\n\n# 这里准备创建2个pool, 每个pool\nceph osd pool create rbd-k8s 16\n\n# 查看\nceph osd lspools\n\n# 创建image\nrbd create rbd-k8s/cephimageredis --size 500M\n\n# 查看list\nrbd list rbd-k8s\n\n# 处理新特性\n# 查看info\nrbd info rbd-k8s/cephimageredis\n\n# 关闭exclusive-lock object-map fast-diff deep-flatten 这些特性\nrbd feature disable  rbd-k8s/cephimageredis exclusive-lock object-map fast-diff deep-flatten\n```\n\n#### 首先创建secret\n```\n#获取key\ngrep key /etc/ceph/ceph.client.admin.keyring |awk '{printf \"%s\", $NF}'|base64\n```\n\n- **ceph-secret.yaml**\n```\napiVersion: v1\nkind: Secret\nmetadata:\n  name: ceph-secret\ntype: \"kubernetes.io/rbd\"\ndata:\n  key: QVFCTFo2dGNGNXFLRnhBQXBGTXJEdm5CY2k2UGtwZmZrN0JSVEE9PQ==\n```\n\n#### 其次创建pv, pv是没有namespace概念的\n> persistentVolumeReclaimPolicy是清理规则 (retain: 不清理, Recycle: 回收)\n- **redis-ceph-pv.yml**\n```\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: redis2-ceph-rbd-pv\nspec:\n  capacity:\n    storage: 100Mi\n  accessModes:\n    - ReadWriteOnce\n  rbd:\n    monitors:\n      - '172.16.76.134:6789'\n    pool: rbd-k8s\n    image: cephimageredis\n    user: admin\n    secretRef:\n      name: ceph-secret\n    fsType: ext4\n    readOnly: false\n  persistentVolumeReclaimPolicy: Recycle\n```\n\n- **执行部署pv**\n```\nkubectl create -f redis-ceph-pv.yml\n```\n\n#### 然后创建pvc\n- **redis-ceph-pvc.yml**\n\n```\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: redis2-ceph-rbd-pvc\nspec:\n  accessModes:\n    - ReadWriteOnce\n  resources:\n    requests:\n      storage: 100Mi\n```\n\n- **执行部署pvc**\n```\nkubectl create -f redis-ceph-pvc.yml\n```\n\n#### 最后在rancher上选择挂载rbd\n\n![rancher-pv](https://zhangzw001.github.io/images/blog6/rancher-pv.png)\n\n\n---\n\n\n\n\n","source":"_posts/6-ceph安装部署.md","raw":"---\ntitle: ceph安装部署\ncopyright: true\ndate: 2019-09-26 11:13:40\ntags:\n  - ceph\n  - cephfs\n  - k8s\n  - k8s存储\ncategories:\n  - [技术文档]\n  - [存储,ceph]\n---\n\nCeph是一个统一的分布式存储系统，设计初衷是提供较好的性能、可靠性和可扩展性。\n\n<!-- more-->\n\n### 简单了解什么是块存储/对象存储/文件系统存储？\n\nceph 目前提供对象存储（RADOSGW）、块存储RDB以及 CephFS 文件系统这 3 种功能。对于这3种功能介绍，分别如下：\n\n1. 对象存储，也就是通常意义的键值存储，其接口就是简单的GET、PUT、DEL 和其他扩展，代表主要有 Swift 、S3 以及 Gluster 等；\n\n2. 块存储，这种接口通常以 QEMU Driver 或者 Kernel Module 的方式存在，这种接口需要实现 Linux 的 Block Device 的接口或者 QEMU 提供的 Block Driver 接口，如 Sheepdog，AWS 的 EBS，青云的云硬盘和阿里云的盘古系统，还有 Ceph 的 RBD（RBD是Ceph面向块存储的接口）。在常见的存储中 DAS、SAN 提供的也是块存储；\n\n3. 文件存储，通常意义是支持 POSIX 接口，它跟传统的文件系统如 Ext4 是一个类型的，但区别在于分布式存储提供了并行化的能力，如 Ceph 的 CephFS (CephFS是Ceph面向文件存储的接口)，但是有时候又会把 GlusterFS ，HDFS 这种非POSIX接口的类文件存储接口归入此类。当然 NFS、NAS也是属于文件系统存储；\n\n\n### 参考教程\n[Kubernetes 集成 Ceph 后端存储教程](https://blog.csdn.net/shida_csdn/article/details/78579043)\n[centos7安装ceph集群](https://blog.csdn.net/zcc_heu/article/details/79017624)\n\n###  准备\n#### 配置源\n```\ncat >/etc/yum.repos.d/ceph.repo<<EOF\n[ceph]\nname=ceph\nbaseurl=http://mirrors.aliyun.com/ceph/rpm-jewel/el7/x86_64/\ngpgcheck=0\npriority=1\n\n[ceph-noarch]\nname=cephnoarch\nbaseurl=http://mirrors.aliyun.com/ceph/rpm-jewel/el7/noarch/\ngpgcheck=0\npriority=1\n\n[ceph-source]\nname=Ceph source packages\nbaseurl=http://mirrors.163.com/ceph/rpm-jewel/el7/SRPMS\nenabled=0\ngpgcheck=1\ntype=rpm-md\ngpgkey=http://mirrors.163.com/ceph/keys/release.asc\npriority=1\nEOF\n\n```\n\n\n#### 安装过卸载\n```\nceph-deploy purge dk1-t dk2-t\nceph-deploy purgedata dk1-t dk2-t\nceph-deploy forgetkeys\n\n```\n\n\n### 在dk2-t节点创建集群 mon模块\n```\nyum install ceph-deploy -y\nceph-deploy --version\n\nmkdir /data/ceph\ncd /data/ceph\nceph-deploy new dk2-t\n\n# 查看配置文件\nls -l\n\n# 配置ceph.conf\n[global]\n...\n# 如果有多个网卡，应该配置如下选项，\n# public network是公共网络，负责集群对外提供服务的流量\n# cluster network是集群网络，负载集群中数据复制传输通信等\n# 本次实验使用同一块网卡，生境环境建议分别使用一块网卡\npublic network = 172.16.76.0/22\ncluster network = 172.16.76.0/22\nosd pool default size = 2\n\n\n# 安装 ceph 包\n# 如果按照官方文档安装方法 会重新配置安装官方ceph源\n# 由于网络问题，安装可能会出错，需要多次执行\n# ceph-deploy install 其实只是会安装 ceph ceph-radosgw 两个包\n# ceph-deploy install lab1 lab2 lab3\n# 推荐使用阿里源安装，因为使用ceph-deploy安装会很慢\n# 使用如下命令手动安装包，替代官方的 ceph-deploy install 命令\n# 如下操作在所有node节点上执行\nexport CEPH_DEPLOY_REPO_URL=http://mirrors.163.com/ceph/rpm-luminous/el7\nexport CEPH_DEPLOY_GPG_URL=http://mirrors.163.com/ceph/keys/release.asc\n\n# 先执行是因为 ceph-deploy install太慢\nyum install -y ceph ceph-radosgw\nceph-deploy install dk2-t\n\n\n# 部署monitor和生成keys\nceph-deploy mon create-initial\nls -l *.keyring\n\n# 复制文件到node节点\nceph-deploy dk1-t dk2-t\n\n# 额外mon节点，mon节点也需要高可用\nceph-deploy mon add dk1-t\n```\n\n\n### 在dk2-t节点创建集群 mgr模块\n```\n# 部署manager （luminous+）12及以后的版本需要部署\n# 本次部署 jewel 版本 ，不需要执行如下命令\n ceph-deploy mgr create dk2-t\n```\n\n### 在dk2-t节点创建集群 osd模块\n```\n# 12的版本(这里挂载一个 10G的磁盘 /dev/sdb)\n# create 命令一次完成准备 OSD 、部署到 OSD 节点、并激活它。 create 命令是依次执行 prepare 和 activate 命令的捷径。\nceph-deploy osd create --data /dev/sdb dk2-t\nceph-deploy osd create --data /dev/sdc dk1-t\n```\n\n\n### 如何卸载osd\n```\n# 查看\nceph osd tree\n\n# 节点状态标记为out\nceph osd out osd.0\n\n# 从crush中移除节点\nceph osd crush remove osd.0\n\n# 删除节点\nceph osd rm osd.0\n\n# 删除节点认证（不删除编号会占住）\nceph auth del osd.0\n```\n\n\n#### 查看 mon 信息\n\n```\nceph mon dump\n\ndumped monmap epoch 1\nepoch 1\nfsid 4620d0c7-4458-4ff9-9296-d1318058bafc\nlast_changed 2019-06-19 14:44:41.361005\ncreated 2019-06-19 14:44:41.361005\n0: 172.16.76.134:6789/0 mon.dk2-t\n```\n\n#### 配置文件内容 /etc/ceph/ceph.conf\n```\n[global]\npublic network = 172.16.76.0/22\ncluster network = 172.16.76.0/22\nosd pool default size = 2\nfsid = 4620d0c7-4458-4ff9-9296-d1318058bafc\nmon_initial_members = dk2-t\nmon_host = 172.16.76.134\nauth_cluster_required = cephx\nauth_service_required = cephx\nauth_client_required = cephx\nmon_max_pg_per_osd = 1000\n```\n\n\n\n### ceph 一些测试命令\n\n####  创建 rbd pool，名字叫做 kube\n```\nceph osd pool create kube 256 256\n```\n\n#### 如何取得admin的密钥\n\n```\nceph auth get client.admin 2>&1 |grep \"key = \" |awk '{print  $3}'\nAQAn/19bbb21GBAA1kc0HRWoGjeoPTRQziA03A==\n```\n\n#### 测试ceph是否正常\n\n```\nrbd create kube/test --size 1024 --image-format 2\nrbd ls kube\nrbd map kube/test\n    # 如果报错, 警用\n    rbd info kube/test\n    rbd feature disable kube/test exclusive-lock object-map fast-diff deep-flatten\n\nrbd map kube/test\nrbd showmapped\nmkfs.ext4 /dev/rbd0\nmkdir /data/rbd0\nmount /dev/rbd0 /data/rbd0\ncd /data/rbd0 && echo test > test.txt\n\n```\n\n\n---\n\n\n\n\n### 在k8s 手动创建存储类\n#### 创建ceph pg\n```\n# Total PGs = (Total_number_of_OSD * 100) / max_replication_count\n# pg = 1 * 100 /2 ~ 64(取2的次方数)\n\n# 这里准备创建2个pool, 每个pool\nceph osd pool create rbd-k8s 16\n\n# 查看\nceph osd lspools\n\n# 创建image\nrbd create rbd-k8s/cephimageredis --size 500M\n\n# 查看list\nrbd list rbd-k8s\n\n# 处理新特性\n# 查看info\nrbd info rbd-k8s/cephimageredis\n\n# 关闭exclusive-lock object-map fast-diff deep-flatten 这些特性\nrbd feature disable  rbd-k8s/cephimageredis exclusive-lock object-map fast-diff deep-flatten\n```\n\n#### 首先创建secret\n```\n#获取key\ngrep key /etc/ceph/ceph.client.admin.keyring |awk '{printf \"%s\", $NF}'|base64\n```\n\n- **ceph-secret.yaml**\n```\napiVersion: v1\nkind: Secret\nmetadata:\n  name: ceph-secret\ntype: \"kubernetes.io/rbd\"\ndata:\n  key: QVFCTFo2dGNGNXFLRnhBQXBGTXJEdm5CY2k2UGtwZmZrN0JSVEE9PQ==\n```\n\n#### 其次创建pv, pv是没有namespace概念的\n> persistentVolumeReclaimPolicy是清理规则 (retain: 不清理, Recycle: 回收)\n- **redis-ceph-pv.yml**\n```\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: redis2-ceph-rbd-pv\nspec:\n  capacity:\n    storage: 100Mi\n  accessModes:\n    - ReadWriteOnce\n  rbd:\n    monitors:\n      - '172.16.76.134:6789'\n    pool: rbd-k8s\n    image: cephimageredis\n    user: admin\n    secretRef:\n      name: ceph-secret\n    fsType: ext4\n    readOnly: false\n  persistentVolumeReclaimPolicy: Recycle\n```\n\n- **执行部署pv**\n```\nkubectl create -f redis-ceph-pv.yml\n```\n\n#### 然后创建pvc\n- **redis-ceph-pvc.yml**\n\n```\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: redis2-ceph-rbd-pvc\nspec:\n  accessModes:\n    - ReadWriteOnce\n  resources:\n    requests:\n      storage: 100Mi\n```\n\n- **执行部署pvc**\n```\nkubectl create -f redis-ceph-pvc.yml\n```\n\n#### 最后在rancher上选择挂载rbd\n\n![rancher-pv](https://zhangzw001.github.io/images/blog6/rancher-pv.png)\n\n\n---\n\n\n\n\n","slug":"6-ceph安装部署","published":1,"updated":"2019-10-16T09:15:27.840Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck28uwzn8000ykerwqj5qtgtp","content":"<p>Ceph是一个统一的分布式存储系统，设计初衷是提供较好的性能、可靠性和可扩展性。</p>\n<a id=\"more\"></a>\n\n<h3 id=\"简单了解什么是块存储-对象存储-文件系统存储？\"><a href=\"#简单了解什么是块存储-对象存储-文件系统存储？\" class=\"headerlink\" title=\"简单了解什么是块存储/对象存储/文件系统存储？\"></a>简单了解什么是块存储/对象存储/文件系统存储？</h3><p>ceph 目前提供对象存储（RADOSGW）、块存储RDB以及 CephFS 文件系统这 3 种功能。对于这3种功能介绍，分别如下：</p>\n<ol>\n<li><p>对象存储，也就是通常意义的键值存储，其接口就是简单的GET、PUT、DEL 和其他扩展，代表主要有 Swift 、S3 以及 Gluster 等；</p>\n</li>\n<li><p>块存储，这种接口通常以 QEMU Driver 或者 Kernel Module 的方式存在，这种接口需要实现 Linux 的 Block Device 的接口或者 QEMU 提供的 Block Driver 接口，如 Sheepdog，AWS 的 EBS，青云的云硬盘和阿里云的盘古系统，还有 Ceph 的 RBD（RBD是Ceph面向块存储的接口）。在常见的存储中 DAS、SAN 提供的也是块存储；</p>\n</li>\n<li><p>文件存储，通常意义是支持 POSIX 接口，它跟传统的文件系统如 Ext4 是一个类型的，但区别在于分布式存储提供了并行化的能力，如 Ceph 的 CephFS (CephFS是Ceph面向文件存储的接口)，但是有时候又会把 GlusterFS ，HDFS 这种非POSIX接口的类文件存储接口归入此类。当然 NFS、NAS也是属于文件系统存储；</p>\n</li>\n</ol>\n<h3 id=\"参考教程\"><a href=\"#参考教程\" class=\"headerlink\" title=\"参考教程\"></a>参考教程</h3><p><a href=\"https://blog.csdn.net/shida_csdn/article/details/78579043\" target=\"_blank\" rel=\"noopener\">Kubernetes 集成 Ceph 后端存储教程</a><br><a href=\"https://blog.csdn.net/zcc_heu/article/details/79017624\" target=\"_blank\" rel=\"noopener\">centos7安装ceph集群</a></p>\n<h3 id=\"准备\"><a href=\"#准备\" class=\"headerlink\" title=\"准备\"></a>准备</h3><h4 id=\"配置源\"><a href=\"#配置源\" class=\"headerlink\" title=\"配置源\"></a>配置源</h4><figure class=\"highlight makefile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat &gt;/etc/yum.repos.d/ceph.repo&lt;&lt;EOF</span><br><span class=\"line\">[ceph]</span><br><span class=\"line\">name=ceph</span><br><span class=\"line\">baseurl=http://mirrors.aliyun.com/ceph/rpm-jewel/el7/x86_64/</span><br><span class=\"line\">gpgcheck=0</span><br><span class=\"line\">priority=1</span><br><span class=\"line\"></span><br><span class=\"line\">[ceph-noarch]</span><br><span class=\"line\">name=cephnoarch</span><br><span class=\"line\">baseurl=http://mirrors.aliyun.com/ceph/rpm-jewel/el7/noarch/</span><br><span class=\"line\">gpgcheck=0</span><br><span class=\"line\">priority=1</span><br><span class=\"line\"></span><br><span class=\"line\">[ceph-source]</span><br><span class=\"line\">name=Ceph source packages</span><br><span class=\"line\">baseurl=http://mirrors.163.com/ceph/rpm-jewel/el7/SRPMS</span><br><span class=\"line\">enabled=0</span><br><span class=\"line\">gpgcheck=1</span><br><span class=\"line\">type=rpm-md</span><br><span class=\"line\">gpgkey=http://mirrors.163.com/ceph/keys/release.asc</span><br><span class=\"line\">priority=1</span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"安装过卸载\"><a href=\"#安装过卸载\" class=\"headerlink\" title=\"安装过卸载\"></a>安装过卸载</h4><figure class=\"highlight excel\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ceph-deploy purge <span class=\"symbol\">dk1</span>-<span class=\"built_in\">t</span> <span class=\"symbol\">dk2</span>-<span class=\"built_in\">t</span></span><br><span class=\"line\">ceph-deploy purgedata <span class=\"symbol\">dk1</span>-<span class=\"built_in\">t</span> <span class=\"symbol\">dk2</span>-<span class=\"built_in\">t</span></span><br><span class=\"line\">ceph-deploy forgetkeys</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"在dk2-t节点创建集群-mon模块\"><a href=\"#在dk2-t节点创建集群-mon模块\" class=\"headerlink\" title=\"在dk2-t节点创建集群 mon模块\"></a>在dk2-t节点创建集群 mon模块</h3><figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install ceph-deploy -y</span><br><span class=\"line\">ceph-deploy --version</span><br><span class=\"line\"></span><br><span class=\"line\">mkdir /data/ceph</span><br><span class=\"line\">cd /data/ceph</span><br><span class=\"line\">ceph-deploy new dk2-t</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 查看配置文件</span></span><br><span class=\"line\">ls -l</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 配置ceph.conf</span></span><br><span class=\"line\">[global]</span><br><span class=\"line\"><span class=\"built_in\">..</span>.</span><br><span class=\"line\"><span class=\"comment\"># 如果有多个网卡，应该配置如下选项，</span></span><br><span class=\"line\"><span class=\"comment\"># public network是公共网络，负责集群对外提供服务的流量</span></span><br><span class=\"line\"><span class=\"comment\"># cluster network是集群网络，负载集群中数据复制传输通信等</span></span><br><span class=\"line\"><span class=\"comment\"># 本次实验使用同一块网卡，生境环境建议分别使用一块网卡</span></span><br><span class=\"line\">public<span class=\"built_in\"> network </span>= 172.16.76.0/22</span><br><span class=\"line\">cluster<span class=\"built_in\"> network </span>= 172.16.76.0/22</span><br><span class=\"line\">osd<span class=\"built_in\"> pool default </span>size = 2</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 安装 ceph 包</span></span><br><span class=\"line\"><span class=\"comment\"># 如果按照官方文档安装方法 会重新配置安装官方ceph源</span></span><br><span class=\"line\"><span class=\"comment\"># 由于网络问题，安装可能会出错，需要多次执行</span></span><br><span class=\"line\"><span class=\"comment\"># ceph-deploy install 其实只是会安装 ceph ceph-radosgw 两个包</span></span><br><span class=\"line\"><span class=\"comment\"># ceph-deploy install lab1 lab2 lab3</span></span><br><span class=\"line\"><span class=\"comment\"># 推荐使用阿里源安装，因为使用ceph-deploy安装会很慢</span></span><br><span class=\"line\"><span class=\"comment\"># 使用如下命令手动安装包，替代官方的 ceph-deploy install 命令</span></span><br><span class=\"line\"><span class=\"comment\"># 如下操作在所有node节点上执行</span></span><br><span class=\"line\"><span class=\"builtin-name\">export</span> <span class=\"attribute\">CEPH_DEPLOY_REPO_URL</span>=http://mirrors.163.com/ceph/rpm-luminous/el7</span><br><span class=\"line\"><span class=\"builtin-name\">export</span> <span class=\"attribute\">CEPH_DEPLOY_GPG_URL</span>=http://mirrors.163.com/ceph/keys/release.asc</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 先执行是因为 ceph-deploy install太慢</span></span><br><span class=\"line\">yum install -y ceph ceph-radosgw</span><br><span class=\"line\">ceph-deploy install dk2-t</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 部署monitor和生成keys</span></span><br><span class=\"line\">ceph-deploy mon create-initial</span><br><span class=\"line\">ls -l *.keyring</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 复制文件到node节点</span></span><br><span class=\"line\">ceph-deploy dk1-t dk2-t</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 额外mon节点，mon节点也需要高可用</span></span><br><span class=\"line\">ceph-deploy mon <span class=\"builtin-name\">add</span> dk1-t</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"在dk2-t节点创建集群-mgr模块\"><a href=\"#在dk2-t节点创建集群-mgr模块\" class=\"headerlink\" title=\"在dk2-t节点创建集群 mgr模块\"></a>在dk2-t节点创建集群 mgr模块</h3><figure class=\"highlight vala\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\"># 部署manager （luminous+）12及以后的版本需要部署</span></span><br><span class=\"line\"><span class=\"meta\"># 本次部署 jewel 版本 ，不需要执行如下命令</span></span><br><span class=\"line\"> ceph-deploy mgr create dk2-t</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"在dk2-t节点创建集群-osd模块\"><a href=\"#在dk2-t节点创建集群-osd模块\" class=\"headerlink\" title=\"在dk2-t节点创建集群 osd模块\"></a>在dk2-t节点创建集群 osd模块</h3><figure class=\"highlight jboss-cli\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 12的版本(这里挂载一个 10G的磁盘 /dev/sdb)</span></span><br><span class=\"line\"><span class=\"comment\"># create 命令一次完成准备 OSD 、部署到 OSD 节点、并激活它。 create 命令是依次执行 prepare 和 activate 命令的捷径。</span></span><br><span class=\"line\">ceph-deploy osd create <span class=\"params\">--data</span> <span class=\"string\">/dev/sdb</span> dk2-t</span><br><span class=\"line\">ceph-deploy osd create <span class=\"params\">--data</span> <span class=\"string\">/dev/sdc</span> dk1-t</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"如何卸载osd\"><a href=\"#如何卸载osd\" class=\"headerlink\" title=\"如何卸载osd\"></a>如何卸载osd</h3><figure class=\"highlight vala\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\"># 查看</span></span><br><span class=\"line\">ceph osd tree</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\"># 节点状态标记为out</span></span><br><span class=\"line\">ceph osd out osd<span class=\"number\">.0</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\"># 从crush中移除节点</span></span><br><span class=\"line\">ceph osd crush remove osd<span class=\"number\">.0</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\"># 删除节点</span></span><br><span class=\"line\">ceph osd rm osd<span class=\"number\">.0</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\"># 删除节点认证（不删除编号会占住）</span></span><br><span class=\"line\">ceph auth del osd<span class=\"number\">.0</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"查看-mon-信息\"><a href=\"#查看-mon-信息\" class=\"headerlink\" title=\"查看 mon 信息\"></a>查看 mon 信息</h4><figure class=\"highlight subunit\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ceph mon dump</span><br><span class=\"line\"></span><br><span class=\"line\">dumped monmap epoch 1</span><br><span class=\"line\">epoch 1</span><br><span class=\"line\">fsid 4620d0c7<span class=\"string\">-4458</span><span class=\"string\">-4</span>ff9<span class=\"string\">-9296</span>-d1318058bafc</span><br><span class=\"line\">last_changed 2019<span class=\"string\">-06</span><span class=\"string\">-19</span> 14:44:41.361005</span><br><span class=\"line\">created 2019<span class=\"string\">-06</span><span class=\"string\">-19</span> 14:44:41.361005</span><br><span class=\"line\">0: 172.16.76.134:6789/0 mon.dk2-t</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"配置文件内容-etc-ceph-ceph-conf\"><a href=\"#配置文件内容-etc-ceph-ceph-conf\" class=\"headerlink\" title=\"配置文件内容 /etc/ceph/ceph.conf\"></a>配置文件内容 /etc/ceph/ceph.conf</h4><figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[global]</span><br><span class=\"line\">public<span class=\"built_in\"> network </span>= 172.16.76.0/22</span><br><span class=\"line\">cluster<span class=\"built_in\"> network </span>= 172.16.76.0/22</span><br><span class=\"line\">osd<span class=\"built_in\"> pool default </span>size = 2</span><br><span class=\"line\">fsid = 4620d0c7-4458-4ff9-9296-d1318058bafc</span><br><span class=\"line\">mon_initial_members = dk2-t</span><br><span class=\"line\">mon_host = 172.16.76.134</span><br><span class=\"line\">auth_cluster_required = cephx</span><br><span class=\"line\">auth_service_required = cephx</span><br><span class=\"line\">auth_client_required = cephx</span><br><span class=\"line\">mon_max_pg_per_osd = 1000</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"ceph-一些测试命令\"><a href=\"#ceph-一些测试命令\" class=\"headerlink\" title=\"ceph 一些测试命令\"></a>ceph 一些测试命令</h3><h4 id=\"创建-rbd-pool，名字叫做-kube\"><a href=\"#创建-rbd-pool，名字叫做-kube\" class=\"headerlink\" title=\"创建 rbd pool，名字叫做 kube\"></a>创建 rbd pool，名字叫做 kube</h4><figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ceph osd<span class=\"built_in\"> pool </span>create kube 256 256</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"如何取得admin的密钥\"><a href=\"#如何取得admin的密钥\" class=\"headerlink\" title=\"如何取得admin的密钥\"></a>如何取得admin的密钥</h4><figure class=\"highlight lsl\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ceph auth get client.admin <span class=\"number\">2</span>&gt;&amp;<span class=\"number\">1</span> |grep <span class=\"string\">\"key = \"</span> |awk '&#123;print  $<span class=\"number\">3</span>&#125;'</span><br><span class=\"line\">AQAn/<span class=\"number\">19</span>bbb21GBAA1kc0HRWoGjeoPTRQziA03A==</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"测试ceph是否正常\"><a href=\"#测试ceph是否正常\" class=\"headerlink\" title=\"测试ceph是否正常\"></a>测试ceph是否正常</h4><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rbd <span class=\"keyword\">create</span> kube/<span class=\"keyword\">test</span> <span class=\"comment\">--size 1024 --image-format 2</span></span><br><span class=\"line\">rbd ls kube</span><br><span class=\"line\">rbd <span class=\"keyword\">map</span> kube/<span class=\"keyword\">test</span></span><br><span class=\"line\">    <span class=\"comment\"># 如果报错, 警用</span></span><br><span class=\"line\">    rbd info kube/<span class=\"keyword\">test</span></span><br><span class=\"line\">    rbd feature <span class=\"keyword\">disable</span> kube/<span class=\"keyword\">test</span> exclusive-<span class=\"keyword\">lock</span> <span class=\"keyword\">object</span>-<span class=\"keyword\">map</span> <span class=\"keyword\">fast</span>-diff deep-flatten</span><br><span class=\"line\"></span><br><span class=\"line\">rbd <span class=\"keyword\">map</span> kube/<span class=\"keyword\">test</span></span><br><span class=\"line\">rbd showmapped</span><br><span class=\"line\">mkfs.ext4 /dev/rbd0</span><br><span class=\"line\">mkdir /<span class=\"keyword\">data</span>/rbd0</span><br><span class=\"line\"><span class=\"keyword\">mount</span> /dev/rbd0 /<span class=\"keyword\">data</span>/rbd0</span><br><span class=\"line\">cd /<span class=\"keyword\">data</span>/rbd0 &amp;&amp; echo <span class=\"keyword\">test</span> &gt; test.txt</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"在k8s-手动创建存储类\"><a href=\"#在k8s-手动创建存储类\" class=\"headerlink\" title=\"在k8s 手动创建存储类\"></a>在k8s 手动创建存储类</h3><h4 id=\"创建ceph-pg\"><a href=\"#创建ceph-pg\" class=\"headerlink\" title=\"创建ceph pg\"></a>创建ceph pg</h4><figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Total PGs = (Total_number_of_OSD * 100) / max_replication_count</span></span><br><span class=\"line\"><span class=\"comment\"># pg = 1 * 100 /2 ~ 64(取2的次方数)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 这里准备创建2个pool, 每个pool</span></span><br><span class=\"line\">ceph osd<span class=\"built_in\"> pool </span>create rbd-k8s 16</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 查看</span></span><br><span class=\"line\">ceph osd lspools</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 创建image</span></span><br><span class=\"line\">rbd create rbd-k8s/cephimageredis --size 500M</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 查看list</span></span><br><span class=\"line\">rbd list rbd-k8s</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 处理新特性</span></span><br><span class=\"line\"><span class=\"comment\"># 查看info</span></span><br><span class=\"line\">rbd <span class=\"builtin-name\">info</span> rbd-k8s/cephimageredis</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 关闭exclusive-lock object-map fast-diff deep-flatten 这些特性</span></span><br><span class=\"line\">rbd feature <span class=\"builtin-name\">disable</span>  rbd-k8s/cephimageredis exclusive-lock object-map fast-diff deep-flatten</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"首先创建secret\"><a href=\"#首先创建secret\" class=\"headerlink\" title=\"首先创建secret\"></a>首先创建secret</h4><figure class=\"highlight maxima\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#获取<span class=\"built_in\">key</span></span><br><span class=\"line\">grep <span class=\"built_in\">key</span> /etc/ceph/ceph.client.admin.keyring |awk '&#123;<span class=\"built_in\">printf</span> <span class=\"string\">\"%s\"</span>, $NF&#125;'|<span class=\"built_in\">base64</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><strong>ceph-secret.yaml</strong><figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apiVersion: v1</span><br><span class=\"line\">kind: Secret</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  name: ceph-secret</span><br><span class=\"line\">type: <span class=\"string\">\"kubernetes.io/rbd\"</span></span><br><span class=\"line\">data:</span><br><span class=\"line\">  key: <span class=\"attribute\">QVFCTFo2dGNGNXFLRnhBQXBGTXJEdm5CY2k2UGtwZmZrN0JSVEE9PQ</span>==</span><br></pre></td></tr></table></figure>\n\n</li>\n</ul>\n<h4 id=\"其次创建pv-pv是没有namespace概念的\"><a href=\"#其次创建pv-pv是没有namespace概念的\" class=\"headerlink\" title=\"其次创建pv, pv是没有namespace概念的\"></a>其次创建pv, pv是没有namespace概念的</h4><blockquote>\n<p>persistentVolumeReclaimPolicy是清理规则 (retain: 不清理, Recycle: 回收)</p>\n<ul>\n<li><strong>redis-ceph-pv.yml</strong></li>\n</ul>\n</blockquote>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">PersistentVolume</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">redis2-ceph-rbd-pv</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\">  capacity:</span></span><br><span class=\"line\"><span class=\"attr\">    storage:</span> <span class=\"number\">100</span><span class=\"string\">Mi</span></span><br><span class=\"line\"><span class=\"attr\">  accessModes:</span></span><br><span class=\"line\"><span class=\"bullet\">    -</span> <span class=\"string\">ReadWriteOnce</span></span><br><span class=\"line\"><span class=\"attr\">  rbd:</span></span><br><span class=\"line\"><span class=\"attr\">    monitors:</span></span><br><span class=\"line\"><span class=\"bullet\">      -</span> <span class=\"string\">'172.16.76.134:6789'</span></span><br><span class=\"line\"><span class=\"attr\">    pool:</span> <span class=\"string\">rbd-k8s</span></span><br><span class=\"line\"><span class=\"attr\">    image:</span> <span class=\"string\">cephimageredis</span></span><br><span class=\"line\"><span class=\"attr\">    user:</span> <span class=\"string\">admin</span></span><br><span class=\"line\"><span class=\"attr\">    secretRef:</span></span><br><span class=\"line\"><span class=\"attr\">      name:</span> <span class=\"string\">ceph-secret</span></span><br><span class=\"line\"><span class=\"attr\">    fsType:</span> <span class=\"string\">ext4</span></span><br><span class=\"line\"><span class=\"attr\">    readOnly:</span> <span class=\"literal\">false</span></span><br><span class=\"line\"><span class=\"attr\">  persistentVolumeReclaimPolicy:</span> <span class=\"string\">Recycle</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><strong>执行部署pv</strong><figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">kubectl</span> <span class=\"selector-tag\">create</span> <span class=\"selector-tag\">-f</span> <span class=\"selector-tag\">redis-ceph-pv</span><span class=\"selector-class\">.yml</span></span><br></pre></td></tr></table></figure>\n\n</li>\n</ul>\n<h4 id=\"然后创建pvc\"><a href=\"#然后创建pvc\" class=\"headerlink\" title=\"然后创建pvc\"></a>然后创建pvc</h4><ul>\n<li><strong>redis-ceph-pvc.yml</strong></li>\n</ul>\n<figure class=\"highlight dts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"symbol\">apiVersion:</span> v1</span><br><span class=\"line\"><span class=\"symbol\">kind:</span> PersistentVolumeClaim</span><br><span class=\"line\"><span class=\"symbol\">metadata:</span></span><br><span class=\"line\"><span class=\"symbol\">  name:</span> redis2-ceph-rbd-pvc</span><br><span class=\"line\"><span class=\"symbol\">spec:</span></span><br><span class=\"line\"><span class=\"symbol\">  accessModes:</span></span><br><span class=\"line\">    - ReadWriteOnce</span><br><span class=\"line\"><span class=\"symbol\">  resources:</span></span><br><span class=\"line\"><span class=\"symbol\">    requests:</span></span><br><span class=\"line\"><span class=\"symbol\">      storage:</span> <span class=\"number\">100</span>Mi</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><strong>执行部署pvc</strong><figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">kubectl</span> <span class=\"selector-tag\">create</span> <span class=\"selector-tag\">-f</span> <span class=\"selector-tag\">redis-ceph-pvc</span><span class=\"selector-class\">.yml</span></span><br></pre></td></tr></table></figure>\n\n</li>\n</ul>\n<h4 id=\"最后在rancher上选择挂载rbd\"><a href=\"#最后在rancher上选择挂载rbd\" class=\"headerlink\" title=\"最后在rancher上选择挂载rbd\"></a>最后在rancher上选择挂载rbd</h4><p><img src=\"https://zhangzw001.github.io/images/blog6/rancher-pv.png\" alt=\"rancher-pv\"></p>\n<hr>\n","site":{"data":{}},"length":5421,"excerpt":"<p>Ceph是一个统一的分布式存储系统，设计初衷是提供较好的性能、可靠性和可扩展性。</p>","more":"<h3 id=\"简单了解什么是块存储-对象存储-文件系统存储？\"><a href=\"#简单了解什么是块存储-对象存储-文件系统存储？\" class=\"headerlink\" title=\"简单了解什么是块存储/对象存储/文件系统存储？\"></a>简单了解什么是块存储/对象存储/文件系统存储？</h3><p>ceph 目前提供对象存储（RADOSGW）、块存储RDB以及 CephFS 文件系统这 3 种功能。对于这3种功能介绍，分别如下：</p>\n<ol>\n<li><p>对象存储，也就是通常意义的键值存储，其接口就是简单的GET、PUT、DEL 和其他扩展，代表主要有 Swift 、S3 以及 Gluster 等；</p>\n</li>\n<li><p>块存储，这种接口通常以 QEMU Driver 或者 Kernel Module 的方式存在，这种接口需要实现 Linux 的 Block Device 的接口或者 QEMU 提供的 Block Driver 接口，如 Sheepdog，AWS 的 EBS，青云的云硬盘和阿里云的盘古系统，还有 Ceph 的 RBD（RBD是Ceph面向块存储的接口）。在常见的存储中 DAS、SAN 提供的也是块存储；</p>\n</li>\n<li><p>文件存储，通常意义是支持 POSIX 接口，它跟传统的文件系统如 Ext4 是一个类型的，但区别在于分布式存储提供了并行化的能力，如 Ceph 的 CephFS (CephFS是Ceph面向文件存储的接口)，但是有时候又会把 GlusterFS ，HDFS 这种非POSIX接口的类文件存储接口归入此类。当然 NFS、NAS也是属于文件系统存储；</p>\n</li>\n</ol>\n<h3 id=\"参考教程\"><a href=\"#参考教程\" class=\"headerlink\" title=\"参考教程\"></a>参考教程</h3><p><a href=\"https://blog.csdn.net/shida_csdn/article/details/78579043\" target=\"_blank\" rel=\"noopener\">Kubernetes 集成 Ceph 后端存储教程</a><br><a href=\"https://blog.csdn.net/zcc_heu/article/details/79017624\" target=\"_blank\" rel=\"noopener\">centos7安装ceph集群</a></p>\n<h3 id=\"准备\"><a href=\"#准备\" class=\"headerlink\" title=\"准备\"></a>准备</h3><h4 id=\"配置源\"><a href=\"#配置源\" class=\"headerlink\" title=\"配置源\"></a>配置源</h4><figure class=\"highlight makefile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat &gt;/etc/yum.repos.d/ceph.repo&lt;&lt;EOF</span><br><span class=\"line\">[ceph]</span><br><span class=\"line\">name=ceph</span><br><span class=\"line\">baseurl=http://mirrors.aliyun.com/ceph/rpm-jewel/el7/x86_64/</span><br><span class=\"line\">gpgcheck=0</span><br><span class=\"line\">priority=1</span><br><span class=\"line\"></span><br><span class=\"line\">[ceph-noarch]</span><br><span class=\"line\">name=cephnoarch</span><br><span class=\"line\">baseurl=http://mirrors.aliyun.com/ceph/rpm-jewel/el7/noarch/</span><br><span class=\"line\">gpgcheck=0</span><br><span class=\"line\">priority=1</span><br><span class=\"line\"></span><br><span class=\"line\">[ceph-source]</span><br><span class=\"line\">name=Ceph source packages</span><br><span class=\"line\">baseurl=http://mirrors.163.com/ceph/rpm-jewel/el7/SRPMS</span><br><span class=\"line\">enabled=0</span><br><span class=\"line\">gpgcheck=1</span><br><span class=\"line\">type=rpm-md</span><br><span class=\"line\">gpgkey=http://mirrors.163.com/ceph/keys/release.asc</span><br><span class=\"line\">priority=1</span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"安装过卸载\"><a href=\"#安装过卸载\" class=\"headerlink\" title=\"安装过卸载\"></a>安装过卸载</h4><figure class=\"highlight excel\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ceph-deploy purge <span class=\"symbol\">dk1</span>-<span class=\"built_in\">t</span> <span class=\"symbol\">dk2</span>-<span class=\"built_in\">t</span></span><br><span class=\"line\">ceph-deploy purgedata <span class=\"symbol\">dk1</span>-<span class=\"built_in\">t</span> <span class=\"symbol\">dk2</span>-<span class=\"built_in\">t</span></span><br><span class=\"line\">ceph-deploy forgetkeys</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"在dk2-t节点创建集群-mon模块\"><a href=\"#在dk2-t节点创建集群-mon模块\" class=\"headerlink\" title=\"在dk2-t节点创建集群 mon模块\"></a>在dk2-t节点创建集群 mon模块</h3><figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install ceph-deploy -y</span><br><span class=\"line\">ceph-deploy --version</span><br><span class=\"line\"></span><br><span class=\"line\">mkdir /data/ceph</span><br><span class=\"line\">cd /data/ceph</span><br><span class=\"line\">ceph-deploy new dk2-t</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 查看配置文件</span></span><br><span class=\"line\">ls -l</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 配置ceph.conf</span></span><br><span class=\"line\">[global]</span><br><span class=\"line\"><span class=\"built_in\">..</span>.</span><br><span class=\"line\"><span class=\"comment\"># 如果有多个网卡，应该配置如下选项，</span></span><br><span class=\"line\"><span class=\"comment\"># public network是公共网络，负责集群对外提供服务的流量</span></span><br><span class=\"line\"><span class=\"comment\"># cluster network是集群网络，负载集群中数据复制传输通信等</span></span><br><span class=\"line\"><span class=\"comment\"># 本次实验使用同一块网卡，生境环境建议分别使用一块网卡</span></span><br><span class=\"line\">public<span class=\"built_in\"> network </span>= 172.16.76.0/22</span><br><span class=\"line\">cluster<span class=\"built_in\"> network </span>= 172.16.76.0/22</span><br><span class=\"line\">osd<span class=\"built_in\"> pool default </span>size = 2</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 安装 ceph 包</span></span><br><span class=\"line\"><span class=\"comment\"># 如果按照官方文档安装方法 会重新配置安装官方ceph源</span></span><br><span class=\"line\"><span class=\"comment\"># 由于网络问题，安装可能会出错，需要多次执行</span></span><br><span class=\"line\"><span class=\"comment\"># ceph-deploy install 其实只是会安装 ceph ceph-radosgw 两个包</span></span><br><span class=\"line\"><span class=\"comment\"># ceph-deploy install lab1 lab2 lab3</span></span><br><span class=\"line\"><span class=\"comment\"># 推荐使用阿里源安装，因为使用ceph-deploy安装会很慢</span></span><br><span class=\"line\"><span class=\"comment\"># 使用如下命令手动安装包，替代官方的 ceph-deploy install 命令</span></span><br><span class=\"line\"><span class=\"comment\"># 如下操作在所有node节点上执行</span></span><br><span class=\"line\"><span class=\"builtin-name\">export</span> <span class=\"attribute\">CEPH_DEPLOY_REPO_URL</span>=http://mirrors.163.com/ceph/rpm-luminous/el7</span><br><span class=\"line\"><span class=\"builtin-name\">export</span> <span class=\"attribute\">CEPH_DEPLOY_GPG_URL</span>=http://mirrors.163.com/ceph/keys/release.asc</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 先执行是因为 ceph-deploy install太慢</span></span><br><span class=\"line\">yum install -y ceph ceph-radosgw</span><br><span class=\"line\">ceph-deploy install dk2-t</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 部署monitor和生成keys</span></span><br><span class=\"line\">ceph-deploy mon create-initial</span><br><span class=\"line\">ls -l *.keyring</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 复制文件到node节点</span></span><br><span class=\"line\">ceph-deploy dk1-t dk2-t</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 额外mon节点，mon节点也需要高可用</span></span><br><span class=\"line\">ceph-deploy mon <span class=\"builtin-name\">add</span> dk1-t</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"在dk2-t节点创建集群-mgr模块\"><a href=\"#在dk2-t节点创建集群-mgr模块\" class=\"headerlink\" title=\"在dk2-t节点创建集群 mgr模块\"></a>在dk2-t节点创建集群 mgr模块</h3><figure class=\"highlight vala\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\"># 部署manager （luminous+）12及以后的版本需要部署</span></span><br><span class=\"line\"><span class=\"meta\"># 本次部署 jewel 版本 ，不需要执行如下命令</span></span><br><span class=\"line\"> ceph-deploy mgr create dk2-t</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"在dk2-t节点创建集群-osd模块\"><a href=\"#在dk2-t节点创建集群-osd模块\" class=\"headerlink\" title=\"在dk2-t节点创建集群 osd模块\"></a>在dk2-t节点创建集群 osd模块</h3><figure class=\"highlight jboss-cli\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 12的版本(这里挂载一个 10G的磁盘 /dev/sdb)</span></span><br><span class=\"line\"><span class=\"comment\"># create 命令一次完成准备 OSD 、部署到 OSD 节点、并激活它。 create 命令是依次执行 prepare 和 activate 命令的捷径。</span></span><br><span class=\"line\">ceph-deploy osd create <span class=\"params\">--data</span> <span class=\"string\">/dev/sdb</span> dk2-t</span><br><span class=\"line\">ceph-deploy osd create <span class=\"params\">--data</span> <span class=\"string\">/dev/sdc</span> dk1-t</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"如何卸载osd\"><a href=\"#如何卸载osd\" class=\"headerlink\" title=\"如何卸载osd\"></a>如何卸载osd</h3><figure class=\"highlight vala\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\"># 查看</span></span><br><span class=\"line\">ceph osd tree</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\"># 节点状态标记为out</span></span><br><span class=\"line\">ceph osd out osd<span class=\"number\">.0</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\"># 从crush中移除节点</span></span><br><span class=\"line\">ceph osd crush remove osd<span class=\"number\">.0</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\"># 删除节点</span></span><br><span class=\"line\">ceph osd rm osd<span class=\"number\">.0</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\"># 删除节点认证（不删除编号会占住）</span></span><br><span class=\"line\">ceph auth del osd<span class=\"number\">.0</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"查看-mon-信息\"><a href=\"#查看-mon-信息\" class=\"headerlink\" title=\"查看 mon 信息\"></a>查看 mon 信息</h4><figure class=\"highlight subunit\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ceph mon dump</span><br><span class=\"line\"></span><br><span class=\"line\">dumped monmap epoch 1</span><br><span class=\"line\">epoch 1</span><br><span class=\"line\">fsid 4620d0c7<span class=\"string\">-4458</span><span class=\"string\">-4</span>ff9<span class=\"string\">-9296</span>-d1318058bafc</span><br><span class=\"line\">last_changed 2019<span class=\"string\">-06</span><span class=\"string\">-19</span> 14:44:41.361005</span><br><span class=\"line\">created 2019<span class=\"string\">-06</span><span class=\"string\">-19</span> 14:44:41.361005</span><br><span class=\"line\">0: 172.16.76.134:6789/0 mon.dk2-t</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"配置文件内容-etc-ceph-ceph-conf\"><a href=\"#配置文件内容-etc-ceph-ceph-conf\" class=\"headerlink\" title=\"配置文件内容 /etc/ceph/ceph.conf\"></a>配置文件内容 /etc/ceph/ceph.conf</h4><figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[global]</span><br><span class=\"line\">public<span class=\"built_in\"> network </span>= 172.16.76.0/22</span><br><span class=\"line\">cluster<span class=\"built_in\"> network </span>= 172.16.76.0/22</span><br><span class=\"line\">osd<span class=\"built_in\"> pool default </span>size = 2</span><br><span class=\"line\">fsid = 4620d0c7-4458-4ff9-9296-d1318058bafc</span><br><span class=\"line\">mon_initial_members = dk2-t</span><br><span class=\"line\">mon_host = 172.16.76.134</span><br><span class=\"line\">auth_cluster_required = cephx</span><br><span class=\"line\">auth_service_required = cephx</span><br><span class=\"line\">auth_client_required = cephx</span><br><span class=\"line\">mon_max_pg_per_osd = 1000</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"ceph-一些测试命令\"><a href=\"#ceph-一些测试命令\" class=\"headerlink\" title=\"ceph 一些测试命令\"></a>ceph 一些测试命令</h3><h4 id=\"创建-rbd-pool，名字叫做-kube\"><a href=\"#创建-rbd-pool，名字叫做-kube\" class=\"headerlink\" title=\"创建 rbd pool，名字叫做 kube\"></a>创建 rbd pool，名字叫做 kube</h4><figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ceph osd<span class=\"built_in\"> pool </span>create kube 256 256</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"如何取得admin的密钥\"><a href=\"#如何取得admin的密钥\" class=\"headerlink\" title=\"如何取得admin的密钥\"></a>如何取得admin的密钥</h4><figure class=\"highlight lsl\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ceph auth get client.admin <span class=\"number\">2</span>&gt;&amp;<span class=\"number\">1</span> |grep <span class=\"string\">\"key = \"</span> |awk '&#123;print  $<span class=\"number\">3</span>&#125;'</span><br><span class=\"line\">AQAn/<span class=\"number\">19</span>bbb21GBAA1kc0HRWoGjeoPTRQziA03A==</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"测试ceph是否正常\"><a href=\"#测试ceph是否正常\" class=\"headerlink\" title=\"测试ceph是否正常\"></a>测试ceph是否正常</h4><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rbd <span class=\"keyword\">create</span> kube/<span class=\"keyword\">test</span> <span class=\"comment\">--size 1024 --image-format 2</span></span><br><span class=\"line\">rbd ls kube</span><br><span class=\"line\">rbd <span class=\"keyword\">map</span> kube/<span class=\"keyword\">test</span></span><br><span class=\"line\">    <span class=\"comment\"># 如果报错, 警用</span></span><br><span class=\"line\">    rbd info kube/<span class=\"keyword\">test</span></span><br><span class=\"line\">    rbd feature <span class=\"keyword\">disable</span> kube/<span class=\"keyword\">test</span> exclusive-<span class=\"keyword\">lock</span> <span class=\"keyword\">object</span>-<span class=\"keyword\">map</span> <span class=\"keyword\">fast</span>-diff deep-flatten</span><br><span class=\"line\"></span><br><span class=\"line\">rbd <span class=\"keyword\">map</span> kube/<span class=\"keyword\">test</span></span><br><span class=\"line\">rbd showmapped</span><br><span class=\"line\">mkfs.ext4 /dev/rbd0</span><br><span class=\"line\">mkdir /<span class=\"keyword\">data</span>/rbd0</span><br><span class=\"line\"><span class=\"keyword\">mount</span> /dev/rbd0 /<span class=\"keyword\">data</span>/rbd0</span><br><span class=\"line\">cd /<span class=\"keyword\">data</span>/rbd0 &amp;&amp; echo <span class=\"keyword\">test</span> &gt; test.txt</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"在k8s-手动创建存储类\"><a href=\"#在k8s-手动创建存储类\" class=\"headerlink\" title=\"在k8s 手动创建存储类\"></a>在k8s 手动创建存储类</h3><h4 id=\"创建ceph-pg\"><a href=\"#创建ceph-pg\" class=\"headerlink\" title=\"创建ceph pg\"></a>创建ceph pg</h4><figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Total PGs = (Total_number_of_OSD * 100) / max_replication_count</span></span><br><span class=\"line\"><span class=\"comment\"># pg = 1 * 100 /2 ~ 64(取2的次方数)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 这里准备创建2个pool, 每个pool</span></span><br><span class=\"line\">ceph osd<span class=\"built_in\"> pool </span>create rbd-k8s 16</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 查看</span></span><br><span class=\"line\">ceph osd lspools</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 创建image</span></span><br><span class=\"line\">rbd create rbd-k8s/cephimageredis --size 500M</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 查看list</span></span><br><span class=\"line\">rbd list rbd-k8s</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 处理新特性</span></span><br><span class=\"line\"><span class=\"comment\"># 查看info</span></span><br><span class=\"line\">rbd <span class=\"builtin-name\">info</span> rbd-k8s/cephimageredis</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 关闭exclusive-lock object-map fast-diff deep-flatten 这些特性</span></span><br><span class=\"line\">rbd feature <span class=\"builtin-name\">disable</span>  rbd-k8s/cephimageredis exclusive-lock object-map fast-diff deep-flatten</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"首先创建secret\"><a href=\"#首先创建secret\" class=\"headerlink\" title=\"首先创建secret\"></a>首先创建secret</h4><figure class=\"highlight maxima\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#获取<span class=\"built_in\">key</span></span><br><span class=\"line\">grep <span class=\"built_in\">key</span> /etc/ceph/ceph.client.admin.keyring |awk '&#123;<span class=\"built_in\">printf</span> <span class=\"string\">\"%s\"</span>, $NF&#125;'|<span class=\"built_in\">base64</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><strong>ceph-secret.yaml</strong><figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apiVersion: v1</span><br><span class=\"line\">kind: Secret</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  name: ceph-secret</span><br><span class=\"line\">type: <span class=\"string\">\"kubernetes.io/rbd\"</span></span><br><span class=\"line\">data:</span><br><span class=\"line\">  key: <span class=\"attribute\">QVFCTFo2dGNGNXFLRnhBQXBGTXJEdm5CY2k2UGtwZmZrN0JSVEE9PQ</span>==</span><br></pre></td></tr></table></figure>\n\n</li>\n</ul>\n<h4 id=\"其次创建pv-pv是没有namespace概念的\"><a href=\"#其次创建pv-pv是没有namespace概念的\" class=\"headerlink\" title=\"其次创建pv, pv是没有namespace概念的\"></a>其次创建pv, pv是没有namespace概念的</h4><blockquote>\n<p>persistentVolumeReclaimPolicy是清理规则 (retain: 不清理, Recycle: 回收)</p>\n<ul>\n<li><strong>redis-ceph-pv.yml</strong></li>\n</ul>\n</blockquote>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">PersistentVolume</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">redis2-ceph-rbd-pv</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\">  capacity:</span></span><br><span class=\"line\"><span class=\"attr\">    storage:</span> <span class=\"number\">100</span><span class=\"string\">Mi</span></span><br><span class=\"line\"><span class=\"attr\">  accessModes:</span></span><br><span class=\"line\"><span class=\"bullet\">    -</span> <span class=\"string\">ReadWriteOnce</span></span><br><span class=\"line\"><span class=\"attr\">  rbd:</span></span><br><span class=\"line\"><span class=\"attr\">    monitors:</span></span><br><span class=\"line\"><span class=\"bullet\">      -</span> <span class=\"string\">'172.16.76.134:6789'</span></span><br><span class=\"line\"><span class=\"attr\">    pool:</span> <span class=\"string\">rbd-k8s</span></span><br><span class=\"line\"><span class=\"attr\">    image:</span> <span class=\"string\">cephimageredis</span></span><br><span class=\"line\"><span class=\"attr\">    user:</span> <span class=\"string\">admin</span></span><br><span class=\"line\"><span class=\"attr\">    secretRef:</span></span><br><span class=\"line\"><span class=\"attr\">      name:</span> <span class=\"string\">ceph-secret</span></span><br><span class=\"line\"><span class=\"attr\">    fsType:</span> <span class=\"string\">ext4</span></span><br><span class=\"line\"><span class=\"attr\">    readOnly:</span> <span class=\"literal\">false</span></span><br><span class=\"line\"><span class=\"attr\">  persistentVolumeReclaimPolicy:</span> <span class=\"string\">Recycle</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><strong>执行部署pv</strong><figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">kubectl</span> <span class=\"selector-tag\">create</span> <span class=\"selector-tag\">-f</span> <span class=\"selector-tag\">redis-ceph-pv</span><span class=\"selector-class\">.yml</span></span><br></pre></td></tr></table></figure>\n\n</li>\n</ul>\n<h4 id=\"然后创建pvc\"><a href=\"#然后创建pvc\" class=\"headerlink\" title=\"然后创建pvc\"></a>然后创建pvc</h4><ul>\n<li><strong>redis-ceph-pvc.yml</strong></li>\n</ul>\n<figure class=\"highlight dts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"symbol\">apiVersion:</span> v1</span><br><span class=\"line\"><span class=\"symbol\">kind:</span> PersistentVolumeClaim</span><br><span class=\"line\"><span class=\"symbol\">metadata:</span></span><br><span class=\"line\"><span class=\"symbol\">  name:</span> redis2-ceph-rbd-pvc</span><br><span class=\"line\"><span class=\"symbol\">spec:</span></span><br><span class=\"line\"><span class=\"symbol\">  accessModes:</span></span><br><span class=\"line\">    - ReadWriteOnce</span><br><span class=\"line\"><span class=\"symbol\">  resources:</span></span><br><span class=\"line\"><span class=\"symbol\">    requests:</span></span><br><span class=\"line\"><span class=\"symbol\">      storage:</span> <span class=\"number\">100</span>Mi</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><strong>执行部署pvc</strong><figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">kubectl</span> <span class=\"selector-tag\">create</span> <span class=\"selector-tag\">-f</span> <span class=\"selector-tag\">redis-ceph-pvc</span><span class=\"selector-class\">.yml</span></span><br></pre></td></tr></table></figure>\n\n</li>\n</ul>\n<h4 id=\"最后在rancher上选择挂载rbd\"><a href=\"#最后在rancher上选择挂载rbd\" class=\"headerlink\" title=\"最后在rancher上选择挂载rbd\"></a>最后在rancher上选择挂载rbd</h4><p><img src=\"https://zhangzw001.github.io/images/blog6/rancher-pv.png\" alt=\"rancher-pv\"></p>\n<hr>"},{"title":"mysql5.7二进制部署","copyright":true,"date":"2019-09-26T07:11:05.000Z","_content":"\n> 二进制方式部署mysql5.7\n\n<!-- more -->\n\n### 下载glibc二进制包\n```\n#打开下载页面, 可能会有小版本更新(注意：选择操作系统时选Linux-Generic）\nhttps://dev.mysql.com/downloads/mysql/5.7.html#downloads\n\n# 最新的可能有小版本变化\nwget https://cdn.mysql.com/Downloads/MySQL-5.7/mysql-5.7.24-linux-glibc2.12-x86_64.tar.gz\n```\n\n### 安装配置 \n```\ntar -xvf mysql-5.7.24-linux-glibc2.12-x86_64.tar.gz\nmv mysql-5.7.24-linux-glibc2.12-x86_64 /usr/local/\ncd /usr/local/\n\n# 我的镜像是安装过5.5mysql, 所以需要mv一下\nmv mysql mysql-5.5.37\n\n# 由于以前安装过php指定了该mysq目录, 这可能导致以前安装的php缺少libmysqlclient.so.18\nln -s /usr/local/mysql-5.5.37/lib/libmysqlclient.so.18 /usr/local/mysql-5.7.24-linux-glibc2.12-x86_64/lib/libmysqlclient.so.18\nln -s mysql-5.7.24-linux-glibc2.12-x86_64 mysql\n\n# 添加启动文件\n\\cp mysql/support-files/mysql.server /etc/init.d/mysqld\necho \"PATH=$PATH:/usr/local/mysql/bin/\" >>~/.bashrc\n\n# 可选\nwget http://centos.mirrors.ucloud.cn/centos/6/os/x86_64/Packages/numactl-2.0.9-2.el6.x86_64.rpm\nyum localinstall numactl-2.0.9-2.el6.x86_64.rpm\n\\rm numactl-2.0.9-2.el6.x86_64.rpm\n\nuseradd mysql\n\n# 配置下mysql的数据目录\ncd /data/\nmkdir u01\nmkdir u02\nchown -R mysql.mysql u01\nchown -R mysql.mysql u02\nchmod 750 u01\nchmod 750 u02\ncd /data/u01/\n\n# 初始化\n/usr/local/mysql/bin/mysqld --initialize-insecure --user=mysql --basedir=/usr/local/mysql --datadir=/data/u01\ncat auto.cnf\n\n# 启动服务 (在这之前准备好 /etc/my.cnf)\n/etc/init.d/mysqld start\n\n# 记录下variables\nmysql -e \"show global variables\" >mysql_option_default.log\n```\n\n\n### my.cnf\n```\n[client]\nport = 3306\nsocket = /data/u01/mysql.sock\n\n[mysql]\nprompt=\"\\u@m1-u [\\d]> \"\nno-auto-rehash\n\n[mysqld]\nuser = mysql\nport = 3306\nbasedir = /usr/local/mysql\ndatadir = /data/u01\nsocket = /data/u01/mysql.sock\npid-file = /data/u01/m1-u.pid\ntmpdir = /data/u02\nserver-id = 1001\ncharacter-set-server = utf8\nskip_name_resolve = 1\ninnodb_file_per_table = 1\nexplicit_defaults_for_timestamp = 0\n\n# buffer&cache\ntable_open_cache = 100\ntable_definition_cache = 400\ntable_open_cache_instances = 64\nsort_buffer_size = 4M\njoin_buffer_size = 4M\nread_buffer_size = 8M\nread_rnd_buffer_size = 4M\n\n# thread&connection\nthread_stack = 256K\nthread_cache_size = 768\nback_log = 1024\nmax_connections = 3000\nmax_connect_errors = 1000000\n\n# temptable\ntmp_table_size = 32M\nmax_heap_table_size = 32M\n\n# network\nmax_allowed_packet = 32M\n#lock_wait_timeout = 3600\n#interactive_timeout = 600\n#wait_timeout = 600\n\n# query cache\nquery_cache_size = 0\nquery_cache_type = 0\n\n# 设置errorlog、slowlog和generallog的时区，默认UTC\nlog_timestamps = SYSTEM\n\n# error-log\nlog_error = /data/u02/mysqld.log\n\n# slow-log\nslow_query_log = 1\nslow_query_log_file = /data/u02/slow.log\nlong_query_time = 0.1\nlog_queries_not_using_indexes =1\nlog_throttle_queries_not_using_indexes = 60\nmin_examined_row_limit = 100\nlog_slow_admin_statements = 1\nlog_slow_slave_statements = 1\n\n# general log\n#general-log = 1\ngeneral_log_file=/data/u02/query.log\n\n# binlog\nbinlog_format = row\nbinlog_checksum = 1\nlog-bin = /data/u02/bdm1-bin\nlog-bin-index = /data/u02/bdm1-bin.index\nsync_binlog = 0\nbinlog_cache_size = 4M\nmax_binlog_cache_size = 2G\nmax_binlog_size = 512M\nexpire_logs_days = 15\n\n# GTID\ngtid_mode = on\nenforce_gtid_consistency = 1\nlog_slave_updates\n\n# Replication\nmaster_info_repository = TABLE\nrelay_log_info_repository = TABLE\nslave-rows-search-algorithms = 'INDEX_SCAN,HASH_SCAN'\nrelay_log_recovery = 1\nrelay_log_purge = 1\nrelay-log=/data/u02/bdm1-relay-bin\nrelay-log-index=/data/u02/bdm1-relay-bin.index\n\n# innodb-buffer&cache\ninnodb_buffer_pool_size = 2G\ninnodb_buffer_pool_instances = 4\n#innodb_additional_mem_pool_size = 16M\ninnodb_max_dirty_pages_pct = 50\n\n# innodb log\ninnodb_data_file_path = ibdata1:1G:autoextend\ninnodb_log_file_size = 1G\ninnodb_log_files_in_group = 2\ninnodb_flush_log_at_trx_commit = 2\ninnodb_log_buffer_size = 32M\n#innodb_max_undo_log_size = 4G\n#innodb_undo_directory = undolog\ninnodb_undo_tablespaces = 4\n\n# innodb-io\ninnodb_flush_method = O_DIRECT\ninnodb_io_capacity = 600\ninnodb_io_capacity_max = 2000\ninnodb_flush_sync = 0\ninnodb_flush_neighbors = 0\n#innodb_lru_scan_depth = 4000\ninnodb_write_io_threads = 8\ninnodb_read_io_threads = 8\ninnodb_purge_threads = 4\ninnodb_page_cleaners = 4\n\n# transaction,lock\n#innodb_sync_spin_loops = 100\n#innodb_spin_wait_delay = 30\ninnodb_lock_wait_timeout = 10\ninnodb_print_all_deadlocks = 1\ninnodb_rollback_on_timeout = 1\n\ninnodb_open_files = 65535\n\ninnodb_online_alter_log_max_size = 2G\n\n# innodb status\ninnodb_status_file = 1\n# 注意: 开启 innodb_status_output & innodb_status_output_locks 后, 可能会导致log-error文件增长较快\ninnodb_status_output = 0\ninnodb_status_output_locks = 0\n\n#performance_schema\nperformance_schema = 1\nperformance_schema_instrument = '%=on'\n\n#innodb monitor\ninnodb_monitor_enable=\"module_innodb\"\ninnodb_monitor_enable=\"module_server\"\ninnodb_monitor_enable=\"module_dml\"\ninnodb_monitor_enable=\"module_ddl\"\ninnodb_monitor_enable=\"module_trx\"\ninnodb_monitor_enable=\"module_os\"\ninnodb_monitor_enable=\"module_purge\"\ninnodb_monitor_enable=\"module_log\"\ninnodb_monitor_enable=\"module_lock\"\ninnodb_monitor_enable=\"module_buffer\"\ninnodb_monitor_enable=\"module_index\"\ninnodb_monitor_enable=\"module_ibuf_system\"\ninnodb_monitor_enable=\"module_buffer_page\"\ninnodb_monitor_enable=\"module_adaptive_hash\"\n\n# MyISAM\nkey_buffer_size = 1024M\nbulk_insert_buffer_size = 64M\nmyisam_sort_buffer_size = 128M\nmyisam_repair_threads = 1\n\n\n[mysqldump]\nquick\nmax_allowed_packet = 32M\n```\n","source":"_posts/8-mysql5-7二进制部署.md","raw":"---\ntitle: mysql5.7二进制部署\ncopyright: true\ndate: 2019-09-26 15:11:05\ntags:\n  - mysql\n  - mysql5.7\ncategories:\n  - [技术文档]\n  - [mysql]\n---\n\n> 二进制方式部署mysql5.7\n\n<!-- more -->\n\n### 下载glibc二进制包\n```\n#打开下载页面, 可能会有小版本更新(注意：选择操作系统时选Linux-Generic）\nhttps://dev.mysql.com/downloads/mysql/5.7.html#downloads\n\n# 最新的可能有小版本变化\nwget https://cdn.mysql.com/Downloads/MySQL-5.7/mysql-5.7.24-linux-glibc2.12-x86_64.tar.gz\n```\n\n### 安装配置 \n```\ntar -xvf mysql-5.7.24-linux-glibc2.12-x86_64.tar.gz\nmv mysql-5.7.24-linux-glibc2.12-x86_64 /usr/local/\ncd /usr/local/\n\n# 我的镜像是安装过5.5mysql, 所以需要mv一下\nmv mysql mysql-5.5.37\n\n# 由于以前安装过php指定了该mysq目录, 这可能导致以前安装的php缺少libmysqlclient.so.18\nln -s /usr/local/mysql-5.5.37/lib/libmysqlclient.so.18 /usr/local/mysql-5.7.24-linux-glibc2.12-x86_64/lib/libmysqlclient.so.18\nln -s mysql-5.7.24-linux-glibc2.12-x86_64 mysql\n\n# 添加启动文件\n\\cp mysql/support-files/mysql.server /etc/init.d/mysqld\necho \"PATH=$PATH:/usr/local/mysql/bin/\" >>~/.bashrc\n\n# 可选\nwget http://centos.mirrors.ucloud.cn/centos/6/os/x86_64/Packages/numactl-2.0.9-2.el6.x86_64.rpm\nyum localinstall numactl-2.0.9-2.el6.x86_64.rpm\n\\rm numactl-2.0.9-2.el6.x86_64.rpm\n\nuseradd mysql\n\n# 配置下mysql的数据目录\ncd /data/\nmkdir u01\nmkdir u02\nchown -R mysql.mysql u01\nchown -R mysql.mysql u02\nchmod 750 u01\nchmod 750 u02\ncd /data/u01/\n\n# 初始化\n/usr/local/mysql/bin/mysqld --initialize-insecure --user=mysql --basedir=/usr/local/mysql --datadir=/data/u01\ncat auto.cnf\n\n# 启动服务 (在这之前准备好 /etc/my.cnf)\n/etc/init.d/mysqld start\n\n# 记录下variables\nmysql -e \"show global variables\" >mysql_option_default.log\n```\n\n\n### my.cnf\n```\n[client]\nport = 3306\nsocket = /data/u01/mysql.sock\n\n[mysql]\nprompt=\"\\u@m1-u [\\d]> \"\nno-auto-rehash\n\n[mysqld]\nuser = mysql\nport = 3306\nbasedir = /usr/local/mysql\ndatadir = /data/u01\nsocket = /data/u01/mysql.sock\npid-file = /data/u01/m1-u.pid\ntmpdir = /data/u02\nserver-id = 1001\ncharacter-set-server = utf8\nskip_name_resolve = 1\ninnodb_file_per_table = 1\nexplicit_defaults_for_timestamp = 0\n\n# buffer&cache\ntable_open_cache = 100\ntable_definition_cache = 400\ntable_open_cache_instances = 64\nsort_buffer_size = 4M\njoin_buffer_size = 4M\nread_buffer_size = 8M\nread_rnd_buffer_size = 4M\n\n# thread&connection\nthread_stack = 256K\nthread_cache_size = 768\nback_log = 1024\nmax_connections = 3000\nmax_connect_errors = 1000000\n\n# temptable\ntmp_table_size = 32M\nmax_heap_table_size = 32M\n\n# network\nmax_allowed_packet = 32M\n#lock_wait_timeout = 3600\n#interactive_timeout = 600\n#wait_timeout = 600\n\n# query cache\nquery_cache_size = 0\nquery_cache_type = 0\n\n# 设置errorlog、slowlog和generallog的时区，默认UTC\nlog_timestamps = SYSTEM\n\n# error-log\nlog_error = /data/u02/mysqld.log\n\n# slow-log\nslow_query_log = 1\nslow_query_log_file = /data/u02/slow.log\nlong_query_time = 0.1\nlog_queries_not_using_indexes =1\nlog_throttle_queries_not_using_indexes = 60\nmin_examined_row_limit = 100\nlog_slow_admin_statements = 1\nlog_slow_slave_statements = 1\n\n# general log\n#general-log = 1\ngeneral_log_file=/data/u02/query.log\n\n# binlog\nbinlog_format = row\nbinlog_checksum = 1\nlog-bin = /data/u02/bdm1-bin\nlog-bin-index = /data/u02/bdm1-bin.index\nsync_binlog = 0\nbinlog_cache_size = 4M\nmax_binlog_cache_size = 2G\nmax_binlog_size = 512M\nexpire_logs_days = 15\n\n# GTID\ngtid_mode = on\nenforce_gtid_consistency = 1\nlog_slave_updates\n\n# Replication\nmaster_info_repository = TABLE\nrelay_log_info_repository = TABLE\nslave-rows-search-algorithms = 'INDEX_SCAN,HASH_SCAN'\nrelay_log_recovery = 1\nrelay_log_purge = 1\nrelay-log=/data/u02/bdm1-relay-bin\nrelay-log-index=/data/u02/bdm1-relay-bin.index\n\n# innodb-buffer&cache\ninnodb_buffer_pool_size = 2G\ninnodb_buffer_pool_instances = 4\n#innodb_additional_mem_pool_size = 16M\ninnodb_max_dirty_pages_pct = 50\n\n# innodb log\ninnodb_data_file_path = ibdata1:1G:autoextend\ninnodb_log_file_size = 1G\ninnodb_log_files_in_group = 2\ninnodb_flush_log_at_trx_commit = 2\ninnodb_log_buffer_size = 32M\n#innodb_max_undo_log_size = 4G\n#innodb_undo_directory = undolog\ninnodb_undo_tablespaces = 4\n\n# innodb-io\ninnodb_flush_method = O_DIRECT\ninnodb_io_capacity = 600\ninnodb_io_capacity_max = 2000\ninnodb_flush_sync = 0\ninnodb_flush_neighbors = 0\n#innodb_lru_scan_depth = 4000\ninnodb_write_io_threads = 8\ninnodb_read_io_threads = 8\ninnodb_purge_threads = 4\ninnodb_page_cleaners = 4\n\n# transaction,lock\n#innodb_sync_spin_loops = 100\n#innodb_spin_wait_delay = 30\ninnodb_lock_wait_timeout = 10\ninnodb_print_all_deadlocks = 1\ninnodb_rollback_on_timeout = 1\n\ninnodb_open_files = 65535\n\ninnodb_online_alter_log_max_size = 2G\n\n# innodb status\ninnodb_status_file = 1\n# 注意: 开启 innodb_status_output & innodb_status_output_locks 后, 可能会导致log-error文件增长较快\ninnodb_status_output = 0\ninnodb_status_output_locks = 0\n\n#performance_schema\nperformance_schema = 1\nperformance_schema_instrument = '%=on'\n\n#innodb monitor\ninnodb_monitor_enable=\"module_innodb\"\ninnodb_monitor_enable=\"module_server\"\ninnodb_monitor_enable=\"module_dml\"\ninnodb_monitor_enable=\"module_ddl\"\ninnodb_monitor_enable=\"module_trx\"\ninnodb_monitor_enable=\"module_os\"\ninnodb_monitor_enable=\"module_purge\"\ninnodb_monitor_enable=\"module_log\"\ninnodb_monitor_enable=\"module_lock\"\ninnodb_monitor_enable=\"module_buffer\"\ninnodb_monitor_enable=\"module_index\"\ninnodb_monitor_enable=\"module_ibuf_system\"\ninnodb_monitor_enable=\"module_buffer_page\"\ninnodb_monitor_enable=\"module_adaptive_hash\"\n\n# MyISAM\nkey_buffer_size = 1024M\nbulk_insert_buffer_size = 64M\nmyisam_sort_buffer_size = 128M\nmyisam_repair_threads = 1\n\n\n[mysqldump]\nquick\nmax_allowed_packet = 32M\n```\n","slug":"8-mysql5-7二进制部署","published":1,"updated":"2019-10-16T09:15:27.840Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck28uwzn9000zkerwn91ilx0n","content":"<blockquote>\n<p>二进制方式部署mysql5.7</p>\n</blockquote>\n<a id=\"more\"></a>\n\n<h3 id=\"下载glibc二进制包\"><a href=\"#下载glibc二进制包\" class=\"headerlink\" title=\"下载glibc二进制包\"></a>下载glibc二进制包</h3><figure class=\"highlight crystal\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#打开下载页面, 可能会有小版本更新(注意：选择操作系统时选Linux-Generic）</span></span><br><span class=\"line\"><span class=\"symbol\">https:</span>/<span class=\"regexp\">/dev.mysql.com/downloads</span><span class=\"regexp\">/mysql/</span><span class=\"number\">5.7</span>.html<span class=\"comment\">#downloads</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 最新的可能有小版本变化</span></span><br><span class=\"line\">wget <span class=\"symbol\">https:</span>/<span class=\"regexp\">/cdn.mysql.com/</span>Downloads/MySQL-<span class=\"number\">5.7</span>/mysql-<span class=\"number\">5.7</span>.<span class=\"number\">24</span>-linux-glibc2.<span class=\"number\">12</span>-x86_64.tar.gz</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"安装配置\"><a href=\"#安装配置\" class=\"headerlink\" title=\"安装配置\"></a>安装配置</h3><figure class=\"highlight jboss-cli\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar -xvf mysql-5.7.24-linux-glibc2.12-x86_64.tar.gz</span><br><span class=\"line\">mv mysql-5.7.24-linux-glibc2.12-x86_64 <span class=\"string\">/usr/local/</span></span><br><span class=\"line\"><span class=\"keyword\">cd</span> <span class=\"string\">/usr/local/</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 我的镜像是安装过5.5mysql, 所以需要mv一下</span></span><br><span class=\"line\">mv mysql mysql-5.5.37</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 由于以前安装过php指定了该mysq目录, 这可能导致以前安装的php缺少libmysqlclient.so.18</span></span><br><span class=\"line\">ln -s <span class=\"string\">/usr/local/mysql-5.5.37/lib/libmysqlclient.so.18</span> <span class=\"string\">/usr/local/mysql-5.7.24-linux-glibc2.12-x86_64/lib/libmysqlclient.so.18</span></span><br><span class=\"line\">ln -s mysql-5.7.24-linux-glibc2.12-x86_64 mysql</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 添加启动文件</span></span><br><span class=\"line\">\\cp mysql/support-files/mysql.server <span class=\"string\">/etc/init.d/mysqld</span></span><br><span class=\"line\"><span class=\"keyword\">echo</span> <span class=\"string\">\"PATH=$PATH:/usr/local/mysql/bin/\"</span> &gt;&gt;~<span class=\"string\">/.bashrc</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 可选</span></span><br><span class=\"line\">wget http:<span class=\"string\">//centos.mirrors.ucloud.cn/centos/6/os/x86_64/Packages/numactl-2.0.9-2.el6.x86_64.rpm</span></span><br><span class=\"line\">yum localinstall numactl-2.0.9-2.el6.x86_64.rpm</span><br><span class=\"line\">\\rm numactl-2.0.9-2.el6.x86_64.rpm</span><br><span class=\"line\"></span><br><span class=\"line\">useradd mysql</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 配置下mysql的数据目录</span></span><br><span class=\"line\"><span class=\"keyword\">cd</span> <span class=\"string\">/data/</span></span><br><span class=\"line\">mkdir u01</span><br><span class=\"line\">mkdir u02</span><br><span class=\"line\">chown -R mysql.mysql u01</span><br><span class=\"line\">chown -R mysql.mysql u02</span><br><span class=\"line\">chmod 750 u01</span><br><span class=\"line\">chmod 750 u02</span><br><span class=\"line\"><span class=\"keyword\">cd</span> <span class=\"string\">/data/u01/</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 初始化</span></span><br><span class=\"line\"><span class=\"string\">/usr/local/mysql/bin/mysqld</span> <span class=\"params\">--initialize-insecure</span> <span class=\"params\">--user=mysql</span> <span class=\"params\">--basedir=/usr/local/mysql</span> <span class=\"params\">--datadir=/data/u01</span></span><br><span class=\"line\">cat auto.cnf</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 启动服务 (在这之前准备好 /etc/my.cnf)</span></span><br><span class=\"line\"><span class=\"string\">/etc/init.d/mysqld</span> start</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 记录下variables</span></span><br><span class=\"line\">mysql -e <span class=\"string\">\"show global variables\"</span> &gt;mysql_option_default.log</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"my-cnf\"><a href=\"#my-cnf\" class=\"headerlink\" title=\"my.cnf\"></a>my.cnf</h3><figure class=\"highlight makefile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[client]</span><br><span class=\"line\">port = 3306</span><br><span class=\"line\">socket = /data/u01/mysql.sock</span><br><span class=\"line\"></span><br><span class=\"line\">[mysql]</span><br><span class=\"line\">prompt=<span class=\"string\">\"\\u@m1-u [\\d]&gt; \"</span></span><br><span class=\"line\">no-auto-rehash</span><br><span class=\"line\"></span><br><span class=\"line\">[mysqld]</span><br><span class=\"line\">user = mysql</span><br><span class=\"line\">port = 3306</span><br><span class=\"line\">basedir = /usr/local/mysql</span><br><span class=\"line\">datadir = /data/u01</span><br><span class=\"line\">socket = /data/u01/mysql.sock</span><br><span class=\"line\">pid-file = /data/u01/m1-u.pid</span><br><span class=\"line\">tmpdir = /data/u02</span><br><span class=\"line\">server-id = 1001</span><br><span class=\"line\">character-set-server = utf8</span><br><span class=\"line\">skip_name_resolve = 1</span><br><span class=\"line\">innodb_file_per_table = 1</span><br><span class=\"line\">explicit_defaults_for_timestamp = 0</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># buffer&amp;cache</span></span><br><span class=\"line\">table_open_cache = 100</span><br><span class=\"line\">table_definition_cache = 400</span><br><span class=\"line\">table_open_cache_instances = 64</span><br><span class=\"line\">sort_buffer_size = 4M</span><br><span class=\"line\">join_buffer_size = 4M</span><br><span class=\"line\">read_buffer_size = 8M</span><br><span class=\"line\">read_rnd_buffer_size = 4M</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># thread&amp;connection</span></span><br><span class=\"line\">thread_stack = 256K</span><br><span class=\"line\">thread_cache_size = 768</span><br><span class=\"line\">back_log = 1024</span><br><span class=\"line\">max_connections = 3000</span><br><span class=\"line\">max_connect_errors = 1000000</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># temptable</span></span><br><span class=\"line\">tmp_table_size = 32M</span><br><span class=\"line\">max_heap_table_size = 32M</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># network</span></span><br><span class=\"line\">max_allowed_packet = 32M</span><br><span class=\"line\"><span class=\"comment\">#lock_wait_timeout = 3600</span></span><br><span class=\"line\"><span class=\"comment\">#interactive_timeout = 600</span></span><br><span class=\"line\"><span class=\"comment\">#wait_timeout = 600</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># query cache</span></span><br><span class=\"line\">query_cache_size = 0</span><br><span class=\"line\">query_cache_type = 0</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 设置errorlog、slowlog和generallog的时区，默认UTC</span></span><br><span class=\"line\">log_timestamps = SYSTEM</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># error-log</span></span><br><span class=\"line\">log_error = /data/u02/mysqld.log</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># slow-log</span></span><br><span class=\"line\">slow_query_log = 1</span><br><span class=\"line\">slow_query_log_file = /data/u02/slow.log</span><br><span class=\"line\">long_query_time = 0.1</span><br><span class=\"line\">log_queries_not_using_indexes =1</span><br><span class=\"line\">log_throttle_queries_not_using_indexes = 60</span><br><span class=\"line\">min_examined_row_limit = 100</span><br><span class=\"line\">log_slow_admin_statements = 1</span><br><span class=\"line\">log_slow_slave_statements = 1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># general log</span></span><br><span class=\"line\"><span class=\"comment\">#general-log = 1</span></span><br><span class=\"line\">general_log_file=/data/u02/query.log</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># binlog</span></span><br><span class=\"line\">binlog_format = row</span><br><span class=\"line\">binlog_checksum = 1</span><br><span class=\"line\">log-bin = /data/u02/bdm1-bin</span><br><span class=\"line\">log-bin-index = /data/u02/bdm1-bin.index</span><br><span class=\"line\">sync_binlog = 0</span><br><span class=\"line\">binlog_cache_size = 4M</span><br><span class=\"line\">max_binlog_cache_size = 2G</span><br><span class=\"line\">max_binlog_size = 512M</span><br><span class=\"line\">expire_logs_days = 15</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># GTID</span></span><br><span class=\"line\">gtid_mode = on</span><br><span class=\"line\">enforce_gtid_consistency = 1</span><br><span class=\"line\">log_slave_updates</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Replication</span></span><br><span class=\"line\">master_info_repository = TABLE</span><br><span class=\"line\">relay_log_info_repository = TABLE</span><br><span class=\"line\">slave-rows-search-algorithms = 'INDEX_SCAN,HASH_SCAN'</span><br><span class=\"line\">relay_log_recovery = 1</span><br><span class=\"line\">relay_log_purge = 1</span><br><span class=\"line\">relay-log=/data/u02/bdm1-relay-bin</span><br><span class=\"line\">relay-log-index=/data/u02/bdm1-relay-bin.index</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># innodb-buffer&amp;cache</span></span><br><span class=\"line\">innodb_buffer_pool_size = 2G</span><br><span class=\"line\">innodb_buffer_pool_instances = 4</span><br><span class=\"line\"><span class=\"comment\">#innodb_additional_mem_pool_size = 16M</span></span><br><span class=\"line\">innodb_max_dirty_pages_pct = 50</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># innodb log</span></span><br><span class=\"line\">innodb_data_file_path = ibdata1:1G:autoextend</span><br><span class=\"line\">innodb_log_file_size = 1G</span><br><span class=\"line\">innodb_log_files_in_group = 2</span><br><span class=\"line\">innodb_flush_log_at_trx_commit = 2</span><br><span class=\"line\">innodb_log_buffer_size = 32M</span><br><span class=\"line\"><span class=\"comment\">#innodb_max_undo_log_size = 4G</span></span><br><span class=\"line\"><span class=\"comment\">#innodb_undo_directory = undolog</span></span><br><span class=\"line\">innodb_undo_tablespaces = 4</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># innodb-io</span></span><br><span class=\"line\">innodb_flush_method = O_DIRECT</span><br><span class=\"line\">innodb_io_capacity = 600</span><br><span class=\"line\">innodb_io_capacity_max = 2000</span><br><span class=\"line\">innodb_flush_sync = 0</span><br><span class=\"line\">innodb_flush_neighbors = 0</span><br><span class=\"line\"><span class=\"comment\">#innodb_lru_scan_depth = 4000</span></span><br><span class=\"line\">innodb_write_io_threads = 8</span><br><span class=\"line\">innodb_read_io_threads = 8</span><br><span class=\"line\">innodb_purge_threads = 4</span><br><span class=\"line\">innodb_page_cleaners = 4</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># transaction,lock</span></span><br><span class=\"line\"><span class=\"comment\">#innodb_sync_spin_loops = 100</span></span><br><span class=\"line\"><span class=\"comment\">#innodb_spin_wait_delay = 30</span></span><br><span class=\"line\">innodb_lock_wait_timeout = 10</span><br><span class=\"line\">innodb_print_all_deadlocks = 1</span><br><span class=\"line\">innodb_rollback_on_timeout = 1</span><br><span class=\"line\"></span><br><span class=\"line\">innodb_open_files = 65535</span><br><span class=\"line\"></span><br><span class=\"line\">innodb_online_alter_log_max_size = 2G</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># innodb status</span></span><br><span class=\"line\">innodb_status_file = 1</span><br><span class=\"line\"><span class=\"comment\"># 注意: 开启 innodb_status_output &amp; innodb_status_output_locks 后, 可能会导致log-error文件增长较快</span></span><br><span class=\"line\">innodb_status_output = 0</span><br><span class=\"line\">innodb_status_output_locks = 0</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#performance_schema</span></span><br><span class=\"line\">performance_schema = 1</span><br><span class=\"line\">performance_schema_instrument = '%=on'</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#innodb monitor</span></span><br><span class=\"line\">innodb_monitor_enable=<span class=\"string\">\"module_innodb\"</span></span><br><span class=\"line\">innodb_monitor_enable=<span class=\"string\">\"module_server\"</span></span><br><span class=\"line\">innodb_monitor_enable=<span class=\"string\">\"module_dml\"</span></span><br><span class=\"line\">innodb_monitor_enable=<span class=\"string\">\"module_ddl\"</span></span><br><span class=\"line\">innodb_monitor_enable=<span class=\"string\">\"module_trx\"</span></span><br><span class=\"line\">innodb_monitor_enable=<span class=\"string\">\"module_os\"</span></span><br><span class=\"line\">innodb_monitor_enable=<span class=\"string\">\"module_purge\"</span></span><br><span class=\"line\">innodb_monitor_enable=<span class=\"string\">\"module_log\"</span></span><br><span class=\"line\">innodb_monitor_enable=<span class=\"string\">\"module_lock\"</span></span><br><span class=\"line\">innodb_monitor_enable=<span class=\"string\">\"module_buffer\"</span></span><br><span class=\"line\">innodb_monitor_enable=<span class=\"string\">\"module_index\"</span></span><br><span class=\"line\">innodb_monitor_enable=<span class=\"string\">\"module_ibuf_system\"</span></span><br><span class=\"line\">innodb_monitor_enable=<span class=\"string\">\"module_buffer_page\"</span></span><br><span class=\"line\">innodb_monitor_enable=<span class=\"string\">\"module_adaptive_hash\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># MyISAM</span></span><br><span class=\"line\">key_buffer_size = 1024M</span><br><span class=\"line\">bulk_insert_buffer_size = 64M</span><br><span class=\"line\">myisam_sort_buffer_size = 128M</span><br><span class=\"line\">myisam_repair_threads = 1</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">[mysqldump]</span><br><span class=\"line\">quick</span><br><span class=\"line\">max_allowed_packet = 32M</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"length":5525,"excerpt":"<blockquote>\n<p>二进制方式部署mysql5.7</p>\n</blockquote>","more":"<h3 id=\"下载glibc二进制包\"><a href=\"#下载glibc二进制包\" class=\"headerlink\" title=\"下载glibc二进制包\"></a>下载glibc二进制包</h3><figure class=\"highlight crystal\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#打开下载页面, 可能会有小版本更新(注意：选择操作系统时选Linux-Generic）</span></span><br><span class=\"line\"><span class=\"symbol\">https:</span>/<span class=\"regexp\">/dev.mysql.com/downloads</span><span class=\"regexp\">/mysql/</span><span class=\"number\">5.7</span>.html<span class=\"comment\">#downloads</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 最新的可能有小版本变化</span></span><br><span class=\"line\">wget <span class=\"symbol\">https:</span>/<span class=\"regexp\">/cdn.mysql.com/</span>Downloads/MySQL-<span class=\"number\">5.7</span>/mysql-<span class=\"number\">5.7</span>.<span class=\"number\">24</span>-linux-glibc2.<span class=\"number\">12</span>-x86_64.tar.gz</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"安装配置\"><a href=\"#安装配置\" class=\"headerlink\" title=\"安装配置\"></a>安装配置</h3><figure class=\"highlight jboss-cli\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar -xvf mysql-5.7.24-linux-glibc2.12-x86_64.tar.gz</span><br><span class=\"line\">mv mysql-5.7.24-linux-glibc2.12-x86_64 <span class=\"string\">/usr/local/</span></span><br><span class=\"line\"><span class=\"keyword\">cd</span> <span class=\"string\">/usr/local/</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 我的镜像是安装过5.5mysql, 所以需要mv一下</span></span><br><span class=\"line\">mv mysql mysql-5.5.37</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 由于以前安装过php指定了该mysq目录, 这可能导致以前安装的php缺少libmysqlclient.so.18</span></span><br><span class=\"line\">ln -s <span class=\"string\">/usr/local/mysql-5.5.37/lib/libmysqlclient.so.18</span> <span class=\"string\">/usr/local/mysql-5.7.24-linux-glibc2.12-x86_64/lib/libmysqlclient.so.18</span></span><br><span class=\"line\">ln -s mysql-5.7.24-linux-glibc2.12-x86_64 mysql</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 添加启动文件</span></span><br><span class=\"line\">\\cp mysql/support-files/mysql.server <span class=\"string\">/etc/init.d/mysqld</span></span><br><span class=\"line\"><span class=\"keyword\">echo</span> <span class=\"string\">\"PATH=$PATH:/usr/local/mysql/bin/\"</span> &gt;&gt;~<span class=\"string\">/.bashrc</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 可选</span></span><br><span class=\"line\">wget http:<span class=\"string\">//centos.mirrors.ucloud.cn/centos/6/os/x86_64/Packages/numactl-2.0.9-2.el6.x86_64.rpm</span></span><br><span class=\"line\">yum localinstall numactl-2.0.9-2.el6.x86_64.rpm</span><br><span class=\"line\">\\rm numactl-2.0.9-2.el6.x86_64.rpm</span><br><span class=\"line\"></span><br><span class=\"line\">useradd mysql</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 配置下mysql的数据目录</span></span><br><span class=\"line\"><span class=\"keyword\">cd</span> <span class=\"string\">/data/</span></span><br><span class=\"line\">mkdir u01</span><br><span class=\"line\">mkdir u02</span><br><span class=\"line\">chown -R mysql.mysql u01</span><br><span class=\"line\">chown -R mysql.mysql u02</span><br><span class=\"line\">chmod 750 u01</span><br><span class=\"line\">chmod 750 u02</span><br><span class=\"line\"><span class=\"keyword\">cd</span> <span class=\"string\">/data/u01/</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 初始化</span></span><br><span class=\"line\"><span class=\"string\">/usr/local/mysql/bin/mysqld</span> <span class=\"params\">--initialize-insecure</span> <span class=\"params\">--user=mysql</span> <span class=\"params\">--basedir=/usr/local/mysql</span> <span class=\"params\">--datadir=/data/u01</span></span><br><span class=\"line\">cat auto.cnf</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 启动服务 (在这之前准备好 /etc/my.cnf)</span></span><br><span class=\"line\"><span class=\"string\">/etc/init.d/mysqld</span> start</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 记录下variables</span></span><br><span class=\"line\">mysql -e <span class=\"string\">\"show global variables\"</span> &gt;mysql_option_default.log</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"my-cnf\"><a href=\"#my-cnf\" class=\"headerlink\" title=\"my.cnf\"></a>my.cnf</h3><figure class=\"highlight makefile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[client]</span><br><span class=\"line\">port = 3306</span><br><span class=\"line\">socket = /data/u01/mysql.sock</span><br><span class=\"line\"></span><br><span class=\"line\">[mysql]</span><br><span class=\"line\">prompt=<span class=\"string\">\"\\u@m1-u [\\d]&gt; \"</span></span><br><span class=\"line\">no-auto-rehash</span><br><span class=\"line\"></span><br><span class=\"line\">[mysqld]</span><br><span class=\"line\">user = mysql</span><br><span class=\"line\">port = 3306</span><br><span class=\"line\">basedir = /usr/local/mysql</span><br><span class=\"line\">datadir = /data/u01</span><br><span class=\"line\">socket = /data/u01/mysql.sock</span><br><span class=\"line\">pid-file = /data/u01/m1-u.pid</span><br><span class=\"line\">tmpdir = /data/u02</span><br><span class=\"line\">server-id = 1001</span><br><span class=\"line\">character-set-server = utf8</span><br><span class=\"line\">skip_name_resolve = 1</span><br><span class=\"line\">innodb_file_per_table = 1</span><br><span class=\"line\">explicit_defaults_for_timestamp = 0</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># buffer&amp;cache</span></span><br><span class=\"line\">table_open_cache = 100</span><br><span class=\"line\">table_definition_cache = 400</span><br><span class=\"line\">table_open_cache_instances = 64</span><br><span class=\"line\">sort_buffer_size = 4M</span><br><span class=\"line\">join_buffer_size = 4M</span><br><span class=\"line\">read_buffer_size = 8M</span><br><span class=\"line\">read_rnd_buffer_size = 4M</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># thread&amp;connection</span></span><br><span class=\"line\">thread_stack = 256K</span><br><span class=\"line\">thread_cache_size = 768</span><br><span class=\"line\">back_log = 1024</span><br><span class=\"line\">max_connections = 3000</span><br><span class=\"line\">max_connect_errors = 1000000</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># temptable</span></span><br><span class=\"line\">tmp_table_size = 32M</span><br><span class=\"line\">max_heap_table_size = 32M</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># network</span></span><br><span class=\"line\">max_allowed_packet = 32M</span><br><span class=\"line\"><span class=\"comment\">#lock_wait_timeout = 3600</span></span><br><span class=\"line\"><span class=\"comment\">#interactive_timeout = 600</span></span><br><span class=\"line\"><span class=\"comment\">#wait_timeout = 600</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># query cache</span></span><br><span class=\"line\">query_cache_size = 0</span><br><span class=\"line\">query_cache_type = 0</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 设置errorlog、slowlog和generallog的时区，默认UTC</span></span><br><span class=\"line\">log_timestamps = SYSTEM</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># error-log</span></span><br><span class=\"line\">log_error = /data/u02/mysqld.log</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># slow-log</span></span><br><span class=\"line\">slow_query_log = 1</span><br><span class=\"line\">slow_query_log_file = /data/u02/slow.log</span><br><span class=\"line\">long_query_time = 0.1</span><br><span class=\"line\">log_queries_not_using_indexes =1</span><br><span class=\"line\">log_throttle_queries_not_using_indexes = 60</span><br><span class=\"line\">min_examined_row_limit = 100</span><br><span class=\"line\">log_slow_admin_statements = 1</span><br><span class=\"line\">log_slow_slave_statements = 1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># general log</span></span><br><span class=\"line\"><span class=\"comment\">#general-log = 1</span></span><br><span class=\"line\">general_log_file=/data/u02/query.log</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># binlog</span></span><br><span class=\"line\">binlog_format = row</span><br><span class=\"line\">binlog_checksum = 1</span><br><span class=\"line\">log-bin = /data/u02/bdm1-bin</span><br><span class=\"line\">log-bin-index = /data/u02/bdm1-bin.index</span><br><span class=\"line\">sync_binlog = 0</span><br><span class=\"line\">binlog_cache_size = 4M</span><br><span class=\"line\">max_binlog_cache_size = 2G</span><br><span class=\"line\">max_binlog_size = 512M</span><br><span class=\"line\">expire_logs_days = 15</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># GTID</span></span><br><span class=\"line\">gtid_mode = on</span><br><span class=\"line\">enforce_gtid_consistency = 1</span><br><span class=\"line\">log_slave_updates</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Replication</span></span><br><span class=\"line\">master_info_repository = TABLE</span><br><span class=\"line\">relay_log_info_repository = TABLE</span><br><span class=\"line\">slave-rows-search-algorithms = 'INDEX_SCAN,HASH_SCAN'</span><br><span class=\"line\">relay_log_recovery = 1</span><br><span class=\"line\">relay_log_purge = 1</span><br><span class=\"line\">relay-log=/data/u02/bdm1-relay-bin</span><br><span class=\"line\">relay-log-index=/data/u02/bdm1-relay-bin.index</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># innodb-buffer&amp;cache</span></span><br><span class=\"line\">innodb_buffer_pool_size = 2G</span><br><span class=\"line\">innodb_buffer_pool_instances = 4</span><br><span class=\"line\"><span class=\"comment\">#innodb_additional_mem_pool_size = 16M</span></span><br><span class=\"line\">innodb_max_dirty_pages_pct = 50</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># innodb log</span></span><br><span class=\"line\">innodb_data_file_path = ibdata1:1G:autoextend</span><br><span class=\"line\">innodb_log_file_size = 1G</span><br><span class=\"line\">innodb_log_files_in_group = 2</span><br><span class=\"line\">innodb_flush_log_at_trx_commit = 2</span><br><span class=\"line\">innodb_log_buffer_size = 32M</span><br><span class=\"line\"><span class=\"comment\">#innodb_max_undo_log_size = 4G</span></span><br><span class=\"line\"><span class=\"comment\">#innodb_undo_directory = undolog</span></span><br><span class=\"line\">innodb_undo_tablespaces = 4</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># innodb-io</span></span><br><span class=\"line\">innodb_flush_method = O_DIRECT</span><br><span class=\"line\">innodb_io_capacity = 600</span><br><span class=\"line\">innodb_io_capacity_max = 2000</span><br><span class=\"line\">innodb_flush_sync = 0</span><br><span class=\"line\">innodb_flush_neighbors = 0</span><br><span class=\"line\"><span class=\"comment\">#innodb_lru_scan_depth = 4000</span></span><br><span class=\"line\">innodb_write_io_threads = 8</span><br><span class=\"line\">innodb_read_io_threads = 8</span><br><span class=\"line\">innodb_purge_threads = 4</span><br><span class=\"line\">innodb_page_cleaners = 4</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># transaction,lock</span></span><br><span class=\"line\"><span class=\"comment\">#innodb_sync_spin_loops = 100</span></span><br><span class=\"line\"><span class=\"comment\">#innodb_spin_wait_delay = 30</span></span><br><span class=\"line\">innodb_lock_wait_timeout = 10</span><br><span class=\"line\">innodb_print_all_deadlocks = 1</span><br><span class=\"line\">innodb_rollback_on_timeout = 1</span><br><span class=\"line\"></span><br><span class=\"line\">innodb_open_files = 65535</span><br><span class=\"line\"></span><br><span class=\"line\">innodb_online_alter_log_max_size = 2G</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># innodb status</span></span><br><span class=\"line\">innodb_status_file = 1</span><br><span class=\"line\"><span class=\"comment\"># 注意: 开启 innodb_status_output &amp; innodb_status_output_locks 后, 可能会导致log-error文件增长较快</span></span><br><span class=\"line\">innodb_status_output = 0</span><br><span class=\"line\">innodb_status_output_locks = 0</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#performance_schema</span></span><br><span class=\"line\">performance_schema = 1</span><br><span class=\"line\">performance_schema_instrument = '%=on'</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#innodb monitor</span></span><br><span class=\"line\">innodb_monitor_enable=<span class=\"string\">\"module_innodb\"</span></span><br><span class=\"line\">innodb_monitor_enable=<span class=\"string\">\"module_server\"</span></span><br><span class=\"line\">innodb_monitor_enable=<span class=\"string\">\"module_dml\"</span></span><br><span class=\"line\">innodb_monitor_enable=<span class=\"string\">\"module_ddl\"</span></span><br><span class=\"line\">innodb_monitor_enable=<span class=\"string\">\"module_trx\"</span></span><br><span class=\"line\">innodb_monitor_enable=<span class=\"string\">\"module_os\"</span></span><br><span class=\"line\">innodb_monitor_enable=<span class=\"string\">\"module_purge\"</span></span><br><span class=\"line\">innodb_monitor_enable=<span class=\"string\">\"module_log\"</span></span><br><span class=\"line\">innodb_monitor_enable=<span class=\"string\">\"module_lock\"</span></span><br><span class=\"line\">innodb_monitor_enable=<span class=\"string\">\"module_buffer\"</span></span><br><span class=\"line\">innodb_monitor_enable=<span class=\"string\">\"module_index\"</span></span><br><span class=\"line\">innodb_monitor_enable=<span class=\"string\">\"module_ibuf_system\"</span></span><br><span class=\"line\">innodb_monitor_enable=<span class=\"string\">\"module_buffer_page\"</span></span><br><span class=\"line\">innodb_monitor_enable=<span class=\"string\">\"module_adaptive_hash\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># MyISAM</span></span><br><span class=\"line\">key_buffer_size = 1024M</span><br><span class=\"line\">bulk_insert_buffer_size = 64M</span><br><span class=\"line\">myisam_sort_buffer_size = 128M</span><br><span class=\"line\">myisam_repair_threads = 1</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">[mysqldump]</span><br><span class=\"line\">quick</span><br><span class=\"line\">max_allowed_packet = 32M</span><br></pre></td></tr></table></figure>"},{"title":"部署elk7.2.0","date":"2019-09-19T09:59:53.000Z","copyright":true,"description":"本文主要是单机版部署elk7, 非高可用部署. 部分安装步骤省略. 主要是记录yml配置文件, 仅供参考. <br>详细内容请点击下方阅读全文, 非常感谢!","_content":"\n\n> 说明:\n```\n1 单台k8s,本机目录挂载(未配置cephfs)\n2 如果replicas大于1, 就会出现多个es挂载同一个目录,会出现报错(uuid block)\n```\n\n### 1. es配置本地挂载 k8s-es-7.2.0.yml\n```\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n labels:\n   app: elasticsearch\n name: elasticsearch7-admin\n namespace: ns-elastic7\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n name: elasticsearch7-admin\n labels:\n   app: elasticsearch\nroleRef:\n apiGroup: rbac.authorization.k8s.io\n kind: ClusterRole\n name: cluster-admin\nsubjects:\n - kind: ServiceAccount\n   name: elasticsearch7-admin\n   namespace: ns-elastic7\n---\napiVersion: apps/v1\nkind: StatefulSet\nmetadata:\n  labels:\n    app: elasticsearch\n    role: master\n  name: elasticsearch-master\n  namespace: ns-elastic7\nspec:\n  replicas: 1\n  serviceName: elasticsearch-master\n  selector:\n    matchLabels:\n      app: elasticsearch\n      role: master\n  template:\n    metadata:\n      labels:\n        app: elasticsearch\n        role: master\n    spec:\n      serviceAccountName: elasticsearch7-admin\n      restartPolicy: Always\n      securityContext:\n        fsGroup: 1000\n      containers:\n        - name: elasticsearch-master\n          image: hub.boqii.com/bq/elasticsearch:7.2.0\n          command: [\"bash\", \"-c\", \"ulimit -l unlimited && sysctl -w vm.max_map_count=262144 && chown -R elasticsearch:elasticsearch /usr/share/elasticsearch/data && exec su elasticsearch docker-entrypoint.sh\"]\n          imagePullPolicy: IfNotPresent\n          securityContext:\n            privileged: true\n          ports:\n            - containerPort: 9200\n              protocol: TCP\n            - containerPort: 9300\n              protocol: TCP\n          resources:\n            requests:\n              cpu: \"50m\"\n            limits:\n              cpu: \"800m\"\n          env:\n            - name: cluster.name\n              value: \"es_cluster\"\n            - name: node.master\n              value: \"true\"\n            - name: node.data\n              value: \"true\"\n            - name: cluster.initial_master_nodes\n              value: \"elasticsearch-master-0\" # 根据副本数和name配置\n            - name: discovery.zen.ping_timeout\n              value: \"5s\"\n            - name: node.ingest\n              value: \"false\"\n            - name: ES_JAVA_OPTS\n              value: \"-Xms1g -Xmx1g\"\n            - name: \"discovery.zen.ping.unicast.hosts\"\n              value: \"elasticsearch-discovery\" # Disvocery Service\n            - name: \"http.cors.enabled\"\n              value: \"true\"\n            - name: \"http.cors.allow-origin\"\n              value: \"*\"\n          volumeMounts:\n            - name: elasticsearch-data-volume\n              mountPath: /usr/share/elasticsearch/data\n      volumes:\n        - name: elasticsearch-data-volume\n          hostPath:\n            path: /data/k8s-container/elk-7.2.0/es-7.2.0/data\n---\napiVersion: v1\nkind: Service\nmetadata:\n  labels:\n    app: elasticsearch\n  name: elasticsearch-discovery\n  namespace: ns-elastic7\nspec:\n  publishNotReadyAddresses: true\n  ports:\n  - name: transport\n    port: 9300\n    targetPort: 9300\n  selector:\n    app: elasticsearch\n    role: master\n---\nkind: Service\napiVersion: v1\nmetadata:\n labels:\n   app: elasticsearch\n name: elasticsearch-service\n namespace: ns-elastic7\nspec:\n type: NodePort\n ports:\n   - port: 9200\n     targetPort: 9200\n     nodePort: 19230\n     protocol: TCP\n selector:\n   app: elasticsearch\n```\n\n### 2. es配置nfs动态挂载 k8s-es-7.2.0-nfs.yml\n```\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n labels:\n   app: elasticsearch\n name: elasticsearch-admin\n namespace: ns-elastic\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n name: elasticsearch-admin\n labels:\n   app: elasticsearch\nroleRef:\n apiGroup: rbac.authorization.k8s.io\n kind: ClusterRole\n name: cluster-admin\nsubjects:\n - kind: ServiceAccount\n   name: elasticsearch-admin\n   namespace: ns-elastic\n---\napiVersion: apps/v1\nkind: StatefulSet\nmetadata:\n  labels:\n    app: elasticsearch\n    role: master\n  name: elasticsearch-master\n  namespace: ns-elastic\nspec:\n  replicas: 2\n  volumeClaimTemplates:\n  - metadata:\n      name: elasticsearch-data-nfs\n      annotations:\n        volume.beta.kubernetes.io/storage-class: \"nfs\"\n    spec:\n      accessModes: [ \"ReadWriteOnce\" ]\n      resources:\n        requests:\n          storage: 2Gi\n  serviceName: elasticsearch-master\n  selector:\n    matchLabels:\n      app: elasticsearch\n      role: master\n  template:\n    metadata:\n      labels:\n        app: elasticsearch\n        role: master\n    spec:\n      serviceAccountName: elasticsearch-admin\n      restartPolicy: Always\n      securityContext:\n        fsGroup: 1000\n      containers:\n        - name: elasticsearch-master\n          image: elasticsearch:7.2.0\n          command: [\"bash\", \"-c\", \"ulimit -l unlimited && sysctl -w vm.max_map_count=262144 && chown -R elasticsearch:elasticsearch /usr/share/elasticsearch/data && exec su elasticsearch docker-entrypoint.sh\"]\n          imagePullPolicy: IfNotPresent\n          volumeMounts:\n          - name: elasticsearch-data-nfs\n            mountPath: /usr/share/elasticsearch/data\n          securityContext:\n            privileged: true\n          ports:\n            - containerPort: 9200\n              protocol: TCP\n            - containerPort: 9300\n              protocol: TCP\n          env:\n            - name: cluster.name\n              value: \"es_cluster\"\n            - name: node.master\n              value: \"true\"\n            - name: node.data\n              value: \"true\"\n            - name: cluster.initial_master_nodes\n              value: \"elasticsearch-master-0,elasticsearch-master-1\" # 根据副本数和name配置\n            - name: discovery.zen.ping_timeout\n              value: \"5s\"\n            - name: node.ingest\n              value: \"false\"\n            - name: ES_JAVA_OPTS\n              value: \"-Xms1g -Xmx1g\"\n            - name: \"discovery.zen.ping.unicast.hosts\"\n              value: \"elasticsearch-discovery\" # Disvocery Service\n            - name: \"http.cors.enabled\"\n              value: \"true\"\n            - name: \"http.cors.allow-origin\"\n              value: \"*\"\n---\napiVersion: v1\nkind: Service\nmetadata:\n  labels:\n    app: elasticsearch\n  name: elasticsearch-discovery\n  namespace: ns-elastic\nspec:\n  publishNotReadyAddresses: true\n  ports:\n  - name: transport\n    port: 9300\n    targetPort: 9300\n  selector:\n    app: elasticsearch\n    role: master\n---\nkind: Service\napiVersion: v1\nmetadata:\n labels:\n   app: elasticsearch\n name: elasticsearch-service\n namespace: ns-elastic\nspec:\n type: NodePort\n ports:\n   - port: 9200\n     targetPort: 9200\n     nodePort: 19220\n     protocol: TCP\n selector:\n   app: elasticsearch\n```\n\n\n### 3. kibana配置k8s-kibana-7.2.0.yml\n```\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: kibana-config\n  namespace: ns-elastic7\n  labels:\n    elastic-app: kibana\ndata:\n  kibana.yml: |\n    server.name: kibana\n    server.host: \"0\"\n    elasticsearch.hosts: [ \"http://elasticsearch-service:9200\" ]\n    xpack.monitoring.ui.container.elasticsearch.enabled: true\n---\nkind: Deployment\napiVersion: apps/v1beta2\nmetadata:\n  labels:\n    elastic-app: kibana\n  name: kibana\n  namespace: ns-elastic7\nspec:\n  replicas: 1\n  revisionHistoryLimit: 10\n  selector:\n    matchLabels:\n      elastic-app: kibana\n  template:\n    metadata:\n      labels:\n        elastic-app: kibana\n    spec:\n      containers:\n        - name: kibana\n          image: hub.boqii.com/bq/kibana:7.2.0\n          ports:\n            - containerPort: 5601\n              protocol: TCP\n          resources:\n            requests:\n              cpu: \"50m\"\n            limits:\n              cpu: \"800m\"\n          volumeMounts:\n            - name: kibana-config\n              mountPath: /usr/share/kibana/config\n      volumes:\n        - name: kibana-config\n          configMap:\n            name: kibana-config\n      tolerations:\n        - key: node-role.kubernetes.io/master\n          effect: NoSchedule\n\n---\nkind: Service\napiVersion: v1\nmetadata:\n  labels:\n    elastic-app: kibana\n  name: kibana-service\n  namespace: ns-elastic7\nspec:\n  ports:\n    - port: 5601\n      targetPort: 5601\n  selector:\n    elastic-app: kibana\n  type: NodePort\n---\napiVersion: extensions/v1beta1\nkind: Ingress\nmetadata:\n labels:\n   elastic-app: kibana\n name: kibana-ingress\n namespace: ns-elastic7\nspec:\n rules:\n   - host: elk-kibana-dev.boqii.com\n     http:\n       paths:\n         - backend:\n             serviceName: kibana-service\n             servicePort: 5601\n```\n\n### 4. logstash配置 本地挂载 k8s-logstash-7.2.0.yml\n- 4.1 config/pipelines.yml\n```\n- pipeline.id: main\n  path.config: \"/usr/share/logstash/config/pipeline/*.conf\"\n```\n\n- 4.2 首先配置grok规则 config/pipeline/logstash.conf\n```\ninput {\n    udp {\n        port => \"10000\"\n        }\n    }\n\n filter {\n      grok {\n          match => {\n            \"message\" => \"\\{\\\"id\\\":\\\"(?<id>(.)*)\\\",\\\"tag\\\":\\\"(?<tag>(.)*)\\\",\\\"title\\\":\\\"%{GREEDYDATA:title}(?<title>(.|\\r|\\n)*)\\\",\\\"value\\\":\\\"%{GREEDYDATA:value}(?<value>(.|\\r|\\n)*)\\\",\\\"createdAt\\\":\\\"(?<createdAt>\\S+ \\S+)\\\",\\\"Telephone\\\":\\\"(?<Telephone>(.)*)\\\",\\\"uid\\\":\\\"(?<uid>(.)*)\\\",\\\"updateTime\\\":\\\"(?<updateTime>(.)*)\\\",\\\"appVersion\\\":\\\"(?<appVersion>(.)*)\\\",\\\"mobileModel\\\":\\\"(?<mobileModel>(.)*)\\\",\\\"osVersion\\\":\\\"(?<osVersion>(.)*)\\\",\\\"channel\\\":\\\"(?<channel>(.)*)\\\",\\\"UDID\\\":\\\"(?<UDID>(.)*)\\\"\\}\"\n              }\n            }\n }\n\noutput {\n    elasticsearch {\n        hosts =>  [ \"http://elasticsearch-service:9200\" ]\n        index => \"k8s2-dev-%{+YYYY.MM.dd}\"\n\n        }\n\n    }\n```\n\n- 4.3 配置文件 k8s-logstash-7.2.0.yml\n```\n---\nkind: Deployment\napiVersion: apps/v1beta2\nmetadata:\n  labels:\n    elastic-app: logstash\n  name: logstash\n  namespace: ns-elastic\nspec:\n  replicas: 1\n  revisionHistoryLimit: 10\n  selector:\n    matchLabels:\n      elastic-app: logstash\n  template:\n    metadata:\n      labels:\n        elastic-app: logstash\n    spec:\n      containers:\n        - name: logstash\n          image: hub.boqii.com/bq/logstash:7.2.0\n          ports:\n            - containerPort: 10000\n              protocol: UDP\n          volumeMounts:\n            - name: logstash-config\n              mountPath: /usr/share/logstash/config\n      volumes:\n        - name: logstash-config\n          hostPath:\n            path: /data/k8s-pod/elk-7.2.0/logstash-7.2.0/config\n      tolerations:\n        - key: node-role.kubernetes.io/master\n          effect: NoSchedule\n\n---\nkind: Service\napiVersion: v1\nmetadata:\n  labels:\n    elastic-app: logstash\n  name: logstash-service\n  namespace: ns-elastic\nspec:\n  type: NodePort\n  ports:\n    - port: 10000\n      targetPort: 10000\n      nodePort: 10000\n      protocol: UDP\n  selector:\n    elastic-app: logstash\n  type: NodePort\n---\n```\n","source":"_posts/2-部署elk7-2-0.md","raw":"---\ntitle: 部署elk7.2.0\ndate: 2019-09-19 17:59:53\ncopyright: true\ntags:\n  - k8s\n  - elk\n  - elk7\ncategories:\n  - [技术文档]\n  - [k8s,elk7]\ndescription: \"本文主要是单机版部署elk7, 非高可用部署. 部分安装步骤省略. 主要是记录yml配置文件, 仅供参考. <br>详细内容请点击下方阅读全文, 非常感谢!\"\n---\n\n\n> 说明:\n```\n1 单台k8s,本机目录挂载(未配置cephfs)\n2 如果replicas大于1, 就会出现多个es挂载同一个目录,会出现报错(uuid block)\n```\n\n### 1. es配置本地挂载 k8s-es-7.2.0.yml\n```\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n labels:\n   app: elasticsearch\n name: elasticsearch7-admin\n namespace: ns-elastic7\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n name: elasticsearch7-admin\n labels:\n   app: elasticsearch\nroleRef:\n apiGroup: rbac.authorization.k8s.io\n kind: ClusterRole\n name: cluster-admin\nsubjects:\n - kind: ServiceAccount\n   name: elasticsearch7-admin\n   namespace: ns-elastic7\n---\napiVersion: apps/v1\nkind: StatefulSet\nmetadata:\n  labels:\n    app: elasticsearch\n    role: master\n  name: elasticsearch-master\n  namespace: ns-elastic7\nspec:\n  replicas: 1\n  serviceName: elasticsearch-master\n  selector:\n    matchLabels:\n      app: elasticsearch\n      role: master\n  template:\n    metadata:\n      labels:\n        app: elasticsearch\n        role: master\n    spec:\n      serviceAccountName: elasticsearch7-admin\n      restartPolicy: Always\n      securityContext:\n        fsGroup: 1000\n      containers:\n        - name: elasticsearch-master\n          image: hub.boqii.com/bq/elasticsearch:7.2.0\n          command: [\"bash\", \"-c\", \"ulimit -l unlimited && sysctl -w vm.max_map_count=262144 && chown -R elasticsearch:elasticsearch /usr/share/elasticsearch/data && exec su elasticsearch docker-entrypoint.sh\"]\n          imagePullPolicy: IfNotPresent\n          securityContext:\n            privileged: true\n          ports:\n            - containerPort: 9200\n              protocol: TCP\n            - containerPort: 9300\n              protocol: TCP\n          resources:\n            requests:\n              cpu: \"50m\"\n            limits:\n              cpu: \"800m\"\n          env:\n            - name: cluster.name\n              value: \"es_cluster\"\n            - name: node.master\n              value: \"true\"\n            - name: node.data\n              value: \"true\"\n            - name: cluster.initial_master_nodes\n              value: \"elasticsearch-master-0\" # 根据副本数和name配置\n            - name: discovery.zen.ping_timeout\n              value: \"5s\"\n            - name: node.ingest\n              value: \"false\"\n            - name: ES_JAVA_OPTS\n              value: \"-Xms1g -Xmx1g\"\n            - name: \"discovery.zen.ping.unicast.hosts\"\n              value: \"elasticsearch-discovery\" # Disvocery Service\n            - name: \"http.cors.enabled\"\n              value: \"true\"\n            - name: \"http.cors.allow-origin\"\n              value: \"*\"\n          volumeMounts:\n            - name: elasticsearch-data-volume\n              mountPath: /usr/share/elasticsearch/data\n      volumes:\n        - name: elasticsearch-data-volume\n          hostPath:\n            path: /data/k8s-container/elk-7.2.0/es-7.2.0/data\n---\napiVersion: v1\nkind: Service\nmetadata:\n  labels:\n    app: elasticsearch\n  name: elasticsearch-discovery\n  namespace: ns-elastic7\nspec:\n  publishNotReadyAddresses: true\n  ports:\n  - name: transport\n    port: 9300\n    targetPort: 9300\n  selector:\n    app: elasticsearch\n    role: master\n---\nkind: Service\napiVersion: v1\nmetadata:\n labels:\n   app: elasticsearch\n name: elasticsearch-service\n namespace: ns-elastic7\nspec:\n type: NodePort\n ports:\n   - port: 9200\n     targetPort: 9200\n     nodePort: 19230\n     protocol: TCP\n selector:\n   app: elasticsearch\n```\n\n### 2. es配置nfs动态挂载 k8s-es-7.2.0-nfs.yml\n```\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n labels:\n   app: elasticsearch\n name: elasticsearch-admin\n namespace: ns-elastic\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n name: elasticsearch-admin\n labels:\n   app: elasticsearch\nroleRef:\n apiGroup: rbac.authorization.k8s.io\n kind: ClusterRole\n name: cluster-admin\nsubjects:\n - kind: ServiceAccount\n   name: elasticsearch-admin\n   namespace: ns-elastic\n---\napiVersion: apps/v1\nkind: StatefulSet\nmetadata:\n  labels:\n    app: elasticsearch\n    role: master\n  name: elasticsearch-master\n  namespace: ns-elastic\nspec:\n  replicas: 2\n  volumeClaimTemplates:\n  - metadata:\n      name: elasticsearch-data-nfs\n      annotations:\n        volume.beta.kubernetes.io/storage-class: \"nfs\"\n    spec:\n      accessModes: [ \"ReadWriteOnce\" ]\n      resources:\n        requests:\n          storage: 2Gi\n  serviceName: elasticsearch-master\n  selector:\n    matchLabels:\n      app: elasticsearch\n      role: master\n  template:\n    metadata:\n      labels:\n        app: elasticsearch\n        role: master\n    spec:\n      serviceAccountName: elasticsearch-admin\n      restartPolicy: Always\n      securityContext:\n        fsGroup: 1000\n      containers:\n        - name: elasticsearch-master\n          image: elasticsearch:7.2.0\n          command: [\"bash\", \"-c\", \"ulimit -l unlimited && sysctl -w vm.max_map_count=262144 && chown -R elasticsearch:elasticsearch /usr/share/elasticsearch/data && exec su elasticsearch docker-entrypoint.sh\"]\n          imagePullPolicy: IfNotPresent\n          volumeMounts:\n          - name: elasticsearch-data-nfs\n            mountPath: /usr/share/elasticsearch/data\n          securityContext:\n            privileged: true\n          ports:\n            - containerPort: 9200\n              protocol: TCP\n            - containerPort: 9300\n              protocol: TCP\n          env:\n            - name: cluster.name\n              value: \"es_cluster\"\n            - name: node.master\n              value: \"true\"\n            - name: node.data\n              value: \"true\"\n            - name: cluster.initial_master_nodes\n              value: \"elasticsearch-master-0,elasticsearch-master-1\" # 根据副本数和name配置\n            - name: discovery.zen.ping_timeout\n              value: \"5s\"\n            - name: node.ingest\n              value: \"false\"\n            - name: ES_JAVA_OPTS\n              value: \"-Xms1g -Xmx1g\"\n            - name: \"discovery.zen.ping.unicast.hosts\"\n              value: \"elasticsearch-discovery\" # Disvocery Service\n            - name: \"http.cors.enabled\"\n              value: \"true\"\n            - name: \"http.cors.allow-origin\"\n              value: \"*\"\n---\napiVersion: v1\nkind: Service\nmetadata:\n  labels:\n    app: elasticsearch\n  name: elasticsearch-discovery\n  namespace: ns-elastic\nspec:\n  publishNotReadyAddresses: true\n  ports:\n  - name: transport\n    port: 9300\n    targetPort: 9300\n  selector:\n    app: elasticsearch\n    role: master\n---\nkind: Service\napiVersion: v1\nmetadata:\n labels:\n   app: elasticsearch\n name: elasticsearch-service\n namespace: ns-elastic\nspec:\n type: NodePort\n ports:\n   - port: 9200\n     targetPort: 9200\n     nodePort: 19220\n     protocol: TCP\n selector:\n   app: elasticsearch\n```\n\n\n### 3. kibana配置k8s-kibana-7.2.0.yml\n```\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: kibana-config\n  namespace: ns-elastic7\n  labels:\n    elastic-app: kibana\ndata:\n  kibana.yml: |\n    server.name: kibana\n    server.host: \"0\"\n    elasticsearch.hosts: [ \"http://elasticsearch-service:9200\" ]\n    xpack.monitoring.ui.container.elasticsearch.enabled: true\n---\nkind: Deployment\napiVersion: apps/v1beta2\nmetadata:\n  labels:\n    elastic-app: kibana\n  name: kibana\n  namespace: ns-elastic7\nspec:\n  replicas: 1\n  revisionHistoryLimit: 10\n  selector:\n    matchLabels:\n      elastic-app: kibana\n  template:\n    metadata:\n      labels:\n        elastic-app: kibana\n    spec:\n      containers:\n        - name: kibana\n          image: hub.boqii.com/bq/kibana:7.2.0\n          ports:\n            - containerPort: 5601\n              protocol: TCP\n          resources:\n            requests:\n              cpu: \"50m\"\n            limits:\n              cpu: \"800m\"\n          volumeMounts:\n            - name: kibana-config\n              mountPath: /usr/share/kibana/config\n      volumes:\n        - name: kibana-config\n          configMap:\n            name: kibana-config\n      tolerations:\n        - key: node-role.kubernetes.io/master\n          effect: NoSchedule\n\n---\nkind: Service\napiVersion: v1\nmetadata:\n  labels:\n    elastic-app: kibana\n  name: kibana-service\n  namespace: ns-elastic7\nspec:\n  ports:\n    - port: 5601\n      targetPort: 5601\n  selector:\n    elastic-app: kibana\n  type: NodePort\n---\napiVersion: extensions/v1beta1\nkind: Ingress\nmetadata:\n labels:\n   elastic-app: kibana\n name: kibana-ingress\n namespace: ns-elastic7\nspec:\n rules:\n   - host: elk-kibana-dev.boqii.com\n     http:\n       paths:\n         - backend:\n             serviceName: kibana-service\n             servicePort: 5601\n```\n\n### 4. logstash配置 本地挂载 k8s-logstash-7.2.0.yml\n- 4.1 config/pipelines.yml\n```\n- pipeline.id: main\n  path.config: \"/usr/share/logstash/config/pipeline/*.conf\"\n```\n\n- 4.2 首先配置grok规则 config/pipeline/logstash.conf\n```\ninput {\n    udp {\n        port => \"10000\"\n        }\n    }\n\n filter {\n      grok {\n          match => {\n            \"message\" => \"\\{\\\"id\\\":\\\"(?<id>(.)*)\\\",\\\"tag\\\":\\\"(?<tag>(.)*)\\\",\\\"title\\\":\\\"%{GREEDYDATA:title}(?<title>(.|\\r|\\n)*)\\\",\\\"value\\\":\\\"%{GREEDYDATA:value}(?<value>(.|\\r|\\n)*)\\\",\\\"createdAt\\\":\\\"(?<createdAt>\\S+ \\S+)\\\",\\\"Telephone\\\":\\\"(?<Telephone>(.)*)\\\",\\\"uid\\\":\\\"(?<uid>(.)*)\\\",\\\"updateTime\\\":\\\"(?<updateTime>(.)*)\\\",\\\"appVersion\\\":\\\"(?<appVersion>(.)*)\\\",\\\"mobileModel\\\":\\\"(?<mobileModel>(.)*)\\\",\\\"osVersion\\\":\\\"(?<osVersion>(.)*)\\\",\\\"channel\\\":\\\"(?<channel>(.)*)\\\",\\\"UDID\\\":\\\"(?<UDID>(.)*)\\\"\\}\"\n              }\n            }\n }\n\noutput {\n    elasticsearch {\n        hosts =>  [ \"http://elasticsearch-service:9200\" ]\n        index => \"k8s2-dev-%{+YYYY.MM.dd}\"\n\n        }\n\n    }\n```\n\n- 4.3 配置文件 k8s-logstash-7.2.0.yml\n```\n---\nkind: Deployment\napiVersion: apps/v1beta2\nmetadata:\n  labels:\n    elastic-app: logstash\n  name: logstash\n  namespace: ns-elastic\nspec:\n  replicas: 1\n  revisionHistoryLimit: 10\n  selector:\n    matchLabels:\n      elastic-app: logstash\n  template:\n    metadata:\n      labels:\n        elastic-app: logstash\n    spec:\n      containers:\n        - name: logstash\n          image: hub.boqii.com/bq/logstash:7.2.0\n          ports:\n            - containerPort: 10000\n              protocol: UDP\n          volumeMounts:\n            - name: logstash-config\n              mountPath: /usr/share/logstash/config\n      volumes:\n        - name: logstash-config\n          hostPath:\n            path: /data/k8s-pod/elk-7.2.0/logstash-7.2.0/config\n      tolerations:\n        - key: node-role.kubernetes.io/master\n          effect: NoSchedule\n\n---\nkind: Service\napiVersion: v1\nmetadata:\n  labels:\n    elastic-app: logstash\n  name: logstash-service\n  namespace: ns-elastic\nspec:\n  type: NodePort\n  ports:\n    - port: 10000\n      targetPort: 10000\n      nodePort: 10000\n      protocol: UDP\n  selector:\n    elastic-app: logstash\n  type: NodePort\n---\n```\n","slug":"2-部署elk7-2-0","published":1,"updated":"2019-10-16T09:15:27.840Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck28uwzp0003vkerwk81m0lku","content":"<blockquote>\n<p>说明:</p>\n</blockquote>\n<figure class=\"highlight basic\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"symbol\">1 </span>单台k8s,本机目录挂载(未配置cephfs)</span><br><span class=\"line\"><span class=\"symbol\">2 </span>如果replicas大于<span class=\"number\">1</span>, 就会出现多个es挂载同一个目录,会出现报错(uuid block)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"1-es配置本地挂载-k8s-es-7-2-0-yml\"><a href=\"#1-es配置本地挂载-k8s-es-7-2-0-yml\" class=\"headerlink\" title=\"1. es配置本地挂载 k8s-es-7.2.0.yml\"></a>1. es配置本地挂载 k8s-es-7.2.0.yml</h3><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ServiceAccount</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\"> labels:</span></span><br><span class=\"line\"><span class=\"attr\">   app:</span> <span class=\"string\">elasticsearch</span></span><br><span class=\"line\"><span class=\"attr\"> name:</span> <span class=\"string\">elasticsearch7-admin</span></span><br><span class=\"line\"><span class=\"attr\"> namespace:</span> <span class=\"string\">ns-elastic7</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">rbac.authorization.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ClusterRoleBinding</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\"> name:</span> <span class=\"string\">elasticsearch7-admin</span></span><br><span class=\"line\"><span class=\"attr\"> labels:</span></span><br><span class=\"line\"><span class=\"attr\">   app:</span> <span class=\"string\">elasticsearch</span></span><br><span class=\"line\"><span class=\"attr\">roleRef:</span></span><br><span class=\"line\"><span class=\"attr\"> apiGroup:</span> <span class=\"string\">rbac.authorization.k8s.io</span></span><br><span class=\"line\"><span class=\"attr\"> kind:</span> <span class=\"string\">ClusterRole</span></span><br><span class=\"line\"><span class=\"attr\"> name:</span> <span class=\"string\">cluster-admin</span></span><br><span class=\"line\"><span class=\"attr\">subjects:</span></span><br><span class=\"line\"><span class=\"attr\"> - kind:</span> <span class=\"string\">ServiceAccount</span></span><br><span class=\"line\"><span class=\"attr\">   name:</span> <span class=\"string\">elasticsearch7-admin</span></span><br><span class=\"line\"><span class=\"attr\">   namespace:</span> <span class=\"string\">ns-elastic7</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">StatefulSet</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  labels:</span></span><br><span class=\"line\"><span class=\"attr\">    app:</span> <span class=\"string\">elasticsearch</span></span><br><span class=\"line\"><span class=\"attr\">    role:</span> <span class=\"string\">master</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">elasticsearch-master</span></span><br><span class=\"line\"><span class=\"attr\">  namespace:</span> <span class=\"string\">ns-elastic7</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\">  replicas:</span> <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"attr\">  serviceName:</span> <span class=\"string\">elasticsearch-master</span></span><br><span class=\"line\"><span class=\"attr\">  selector:</span></span><br><span class=\"line\"><span class=\"attr\">    matchLabels:</span></span><br><span class=\"line\"><span class=\"attr\">      app:</span> <span class=\"string\">elasticsearch</span></span><br><span class=\"line\"><span class=\"attr\">      role:</span> <span class=\"string\">master</span></span><br><span class=\"line\"><span class=\"attr\">  template:</span></span><br><span class=\"line\"><span class=\"attr\">    metadata:</span></span><br><span class=\"line\"><span class=\"attr\">      labels:</span></span><br><span class=\"line\"><span class=\"attr\">        app:</span> <span class=\"string\">elasticsearch</span></span><br><span class=\"line\"><span class=\"attr\">        role:</span> <span class=\"string\">master</span></span><br><span class=\"line\"><span class=\"attr\">    spec:</span></span><br><span class=\"line\"><span class=\"attr\">      serviceAccountName:</span> <span class=\"string\">elasticsearch7-admin</span></span><br><span class=\"line\"><span class=\"attr\">      restartPolicy:</span> <span class=\"string\">Always</span></span><br><span class=\"line\"><span class=\"attr\">      securityContext:</span></span><br><span class=\"line\"><span class=\"attr\">        fsGroup:</span> <span class=\"number\">1000</span></span><br><span class=\"line\"><span class=\"attr\">      containers:</span></span><br><span class=\"line\"><span class=\"attr\">        - name:</span> <span class=\"string\">elasticsearch-master</span></span><br><span class=\"line\"><span class=\"attr\">          image:</span> <span class=\"string\">hub.boqii.com/bq/elasticsearch:7.2.0</span></span><br><span class=\"line\"><span class=\"attr\">          command:</span> <span class=\"string\">[\"bash\",</span> <span class=\"string\">\"-c\"</span><span class=\"string\">,</span> <span class=\"string\">\"ulimit -l unlimited &amp;&amp; sysctl -w vm.max_map_count=262144 &amp;&amp; chown -R elasticsearch:elasticsearch /usr/share/elasticsearch/data &amp;&amp; exec su elasticsearch docker-entrypoint.sh\"</span><span class=\"string\">]</span></span><br><span class=\"line\"><span class=\"attr\">          imagePullPolicy:</span> <span class=\"string\">IfNotPresent</span></span><br><span class=\"line\"><span class=\"attr\">          securityContext:</span></span><br><span class=\"line\"><span class=\"attr\">            privileged:</span> <span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"attr\">          ports:</span></span><br><span class=\"line\"><span class=\"attr\">            - containerPort:</span> <span class=\"number\">9200</span></span><br><span class=\"line\"><span class=\"attr\">              protocol:</span> <span class=\"string\">TCP</span></span><br><span class=\"line\"><span class=\"attr\">            - containerPort:</span> <span class=\"number\">9300</span></span><br><span class=\"line\"><span class=\"attr\">              protocol:</span> <span class=\"string\">TCP</span></span><br><span class=\"line\"><span class=\"attr\">          resources:</span></span><br><span class=\"line\"><span class=\"attr\">            requests:</span></span><br><span class=\"line\"><span class=\"attr\">              cpu:</span> <span class=\"string\">\"50m\"</span></span><br><span class=\"line\"><span class=\"attr\">            limits:</span></span><br><span class=\"line\"><span class=\"attr\">              cpu:</span> <span class=\"string\">\"800m\"</span></span><br><span class=\"line\"><span class=\"attr\">          env:</span></span><br><span class=\"line\"><span class=\"attr\">            - name:</span> <span class=\"string\">cluster.name</span></span><br><span class=\"line\"><span class=\"attr\">              value:</span> <span class=\"string\">\"es_cluster\"</span></span><br><span class=\"line\"><span class=\"attr\">            - name:</span> <span class=\"string\">node.master</span></span><br><span class=\"line\"><span class=\"attr\">              value:</span> <span class=\"string\">\"true\"</span></span><br><span class=\"line\"><span class=\"attr\">            - name:</span> <span class=\"string\">node.data</span></span><br><span class=\"line\"><span class=\"attr\">              value:</span> <span class=\"string\">\"true\"</span></span><br><span class=\"line\"><span class=\"attr\">            - name:</span> <span class=\"string\">cluster.initial_master_nodes</span></span><br><span class=\"line\"><span class=\"attr\">              value:</span> <span class=\"string\">\"elasticsearch-master-0\"</span> <span class=\"comment\"># 根据副本数和name配置</span></span><br><span class=\"line\"><span class=\"attr\">            - name:</span> <span class=\"string\">discovery.zen.ping_timeout</span></span><br><span class=\"line\"><span class=\"attr\">              value:</span> <span class=\"string\">\"5s\"</span></span><br><span class=\"line\"><span class=\"attr\">            - name:</span> <span class=\"string\">node.ingest</span></span><br><span class=\"line\"><span class=\"attr\">              value:</span> <span class=\"string\">\"false\"</span></span><br><span class=\"line\"><span class=\"attr\">            - name:</span> <span class=\"string\">ES_JAVA_OPTS</span></span><br><span class=\"line\"><span class=\"attr\">              value:</span> <span class=\"string\">\"-Xms1g -Xmx1g\"</span></span><br><span class=\"line\"><span class=\"attr\">            - name:</span> <span class=\"string\">\"discovery.zen.ping.unicast.hosts\"</span></span><br><span class=\"line\"><span class=\"attr\">              value:</span> <span class=\"string\">\"elasticsearch-discovery\"</span> <span class=\"comment\"># Disvocery Service</span></span><br><span class=\"line\"><span class=\"attr\">            - name:</span> <span class=\"string\">\"http.cors.enabled\"</span></span><br><span class=\"line\"><span class=\"attr\">              value:</span> <span class=\"string\">\"true\"</span></span><br><span class=\"line\"><span class=\"attr\">            - name:</span> <span class=\"string\">\"http.cors.allow-origin\"</span></span><br><span class=\"line\"><span class=\"attr\">              value:</span> <span class=\"string\">\"*\"</span></span><br><span class=\"line\"><span class=\"attr\">          volumeMounts:</span></span><br><span class=\"line\"><span class=\"attr\">            - name:</span> <span class=\"string\">elasticsearch-data-volume</span></span><br><span class=\"line\"><span class=\"attr\">              mountPath:</span> <span class=\"string\">/usr/share/elasticsearch/data</span></span><br><span class=\"line\"><span class=\"attr\">      volumes:</span></span><br><span class=\"line\"><span class=\"attr\">        - name:</span> <span class=\"string\">elasticsearch-data-volume</span></span><br><span class=\"line\"><span class=\"attr\">          hostPath:</span></span><br><span class=\"line\"><span class=\"attr\">            path:</span> <span class=\"string\">/data/k8s-container/elk-7.2.0/es-7.2.0/data</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Service</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  labels:</span></span><br><span class=\"line\"><span class=\"attr\">    app:</span> <span class=\"string\">elasticsearch</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">elasticsearch-discovery</span></span><br><span class=\"line\"><span class=\"attr\">  namespace:</span> <span class=\"string\">ns-elastic7</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\">  publishNotReadyAddresses:</span> <span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"attr\">  ports:</span></span><br><span class=\"line\"><span class=\"attr\">  - name:</span> <span class=\"string\">transport</span></span><br><span class=\"line\"><span class=\"attr\">    port:</span> <span class=\"number\">9300</span></span><br><span class=\"line\"><span class=\"attr\">    targetPort:</span> <span class=\"number\">9300</span></span><br><span class=\"line\"><span class=\"attr\">  selector:</span></span><br><span class=\"line\"><span class=\"attr\">    app:</span> <span class=\"string\">elasticsearch</span></span><br><span class=\"line\"><span class=\"attr\">    role:</span> <span class=\"string\">master</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Service</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\"> labels:</span></span><br><span class=\"line\"><span class=\"attr\">   app:</span> <span class=\"string\">elasticsearch</span></span><br><span class=\"line\"><span class=\"attr\"> name:</span> <span class=\"string\">elasticsearch-service</span></span><br><span class=\"line\"><span class=\"attr\"> namespace:</span> <span class=\"string\">ns-elastic7</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\"> type:</span> <span class=\"string\">NodePort</span></span><br><span class=\"line\"><span class=\"attr\"> ports:</span></span><br><span class=\"line\"><span class=\"attr\">   - port:</span> <span class=\"number\">9200</span></span><br><span class=\"line\"><span class=\"attr\">     targetPort:</span> <span class=\"number\">9200</span></span><br><span class=\"line\"><span class=\"attr\">     nodePort:</span> <span class=\"number\">19230</span></span><br><span class=\"line\"><span class=\"attr\">     protocol:</span> <span class=\"string\">TCP</span></span><br><span class=\"line\"><span class=\"attr\"> selector:</span></span><br><span class=\"line\"><span class=\"attr\">   app:</span> <span class=\"string\">elasticsearch</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-es配置nfs动态挂载-k8s-es-7-2-0-nfs-yml\"><a href=\"#2-es配置nfs动态挂载-k8s-es-7-2-0-nfs-yml\" class=\"headerlink\" title=\"2. es配置nfs动态挂载 k8s-es-7.2.0-nfs.yml\"></a>2. es配置nfs动态挂载 k8s-es-7.2.0-nfs.yml</h3><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ServiceAccount</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\"> labels:</span></span><br><span class=\"line\"><span class=\"attr\">   app:</span> <span class=\"string\">elasticsearch</span></span><br><span class=\"line\"><span class=\"attr\"> name:</span> <span class=\"string\">elasticsearch-admin</span></span><br><span class=\"line\"><span class=\"attr\"> namespace:</span> <span class=\"string\">ns-elastic</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">rbac.authorization.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ClusterRoleBinding</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\"> name:</span> <span class=\"string\">elasticsearch-admin</span></span><br><span class=\"line\"><span class=\"attr\"> labels:</span></span><br><span class=\"line\"><span class=\"attr\">   app:</span> <span class=\"string\">elasticsearch</span></span><br><span class=\"line\"><span class=\"attr\">roleRef:</span></span><br><span class=\"line\"><span class=\"attr\"> apiGroup:</span> <span class=\"string\">rbac.authorization.k8s.io</span></span><br><span class=\"line\"><span class=\"attr\"> kind:</span> <span class=\"string\">ClusterRole</span></span><br><span class=\"line\"><span class=\"attr\"> name:</span> <span class=\"string\">cluster-admin</span></span><br><span class=\"line\"><span class=\"attr\">subjects:</span></span><br><span class=\"line\"><span class=\"attr\"> - kind:</span> <span class=\"string\">ServiceAccount</span></span><br><span class=\"line\"><span class=\"attr\">   name:</span> <span class=\"string\">elasticsearch-admin</span></span><br><span class=\"line\"><span class=\"attr\">   namespace:</span> <span class=\"string\">ns-elastic</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">StatefulSet</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  labels:</span></span><br><span class=\"line\"><span class=\"attr\">    app:</span> <span class=\"string\">elasticsearch</span></span><br><span class=\"line\"><span class=\"attr\">    role:</span> <span class=\"string\">master</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">elasticsearch-master</span></span><br><span class=\"line\"><span class=\"attr\">  namespace:</span> <span class=\"string\">ns-elastic</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\">  replicas:</span> <span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"attr\">  volumeClaimTemplates:</span></span><br><span class=\"line\"><span class=\"attr\">  - metadata:</span></span><br><span class=\"line\"><span class=\"attr\">      name:</span> <span class=\"string\">elasticsearch-data-nfs</span></span><br><span class=\"line\"><span class=\"attr\">      annotations:</span></span><br><span class=\"line\">        <span class=\"string\">volume.beta.kubernetes.io/storage-class:</span> <span class=\"string\">\"nfs\"</span></span><br><span class=\"line\"><span class=\"attr\">    spec:</span></span><br><span class=\"line\"><span class=\"attr\">      accessModes:</span> <span class=\"string\">[</span> <span class=\"string\">\"ReadWriteOnce\"</span> <span class=\"string\">]</span></span><br><span class=\"line\"><span class=\"attr\">      resources:</span></span><br><span class=\"line\"><span class=\"attr\">        requests:</span></span><br><span class=\"line\"><span class=\"attr\">          storage:</span> <span class=\"number\">2</span><span class=\"string\">Gi</span></span><br><span class=\"line\"><span class=\"attr\">  serviceName:</span> <span class=\"string\">elasticsearch-master</span></span><br><span class=\"line\"><span class=\"attr\">  selector:</span></span><br><span class=\"line\"><span class=\"attr\">    matchLabels:</span></span><br><span class=\"line\"><span class=\"attr\">      app:</span> <span class=\"string\">elasticsearch</span></span><br><span class=\"line\"><span class=\"attr\">      role:</span> <span class=\"string\">master</span></span><br><span class=\"line\"><span class=\"attr\">  template:</span></span><br><span class=\"line\"><span class=\"attr\">    metadata:</span></span><br><span class=\"line\"><span class=\"attr\">      labels:</span></span><br><span class=\"line\"><span class=\"attr\">        app:</span> <span class=\"string\">elasticsearch</span></span><br><span class=\"line\"><span class=\"attr\">        role:</span> <span class=\"string\">master</span></span><br><span class=\"line\"><span class=\"attr\">    spec:</span></span><br><span class=\"line\"><span class=\"attr\">      serviceAccountName:</span> <span class=\"string\">elasticsearch-admin</span></span><br><span class=\"line\"><span class=\"attr\">      restartPolicy:</span> <span class=\"string\">Always</span></span><br><span class=\"line\"><span class=\"attr\">      securityContext:</span></span><br><span class=\"line\"><span class=\"attr\">        fsGroup:</span> <span class=\"number\">1000</span></span><br><span class=\"line\"><span class=\"attr\">      containers:</span></span><br><span class=\"line\"><span class=\"attr\">        - name:</span> <span class=\"string\">elasticsearch-master</span></span><br><span class=\"line\"><span class=\"attr\">          image:</span> <span class=\"attr\">elasticsearch:7.2.0</span></span><br><span class=\"line\"><span class=\"attr\">          command:</span> <span class=\"string\">[\"bash\",</span> <span class=\"string\">\"-c\"</span><span class=\"string\">,</span> <span class=\"string\">\"ulimit -l unlimited &amp;&amp; sysctl -w vm.max_map_count=262144 &amp;&amp; chown -R elasticsearch:elasticsearch /usr/share/elasticsearch/data &amp;&amp; exec su elasticsearch docker-entrypoint.sh\"</span><span class=\"string\">]</span></span><br><span class=\"line\"><span class=\"attr\">          imagePullPolicy:</span> <span class=\"string\">IfNotPresent</span></span><br><span class=\"line\"><span class=\"attr\">          volumeMounts:</span></span><br><span class=\"line\"><span class=\"attr\">          - name:</span> <span class=\"string\">elasticsearch-data-nfs</span></span><br><span class=\"line\"><span class=\"attr\">            mountPath:</span> <span class=\"string\">/usr/share/elasticsearch/data</span></span><br><span class=\"line\"><span class=\"attr\">          securityContext:</span></span><br><span class=\"line\"><span class=\"attr\">            privileged:</span> <span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"attr\">          ports:</span></span><br><span class=\"line\"><span class=\"attr\">            - containerPort:</span> <span class=\"number\">9200</span></span><br><span class=\"line\"><span class=\"attr\">              protocol:</span> <span class=\"string\">TCP</span></span><br><span class=\"line\"><span class=\"attr\">            - containerPort:</span> <span class=\"number\">9300</span></span><br><span class=\"line\"><span class=\"attr\">              protocol:</span> <span class=\"string\">TCP</span></span><br><span class=\"line\"><span class=\"attr\">          env:</span></span><br><span class=\"line\"><span class=\"attr\">            - name:</span> <span class=\"string\">cluster.name</span></span><br><span class=\"line\"><span class=\"attr\">              value:</span> <span class=\"string\">\"es_cluster\"</span></span><br><span class=\"line\"><span class=\"attr\">            - name:</span> <span class=\"string\">node.master</span></span><br><span class=\"line\"><span class=\"attr\">              value:</span> <span class=\"string\">\"true\"</span></span><br><span class=\"line\"><span class=\"attr\">            - name:</span> <span class=\"string\">node.data</span></span><br><span class=\"line\"><span class=\"attr\">              value:</span> <span class=\"string\">\"true\"</span></span><br><span class=\"line\"><span class=\"attr\">            - name:</span> <span class=\"string\">cluster.initial_master_nodes</span></span><br><span class=\"line\"><span class=\"attr\">              value:</span> <span class=\"string\">\"elasticsearch-master-0,elasticsearch-master-1\"</span> <span class=\"comment\"># 根据副本数和name配置</span></span><br><span class=\"line\"><span class=\"attr\">            - name:</span> <span class=\"string\">discovery.zen.ping_timeout</span></span><br><span class=\"line\"><span class=\"attr\">              value:</span> <span class=\"string\">\"5s\"</span></span><br><span class=\"line\"><span class=\"attr\">            - name:</span> <span class=\"string\">node.ingest</span></span><br><span class=\"line\"><span class=\"attr\">              value:</span> <span class=\"string\">\"false\"</span></span><br><span class=\"line\"><span class=\"attr\">            - name:</span> <span class=\"string\">ES_JAVA_OPTS</span></span><br><span class=\"line\"><span class=\"attr\">              value:</span> <span class=\"string\">\"-Xms1g -Xmx1g\"</span></span><br><span class=\"line\"><span class=\"attr\">            - name:</span> <span class=\"string\">\"discovery.zen.ping.unicast.hosts\"</span></span><br><span class=\"line\"><span class=\"attr\">              value:</span> <span class=\"string\">\"elasticsearch-discovery\"</span> <span class=\"comment\"># Disvocery Service</span></span><br><span class=\"line\"><span class=\"attr\">            - name:</span> <span class=\"string\">\"http.cors.enabled\"</span></span><br><span class=\"line\"><span class=\"attr\">              value:</span> <span class=\"string\">\"true\"</span></span><br><span class=\"line\"><span class=\"attr\">            - name:</span> <span class=\"string\">\"http.cors.allow-origin\"</span></span><br><span class=\"line\"><span class=\"attr\">              value:</span> <span class=\"string\">\"*\"</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Service</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  labels:</span></span><br><span class=\"line\"><span class=\"attr\">    app:</span> <span class=\"string\">elasticsearch</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">elasticsearch-discovery</span></span><br><span class=\"line\"><span class=\"attr\">  namespace:</span> <span class=\"string\">ns-elastic</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\">  publishNotReadyAddresses:</span> <span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"attr\">  ports:</span></span><br><span class=\"line\"><span class=\"attr\">  - name:</span> <span class=\"string\">transport</span></span><br><span class=\"line\"><span class=\"attr\">    port:</span> <span class=\"number\">9300</span></span><br><span class=\"line\"><span class=\"attr\">    targetPort:</span> <span class=\"number\">9300</span></span><br><span class=\"line\"><span class=\"attr\">  selector:</span></span><br><span class=\"line\"><span class=\"attr\">    app:</span> <span class=\"string\">elasticsearch</span></span><br><span class=\"line\"><span class=\"attr\">    role:</span> <span class=\"string\">master</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Service</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\"> labels:</span></span><br><span class=\"line\"><span class=\"attr\">   app:</span> <span class=\"string\">elasticsearch</span></span><br><span class=\"line\"><span class=\"attr\"> name:</span> <span class=\"string\">elasticsearch-service</span></span><br><span class=\"line\"><span class=\"attr\"> namespace:</span> <span class=\"string\">ns-elastic</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\"> type:</span> <span class=\"string\">NodePort</span></span><br><span class=\"line\"><span class=\"attr\"> ports:</span></span><br><span class=\"line\"><span class=\"attr\">   - port:</span> <span class=\"number\">9200</span></span><br><span class=\"line\"><span class=\"attr\">     targetPort:</span> <span class=\"number\">9200</span></span><br><span class=\"line\"><span class=\"attr\">     nodePort:</span> <span class=\"number\">19220</span></span><br><span class=\"line\"><span class=\"attr\">     protocol:</span> <span class=\"string\">TCP</span></span><br><span class=\"line\"><span class=\"attr\"> selector:</span></span><br><span class=\"line\"><span class=\"attr\">   app:</span> <span class=\"string\">elasticsearch</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-kibana配置k8s-kibana-7-2-0-yml\"><a href=\"#3-kibana配置k8s-kibana-7-2-0-yml\" class=\"headerlink\" title=\"3. kibana配置k8s-kibana-7.2.0.yml\"></a>3. kibana配置k8s-kibana-7.2.0.yml</h3><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ConfigMap</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">kibana-config</span></span><br><span class=\"line\"><span class=\"attr\">  namespace:</span> <span class=\"string\">ns-elastic7</span></span><br><span class=\"line\"><span class=\"attr\">  labels:</span></span><br><span class=\"line\"><span class=\"attr\">    elastic-app:</span> <span class=\"string\">kibana</span></span><br><span class=\"line\"><span class=\"attr\">data:</span></span><br><span class=\"line\">  <span class=\"string\">kibana.yml:</span> <span class=\"string\">|</span></span><br><span class=\"line\"><span class=\"string\">    server.name: kibana</span></span><br><span class=\"line\"><span class=\"string\">    server.host: \"0\"</span></span><br><span class=\"line\"><span class=\"string\">    elasticsearch.hosts: [ \"http://elasticsearch-service:9200\" ]</span></span><br><span class=\"line\"><span class=\"string\">    xpack.monitoring.ui.container.elasticsearch.enabled: true</span></span><br><span class=\"line\"><span class=\"string\">---</span></span><br><span class=\"line\"><span class=\"string\"></span><span class=\"attr\">kind:</span> <span class=\"string\">Deployment</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1beta2</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  labels:</span></span><br><span class=\"line\"><span class=\"attr\">    elastic-app:</span> <span class=\"string\">kibana</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">kibana</span></span><br><span class=\"line\"><span class=\"attr\">  namespace:</span> <span class=\"string\">ns-elastic7</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\">  replicas:</span> <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"attr\">  revisionHistoryLimit:</span> <span class=\"number\">10</span></span><br><span class=\"line\"><span class=\"attr\">  selector:</span></span><br><span class=\"line\"><span class=\"attr\">    matchLabels:</span></span><br><span class=\"line\"><span class=\"attr\">      elastic-app:</span> <span class=\"string\">kibana</span></span><br><span class=\"line\"><span class=\"attr\">  template:</span></span><br><span class=\"line\"><span class=\"attr\">    metadata:</span></span><br><span class=\"line\"><span class=\"attr\">      labels:</span></span><br><span class=\"line\"><span class=\"attr\">        elastic-app:</span> <span class=\"string\">kibana</span></span><br><span class=\"line\"><span class=\"attr\">    spec:</span></span><br><span class=\"line\"><span class=\"attr\">      containers:</span></span><br><span class=\"line\"><span class=\"attr\">        - name:</span> <span class=\"string\">kibana</span></span><br><span class=\"line\"><span class=\"attr\">          image:</span> <span class=\"string\">hub.boqii.com/bq/kibana:7.2.0</span></span><br><span class=\"line\"><span class=\"attr\">          ports:</span></span><br><span class=\"line\"><span class=\"attr\">            - containerPort:</span> <span class=\"number\">5601</span></span><br><span class=\"line\"><span class=\"attr\">              protocol:</span> <span class=\"string\">TCP</span></span><br><span class=\"line\"><span class=\"attr\">          resources:</span></span><br><span class=\"line\"><span class=\"attr\">            requests:</span></span><br><span class=\"line\"><span class=\"attr\">              cpu:</span> <span class=\"string\">\"50m\"</span></span><br><span class=\"line\"><span class=\"attr\">            limits:</span></span><br><span class=\"line\"><span class=\"attr\">              cpu:</span> <span class=\"string\">\"800m\"</span></span><br><span class=\"line\"><span class=\"attr\">          volumeMounts:</span></span><br><span class=\"line\"><span class=\"attr\">            - name:</span> <span class=\"string\">kibana-config</span></span><br><span class=\"line\"><span class=\"attr\">              mountPath:</span> <span class=\"string\">/usr/share/kibana/config</span></span><br><span class=\"line\"><span class=\"attr\">      volumes:</span></span><br><span class=\"line\"><span class=\"attr\">        - name:</span> <span class=\"string\">kibana-config</span></span><br><span class=\"line\"><span class=\"attr\">          configMap:</span></span><br><span class=\"line\"><span class=\"attr\">            name:</span> <span class=\"string\">kibana-config</span></span><br><span class=\"line\"><span class=\"attr\">      tolerations:</span></span><br><span class=\"line\"><span class=\"attr\">        - key:</span> <span class=\"string\">node-role.kubernetes.io/master</span></span><br><span class=\"line\"><span class=\"attr\">          effect:</span> <span class=\"string\">NoSchedule</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Service</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  labels:</span></span><br><span class=\"line\"><span class=\"attr\">    elastic-app:</span> <span class=\"string\">kibana</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">kibana-service</span></span><br><span class=\"line\"><span class=\"attr\">  namespace:</span> <span class=\"string\">ns-elastic7</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\">  ports:</span></span><br><span class=\"line\"><span class=\"attr\">    - port:</span> <span class=\"number\">5601</span></span><br><span class=\"line\"><span class=\"attr\">      targetPort:</span> <span class=\"number\">5601</span></span><br><span class=\"line\"><span class=\"attr\">  selector:</span></span><br><span class=\"line\"><span class=\"attr\">    elastic-app:</span> <span class=\"string\">kibana</span></span><br><span class=\"line\"><span class=\"attr\">  type:</span> <span class=\"string\">NodePort</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">extensions/v1beta1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Ingress</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\"> labels:</span></span><br><span class=\"line\"><span class=\"attr\">   elastic-app:</span> <span class=\"string\">kibana</span></span><br><span class=\"line\"><span class=\"attr\"> name:</span> <span class=\"string\">kibana-ingress</span></span><br><span class=\"line\"><span class=\"attr\"> namespace:</span> <span class=\"string\">ns-elastic7</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\"> rules:</span></span><br><span class=\"line\"><span class=\"attr\">   - host:</span> <span class=\"string\">elk-kibana-dev.boqii.com</span></span><br><span class=\"line\"><span class=\"attr\">     http:</span></span><br><span class=\"line\"><span class=\"attr\">       paths:</span></span><br><span class=\"line\"><span class=\"attr\">         - backend:</span></span><br><span class=\"line\"><span class=\"attr\">             serviceName:</span> <span class=\"string\">kibana-service</span></span><br><span class=\"line\"><span class=\"attr\">             servicePort:</span> <span class=\"number\">5601</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4-logstash配置-本地挂载-k8s-logstash-7-2-0-yml\"><a href=\"#4-logstash配置-本地挂载-k8s-logstash-7-2-0-yml\" class=\"headerlink\" title=\"4. logstash配置 本地挂载 k8s-logstash-7.2.0.yml\"></a>4. logstash配置 本地挂载 k8s-logstash-7.2.0.yml</h3><ul>\n<li><p>4.1 config/pipelines.yml</p>\n<figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- pipeline<span class=\"selector-class\">.id</span>: main</span><br><span class=\"line\">  path<span class=\"selector-class\">.config</span>: <span class=\"string\">\"/usr/share/logstash/config/pipeline/*.conf\"</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>4.2 首先配置grok规则 config/pipeline/logstash.conf</p>\n<figure class=\"highlight lsl\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">input &#123;</span><br><span class=\"line\">    udp &#123;</span><br><span class=\"line\">        port =&gt; <span class=\"string\">\"10000\"</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"> filter &#123;</span><br><span class=\"line\">      grok &#123;</span><br><span class=\"line\">          match =&gt; &#123;</span><br><span class=\"line\">            <span class=\"string\">\"message\"</span> =&gt; <span class=\"string\">\"\\&#123;<span class=\"subst\">\\\"</span>id<span class=\"subst\">\\\"</span>:<span class=\"subst\">\\\"</span>(?&lt;id&gt;(.)*)<span class=\"subst\">\\\"</span>,<span class=\"subst\">\\\"</span>tag<span class=\"subst\">\\\"</span>:<span class=\"subst\">\\\"</span>(?&lt;tag&gt;(.)*)<span class=\"subst\">\\\"</span>,<span class=\"subst\">\\\"</span>title<span class=\"subst\">\\\"</span>:<span class=\"subst\">\\\"</span>%&#123;GREEDYDATA:title&#125;(?&lt;title&gt;(.|\\r|<span class=\"subst\">\\n</span>)*)<span class=\"subst\">\\\"</span>,<span class=\"subst\">\\\"</span>value<span class=\"subst\">\\\"</span>:<span class=\"subst\">\\\"</span>%&#123;GREEDYDATA:value&#125;(?&lt;value&gt;(.|\\r|<span class=\"subst\">\\n</span>)*)<span class=\"subst\">\\\"</span>,<span class=\"subst\">\\\"</span>createdAt<span class=\"subst\">\\\"</span>:<span class=\"subst\">\\\"</span>(?&lt;createdAt&gt;\\S+ \\S+)<span class=\"subst\">\\\"</span>,<span class=\"subst\">\\\"</span>Telephone<span class=\"subst\">\\\"</span>:<span class=\"subst\">\\\"</span>(?&lt;Telephone&gt;(.)*)<span class=\"subst\">\\\"</span>,<span class=\"subst\">\\\"</span>uid<span class=\"subst\">\\\"</span>:<span class=\"subst\">\\\"</span>(?&lt;uid&gt;(.)*)<span class=\"subst\">\\\"</span>,<span class=\"subst\">\\\"</span>updateTime<span class=\"subst\">\\\"</span>:<span class=\"subst\">\\\"</span>(?&lt;updateTime&gt;(.)*)<span class=\"subst\">\\\"</span>,<span class=\"subst\">\\\"</span>appVersion<span class=\"subst\">\\\"</span>:<span class=\"subst\">\\\"</span>(?&lt;appVersion&gt;(.)*)<span class=\"subst\">\\\"</span>,<span class=\"subst\">\\\"</span>mobileModel<span class=\"subst\">\\\"</span>:<span class=\"subst\">\\\"</span>(?&lt;mobileModel&gt;(.)*)<span class=\"subst\">\\\"</span>,<span class=\"subst\">\\\"</span>osVersion<span class=\"subst\">\\\"</span>:<span class=\"subst\">\\\"</span>(?&lt;osVersion&gt;(.)*)<span class=\"subst\">\\\"</span>,<span class=\"subst\">\\\"</span>channel<span class=\"subst\">\\\"</span>:<span class=\"subst\">\\\"</span>(?&lt;channel&gt;(.)*)<span class=\"subst\">\\\"</span>,<span class=\"subst\">\\\"</span>UDID<span class=\"subst\">\\\"</span>:<span class=\"subst\">\\\"</span>(?&lt;UDID&gt;(.)*)<span class=\"subst\">\\\"</span>\\&#125;\"</span></span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">output &#123;</span><br><span class=\"line\">    elasticsearch &#123;</span><br><span class=\"line\">        hosts =&gt;  [ <span class=\"string\">\"http://elasticsearch-service:9200\"</span> ]</span><br><span class=\"line\">        index =&gt; <span class=\"string\">\"k8s2-dev-%&#123;+YYYY.MM.dd&#125;\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>4.3 配置文件 k8s-logstash-7.2.0.yml</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Deployment</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1beta2</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  labels:</span></span><br><span class=\"line\"><span class=\"attr\">    elastic-app:</span> <span class=\"string\">logstash</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">logstash</span></span><br><span class=\"line\"><span class=\"attr\">  namespace:</span> <span class=\"string\">ns-elastic</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\">  replicas:</span> <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"attr\">  revisionHistoryLimit:</span> <span class=\"number\">10</span></span><br><span class=\"line\"><span class=\"attr\">  selector:</span></span><br><span class=\"line\"><span class=\"attr\">    matchLabels:</span></span><br><span class=\"line\"><span class=\"attr\">      elastic-app:</span> <span class=\"string\">logstash</span></span><br><span class=\"line\"><span class=\"attr\">  template:</span></span><br><span class=\"line\"><span class=\"attr\">    metadata:</span></span><br><span class=\"line\"><span class=\"attr\">      labels:</span></span><br><span class=\"line\"><span class=\"attr\">        elastic-app:</span> <span class=\"string\">logstash</span></span><br><span class=\"line\"><span class=\"attr\">    spec:</span></span><br><span class=\"line\"><span class=\"attr\">      containers:</span></span><br><span class=\"line\"><span class=\"attr\">        - name:</span> <span class=\"string\">logstash</span></span><br><span class=\"line\"><span class=\"attr\">          image:</span> <span class=\"string\">hub.boqii.com/bq/logstash:7.2.0</span></span><br><span class=\"line\"><span class=\"attr\">          ports:</span></span><br><span class=\"line\"><span class=\"attr\">            - containerPort:</span> <span class=\"number\">10000</span></span><br><span class=\"line\"><span class=\"attr\">              protocol:</span> <span class=\"string\">UDP</span></span><br><span class=\"line\"><span class=\"attr\">          volumeMounts:</span></span><br><span class=\"line\"><span class=\"attr\">            - name:</span> <span class=\"string\">logstash-config</span></span><br><span class=\"line\"><span class=\"attr\">              mountPath:</span> <span class=\"string\">/usr/share/logstash/config</span></span><br><span class=\"line\"><span class=\"attr\">      volumes:</span></span><br><span class=\"line\"><span class=\"attr\">        - name:</span> <span class=\"string\">logstash-config</span></span><br><span class=\"line\"><span class=\"attr\">          hostPath:</span></span><br><span class=\"line\"><span class=\"attr\">            path:</span> <span class=\"string\">/data/k8s-pod/elk-7.2.0/logstash-7.2.0/config</span></span><br><span class=\"line\"><span class=\"attr\">      tolerations:</span></span><br><span class=\"line\"><span class=\"attr\">        - key:</span> <span class=\"string\">node-role.kubernetes.io/master</span></span><br><span class=\"line\"><span class=\"attr\">          effect:</span> <span class=\"string\">NoSchedule</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Service</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  labels:</span></span><br><span class=\"line\"><span class=\"attr\">    elastic-app:</span> <span class=\"string\">logstash</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">logstash-service</span></span><br><span class=\"line\"><span class=\"attr\">  namespace:</span> <span class=\"string\">ns-elastic</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\">  type:</span> <span class=\"string\">NodePort</span></span><br><span class=\"line\"><span class=\"attr\">  ports:</span></span><br><span class=\"line\"><span class=\"attr\">    - port:</span> <span class=\"number\">10000</span></span><br><span class=\"line\"><span class=\"attr\">      targetPort:</span> <span class=\"number\">10000</span></span><br><span class=\"line\"><span class=\"attr\">      nodePort:</span> <span class=\"number\">10000</span></span><br><span class=\"line\"><span class=\"attr\">      protocol:</span> <span class=\"string\">UDP</span></span><br><span class=\"line\"><span class=\"attr\">  selector:</span></span><br><span class=\"line\"><span class=\"attr\">    elastic-app:</span> <span class=\"string\">logstash</span></span><br><span class=\"line\"><span class=\"attr\">  type:</span> <span class=\"string\">NodePort</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br></pre></td></tr></table></figure>\n\n</li>\n</ul>\n","site":{"data":{}},"length":11166,"excerpt":"","more":"<blockquote>\n<p>说明:</p>\n</blockquote>\n<figure class=\"highlight basic\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"symbol\">1 </span>单台k8s,本机目录挂载(未配置cephfs)</span><br><span class=\"line\"><span class=\"symbol\">2 </span>如果replicas大于<span class=\"number\">1</span>, 就会出现多个es挂载同一个目录,会出现报错(uuid block)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"1-es配置本地挂载-k8s-es-7-2-0-yml\"><a href=\"#1-es配置本地挂载-k8s-es-7-2-0-yml\" class=\"headerlink\" title=\"1. es配置本地挂载 k8s-es-7.2.0.yml\"></a>1. es配置本地挂载 k8s-es-7.2.0.yml</h3><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ServiceAccount</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\"> labels:</span></span><br><span class=\"line\"><span class=\"attr\">   app:</span> <span class=\"string\">elasticsearch</span></span><br><span class=\"line\"><span class=\"attr\"> name:</span> <span class=\"string\">elasticsearch7-admin</span></span><br><span class=\"line\"><span class=\"attr\"> namespace:</span> <span class=\"string\">ns-elastic7</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">rbac.authorization.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ClusterRoleBinding</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\"> name:</span> <span class=\"string\">elasticsearch7-admin</span></span><br><span class=\"line\"><span class=\"attr\"> labels:</span></span><br><span class=\"line\"><span class=\"attr\">   app:</span> <span class=\"string\">elasticsearch</span></span><br><span class=\"line\"><span class=\"attr\">roleRef:</span></span><br><span class=\"line\"><span class=\"attr\"> apiGroup:</span> <span class=\"string\">rbac.authorization.k8s.io</span></span><br><span class=\"line\"><span class=\"attr\"> kind:</span> <span class=\"string\">ClusterRole</span></span><br><span class=\"line\"><span class=\"attr\"> name:</span> <span class=\"string\">cluster-admin</span></span><br><span class=\"line\"><span class=\"attr\">subjects:</span></span><br><span class=\"line\"><span class=\"attr\"> - kind:</span> <span class=\"string\">ServiceAccount</span></span><br><span class=\"line\"><span class=\"attr\">   name:</span> <span class=\"string\">elasticsearch7-admin</span></span><br><span class=\"line\"><span class=\"attr\">   namespace:</span> <span class=\"string\">ns-elastic7</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">StatefulSet</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  labels:</span></span><br><span class=\"line\"><span class=\"attr\">    app:</span> <span class=\"string\">elasticsearch</span></span><br><span class=\"line\"><span class=\"attr\">    role:</span> <span class=\"string\">master</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">elasticsearch-master</span></span><br><span class=\"line\"><span class=\"attr\">  namespace:</span> <span class=\"string\">ns-elastic7</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\">  replicas:</span> <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"attr\">  serviceName:</span> <span class=\"string\">elasticsearch-master</span></span><br><span class=\"line\"><span class=\"attr\">  selector:</span></span><br><span class=\"line\"><span class=\"attr\">    matchLabels:</span></span><br><span class=\"line\"><span class=\"attr\">      app:</span> <span class=\"string\">elasticsearch</span></span><br><span class=\"line\"><span class=\"attr\">      role:</span> <span class=\"string\">master</span></span><br><span class=\"line\"><span class=\"attr\">  template:</span></span><br><span class=\"line\"><span class=\"attr\">    metadata:</span></span><br><span class=\"line\"><span class=\"attr\">      labels:</span></span><br><span class=\"line\"><span class=\"attr\">        app:</span> <span class=\"string\">elasticsearch</span></span><br><span class=\"line\"><span class=\"attr\">        role:</span> <span class=\"string\">master</span></span><br><span class=\"line\"><span class=\"attr\">    spec:</span></span><br><span class=\"line\"><span class=\"attr\">      serviceAccountName:</span> <span class=\"string\">elasticsearch7-admin</span></span><br><span class=\"line\"><span class=\"attr\">      restartPolicy:</span> <span class=\"string\">Always</span></span><br><span class=\"line\"><span class=\"attr\">      securityContext:</span></span><br><span class=\"line\"><span class=\"attr\">        fsGroup:</span> <span class=\"number\">1000</span></span><br><span class=\"line\"><span class=\"attr\">      containers:</span></span><br><span class=\"line\"><span class=\"attr\">        - name:</span> <span class=\"string\">elasticsearch-master</span></span><br><span class=\"line\"><span class=\"attr\">          image:</span> <span class=\"string\">hub.boqii.com/bq/elasticsearch:7.2.0</span></span><br><span class=\"line\"><span class=\"attr\">          command:</span> <span class=\"string\">[\"bash\",</span> <span class=\"string\">\"-c\"</span><span class=\"string\">,</span> <span class=\"string\">\"ulimit -l unlimited &amp;&amp; sysctl -w vm.max_map_count=262144 &amp;&amp; chown -R elasticsearch:elasticsearch /usr/share/elasticsearch/data &amp;&amp; exec su elasticsearch docker-entrypoint.sh\"</span><span class=\"string\">]</span></span><br><span class=\"line\"><span class=\"attr\">          imagePullPolicy:</span> <span class=\"string\">IfNotPresent</span></span><br><span class=\"line\"><span class=\"attr\">          securityContext:</span></span><br><span class=\"line\"><span class=\"attr\">            privileged:</span> <span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"attr\">          ports:</span></span><br><span class=\"line\"><span class=\"attr\">            - containerPort:</span> <span class=\"number\">9200</span></span><br><span class=\"line\"><span class=\"attr\">              protocol:</span> <span class=\"string\">TCP</span></span><br><span class=\"line\"><span class=\"attr\">            - containerPort:</span> <span class=\"number\">9300</span></span><br><span class=\"line\"><span class=\"attr\">              protocol:</span> <span class=\"string\">TCP</span></span><br><span class=\"line\"><span class=\"attr\">          resources:</span></span><br><span class=\"line\"><span class=\"attr\">            requests:</span></span><br><span class=\"line\"><span class=\"attr\">              cpu:</span> <span class=\"string\">\"50m\"</span></span><br><span class=\"line\"><span class=\"attr\">            limits:</span></span><br><span class=\"line\"><span class=\"attr\">              cpu:</span> <span class=\"string\">\"800m\"</span></span><br><span class=\"line\"><span class=\"attr\">          env:</span></span><br><span class=\"line\"><span class=\"attr\">            - name:</span> <span class=\"string\">cluster.name</span></span><br><span class=\"line\"><span class=\"attr\">              value:</span> <span class=\"string\">\"es_cluster\"</span></span><br><span class=\"line\"><span class=\"attr\">            - name:</span> <span class=\"string\">node.master</span></span><br><span class=\"line\"><span class=\"attr\">              value:</span> <span class=\"string\">\"true\"</span></span><br><span class=\"line\"><span class=\"attr\">            - name:</span> <span class=\"string\">node.data</span></span><br><span class=\"line\"><span class=\"attr\">              value:</span> <span class=\"string\">\"true\"</span></span><br><span class=\"line\"><span class=\"attr\">            - name:</span> <span class=\"string\">cluster.initial_master_nodes</span></span><br><span class=\"line\"><span class=\"attr\">              value:</span> <span class=\"string\">\"elasticsearch-master-0\"</span> <span class=\"comment\"># 根据副本数和name配置</span></span><br><span class=\"line\"><span class=\"attr\">            - name:</span> <span class=\"string\">discovery.zen.ping_timeout</span></span><br><span class=\"line\"><span class=\"attr\">              value:</span> <span class=\"string\">\"5s\"</span></span><br><span class=\"line\"><span class=\"attr\">            - name:</span> <span class=\"string\">node.ingest</span></span><br><span class=\"line\"><span class=\"attr\">              value:</span> <span class=\"string\">\"false\"</span></span><br><span class=\"line\"><span class=\"attr\">            - name:</span> <span class=\"string\">ES_JAVA_OPTS</span></span><br><span class=\"line\"><span class=\"attr\">              value:</span> <span class=\"string\">\"-Xms1g -Xmx1g\"</span></span><br><span class=\"line\"><span class=\"attr\">            - name:</span> <span class=\"string\">\"discovery.zen.ping.unicast.hosts\"</span></span><br><span class=\"line\"><span class=\"attr\">              value:</span> <span class=\"string\">\"elasticsearch-discovery\"</span> <span class=\"comment\"># Disvocery Service</span></span><br><span class=\"line\"><span class=\"attr\">            - name:</span> <span class=\"string\">\"http.cors.enabled\"</span></span><br><span class=\"line\"><span class=\"attr\">              value:</span> <span class=\"string\">\"true\"</span></span><br><span class=\"line\"><span class=\"attr\">            - name:</span> <span class=\"string\">\"http.cors.allow-origin\"</span></span><br><span class=\"line\"><span class=\"attr\">              value:</span> <span class=\"string\">\"*\"</span></span><br><span class=\"line\"><span class=\"attr\">          volumeMounts:</span></span><br><span class=\"line\"><span class=\"attr\">            - name:</span> <span class=\"string\">elasticsearch-data-volume</span></span><br><span class=\"line\"><span class=\"attr\">              mountPath:</span> <span class=\"string\">/usr/share/elasticsearch/data</span></span><br><span class=\"line\"><span class=\"attr\">      volumes:</span></span><br><span class=\"line\"><span class=\"attr\">        - name:</span> <span class=\"string\">elasticsearch-data-volume</span></span><br><span class=\"line\"><span class=\"attr\">          hostPath:</span></span><br><span class=\"line\"><span class=\"attr\">            path:</span> <span class=\"string\">/data/k8s-container/elk-7.2.0/es-7.2.0/data</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Service</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  labels:</span></span><br><span class=\"line\"><span class=\"attr\">    app:</span> <span class=\"string\">elasticsearch</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">elasticsearch-discovery</span></span><br><span class=\"line\"><span class=\"attr\">  namespace:</span> <span class=\"string\">ns-elastic7</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\">  publishNotReadyAddresses:</span> <span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"attr\">  ports:</span></span><br><span class=\"line\"><span class=\"attr\">  - name:</span> <span class=\"string\">transport</span></span><br><span class=\"line\"><span class=\"attr\">    port:</span> <span class=\"number\">9300</span></span><br><span class=\"line\"><span class=\"attr\">    targetPort:</span> <span class=\"number\">9300</span></span><br><span class=\"line\"><span class=\"attr\">  selector:</span></span><br><span class=\"line\"><span class=\"attr\">    app:</span> <span class=\"string\">elasticsearch</span></span><br><span class=\"line\"><span class=\"attr\">    role:</span> <span class=\"string\">master</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Service</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\"> labels:</span></span><br><span class=\"line\"><span class=\"attr\">   app:</span> <span class=\"string\">elasticsearch</span></span><br><span class=\"line\"><span class=\"attr\"> name:</span> <span class=\"string\">elasticsearch-service</span></span><br><span class=\"line\"><span class=\"attr\"> namespace:</span> <span class=\"string\">ns-elastic7</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\"> type:</span> <span class=\"string\">NodePort</span></span><br><span class=\"line\"><span class=\"attr\"> ports:</span></span><br><span class=\"line\"><span class=\"attr\">   - port:</span> <span class=\"number\">9200</span></span><br><span class=\"line\"><span class=\"attr\">     targetPort:</span> <span class=\"number\">9200</span></span><br><span class=\"line\"><span class=\"attr\">     nodePort:</span> <span class=\"number\">19230</span></span><br><span class=\"line\"><span class=\"attr\">     protocol:</span> <span class=\"string\">TCP</span></span><br><span class=\"line\"><span class=\"attr\"> selector:</span></span><br><span class=\"line\"><span class=\"attr\">   app:</span> <span class=\"string\">elasticsearch</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-es配置nfs动态挂载-k8s-es-7-2-0-nfs-yml\"><a href=\"#2-es配置nfs动态挂载-k8s-es-7-2-0-nfs-yml\" class=\"headerlink\" title=\"2. es配置nfs动态挂载 k8s-es-7.2.0-nfs.yml\"></a>2. es配置nfs动态挂载 k8s-es-7.2.0-nfs.yml</h3><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ServiceAccount</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\"> labels:</span></span><br><span class=\"line\"><span class=\"attr\">   app:</span> <span class=\"string\">elasticsearch</span></span><br><span class=\"line\"><span class=\"attr\"> name:</span> <span class=\"string\">elasticsearch-admin</span></span><br><span class=\"line\"><span class=\"attr\"> namespace:</span> <span class=\"string\">ns-elastic</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">rbac.authorization.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ClusterRoleBinding</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\"> name:</span> <span class=\"string\">elasticsearch-admin</span></span><br><span class=\"line\"><span class=\"attr\"> labels:</span></span><br><span class=\"line\"><span class=\"attr\">   app:</span> <span class=\"string\">elasticsearch</span></span><br><span class=\"line\"><span class=\"attr\">roleRef:</span></span><br><span class=\"line\"><span class=\"attr\"> apiGroup:</span> <span class=\"string\">rbac.authorization.k8s.io</span></span><br><span class=\"line\"><span class=\"attr\"> kind:</span> <span class=\"string\">ClusterRole</span></span><br><span class=\"line\"><span class=\"attr\"> name:</span> <span class=\"string\">cluster-admin</span></span><br><span class=\"line\"><span class=\"attr\">subjects:</span></span><br><span class=\"line\"><span class=\"attr\"> - kind:</span> <span class=\"string\">ServiceAccount</span></span><br><span class=\"line\"><span class=\"attr\">   name:</span> <span class=\"string\">elasticsearch-admin</span></span><br><span class=\"line\"><span class=\"attr\">   namespace:</span> <span class=\"string\">ns-elastic</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">StatefulSet</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  labels:</span></span><br><span class=\"line\"><span class=\"attr\">    app:</span> <span class=\"string\">elasticsearch</span></span><br><span class=\"line\"><span class=\"attr\">    role:</span> <span class=\"string\">master</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">elasticsearch-master</span></span><br><span class=\"line\"><span class=\"attr\">  namespace:</span> <span class=\"string\">ns-elastic</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\">  replicas:</span> <span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"attr\">  volumeClaimTemplates:</span></span><br><span class=\"line\"><span class=\"attr\">  - metadata:</span></span><br><span class=\"line\"><span class=\"attr\">      name:</span> <span class=\"string\">elasticsearch-data-nfs</span></span><br><span class=\"line\"><span class=\"attr\">      annotations:</span></span><br><span class=\"line\">        <span class=\"string\">volume.beta.kubernetes.io/storage-class:</span> <span class=\"string\">\"nfs\"</span></span><br><span class=\"line\"><span class=\"attr\">    spec:</span></span><br><span class=\"line\"><span class=\"attr\">      accessModes:</span> <span class=\"string\">[</span> <span class=\"string\">\"ReadWriteOnce\"</span> <span class=\"string\">]</span></span><br><span class=\"line\"><span class=\"attr\">      resources:</span></span><br><span class=\"line\"><span class=\"attr\">        requests:</span></span><br><span class=\"line\"><span class=\"attr\">          storage:</span> <span class=\"number\">2</span><span class=\"string\">Gi</span></span><br><span class=\"line\"><span class=\"attr\">  serviceName:</span> <span class=\"string\">elasticsearch-master</span></span><br><span class=\"line\"><span class=\"attr\">  selector:</span></span><br><span class=\"line\"><span class=\"attr\">    matchLabels:</span></span><br><span class=\"line\"><span class=\"attr\">      app:</span> <span class=\"string\">elasticsearch</span></span><br><span class=\"line\"><span class=\"attr\">      role:</span> <span class=\"string\">master</span></span><br><span class=\"line\"><span class=\"attr\">  template:</span></span><br><span class=\"line\"><span class=\"attr\">    metadata:</span></span><br><span class=\"line\"><span class=\"attr\">      labels:</span></span><br><span class=\"line\"><span class=\"attr\">        app:</span> <span class=\"string\">elasticsearch</span></span><br><span class=\"line\"><span class=\"attr\">        role:</span> <span class=\"string\">master</span></span><br><span class=\"line\"><span class=\"attr\">    spec:</span></span><br><span class=\"line\"><span class=\"attr\">      serviceAccountName:</span> <span class=\"string\">elasticsearch-admin</span></span><br><span class=\"line\"><span class=\"attr\">      restartPolicy:</span> <span class=\"string\">Always</span></span><br><span class=\"line\"><span class=\"attr\">      securityContext:</span></span><br><span class=\"line\"><span class=\"attr\">        fsGroup:</span> <span class=\"number\">1000</span></span><br><span class=\"line\"><span class=\"attr\">      containers:</span></span><br><span class=\"line\"><span class=\"attr\">        - name:</span> <span class=\"string\">elasticsearch-master</span></span><br><span class=\"line\"><span class=\"attr\">          image:</span> <span class=\"attr\">elasticsearch:7.2.0</span></span><br><span class=\"line\"><span class=\"attr\">          command:</span> <span class=\"string\">[\"bash\",</span> <span class=\"string\">\"-c\"</span><span class=\"string\">,</span> <span class=\"string\">\"ulimit -l unlimited &amp;&amp; sysctl -w vm.max_map_count=262144 &amp;&amp; chown -R elasticsearch:elasticsearch /usr/share/elasticsearch/data &amp;&amp; exec su elasticsearch docker-entrypoint.sh\"</span><span class=\"string\">]</span></span><br><span class=\"line\"><span class=\"attr\">          imagePullPolicy:</span> <span class=\"string\">IfNotPresent</span></span><br><span class=\"line\"><span class=\"attr\">          volumeMounts:</span></span><br><span class=\"line\"><span class=\"attr\">          - name:</span> <span class=\"string\">elasticsearch-data-nfs</span></span><br><span class=\"line\"><span class=\"attr\">            mountPath:</span> <span class=\"string\">/usr/share/elasticsearch/data</span></span><br><span class=\"line\"><span class=\"attr\">          securityContext:</span></span><br><span class=\"line\"><span class=\"attr\">            privileged:</span> <span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"attr\">          ports:</span></span><br><span class=\"line\"><span class=\"attr\">            - containerPort:</span> <span class=\"number\">9200</span></span><br><span class=\"line\"><span class=\"attr\">              protocol:</span> <span class=\"string\">TCP</span></span><br><span class=\"line\"><span class=\"attr\">            - containerPort:</span> <span class=\"number\">9300</span></span><br><span class=\"line\"><span class=\"attr\">              protocol:</span> <span class=\"string\">TCP</span></span><br><span class=\"line\"><span class=\"attr\">          env:</span></span><br><span class=\"line\"><span class=\"attr\">            - name:</span> <span class=\"string\">cluster.name</span></span><br><span class=\"line\"><span class=\"attr\">              value:</span> <span class=\"string\">\"es_cluster\"</span></span><br><span class=\"line\"><span class=\"attr\">            - name:</span> <span class=\"string\">node.master</span></span><br><span class=\"line\"><span class=\"attr\">              value:</span> <span class=\"string\">\"true\"</span></span><br><span class=\"line\"><span class=\"attr\">            - name:</span> <span class=\"string\">node.data</span></span><br><span class=\"line\"><span class=\"attr\">              value:</span> <span class=\"string\">\"true\"</span></span><br><span class=\"line\"><span class=\"attr\">            - name:</span> <span class=\"string\">cluster.initial_master_nodes</span></span><br><span class=\"line\"><span class=\"attr\">              value:</span> <span class=\"string\">\"elasticsearch-master-0,elasticsearch-master-1\"</span> <span class=\"comment\"># 根据副本数和name配置</span></span><br><span class=\"line\"><span class=\"attr\">            - name:</span> <span class=\"string\">discovery.zen.ping_timeout</span></span><br><span class=\"line\"><span class=\"attr\">              value:</span> <span class=\"string\">\"5s\"</span></span><br><span class=\"line\"><span class=\"attr\">            - name:</span> <span class=\"string\">node.ingest</span></span><br><span class=\"line\"><span class=\"attr\">              value:</span> <span class=\"string\">\"false\"</span></span><br><span class=\"line\"><span class=\"attr\">            - name:</span> <span class=\"string\">ES_JAVA_OPTS</span></span><br><span class=\"line\"><span class=\"attr\">              value:</span> <span class=\"string\">\"-Xms1g -Xmx1g\"</span></span><br><span class=\"line\"><span class=\"attr\">            - name:</span> <span class=\"string\">\"discovery.zen.ping.unicast.hosts\"</span></span><br><span class=\"line\"><span class=\"attr\">              value:</span> <span class=\"string\">\"elasticsearch-discovery\"</span> <span class=\"comment\"># Disvocery Service</span></span><br><span class=\"line\"><span class=\"attr\">            - name:</span> <span class=\"string\">\"http.cors.enabled\"</span></span><br><span class=\"line\"><span class=\"attr\">              value:</span> <span class=\"string\">\"true\"</span></span><br><span class=\"line\"><span class=\"attr\">            - name:</span> <span class=\"string\">\"http.cors.allow-origin\"</span></span><br><span class=\"line\"><span class=\"attr\">              value:</span> <span class=\"string\">\"*\"</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Service</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  labels:</span></span><br><span class=\"line\"><span class=\"attr\">    app:</span> <span class=\"string\">elasticsearch</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">elasticsearch-discovery</span></span><br><span class=\"line\"><span class=\"attr\">  namespace:</span> <span class=\"string\">ns-elastic</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\">  publishNotReadyAddresses:</span> <span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"attr\">  ports:</span></span><br><span class=\"line\"><span class=\"attr\">  - name:</span> <span class=\"string\">transport</span></span><br><span class=\"line\"><span class=\"attr\">    port:</span> <span class=\"number\">9300</span></span><br><span class=\"line\"><span class=\"attr\">    targetPort:</span> <span class=\"number\">9300</span></span><br><span class=\"line\"><span class=\"attr\">  selector:</span></span><br><span class=\"line\"><span class=\"attr\">    app:</span> <span class=\"string\">elasticsearch</span></span><br><span class=\"line\"><span class=\"attr\">    role:</span> <span class=\"string\">master</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Service</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\"> labels:</span></span><br><span class=\"line\"><span class=\"attr\">   app:</span> <span class=\"string\">elasticsearch</span></span><br><span class=\"line\"><span class=\"attr\"> name:</span> <span class=\"string\">elasticsearch-service</span></span><br><span class=\"line\"><span class=\"attr\"> namespace:</span> <span class=\"string\">ns-elastic</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\"> type:</span> <span class=\"string\">NodePort</span></span><br><span class=\"line\"><span class=\"attr\"> ports:</span></span><br><span class=\"line\"><span class=\"attr\">   - port:</span> <span class=\"number\">9200</span></span><br><span class=\"line\"><span class=\"attr\">     targetPort:</span> <span class=\"number\">9200</span></span><br><span class=\"line\"><span class=\"attr\">     nodePort:</span> <span class=\"number\">19220</span></span><br><span class=\"line\"><span class=\"attr\">     protocol:</span> <span class=\"string\">TCP</span></span><br><span class=\"line\"><span class=\"attr\"> selector:</span></span><br><span class=\"line\"><span class=\"attr\">   app:</span> <span class=\"string\">elasticsearch</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-kibana配置k8s-kibana-7-2-0-yml\"><a href=\"#3-kibana配置k8s-kibana-7-2-0-yml\" class=\"headerlink\" title=\"3. kibana配置k8s-kibana-7.2.0.yml\"></a>3. kibana配置k8s-kibana-7.2.0.yml</h3><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ConfigMap</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">kibana-config</span></span><br><span class=\"line\"><span class=\"attr\">  namespace:</span> <span class=\"string\">ns-elastic7</span></span><br><span class=\"line\"><span class=\"attr\">  labels:</span></span><br><span class=\"line\"><span class=\"attr\">    elastic-app:</span> <span class=\"string\">kibana</span></span><br><span class=\"line\"><span class=\"attr\">data:</span></span><br><span class=\"line\">  <span class=\"string\">kibana.yml:</span> <span class=\"string\">|</span></span><br><span class=\"line\"><span class=\"string\">    server.name: kibana</span></span><br><span class=\"line\"><span class=\"string\">    server.host: \"0\"</span></span><br><span class=\"line\"><span class=\"string\">    elasticsearch.hosts: [ \"http://elasticsearch-service:9200\" ]</span></span><br><span class=\"line\"><span class=\"string\">    xpack.monitoring.ui.container.elasticsearch.enabled: true</span></span><br><span class=\"line\"><span class=\"string\">---</span></span><br><span class=\"line\"><span class=\"string\"></span><span class=\"attr\">kind:</span> <span class=\"string\">Deployment</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1beta2</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  labels:</span></span><br><span class=\"line\"><span class=\"attr\">    elastic-app:</span> <span class=\"string\">kibana</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">kibana</span></span><br><span class=\"line\"><span class=\"attr\">  namespace:</span> <span class=\"string\">ns-elastic7</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\">  replicas:</span> <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"attr\">  revisionHistoryLimit:</span> <span class=\"number\">10</span></span><br><span class=\"line\"><span class=\"attr\">  selector:</span></span><br><span class=\"line\"><span class=\"attr\">    matchLabels:</span></span><br><span class=\"line\"><span class=\"attr\">      elastic-app:</span> <span class=\"string\">kibana</span></span><br><span class=\"line\"><span class=\"attr\">  template:</span></span><br><span class=\"line\"><span class=\"attr\">    metadata:</span></span><br><span class=\"line\"><span class=\"attr\">      labels:</span></span><br><span class=\"line\"><span class=\"attr\">        elastic-app:</span> <span class=\"string\">kibana</span></span><br><span class=\"line\"><span class=\"attr\">    spec:</span></span><br><span class=\"line\"><span class=\"attr\">      containers:</span></span><br><span class=\"line\"><span class=\"attr\">        - name:</span> <span class=\"string\">kibana</span></span><br><span class=\"line\"><span class=\"attr\">          image:</span> <span class=\"string\">hub.boqii.com/bq/kibana:7.2.0</span></span><br><span class=\"line\"><span class=\"attr\">          ports:</span></span><br><span class=\"line\"><span class=\"attr\">            - containerPort:</span> <span class=\"number\">5601</span></span><br><span class=\"line\"><span class=\"attr\">              protocol:</span> <span class=\"string\">TCP</span></span><br><span class=\"line\"><span class=\"attr\">          resources:</span></span><br><span class=\"line\"><span class=\"attr\">            requests:</span></span><br><span class=\"line\"><span class=\"attr\">              cpu:</span> <span class=\"string\">\"50m\"</span></span><br><span class=\"line\"><span class=\"attr\">            limits:</span></span><br><span class=\"line\"><span class=\"attr\">              cpu:</span> <span class=\"string\">\"800m\"</span></span><br><span class=\"line\"><span class=\"attr\">          volumeMounts:</span></span><br><span class=\"line\"><span class=\"attr\">            - name:</span> <span class=\"string\">kibana-config</span></span><br><span class=\"line\"><span class=\"attr\">              mountPath:</span> <span class=\"string\">/usr/share/kibana/config</span></span><br><span class=\"line\"><span class=\"attr\">      volumes:</span></span><br><span class=\"line\"><span class=\"attr\">        - name:</span> <span class=\"string\">kibana-config</span></span><br><span class=\"line\"><span class=\"attr\">          configMap:</span></span><br><span class=\"line\"><span class=\"attr\">            name:</span> <span class=\"string\">kibana-config</span></span><br><span class=\"line\"><span class=\"attr\">      tolerations:</span></span><br><span class=\"line\"><span class=\"attr\">        - key:</span> <span class=\"string\">node-role.kubernetes.io/master</span></span><br><span class=\"line\"><span class=\"attr\">          effect:</span> <span class=\"string\">NoSchedule</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Service</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  labels:</span></span><br><span class=\"line\"><span class=\"attr\">    elastic-app:</span> <span class=\"string\">kibana</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">kibana-service</span></span><br><span class=\"line\"><span class=\"attr\">  namespace:</span> <span class=\"string\">ns-elastic7</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\">  ports:</span></span><br><span class=\"line\"><span class=\"attr\">    - port:</span> <span class=\"number\">5601</span></span><br><span class=\"line\"><span class=\"attr\">      targetPort:</span> <span class=\"number\">5601</span></span><br><span class=\"line\"><span class=\"attr\">  selector:</span></span><br><span class=\"line\"><span class=\"attr\">    elastic-app:</span> <span class=\"string\">kibana</span></span><br><span class=\"line\"><span class=\"attr\">  type:</span> <span class=\"string\">NodePort</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">extensions/v1beta1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Ingress</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\"> labels:</span></span><br><span class=\"line\"><span class=\"attr\">   elastic-app:</span> <span class=\"string\">kibana</span></span><br><span class=\"line\"><span class=\"attr\"> name:</span> <span class=\"string\">kibana-ingress</span></span><br><span class=\"line\"><span class=\"attr\"> namespace:</span> <span class=\"string\">ns-elastic7</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\"> rules:</span></span><br><span class=\"line\"><span class=\"attr\">   - host:</span> <span class=\"string\">elk-kibana-dev.boqii.com</span></span><br><span class=\"line\"><span class=\"attr\">     http:</span></span><br><span class=\"line\"><span class=\"attr\">       paths:</span></span><br><span class=\"line\"><span class=\"attr\">         - backend:</span></span><br><span class=\"line\"><span class=\"attr\">             serviceName:</span> <span class=\"string\">kibana-service</span></span><br><span class=\"line\"><span class=\"attr\">             servicePort:</span> <span class=\"number\">5601</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4-logstash配置-本地挂载-k8s-logstash-7-2-0-yml\"><a href=\"#4-logstash配置-本地挂载-k8s-logstash-7-2-0-yml\" class=\"headerlink\" title=\"4. logstash配置 本地挂载 k8s-logstash-7.2.0.yml\"></a>4. logstash配置 本地挂载 k8s-logstash-7.2.0.yml</h3><ul>\n<li><p>4.1 config/pipelines.yml</p>\n<figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- pipeline<span class=\"selector-class\">.id</span>: main</span><br><span class=\"line\">  path<span class=\"selector-class\">.config</span>: <span class=\"string\">\"/usr/share/logstash/config/pipeline/*.conf\"</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>4.2 首先配置grok规则 config/pipeline/logstash.conf</p>\n<figure class=\"highlight lsl\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">input &#123;</span><br><span class=\"line\">    udp &#123;</span><br><span class=\"line\">        port =&gt; <span class=\"string\">\"10000\"</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"> filter &#123;</span><br><span class=\"line\">      grok &#123;</span><br><span class=\"line\">          match =&gt; &#123;</span><br><span class=\"line\">            <span class=\"string\">\"message\"</span> =&gt; <span class=\"string\">\"\\&#123;<span class=\"subst\">\\\"</span>id<span class=\"subst\">\\\"</span>:<span class=\"subst\">\\\"</span>(?&lt;id&gt;(.)*)<span class=\"subst\">\\\"</span>,<span class=\"subst\">\\\"</span>tag<span class=\"subst\">\\\"</span>:<span class=\"subst\">\\\"</span>(?&lt;tag&gt;(.)*)<span class=\"subst\">\\\"</span>,<span class=\"subst\">\\\"</span>title<span class=\"subst\">\\\"</span>:<span class=\"subst\">\\\"</span>%&#123;GREEDYDATA:title&#125;(?&lt;title&gt;(.|\\r|<span class=\"subst\">\\n</span>)*)<span class=\"subst\">\\\"</span>,<span class=\"subst\">\\\"</span>value<span class=\"subst\">\\\"</span>:<span class=\"subst\">\\\"</span>%&#123;GREEDYDATA:value&#125;(?&lt;value&gt;(.|\\r|<span class=\"subst\">\\n</span>)*)<span class=\"subst\">\\\"</span>,<span class=\"subst\">\\\"</span>createdAt<span class=\"subst\">\\\"</span>:<span class=\"subst\">\\\"</span>(?&lt;createdAt&gt;\\S+ \\S+)<span class=\"subst\">\\\"</span>,<span class=\"subst\">\\\"</span>Telephone<span class=\"subst\">\\\"</span>:<span class=\"subst\">\\\"</span>(?&lt;Telephone&gt;(.)*)<span class=\"subst\">\\\"</span>,<span class=\"subst\">\\\"</span>uid<span class=\"subst\">\\\"</span>:<span class=\"subst\">\\\"</span>(?&lt;uid&gt;(.)*)<span class=\"subst\">\\\"</span>,<span class=\"subst\">\\\"</span>updateTime<span class=\"subst\">\\\"</span>:<span class=\"subst\">\\\"</span>(?&lt;updateTime&gt;(.)*)<span class=\"subst\">\\\"</span>,<span class=\"subst\">\\\"</span>appVersion<span class=\"subst\">\\\"</span>:<span class=\"subst\">\\\"</span>(?&lt;appVersion&gt;(.)*)<span class=\"subst\">\\\"</span>,<span class=\"subst\">\\\"</span>mobileModel<span class=\"subst\">\\\"</span>:<span class=\"subst\">\\\"</span>(?&lt;mobileModel&gt;(.)*)<span class=\"subst\">\\\"</span>,<span class=\"subst\">\\\"</span>osVersion<span class=\"subst\">\\\"</span>:<span class=\"subst\">\\\"</span>(?&lt;osVersion&gt;(.)*)<span class=\"subst\">\\\"</span>,<span class=\"subst\">\\\"</span>channel<span class=\"subst\">\\\"</span>:<span class=\"subst\">\\\"</span>(?&lt;channel&gt;(.)*)<span class=\"subst\">\\\"</span>,<span class=\"subst\">\\\"</span>UDID<span class=\"subst\">\\\"</span>:<span class=\"subst\">\\\"</span>(?&lt;UDID&gt;(.)*)<span class=\"subst\">\\\"</span>\\&#125;\"</span></span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">output &#123;</span><br><span class=\"line\">    elasticsearch &#123;</span><br><span class=\"line\">        hosts =&gt;  [ <span class=\"string\">\"http://elasticsearch-service:9200\"</span> ]</span><br><span class=\"line\">        index =&gt; <span class=\"string\">\"k8s2-dev-%&#123;+YYYY.MM.dd&#125;\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>4.3 配置文件 k8s-logstash-7.2.0.yml</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Deployment</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1beta2</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  labels:</span></span><br><span class=\"line\"><span class=\"attr\">    elastic-app:</span> <span class=\"string\">logstash</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">logstash</span></span><br><span class=\"line\"><span class=\"attr\">  namespace:</span> <span class=\"string\">ns-elastic</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\">  replicas:</span> <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"attr\">  revisionHistoryLimit:</span> <span class=\"number\">10</span></span><br><span class=\"line\"><span class=\"attr\">  selector:</span></span><br><span class=\"line\"><span class=\"attr\">    matchLabels:</span></span><br><span class=\"line\"><span class=\"attr\">      elastic-app:</span> <span class=\"string\">logstash</span></span><br><span class=\"line\"><span class=\"attr\">  template:</span></span><br><span class=\"line\"><span class=\"attr\">    metadata:</span></span><br><span class=\"line\"><span class=\"attr\">      labels:</span></span><br><span class=\"line\"><span class=\"attr\">        elastic-app:</span> <span class=\"string\">logstash</span></span><br><span class=\"line\"><span class=\"attr\">    spec:</span></span><br><span class=\"line\"><span class=\"attr\">      containers:</span></span><br><span class=\"line\"><span class=\"attr\">        - name:</span> <span class=\"string\">logstash</span></span><br><span class=\"line\"><span class=\"attr\">          image:</span> <span class=\"string\">hub.boqii.com/bq/logstash:7.2.0</span></span><br><span class=\"line\"><span class=\"attr\">          ports:</span></span><br><span class=\"line\"><span class=\"attr\">            - containerPort:</span> <span class=\"number\">10000</span></span><br><span class=\"line\"><span class=\"attr\">              protocol:</span> <span class=\"string\">UDP</span></span><br><span class=\"line\"><span class=\"attr\">          volumeMounts:</span></span><br><span class=\"line\"><span class=\"attr\">            - name:</span> <span class=\"string\">logstash-config</span></span><br><span class=\"line\"><span class=\"attr\">              mountPath:</span> <span class=\"string\">/usr/share/logstash/config</span></span><br><span class=\"line\"><span class=\"attr\">      volumes:</span></span><br><span class=\"line\"><span class=\"attr\">        - name:</span> <span class=\"string\">logstash-config</span></span><br><span class=\"line\"><span class=\"attr\">          hostPath:</span></span><br><span class=\"line\"><span class=\"attr\">            path:</span> <span class=\"string\">/data/k8s-pod/elk-7.2.0/logstash-7.2.0/config</span></span><br><span class=\"line\"><span class=\"attr\">      tolerations:</span></span><br><span class=\"line\"><span class=\"attr\">        - key:</span> <span class=\"string\">node-role.kubernetes.io/master</span></span><br><span class=\"line\"><span class=\"attr\">          effect:</span> <span class=\"string\">NoSchedule</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Service</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  labels:</span></span><br><span class=\"line\"><span class=\"attr\">    elastic-app:</span> <span class=\"string\">logstash</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">logstash-service</span></span><br><span class=\"line\"><span class=\"attr\">  namespace:</span> <span class=\"string\">ns-elastic</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\">  type:</span> <span class=\"string\">NodePort</span></span><br><span class=\"line\"><span class=\"attr\">  ports:</span></span><br><span class=\"line\"><span class=\"attr\">    - port:</span> <span class=\"number\">10000</span></span><br><span class=\"line\"><span class=\"attr\">      targetPort:</span> <span class=\"number\">10000</span></span><br><span class=\"line\"><span class=\"attr\">      nodePort:</span> <span class=\"number\">10000</span></span><br><span class=\"line\"><span class=\"attr\">      protocol:</span> <span class=\"string\">UDP</span></span><br><span class=\"line\"><span class=\"attr\">  selector:</span></span><br><span class=\"line\"><span class=\"attr\">    elastic-app:</span> <span class=\"string\">logstash</span></span><br><span class=\"line\"><span class=\"attr\">  type:</span> <span class=\"string\">NodePort</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br></pre></td></tr></table></figure>\n\n</li>\n</ul>\n"},{"title":"k8s部署storageclass动态创建pv(nfs&rbd)","copyright":true,"date":"2019-09-26T06:12:49.000Z","_content":"\n考虑到k8s存储的问题, 本机目录挂载存在太大局限性, 多node多pod的服务存储急迫需要共享存储, 这里简单应用k8s storageclass nfs和rbd存储\n<!-- more -->\n\n# 第一部分 nfs\n\n### 这里单节点简单配置nfs(高并发可采用nfs+rsync+inotify或Sersync)\n\n> 高并发参考\n\n[NFS高可用(NFS+keepalive+Sersync)](https://cloud.tencent.com/developer/article/1445884)\n[inotify+rsync实时备份总结](https://blog.51cto.com/lzhnb/2088224)\n\n\n```\n#安装nfs\nyum install -y nfs-utils rpcbind\n\n# 创建目录\nmkdir /data/nfs\necho \"/data/nfs 172.16.76.0/24(rw,sync,no_root_squash) \" >>/etc/exports\n\n# 启动服务\nsystemctl start rpcbind\nsystemctl start nfs\n```\n\n### k8s部署storageclass环境-nfs\n#### 导入外部配置\n```\ngit clone https://github.com/kubernetes-incubator/external-storage.git\ncd external-storage/nfs-client/deploy\n\n#注意\n1  node节点需要安装nfs-utils(centos7),nfs-common(ubuntu)\n```\n\n\n#### 修改deployment.yaml\n```\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: nfs-client-provisioner\n---\nkind: Deployment\napiVersion: extensions/v1beta1\nmetadata:\n  name: nfs-client-provisioner\nspec:\n  replicas: 1\n  strategy:\n    type: Recreate\n  template:\n    metadata:\n      labels:\n        app: nfs-client-provisioner\n    spec:\n      serviceAccountName: nfs-client-provisioner\n      containers:\n        - name: nfs-client-provisioner\n          image: quay.io/external_storage/nfs-client-provisioner:latest\n          volumeMounts:\n            - name: nfs-client-root\n              mountPath: /persistentvolumes\n          env:\n            - name: PROVISIONER_NAME\n              value: nfs.com/nfs\n            - name: NFS_SERVER\n              value: 172.16.76.134\n            - name: NFS_PATH\n              value: /data/nfs\n      volumes:\n        - name: nfs-client-root\n          nfs:\n            server: 172.16.76.134\n            path: /data/nfs\n```\n\n#### 修改class.yaml\n```\napiVersion: storage.k8s.io/v1\nkind: StorageClass\nmetadata:\n  name: nfs\nprovisioner: nfs.com/nfs\nparameters:\n  archiveOnDelete: \"false\"\n```\n\n#### rbac.yaml不用修改\n```\nrbac.yaml\nkind: ServiceAccount\napiVersion: v1\nmetadata:\n  name: nfs-client-provisioner\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  name: nfs-client-provisioner-runner\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"persistentvolumes\"]\n    verbs: [\"get\", \"list\", \"watch\", \"create\", \"delete\"]\n  - apiGroups: [\"\"]\n    resources: [\"persistentvolumeclaims\"]\n    verbs: [\"get\", \"list\", \"watch\", \"update\"]\n  - apiGroups: [\"storage.k8s.io\"]\n    resources: [\"storageclasses\"]\n    verbs: [\"get\", \"list\", \"watch\"]\n  - apiGroups: [\"\"]\n    resources: [\"events\"]\n    verbs: [\"create\", \"update\", \"patch\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  name: run-nfs-client-provisioner\nsubjects:\n  - kind: ServiceAccount\n    name: nfs-client-provisioner\n    namespace: default\nroleRef:\n  kind: ClusterRole\n  name: nfs-client-provisioner-runner\n  apiGroup: rbac.authorization.k8s.io\n---\nkind: Role\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  name: leader-locking-nfs-client-provisioner\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"endpoints\"]\n    verbs: [\"get\", \"list\", \"watch\", \"create\", \"update\", \"patch\"]\n---\nkind: RoleBinding\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  name: leader-locking-nfs-client-provisioner\nsubjects:\n  - kind: ServiceAccount\n    name: nfs-client-provisioner\n    # replace with namespace where provisioner is deployed\n    namespace: default\nroleRef:\n  kind: Role\n  name: leader-locking-nfs-client-provisioner\n  apiGroup: rbac.authorization.k8s.io\n```\n\n#### 部署nfs环境(创建nfs存储类)\n```\nkubectl apply -f rbac.yaml -f class.yaml -f deployment.yaml\n```\n\n\n---\n\n### k8s中部署nginx项目采用nfs存储\n#### 部署nginx-deployment-nfs.yaml(测试nfs)\n> 这种方式会创建一个pvc 挂载到多个pod中,这种方式适合nginx-html挂载\n\n```\n---\nkind: PersistentVolumeClaim\napiVersion: v1\nmetadata:\n  name: html0-deploy-nfs\n  annotations:\n    volume.beta.kubernetes.io/storage-class: 'nfs'\nspec:\n  accessModes:\n    - ReadWriteMany\n  resources:\n    requests:\n      storage: 1Gi\n---\napiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: nginx0-deploy\nspec:\n  replicas: 2\n  template:\n    metadata:\n      labels:\n        app: nginx0-deploy\n    spec:\n      containers:\n      - name: nginx0-deploy\n        image: hub.boqii.com/bq/nginx:1.15.12\n        ports:\n        - containerPort: 80\n        volumeMounts:\n        - name: html0-deploy-nfs\n          mountPath: /usr/share/nginx/html\n        - name: nginx-config\n          mountPath: \"/etc/nginx/conf.d\"\n      volumes:\n      - name: nginx-config\n        configMap:\n            name: nginx-config\n      - name: html0-deploy-nfs\n        persistentVolumeClaim:\n          claimName: html0-deploy-nfs\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: nginx-config\ndata:\n  default.conf: |\n            server {\n              listen       80;\n              server_name  localhost;\n              root   /usr/share/nginx/html/;\n              access_log  /var/log/nginx/host_access.log;\n              error_log  /var/log/nginx/host_error.log debug;\n              location / {\n                  root   /usr/share/nginx/html/;\n                  index  index.html index.htm index.php;\n              }\n              error_page   500 502 503 504  /50x.html;\n\n              location = /50x.html {\n                  root   /usr/share/nginx/html;\n              }\n              }\n```\n\n\n#### 部署nginx-statefulset-nfs.yaml(测试nfs)\n> 这里statefulset 方式会创建多个pvc, 每个pod的html就可以都不一样!\n\n```\n---\napiVersion: apps/v1beta1\nkind: StatefulSet\nmetadata:\n  name: nginx3\nspec:\n  serviceName: \"nginx\"\n  replicas: 2\n  volumeClaimTemplates:\n  - metadata:\n      name: html\n      annotations:\n        volume.beta.kubernetes.io/storage-class: \"nfs\" # 这里配置 上面创建的 storageclass 的名称\n    spec:\n      accessModes: [ \"ReadWriteOnce\" ]\n      resources:\n        requests:\n          storage: 2Gi\n  template:\n    metadata:\n      labels:\n        app: nginx\n    spec:\n      containers:\n      - name: nginx\n        image: hub.boqii.com/bq/nginx:1.15.12\n        volumeMounts:\n        - mountPath: \"/usr/share/nginx/html/\"\n          name: html\n        - mountPath: \"/etc/nginx/conf.d\"\n          name: nginx-config\n      volumes:\n      - name: nginx-config\n        configMap:\n            name: nginx-config\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: nginx-config\ndata:\n  default.conf: |\n            server {\n              listen       80;\n              server_name  localhost;\n              root   /usr/share/nginx/html/;\n              access_log  /var/log/nginx/host_access.log;\n              error_log  /var/log/nginx/host_error.log debug;\n              location / {\n                  root   /usr/share/nginx/html/;\n                  index  index.html index.htm index.php;\n              }\n              error_page   500 502 503 504  /50x.html;\n\n              location = /50x.html {\n                  root   /usr/share/nginx/html;\n              }\n              }\n```\n\n---\n### 另外说明一下将nfs作为文件存储类似mount方式,这种方式不适用于多容器自动化部署 ,显然这种并不适合ceph rbd存储, cephfs是可以的\n\n#### 首先需要在nfs目录创建需要挂载的目录\n```\n#例如\nmkdir -p /data/nfs/k8s-db-t/mysql-data-dev\n```\n\n#### 在部署的yml中直接mount nfs的目录\n```\napiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: mysql-server\n  namespace: devops\nspec:\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        app: mysql-server\n    spec:\n      containers:\n      - image: mysql:5.7.16\n        imagePullPolicy: Always\n        name: mysql-server\n        ports:\n        - containerPort: 3306\n          protocol: TCP\n        volumeMounts:\n          - name: mysql-data\n            mountPath: /var/lib/mysql\n        resources:\n          requests:\n            cpu: 40m\n            memory: 32Mi\n          limits:\n            cpu: \"300m\"\n            memory: 256Mi\n        env:\n        - name: MYSQL_ROOT_PASSWORD\n          value: \"boqii.123\"\n        - name: MYSQL_DATABASE\n          value: \"gogs\"\n        - name: MYSQL_USER\n          value: \"gogs\"\n        - name: MYSQL_PASSWORD\n          value: \"gogspass\"\n        - name: TZ\n          value: \"Asia/Shanghai\"\n      volumes:\n        - name: mysql-data\n          nfs:\n            server: 172.16.76.134\n            path: /data/nfs/k8s-db-t/mysql-data-dev\n\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: mysql-service\n  namespace: devops\nspec:\n  clusterIP: None\n  selector:\n    app: mysql-server\n  ports:\n  - name: http\n    port: 3306\n```\n\n---\n# 第二部分 ceph\n### k8s部署storageclass环境-ceph\n\n#### 如果集群是用kubeadm部署的，由于controller-manager官方镜像中没有rbd命令，所以我们要导入外部配置\n```\ngit clone https://github.com/kubernetes-incubator/external-storage.git\ncd external-storage/ceph/rbd/deploy\n```\n\n> 以下整合在一个文件, 两个版本,默认 和retain\n \n#### storageclass-cepm.com-rbd.yaml\n```\n---\napiVersion: v1\ndata:\n  key: QVFEYzJRbGQ1VjI5THhBQU00WUtPUU5sUVJqdWtLSWJ2VDZ0a3c9PQ==\nkind: Secret\nmetadata:\n  name: ceph-secret-admin\ntype: kubernetes.io/rbd\n---\napiVersion: v1\ndata:\n  key: QVFEYzJRbGQ1VjI5THhBQU00WUtPUU5sUVJqdWtLSWJ2VDZ0a3c9PQ==\nkind: Secret\nmetadata:\n  name: ceph-secret-admin\n  namespace: ns-elastic\ntype: kubernetes.io/rbd\n---\napiVersion: storage.k8s.io/v1\nkind: StorageClass\nmetadata:\n  name: rbd\n  annotations:\n    storageclass.kubernetes.io/is-default-class: \"true\"\nprovisioner: ceph.com/rbd\nparameters:\n  monitors: 172.16.76.134:6789\n  adminId: admin\n  adminSecretName: ceph-secret-admin\n  adminSecretNamespace: default\n  pool: storageclass-rbd\n  userId: admin\n  userSecretName: ceph-secret-admin\n  fsType: ext4\n  imageFormat: \"2\"\n  imageFeatures: \"layering\"\n```\n\n#### storageclass-cepm.com-rbd-retain.yaml\n```\n---\napiVersion: v1\ndata:\n  key: QVFEYzJRbGQ1VjI5THhBQU00WUtPUU5sUVJqdWtLSWJ2VDZ0a3c9PQ==\nkind: Secret\nmetadata:\n  name: ceph-secret-admin\ntype: kubernetes.io/rbd\n---\napiVersion: v1\ndata:\n  key: QVFEYzJRbGQ1VjI5THhBQU00WUtPUU5sUVJqdWtLSWJ2VDZ0a3c9PQ==\nkind: Secret\nmetadata:\n  name: ceph-secret-admin\n  namespace: ns-elastic\ntype: kubernetes.io/rbd\n---\napiVersion: storage.k8s.io/v1\nkind: StorageClass\nmetadata:\n  name: rbd-retain\n  annotations:\n    storageclass.kubernetes.io/is-default-class: \"false\"\nprovisioner: ceph.com/rbd\nreclaimPolicy: Retain\nparameters:\n  monitors: 172.16.76.134:6789\n  adminId: admin\n  adminSecretName: ceph-secret-admin\n  adminSecretNamespace: default\n  pool: storageclass-rbd-retain\n  userId: admin\n  userSecretName: ceph-secret-admin\n  fsType: ext4\n  imageFormat: \"2\"\n  imageFeatures: \"layering\"\n```\n\n#### k8s中部署nginx项目采用 ceph.com/rbd 和nfs类似, 这里省略 \n\n> 以上采用的是persistentVolumeClaim 方式动态分配全部内容\n","source":"_posts/7-k8s部署storageclass动态创建pv-nfs-rbd.md","raw":"---\ntitle: k8s部署storageclass动态创建pv(nfs&rbd)\ncopyright: true\ndate: 2019-09-26 14:12:49\ntags:\n  - ceph\n  - nfs\n  - k8s\n  - k8s存储\n  - storageclass\ncategories:\n  - [k8s,storageclass]\n  - [存储,nfs]\n  - [存储,ceph]\n  - [技术文档]\n---\n\n考虑到k8s存储的问题, 本机目录挂载存在太大局限性, 多node多pod的服务存储急迫需要共享存储, 这里简单应用k8s storageclass nfs和rbd存储\n<!-- more -->\n\n# 第一部分 nfs\n\n### 这里单节点简单配置nfs(高并发可采用nfs+rsync+inotify或Sersync)\n\n> 高并发参考\n\n[NFS高可用(NFS+keepalive+Sersync)](https://cloud.tencent.com/developer/article/1445884)\n[inotify+rsync实时备份总结](https://blog.51cto.com/lzhnb/2088224)\n\n\n```\n#安装nfs\nyum install -y nfs-utils rpcbind\n\n# 创建目录\nmkdir /data/nfs\necho \"/data/nfs 172.16.76.0/24(rw,sync,no_root_squash) \" >>/etc/exports\n\n# 启动服务\nsystemctl start rpcbind\nsystemctl start nfs\n```\n\n### k8s部署storageclass环境-nfs\n#### 导入外部配置\n```\ngit clone https://github.com/kubernetes-incubator/external-storage.git\ncd external-storage/nfs-client/deploy\n\n#注意\n1  node节点需要安装nfs-utils(centos7),nfs-common(ubuntu)\n```\n\n\n#### 修改deployment.yaml\n```\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: nfs-client-provisioner\n---\nkind: Deployment\napiVersion: extensions/v1beta1\nmetadata:\n  name: nfs-client-provisioner\nspec:\n  replicas: 1\n  strategy:\n    type: Recreate\n  template:\n    metadata:\n      labels:\n        app: nfs-client-provisioner\n    spec:\n      serviceAccountName: nfs-client-provisioner\n      containers:\n        - name: nfs-client-provisioner\n          image: quay.io/external_storage/nfs-client-provisioner:latest\n          volumeMounts:\n            - name: nfs-client-root\n              mountPath: /persistentvolumes\n          env:\n            - name: PROVISIONER_NAME\n              value: nfs.com/nfs\n            - name: NFS_SERVER\n              value: 172.16.76.134\n            - name: NFS_PATH\n              value: /data/nfs\n      volumes:\n        - name: nfs-client-root\n          nfs:\n            server: 172.16.76.134\n            path: /data/nfs\n```\n\n#### 修改class.yaml\n```\napiVersion: storage.k8s.io/v1\nkind: StorageClass\nmetadata:\n  name: nfs\nprovisioner: nfs.com/nfs\nparameters:\n  archiveOnDelete: \"false\"\n```\n\n#### rbac.yaml不用修改\n```\nrbac.yaml\nkind: ServiceAccount\napiVersion: v1\nmetadata:\n  name: nfs-client-provisioner\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  name: nfs-client-provisioner-runner\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"persistentvolumes\"]\n    verbs: [\"get\", \"list\", \"watch\", \"create\", \"delete\"]\n  - apiGroups: [\"\"]\n    resources: [\"persistentvolumeclaims\"]\n    verbs: [\"get\", \"list\", \"watch\", \"update\"]\n  - apiGroups: [\"storage.k8s.io\"]\n    resources: [\"storageclasses\"]\n    verbs: [\"get\", \"list\", \"watch\"]\n  - apiGroups: [\"\"]\n    resources: [\"events\"]\n    verbs: [\"create\", \"update\", \"patch\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  name: run-nfs-client-provisioner\nsubjects:\n  - kind: ServiceAccount\n    name: nfs-client-provisioner\n    namespace: default\nroleRef:\n  kind: ClusterRole\n  name: nfs-client-provisioner-runner\n  apiGroup: rbac.authorization.k8s.io\n---\nkind: Role\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  name: leader-locking-nfs-client-provisioner\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"endpoints\"]\n    verbs: [\"get\", \"list\", \"watch\", \"create\", \"update\", \"patch\"]\n---\nkind: RoleBinding\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  name: leader-locking-nfs-client-provisioner\nsubjects:\n  - kind: ServiceAccount\n    name: nfs-client-provisioner\n    # replace with namespace where provisioner is deployed\n    namespace: default\nroleRef:\n  kind: Role\n  name: leader-locking-nfs-client-provisioner\n  apiGroup: rbac.authorization.k8s.io\n```\n\n#### 部署nfs环境(创建nfs存储类)\n```\nkubectl apply -f rbac.yaml -f class.yaml -f deployment.yaml\n```\n\n\n---\n\n### k8s中部署nginx项目采用nfs存储\n#### 部署nginx-deployment-nfs.yaml(测试nfs)\n> 这种方式会创建一个pvc 挂载到多个pod中,这种方式适合nginx-html挂载\n\n```\n---\nkind: PersistentVolumeClaim\napiVersion: v1\nmetadata:\n  name: html0-deploy-nfs\n  annotations:\n    volume.beta.kubernetes.io/storage-class: 'nfs'\nspec:\n  accessModes:\n    - ReadWriteMany\n  resources:\n    requests:\n      storage: 1Gi\n---\napiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: nginx0-deploy\nspec:\n  replicas: 2\n  template:\n    metadata:\n      labels:\n        app: nginx0-deploy\n    spec:\n      containers:\n      - name: nginx0-deploy\n        image: hub.boqii.com/bq/nginx:1.15.12\n        ports:\n        - containerPort: 80\n        volumeMounts:\n        - name: html0-deploy-nfs\n          mountPath: /usr/share/nginx/html\n        - name: nginx-config\n          mountPath: \"/etc/nginx/conf.d\"\n      volumes:\n      - name: nginx-config\n        configMap:\n            name: nginx-config\n      - name: html0-deploy-nfs\n        persistentVolumeClaim:\n          claimName: html0-deploy-nfs\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: nginx-config\ndata:\n  default.conf: |\n            server {\n              listen       80;\n              server_name  localhost;\n              root   /usr/share/nginx/html/;\n              access_log  /var/log/nginx/host_access.log;\n              error_log  /var/log/nginx/host_error.log debug;\n              location / {\n                  root   /usr/share/nginx/html/;\n                  index  index.html index.htm index.php;\n              }\n              error_page   500 502 503 504  /50x.html;\n\n              location = /50x.html {\n                  root   /usr/share/nginx/html;\n              }\n              }\n```\n\n\n#### 部署nginx-statefulset-nfs.yaml(测试nfs)\n> 这里statefulset 方式会创建多个pvc, 每个pod的html就可以都不一样!\n\n```\n---\napiVersion: apps/v1beta1\nkind: StatefulSet\nmetadata:\n  name: nginx3\nspec:\n  serviceName: \"nginx\"\n  replicas: 2\n  volumeClaimTemplates:\n  - metadata:\n      name: html\n      annotations:\n        volume.beta.kubernetes.io/storage-class: \"nfs\" # 这里配置 上面创建的 storageclass 的名称\n    spec:\n      accessModes: [ \"ReadWriteOnce\" ]\n      resources:\n        requests:\n          storage: 2Gi\n  template:\n    metadata:\n      labels:\n        app: nginx\n    spec:\n      containers:\n      - name: nginx\n        image: hub.boqii.com/bq/nginx:1.15.12\n        volumeMounts:\n        - mountPath: \"/usr/share/nginx/html/\"\n          name: html\n        - mountPath: \"/etc/nginx/conf.d\"\n          name: nginx-config\n      volumes:\n      - name: nginx-config\n        configMap:\n            name: nginx-config\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: nginx-config\ndata:\n  default.conf: |\n            server {\n              listen       80;\n              server_name  localhost;\n              root   /usr/share/nginx/html/;\n              access_log  /var/log/nginx/host_access.log;\n              error_log  /var/log/nginx/host_error.log debug;\n              location / {\n                  root   /usr/share/nginx/html/;\n                  index  index.html index.htm index.php;\n              }\n              error_page   500 502 503 504  /50x.html;\n\n              location = /50x.html {\n                  root   /usr/share/nginx/html;\n              }\n              }\n```\n\n---\n### 另外说明一下将nfs作为文件存储类似mount方式,这种方式不适用于多容器自动化部署 ,显然这种并不适合ceph rbd存储, cephfs是可以的\n\n#### 首先需要在nfs目录创建需要挂载的目录\n```\n#例如\nmkdir -p /data/nfs/k8s-db-t/mysql-data-dev\n```\n\n#### 在部署的yml中直接mount nfs的目录\n```\napiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: mysql-server\n  namespace: devops\nspec:\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        app: mysql-server\n    spec:\n      containers:\n      - image: mysql:5.7.16\n        imagePullPolicy: Always\n        name: mysql-server\n        ports:\n        - containerPort: 3306\n          protocol: TCP\n        volumeMounts:\n          - name: mysql-data\n            mountPath: /var/lib/mysql\n        resources:\n          requests:\n            cpu: 40m\n            memory: 32Mi\n          limits:\n            cpu: \"300m\"\n            memory: 256Mi\n        env:\n        - name: MYSQL_ROOT_PASSWORD\n          value: \"boqii.123\"\n        - name: MYSQL_DATABASE\n          value: \"gogs\"\n        - name: MYSQL_USER\n          value: \"gogs\"\n        - name: MYSQL_PASSWORD\n          value: \"gogspass\"\n        - name: TZ\n          value: \"Asia/Shanghai\"\n      volumes:\n        - name: mysql-data\n          nfs:\n            server: 172.16.76.134\n            path: /data/nfs/k8s-db-t/mysql-data-dev\n\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: mysql-service\n  namespace: devops\nspec:\n  clusterIP: None\n  selector:\n    app: mysql-server\n  ports:\n  - name: http\n    port: 3306\n```\n\n---\n# 第二部分 ceph\n### k8s部署storageclass环境-ceph\n\n#### 如果集群是用kubeadm部署的，由于controller-manager官方镜像中没有rbd命令，所以我们要导入外部配置\n```\ngit clone https://github.com/kubernetes-incubator/external-storage.git\ncd external-storage/ceph/rbd/deploy\n```\n\n> 以下整合在一个文件, 两个版本,默认 和retain\n \n#### storageclass-cepm.com-rbd.yaml\n```\n---\napiVersion: v1\ndata:\n  key: QVFEYzJRbGQ1VjI5THhBQU00WUtPUU5sUVJqdWtLSWJ2VDZ0a3c9PQ==\nkind: Secret\nmetadata:\n  name: ceph-secret-admin\ntype: kubernetes.io/rbd\n---\napiVersion: v1\ndata:\n  key: QVFEYzJRbGQ1VjI5THhBQU00WUtPUU5sUVJqdWtLSWJ2VDZ0a3c9PQ==\nkind: Secret\nmetadata:\n  name: ceph-secret-admin\n  namespace: ns-elastic\ntype: kubernetes.io/rbd\n---\napiVersion: storage.k8s.io/v1\nkind: StorageClass\nmetadata:\n  name: rbd\n  annotations:\n    storageclass.kubernetes.io/is-default-class: \"true\"\nprovisioner: ceph.com/rbd\nparameters:\n  monitors: 172.16.76.134:6789\n  adminId: admin\n  adminSecretName: ceph-secret-admin\n  adminSecretNamespace: default\n  pool: storageclass-rbd\n  userId: admin\n  userSecretName: ceph-secret-admin\n  fsType: ext4\n  imageFormat: \"2\"\n  imageFeatures: \"layering\"\n```\n\n#### storageclass-cepm.com-rbd-retain.yaml\n```\n---\napiVersion: v1\ndata:\n  key: QVFEYzJRbGQ1VjI5THhBQU00WUtPUU5sUVJqdWtLSWJ2VDZ0a3c9PQ==\nkind: Secret\nmetadata:\n  name: ceph-secret-admin\ntype: kubernetes.io/rbd\n---\napiVersion: v1\ndata:\n  key: QVFEYzJRbGQ1VjI5THhBQU00WUtPUU5sUVJqdWtLSWJ2VDZ0a3c9PQ==\nkind: Secret\nmetadata:\n  name: ceph-secret-admin\n  namespace: ns-elastic\ntype: kubernetes.io/rbd\n---\napiVersion: storage.k8s.io/v1\nkind: StorageClass\nmetadata:\n  name: rbd-retain\n  annotations:\n    storageclass.kubernetes.io/is-default-class: \"false\"\nprovisioner: ceph.com/rbd\nreclaimPolicy: Retain\nparameters:\n  monitors: 172.16.76.134:6789\n  adminId: admin\n  adminSecretName: ceph-secret-admin\n  adminSecretNamespace: default\n  pool: storageclass-rbd-retain\n  userId: admin\n  userSecretName: ceph-secret-admin\n  fsType: ext4\n  imageFormat: \"2\"\n  imageFeatures: \"layering\"\n```\n\n#### k8s中部署nginx项目采用 ceph.com/rbd 和nfs类似, 这里省略 \n\n> 以上采用的是persistentVolumeClaim 方式动态分配全部内容\n","slug":"7-k8s部署storageclass动态创建pv-nfs-rbd","published":1,"updated":"2019-10-16T09:15:27.840Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck28uwzp1003wkerw9ua9nqra","content":"<p>考虑到k8s存储的问题, 本机目录挂载存在太大局限性, 多node多pod的服务存储急迫需要共享存储, 这里简单应用k8s storageclass nfs和rbd存储</p>\n<a id=\"more\"></a>\n\n<h1 id=\"第一部分-nfs\"><a href=\"#第一部分-nfs\" class=\"headerlink\" title=\"第一部分 nfs\"></a>第一部分 nfs</h1><h3 id=\"这里单节点简单配置nfs-高并发可采用nfs-rsync-inotify或Sersync\"><a href=\"#这里单节点简单配置nfs-高并发可采用nfs-rsync-inotify或Sersync\" class=\"headerlink\" title=\"这里单节点简单配置nfs(高并发可采用nfs+rsync+inotify或Sersync)\"></a>这里单节点简单配置nfs(高并发可采用nfs+rsync+inotify或Sersync)</h3><blockquote>\n<p>高并发参考</p>\n</blockquote>\n<p><a href=\"https://cloud.tencent.com/developer/article/1445884\" target=\"_blank\" rel=\"noopener\">NFS高可用(NFS+keepalive+Sersync)</a><br><a href=\"https://blog.51cto.com/lzhnb/2088224\" target=\"_blank\" rel=\"noopener\">inotify+rsync实时备份总结</a></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#安装nfs</span></span><br><span class=\"line\">yum <span class=\"keyword\">install</span> -y nfs-utils rpcbind</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 创建目录</span></span><br><span class=\"line\">mkdir /<span class=\"keyword\">data</span>/nfs</span><br><span class=\"line\">echo <span class=\"string\">\"/data/nfs 172.16.76.0/24(rw,sync,no_root_squash) \"</span> &gt;&gt;/etc/exports</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 启动服务</span></span><br><span class=\"line\">systemctl <span class=\"keyword\">start</span> rpcbind</span><br><span class=\"line\">systemctl <span class=\"keyword\">start</span> nfs</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"k8s部署storageclass环境-nfs\"><a href=\"#k8s部署storageclass环境-nfs\" class=\"headerlink\" title=\"k8s部署storageclass环境-nfs\"></a>k8s部署storageclass环境-nfs</h3><h4 id=\"导入外部配置\"><a href=\"#导入外部配置\" class=\"headerlink\" title=\"导入外部配置\"></a>导入外部配置</h4><figure class=\"highlight crmsh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git <span class=\"keyword\">clone</span> <span class=\"title\">https</span>://github.com/kubernetes-incubator/external-storage.git</span><br><span class=\"line\">cd external-storage/nfs-client/deploy</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#注意</span></span><br><span class=\"line\"><span class=\"number\">1</span>  <span class=\"keyword\">node</span><span class=\"title\">节点需要安装nfs-utils</span>(centos7),nfs-common(ubuntu)</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"修改deployment-yaml\"><a href=\"#修改deployment-yaml\" class=\"headerlink\" title=\"修改deployment.yaml\"></a>修改deployment.yaml</h4><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ServiceAccount</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">nfs-client-provisioner</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Deployment</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">extensions/v1beta1</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">nfs-client-provisioner</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\">  replicas:</span> <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"attr\">  strategy:</span></span><br><span class=\"line\"><span class=\"attr\">    type:</span> <span class=\"string\">Recreate</span></span><br><span class=\"line\"><span class=\"attr\">  template:</span></span><br><span class=\"line\"><span class=\"attr\">    metadata:</span></span><br><span class=\"line\"><span class=\"attr\">      labels:</span></span><br><span class=\"line\"><span class=\"attr\">        app:</span> <span class=\"string\">nfs-client-provisioner</span></span><br><span class=\"line\"><span class=\"attr\">    spec:</span></span><br><span class=\"line\"><span class=\"attr\">      serviceAccountName:</span> <span class=\"string\">nfs-client-provisioner</span></span><br><span class=\"line\"><span class=\"attr\">      containers:</span></span><br><span class=\"line\"><span class=\"attr\">        - name:</span> <span class=\"string\">nfs-client-provisioner</span></span><br><span class=\"line\"><span class=\"attr\">          image:</span> <span class=\"string\">quay.io/external_storage/nfs-client-provisioner:latest</span></span><br><span class=\"line\"><span class=\"attr\">          volumeMounts:</span></span><br><span class=\"line\"><span class=\"attr\">            - name:</span> <span class=\"string\">nfs-client-root</span></span><br><span class=\"line\"><span class=\"attr\">              mountPath:</span> <span class=\"string\">/persistentvolumes</span></span><br><span class=\"line\"><span class=\"attr\">          env:</span></span><br><span class=\"line\"><span class=\"attr\">            - name:</span> <span class=\"string\">PROVISIONER_NAME</span></span><br><span class=\"line\"><span class=\"attr\">              value:</span> <span class=\"string\">nfs.com/nfs</span></span><br><span class=\"line\"><span class=\"attr\">            - name:</span> <span class=\"string\">NFS_SERVER</span></span><br><span class=\"line\"><span class=\"attr\">              value:</span> <span class=\"number\">172.16</span><span class=\"number\">.76</span><span class=\"number\">.134</span></span><br><span class=\"line\"><span class=\"attr\">            - name:</span> <span class=\"string\">NFS_PATH</span></span><br><span class=\"line\"><span class=\"attr\">              value:</span> <span class=\"string\">/data/nfs</span></span><br><span class=\"line\"><span class=\"attr\">      volumes:</span></span><br><span class=\"line\"><span class=\"attr\">        - name:</span> <span class=\"string\">nfs-client-root</span></span><br><span class=\"line\"><span class=\"attr\">          nfs:</span></span><br><span class=\"line\"><span class=\"attr\">            server:</span> <span class=\"number\">172.16</span><span class=\"number\">.76</span><span class=\"number\">.134</span></span><br><span class=\"line\"><span class=\"attr\">            path:</span> <span class=\"string\">/data/nfs</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"修改class-yaml\"><a href=\"#修改class-yaml\" class=\"headerlink\" title=\"修改class.yaml\"></a>修改class.yaml</h4><figure class=\"highlight dts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"symbol\">apiVersion:</span> storage.k8s.io/v1</span><br><span class=\"line\"><span class=\"symbol\">kind:</span> StorageClass</span><br><span class=\"line\"><span class=\"symbol\">metadata:</span></span><br><span class=\"line\"><span class=\"symbol\">  name:</span> nfs</span><br><span class=\"line\"><span class=\"symbol\">provisioner:</span> nfs.com/nfs</span><br><span class=\"line\"><span class=\"symbol\">parameters:</span></span><br><span class=\"line\"><span class=\"symbol\">  archiveOnDelete:</span> <span class=\"string\">\"false\"</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"rbac-yaml不用修改\"><a href=\"#rbac-yaml不用修改\" class=\"headerlink\" title=\"rbac.yaml不用修改\"></a>rbac.yaml不用修改</h4><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">rbac.yaml</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ServiceAccount</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">nfs-client-provisioner</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ClusterRole</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">rbac.authorization.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">nfs-client-provisioner-runner</span></span><br><span class=\"line\"><span class=\"attr\">rules:</span></span><br><span class=\"line\"><span class=\"attr\">  - apiGroups:</span> <span class=\"string\">[\"\"]</span></span><br><span class=\"line\"><span class=\"attr\">    resources:</span> <span class=\"string\">[\"persistentvolumes\"]</span></span><br><span class=\"line\"><span class=\"attr\">    verbs:</span> <span class=\"string\">[\"get\",</span> <span class=\"string\">\"list\"</span><span class=\"string\">,</span> <span class=\"string\">\"watch\"</span><span class=\"string\">,</span> <span class=\"string\">\"create\"</span><span class=\"string\">,</span> <span class=\"string\">\"delete\"</span><span class=\"string\">]</span></span><br><span class=\"line\"><span class=\"attr\">  - apiGroups:</span> <span class=\"string\">[\"\"]</span></span><br><span class=\"line\"><span class=\"attr\">    resources:</span> <span class=\"string\">[\"persistentvolumeclaims\"]</span></span><br><span class=\"line\"><span class=\"attr\">    verbs:</span> <span class=\"string\">[\"get\",</span> <span class=\"string\">\"list\"</span><span class=\"string\">,</span> <span class=\"string\">\"watch\"</span><span class=\"string\">,</span> <span class=\"string\">\"update\"</span><span class=\"string\">]</span></span><br><span class=\"line\"><span class=\"attr\">  - apiGroups:</span> <span class=\"string\">[\"storage.k8s.io\"]</span></span><br><span class=\"line\"><span class=\"attr\">    resources:</span> <span class=\"string\">[\"storageclasses\"]</span></span><br><span class=\"line\"><span class=\"attr\">    verbs:</span> <span class=\"string\">[\"get\",</span> <span class=\"string\">\"list\"</span><span class=\"string\">,</span> <span class=\"string\">\"watch\"</span><span class=\"string\">]</span></span><br><span class=\"line\"><span class=\"attr\">  - apiGroups:</span> <span class=\"string\">[\"\"]</span></span><br><span class=\"line\"><span class=\"attr\">    resources:</span> <span class=\"string\">[\"events\"]</span></span><br><span class=\"line\"><span class=\"attr\">    verbs:</span> <span class=\"string\">[\"create\",</span> <span class=\"string\">\"update\"</span><span class=\"string\">,</span> <span class=\"string\">\"patch\"</span><span class=\"string\">]</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ClusterRoleBinding</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">rbac.authorization.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">run-nfs-client-provisioner</span></span><br><span class=\"line\"><span class=\"attr\">subjects:</span></span><br><span class=\"line\"><span class=\"attr\">  - kind:</span> <span class=\"string\">ServiceAccount</span></span><br><span class=\"line\"><span class=\"attr\">    name:</span> <span class=\"string\">nfs-client-provisioner</span></span><br><span class=\"line\"><span class=\"attr\">    namespace:</span> <span class=\"string\">default</span></span><br><span class=\"line\"><span class=\"attr\">roleRef:</span></span><br><span class=\"line\"><span class=\"attr\">  kind:</span> <span class=\"string\">ClusterRole</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">nfs-client-provisioner-runner</span></span><br><span class=\"line\"><span class=\"attr\">  apiGroup:</span> <span class=\"string\">rbac.authorization.k8s.io</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Role</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">rbac.authorization.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">leader-locking-nfs-client-provisioner</span></span><br><span class=\"line\"><span class=\"attr\">rules:</span></span><br><span class=\"line\"><span class=\"attr\">  - apiGroups:</span> <span class=\"string\">[\"\"]</span></span><br><span class=\"line\"><span class=\"attr\">    resources:</span> <span class=\"string\">[\"endpoints\"]</span></span><br><span class=\"line\"><span class=\"attr\">    verbs:</span> <span class=\"string\">[\"get\",</span> <span class=\"string\">\"list\"</span><span class=\"string\">,</span> <span class=\"string\">\"watch\"</span><span class=\"string\">,</span> <span class=\"string\">\"create\"</span><span class=\"string\">,</span> <span class=\"string\">\"update\"</span><span class=\"string\">,</span> <span class=\"string\">\"patch\"</span><span class=\"string\">]</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">RoleBinding</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">rbac.authorization.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">leader-locking-nfs-client-provisioner</span></span><br><span class=\"line\"><span class=\"attr\">subjects:</span></span><br><span class=\"line\"><span class=\"attr\">  - kind:</span> <span class=\"string\">ServiceAccount</span></span><br><span class=\"line\"><span class=\"attr\">    name:</span> <span class=\"string\">nfs-client-provisioner</span></span><br><span class=\"line\">    <span class=\"comment\"># replace with namespace where provisioner is deployed</span></span><br><span class=\"line\"><span class=\"attr\">    namespace:</span> <span class=\"string\">default</span></span><br><span class=\"line\"><span class=\"attr\">roleRef:</span></span><br><span class=\"line\"><span class=\"attr\">  kind:</span> <span class=\"string\">Role</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">leader-locking-nfs-client-provisioner</span></span><br><span class=\"line\"><span class=\"attr\">  apiGroup:</span> <span class=\"string\">rbac.authorization.k8s.io</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"部署nfs环境-创建nfs存储类\"><a href=\"#部署nfs环境-创建nfs存储类\" class=\"headerlink\" title=\"部署nfs环境(创建nfs存储类)\"></a>部署nfs环境(创建nfs存储类)</h4><figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl apply -f rbac<span class=\"selector-class\">.yaml</span> -f class<span class=\"selector-class\">.yaml</span> -f deployment.yaml</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"k8s中部署nginx项目采用nfs存储\"><a href=\"#k8s中部署nginx项目采用nfs存储\" class=\"headerlink\" title=\"k8s中部署nginx项目采用nfs存储\"></a>k8s中部署nginx项目采用nfs存储</h3><h4 id=\"部署nginx-deployment-nfs-yaml-测试nfs\"><a href=\"#部署nginx-deployment-nfs-yaml-测试nfs\" class=\"headerlink\" title=\"部署nginx-deployment-nfs.yaml(测试nfs)\"></a>部署nginx-deployment-nfs.yaml(测试nfs)</h4><blockquote>\n<p>这种方式会创建一个pvc 挂载到多个pod中,这种方式适合nginx-html挂载</p>\n</blockquote>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">PersistentVolumeClaim</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">html0-deploy-nfs</span></span><br><span class=\"line\"><span class=\"attr\">  annotations:</span></span><br><span class=\"line\">    <span class=\"string\">volume.beta.kubernetes.io/storage-class:</span> <span class=\"string\">'nfs'</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\">  accessModes:</span></span><br><span class=\"line\"><span class=\"bullet\">    -</span> <span class=\"string\">ReadWriteMany</span></span><br><span class=\"line\"><span class=\"attr\">  resources:</span></span><br><span class=\"line\"><span class=\"attr\">    requests:</span></span><br><span class=\"line\"><span class=\"attr\">      storage:</span> <span class=\"number\">1</span><span class=\"string\">Gi</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">extensions/v1beta1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Deployment</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">nginx0-deploy</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\">  replicas:</span> <span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"attr\">  template:</span></span><br><span class=\"line\"><span class=\"attr\">    metadata:</span></span><br><span class=\"line\"><span class=\"attr\">      labels:</span></span><br><span class=\"line\"><span class=\"attr\">        app:</span> <span class=\"string\">nginx0-deploy</span></span><br><span class=\"line\"><span class=\"attr\">    spec:</span></span><br><span class=\"line\"><span class=\"attr\">      containers:</span></span><br><span class=\"line\"><span class=\"attr\">      - name:</span> <span class=\"string\">nginx0-deploy</span></span><br><span class=\"line\"><span class=\"attr\">        image:</span> <span class=\"string\">hub.boqii.com/bq/nginx:1.15.12</span></span><br><span class=\"line\"><span class=\"attr\">        ports:</span></span><br><span class=\"line\"><span class=\"attr\">        - containerPort:</span> <span class=\"number\">80</span></span><br><span class=\"line\"><span class=\"attr\">        volumeMounts:</span></span><br><span class=\"line\"><span class=\"attr\">        - name:</span> <span class=\"string\">html0-deploy-nfs</span></span><br><span class=\"line\"><span class=\"attr\">          mountPath:</span> <span class=\"string\">/usr/share/nginx/html</span></span><br><span class=\"line\"><span class=\"attr\">        - name:</span> <span class=\"string\">nginx-config</span></span><br><span class=\"line\"><span class=\"attr\">          mountPath:</span> <span class=\"string\">\"/etc/nginx/conf.d\"</span></span><br><span class=\"line\"><span class=\"attr\">      volumes:</span></span><br><span class=\"line\"><span class=\"attr\">      - name:</span> <span class=\"string\">nginx-config</span></span><br><span class=\"line\"><span class=\"attr\">        configMap:</span></span><br><span class=\"line\"><span class=\"attr\">            name:</span> <span class=\"string\">nginx-config</span></span><br><span class=\"line\"><span class=\"attr\">      - name:</span> <span class=\"string\">html0-deploy-nfs</span></span><br><span class=\"line\"><span class=\"attr\">        persistentVolumeClaim:</span></span><br><span class=\"line\"><span class=\"attr\">          claimName:</span> <span class=\"string\">html0-deploy-nfs</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ConfigMap</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">nginx-config</span></span><br><span class=\"line\"><span class=\"attr\">data:</span></span><br><span class=\"line\">  <span class=\"string\">default.conf:</span> <span class=\"string\">|</span></span><br><span class=\"line\"><span class=\"string\">            server &#123;</span></span><br><span class=\"line\"><span class=\"string\">              listen       80;</span></span><br><span class=\"line\"><span class=\"string\">              server_name  localhost;</span></span><br><span class=\"line\"><span class=\"string\">              root   /usr/share/nginx/html/;</span></span><br><span class=\"line\"><span class=\"string\">              access_log  /var/log/nginx/host_access.log;</span></span><br><span class=\"line\"><span class=\"string\">              error_log  /var/log/nginx/host_error.log debug;</span></span><br><span class=\"line\"><span class=\"string\">              location / &#123;</span></span><br><span class=\"line\"><span class=\"string\">                  root   /usr/share/nginx/html/;</span></span><br><span class=\"line\"><span class=\"string\">                  index  index.html index.htm index.php;</span></span><br><span class=\"line\"><span class=\"string\">              &#125;</span></span><br><span class=\"line\"><span class=\"string\">              error_page   500 502 503 504  /50x.html;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">              location = /50x.html &#123;</span></span><br><span class=\"line\"><span class=\"string\">                  root   /usr/share/nginx/html;</span></span><br><span class=\"line\"><span class=\"string\">              &#125;</span></span><br><span class=\"line\"><span class=\"string\">              &#125;</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"部署nginx-statefulset-nfs-yaml-测试nfs\"><a href=\"#部署nginx-statefulset-nfs-yaml-测试nfs\" class=\"headerlink\" title=\"部署nginx-statefulset-nfs.yaml(测试nfs)\"></a>部署nginx-statefulset-nfs.yaml(测试nfs)</h4><blockquote>\n<p>这里statefulset 方式会创建多个pvc, 每个pod的html就可以都不一样!</p>\n</blockquote>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1beta1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">StatefulSet</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">nginx3</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\">  serviceName:</span> <span class=\"string\">\"nginx\"</span></span><br><span class=\"line\"><span class=\"attr\">  replicas:</span> <span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"attr\">  volumeClaimTemplates:</span></span><br><span class=\"line\"><span class=\"attr\">  - metadata:</span></span><br><span class=\"line\"><span class=\"attr\">      name:</span> <span class=\"string\">html</span></span><br><span class=\"line\"><span class=\"attr\">      annotations:</span></span><br><span class=\"line\">        <span class=\"string\">volume.beta.kubernetes.io/storage-class:</span> <span class=\"string\">\"nfs\"</span> <span class=\"comment\"># 这里配置 上面创建的 storageclass 的名称</span></span><br><span class=\"line\"><span class=\"attr\">    spec:</span></span><br><span class=\"line\"><span class=\"attr\">      accessModes:</span> <span class=\"string\">[</span> <span class=\"string\">\"ReadWriteOnce\"</span> <span class=\"string\">]</span></span><br><span class=\"line\"><span class=\"attr\">      resources:</span></span><br><span class=\"line\"><span class=\"attr\">        requests:</span></span><br><span class=\"line\"><span class=\"attr\">          storage:</span> <span class=\"number\">2</span><span class=\"string\">Gi</span></span><br><span class=\"line\"><span class=\"attr\">  template:</span></span><br><span class=\"line\"><span class=\"attr\">    metadata:</span></span><br><span class=\"line\"><span class=\"attr\">      labels:</span></span><br><span class=\"line\"><span class=\"attr\">        app:</span> <span class=\"string\">nginx</span></span><br><span class=\"line\"><span class=\"attr\">    spec:</span></span><br><span class=\"line\"><span class=\"attr\">      containers:</span></span><br><span class=\"line\"><span class=\"attr\">      - name:</span> <span class=\"string\">nginx</span></span><br><span class=\"line\"><span class=\"attr\">        image:</span> <span class=\"string\">hub.boqii.com/bq/nginx:1.15.12</span></span><br><span class=\"line\"><span class=\"attr\">        volumeMounts:</span></span><br><span class=\"line\"><span class=\"attr\">        - mountPath:</span> <span class=\"string\">\"/usr/share/nginx/html/\"</span></span><br><span class=\"line\"><span class=\"attr\">          name:</span> <span class=\"string\">html</span></span><br><span class=\"line\"><span class=\"attr\">        - mountPath:</span> <span class=\"string\">\"/etc/nginx/conf.d\"</span></span><br><span class=\"line\"><span class=\"attr\">          name:</span> <span class=\"string\">nginx-config</span></span><br><span class=\"line\"><span class=\"attr\">      volumes:</span></span><br><span class=\"line\"><span class=\"attr\">      - name:</span> <span class=\"string\">nginx-config</span></span><br><span class=\"line\"><span class=\"attr\">        configMap:</span></span><br><span class=\"line\"><span class=\"attr\">            name:</span> <span class=\"string\">nginx-config</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ConfigMap</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">nginx-config</span></span><br><span class=\"line\"><span class=\"attr\">data:</span></span><br><span class=\"line\">  <span class=\"string\">default.conf:</span> <span class=\"string\">|</span></span><br><span class=\"line\"><span class=\"string\">            server &#123;</span></span><br><span class=\"line\"><span class=\"string\">              listen       80;</span></span><br><span class=\"line\"><span class=\"string\">              server_name  localhost;</span></span><br><span class=\"line\"><span class=\"string\">              root   /usr/share/nginx/html/;</span></span><br><span class=\"line\"><span class=\"string\">              access_log  /var/log/nginx/host_access.log;</span></span><br><span class=\"line\"><span class=\"string\">              error_log  /var/log/nginx/host_error.log debug;</span></span><br><span class=\"line\"><span class=\"string\">              location / &#123;</span></span><br><span class=\"line\"><span class=\"string\">                  root   /usr/share/nginx/html/;</span></span><br><span class=\"line\"><span class=\"string\">                  index  index.html index.htm index.php;</span></span><br><span class=\"line\"><span class=\"string\">              &#125;</span></span><br><span class=\"line\"><span class=\"string\">              error_page   500 502 503 504  /50x.html;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">              location = /50x.html &#123;</span></span><br><span class=\"line\"><span class=\"string\">                  root   /usr/share/nginx/html;</span></span><br><span class=\"line\"><span class=\"string\">              &#125;</span></span><br><span class=\"line\"><span class=\"string\">              &#125;</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"另外说明一下将nfs作为文件存储类似mount方式-这种方式不适用于多容器自动化部署-显然这种并不适合ceph-rbd存储-cephfs是可以的\"><a href=\"#另外说明一下将nfs作为文件存储类似mount方式-这种方式不适用于多容器自动化部署-显然这种并不适合ceph-rbd存储-cephfs是可以的\" class=\"headerlink\" title=\"另外说明一下将nfs作为文件存储类似mount方式,这种方式不适用于多容器自动化部署 ,显然这种并不适合ceph rbd存储, cephfs是可以的\"></a>另外说明一下将nfs作为文件存储类似mount方式,这种方式不适用于多容器自动化部署 ,显然这种并不适合ceph rbd存储, cephfs是可以的</h3><h4 id=\"首先需要在nfs目录创建需要挂载的目录\"><a href=\"#首先需要在nfs目录创建需要挂载的目录\" class=\"headerlink\" title=\"首先需要在nfs目录创建需要挂载的目录\"></a>首先需要在nfs目录创建需要挂载的目录</h4><figure class=\"highlight haskell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#例如</span></span><br><span class=\"line\"><span class=\"title\">mkdir</span> -p /<span class=\"class\"><span class=\"keyword\">data</span>/nfs/k8s-db-t/mysql-<span class=\"keyword\">data</span>-dev</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"在部署的yml中直接mount-nfs的目录\"><a href=\"#在部署的yml中直接mount-nfs的目录\" class=\"headerlink\" title=\"在部署的yml中直接mount nfs的目录\"></a>在部署的yml中直接mount nfs的目录</h4><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">extensions/v1beta1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Deployment</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">mysql-server</span></span><br><span class=\"line\"><span class=\"attr\">  namespace:</span> <span class=\"string\">devops</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\">  replicas:</span> <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"attr\">  template:</span></span><br><span class=\"line\"><span class=\"attr\">    metadata:</span></span><br><span class=\"line\"><span class=\"attr\">      labels:</span></span><br><span class=\"line\"><span class=\"attr\">        app:</span> <span class=\"string\">mysql-server</span></span><br><span class=\"line\"><span class=\"attr\">    spec:</span></span><br><span class=\"line\"><span class=\"attr\">      containers:</span></span><br><span class=\"line\"><span class=\"attr\">      - image:</span> <span class=\"attr\">mysql:5.7.16</span></span><br><span class=\"line\"><span class=\"attr\">        imagePullPolicy:</span> <span class=\"string\">Always</span></span><br><span class=\"line\"><span class=\"attr\">        name:</span> <span class=\"string\">mysql-server</span></span><br><span class=\"line\"><span class=\"attr\">        ports:</span></span><br><span class=\"line\"><span class=\"attr\">        - containerPort:</span> <span class=\"number\">3306</span></span><br><span class=\"line\"><span class=\"attr\">          protocol:</span> <span class=\"string\">TCP</span></span><br><span class=\"line\"><span class=\"attr\">        volumeMounts:</span></span><br><span class=\"line\"><span class=\"attr\">          - name:</span> <span class=\"string\">mysql-data</span></span><br><span class=\"line\"><span class=\"attr\">            mountPath:</span> <span class=\"string\">/var/lib/mysql</span></span><br><span class=\"line\"><span class=\"attr\">        resources:</span></span><br><span class=\"line\"><span class=\"attr\">          requests:</span></span><br><span class=\"line\"><span class=\"attr\">            cpu:</span> <span class=\"number\">40</span><span class=\"string\">m</span></span><br><span class=\"line\"><span class=\"attr\">            memory:</span> <span class=\"number\">32</span><span class=\"string\">Mi</span></span><br><span class=\"line\"><span class=\"attr\">          limits:</span></span><br><span class=\"line\"><span class=\"attr\">            cpu:</span> <span class=\"string\">\"300m\"</span></span><br><span class=\"line\"><span class=\"attr\">            memory:</span> <span class=\"number\">256</span><span class=\"string\">Mi</span></span><br><span class=\"line\"><span class=\"attr\">        env:</span></span><br><span class=\"line\"><span class=\"attr\">        - name:</span> <span class=\"string\">MYSQL_ROOT_PASSWORD</span></span><br><span class=\"line\"><span class=\"attr\">          value:</span> <span class=\"string\">\"boqii.123\"</span></span><br><span class=\"line\"><span class=\"attr\">        - name:</span> <span class=\"string\">MYSQL_DATABASE</span></span><br><span class=\"line\"><span class=\"attr\">          value:</span> <span class=\"string\">\"gogs\"</span></span><br><span class=\"line\"><span class=\"attr\">        - name:</span> <span class=\"string\">MYSQL_USER</span></span><br><span class=\"line\"><span class=\"attr\">          value:</span> <span class=\"string\">\"gogs\"</span></span><br><span class=\"line\"><span class=\"attr\">        - name:</span> <span class=\"string\">MYSQL_PASSWORD</span></span><br><span class=\"line\"><span class=\"attr\">          value:</span> <span class=\"string\">\"gogspass\"</span></span><br><span class=\"line\"><span class=\"attr\">        - name:</span> <span class=\"string\">TZ</span></span><br><span class=\"line\"><span class=\"attr\">          value:</span> <span class=\"string\">\"Asia/Shanghai\"</span></span><br><span class=\"line\"><span class=\"attr\">      volumes:</span></span><br><span class=\"line\"><span class=\"attr\">        - name:</span> <span class=\"string\">mysql-data</span></span><br><span class=\"line\"><span class=\"attr\">          nfs:</span></span><br><span class=\"line\"><span class=\"attr\">            server:</span> <span class=\"number\">172.16</span><span class=\"number\">.76</span><span class=\"number\">.134</span></span><br><span class=\"line\"><span class=\"attr\">            path:</span> <span class=\"string\">/data/nfs/k8s-db-t/mysql-data-dev</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Service</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">mysql-service</span></span><br><span class=\"line\"><span class=\"attr\">  namespace:</span> <span class=\"string\">devops</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\">  clusterIP:</span> <span class=\"string\">None</span></span><br><span class=\"line\"><span class=\"attr\">  selector:</span></span><br><span class=\"line\"><span class=\"attr\">    app:</span> <span class=\"string\">mysql-server</span></span><br><span class=\"line\"><span class=\"attr\">  ports:</span></span><br><span class=\"line\"><span class=\"attr\">  - name:</span> <span class=\"string\">http</span></span><br><span class=\"line\"><span class=\"attr\">    port:</span> <span class=\"number\">3306</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<h1 id=\"第二部分-ceph\"><a href=\"#第二部分-ceph\" class=\"headerlink\" title=\"第二部分 ceph\"></a>第二部分 ceph</h1><h3 id=\"k8s部署storageclass环境-ceph\"><a href=\"#k8s部署storageclass环境-ceph\" class=\"headerlink\" title=\"k8s部署storageclass环境-ceph\"></a>k8s部署storageclass环境-ceph</h3><h4 id=\"如果集群是用kubeadm部署的，由于controller-manager官方镜像中没有rbd命令，所以我们要导入外部配置\"><a href=\"#如果集群是用kubeadm部署的，由于controller-manager官方镜像中没有rbd命令，所以我们要导入外部配置\" class=\"headerlink\" title=\"如果集群是用kubeadm部署的，由于controller-manager官方镜像中没有rbd命令，所以我们要导入外部配置\"></a>如果集群是用kubeadm部署的，由于controller-manager官方镜像中没有rbd命令，所以我们要导入外部配置</h4><figure class=\"highlight awk\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git clone https:<span class=\"regexp\">//gi</span>thub.com<span class=\"regexp\">/kubernetes-incubator/</span>external-storage.git</span><br><span class=\"line\">cd external-storage<span class=\"regexp\">/ceph/</span>rbd<span class=\"regexp\">/deploy</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>以下整合在一个文件, 两个版本,默认 和retain</p>\n</blockquote>\n<h4 id=\"storageclass-cepm-com-rbd-yaml\"><a href=\"#storageclass-cepm-com-rbd-yaml\" class=\"headerlink\" title=\"storageclass-cepm.com-rbd.yaml\"></a>storageclass-cepm.com-rbd.yaml</h4><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">data:</span></span><br><span class=\"line\"><span class=\"attr\">  key:</span> <span class=\"string\">QVFEYzJRbGQ1VjI5THhBQU00WUtPUU5sUVJqdWtLSWJ2VDZ0a3c9PQ==</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Secret</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">ceph-secret-admin</span></span><br><span class=\"line\"><span class=\"attr\">type:</span> <span class=\"string\">kubernetes.io/rbd</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">data:</span></span><br><span class=\"line\"><span class=\"attr\">  key:</span> <span class=\"string\">QVFEYzJRbGQ1VjI5THhBQU00WUtPUU5sUVJqdWtLSWJ2VDZ0a3c9PQ==</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Secret</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">ceph-secret-admin</span></span><br><span class=\"line\"><span class=\"attr\">  namespace:</span> <span class=\"string\">ns-elastic</span></span><br><span class=\"line\"><span class=\"attr\">type:</span> <span class=\"string\">kubernetes.io/rbd</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">storage.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">StorageClass</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">rbd</span></span><br><span class=\"line\"><span class=\"attr\">  annotations:</span></span><br><span class=\"line\">    <span class=\"string\">storageclass.kubernetes.io/is-default-class:</span> <span class=\"string\">\"true\"</span></span><br><span class=\"line\"><span class=\"attr\">provisioner:</span> <span class=\"string\">ceph.com/rbd</span></span><br><span class=\"line\"><span class=\"attr\">parameters:</span></span><br><span class=\"line\"><span class=\"attr\">  monitors:</span> <span class=\"number\">172.16</span><span class=\"number\">.76</span><span class=\"number\">.134</span><span class=\"string\">:6789</span></span><br><span class=\"line\"><span class=\"attr\">  adminId:</span> <span class=\"string\">admin</span></span><br><span class=\"line\"><span class=\"attr\">  adminSecretName:</span> <span class=\"string\">ceph-secret-admin</span></span><br><span class=\"line\"><span class=\"attr\">  adminSecretNamespace:</span> <span class=\"string\">default</span></span><br><span class=\"line\"><span class=\"attr\">  pool:</span> <span class=\"string\">storageclass-rbd</span></span><br><span class=\"line\"><span class=\"attr\">  userId:</span> <span class=\"string\">admin</span></span><br><span class=\"line\"><span class=\"attr\">  userSecretName:</span> <span class=\"string\">ceph-secret-admin</span></span><br><span class=\"line\"><span class=\"attr\">  fsType:</span> <span class=\"string\">ext4</span></span><br><span class=\"line\"><span class=\"attr\">  imageFormat:</span> <span class=\"string\">\"2\"</span></span><br><span class=\"line\"><span class=\"attr\">  imageFeatures:</span> <span class=\"string\">\"layering\"</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"storageclass-cepm-com-rbd-retain-yaml\"><a href=\"#storageclass-cepm-com-rbd-retain-yaml\" class=\"headerlink\" title=\"storageclass-cepm.com-rbd-retain.yaml\"></a>storageclass-cepm.com-rbd-retain.yaml</h4><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">data:</span></span><br><span class=\"line\"><span class=\"attr\">  key:</span> <span class=\"string\">QVFEYzJRbGQ1VjI5THhBQU00WUtPUU5sUVJqdWtLSWJ2VDZ0a3c9PQ==</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Secret</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">ceph-secret-admin</span></span><br><span class=\"line\"><span class=\"attr\">type:</span> <span class=\"string\">kubernetes.io/rbd</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">data:</span></span><br><span class=\"line\"><span class=\"attr\">  key:</span> <span class=\"string\">QVFEYzJRbGQ1VjI5THhBQU00WUtPUU5sUVJqdWtLSWJ2VDZ0a3c9PQ==</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Secret</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">ceph-secret-admin</span></span><br><span class=\"line\"><span class=\"attr\">  namespace:</span> <span class=\"string\">ns-elastic</span></span><br><span class=\"line\"><span class=\"attr\">type:</span> <span class=\"string\">kubernetes.io/rbd</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">storage.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">StorageClass</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">rbd-retain</span></span><br><span class=\"line\"><span class=\"attr\">  annotations:</span></span><br><span class=\"line\">    <span class=\"string\">storageclass.kubernetes.io/is-default-class:</span> <span class=\"string\">\"false\"</span></span><br><span class=\"line\"><span class=\"attr\">provisioner:</span> <span class=\"string\">ceph.com/rbd</span></span><br><span class=\"line\"><span class=\"attr\">reclaimPolicy:</span> <span class=\"string\">Retain</span></span><br><span class=\"line\"><span class=\"attr\">parameters:</span></span><br><span class=\"line\"><span class=\"attr\">  monitors:</span> <span class=\"number\">172.16</span><span class=\"number\">.76</span><span class=\"number\">.134</span><span class=\"string\">:6789</span></span><br><span class=\"line\"><span class=\"attr\">  adminId:</span> <span class=\"string\">admin</span></span><br><span class=\"line\"><span class=\"attr\">  adminSecretName:</span> <span class=\"string\">ceph-secret-admin</span></span><br><span class=\"line\"><span class=\"attr\">  adminSecretNamespace:</span> <span class=\"string\">default</span></span><br><span class=\"line\"><span class=\"attr\">  pool:</span> <span class=\"string\">storageclass-rbd-retain</span></span><br><span class=\"line\"><span class=\"attr\">  userId:</span> <span class=\"string\">admin</span></span><br><span class=\"line\"><span class=\"attr\">  userSecretName:</span> <span class=\"string\">ceph-secret-admin</span></span><br><span class=\"line\"><span class=\"attr\">  fsType:</span> <span class=\"string\">ext4</span></span><br><span class=\"line\"><span class=\"attr\">  imageFormat:</span> <span class=\"string\">\"2\"</span></span><br><span class=\"line\"><span class=\"attr\">  imageFeatures:</span> <span class=\"string\">\"layering\"</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"k8s中部署nginx项目采用-ceph-com-rbd-和nfs类似-这里省略\"><a href=\"#k8s中部署nginx项目采用-ceph-com-rbd-和nfs类似-这里省略\" class=\"headerlink\" title=\"k8s中部署nginx项目采用 ceph.com/rbd 和nfs类似, 这里省略\"></a>k8s中部署nginx项目采用 ceph.com/rbd 和nfs类似, 这里省略</h4><blockquote>\n<p>以上采用的是persistentVolumeClaim 方式动态分配全部内容</p>\n</blockquote>\n","site":{"data":{}},"length":10225,"excerpt":"<p>考虑到k8s存储的问题, 本机目录挂载存在太大局限性, 多node多pod的服务存储急迫需要共享存储, 这里简单应用k8s storageclass nfs和rbd存储</p>","more":"<h1 id=\"第一部分-nfs\"><a href=\"#第一部分-nfs\" class=\"headerlink\" title=\"第一部分 nfs\"></a>第一部分 nfs</h1><h3 id=\"这里单节点简单配置nfs-高并发可采用nfs-rsync-inotify或Sersync\"><a href=\"#这里单节点简单配置nfs-高并发可采用nfs-rsync-inotify或Sersync\" class=\"headerlink\" title=\"这里单节点简单配置nfs(高并发可采用nfs+rsync+inotify或Sersync)\"></a>这里单节点简单配置nfs(高并发可采用nfs+rsync+inotify或Sersync)</h3><blockquote>\n<p>高并发参考</p>\n</blockquote>\n<p><a href=\"https://cloud.tencent.com/developer/article/1445884\" target=\"_blank\" rel=\"noopener\">NFS高可用(NFS+keepalive+Sersync)</a><br><a href=\"https://blog.51cto.com/lzhnb/2088224\" target=\"_blank\" rel=\"noopener\">inotify+rsync实时备份总结</a></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#安装nfs</span></span><br><span class=\"line\">yum <span class=\"keyword\">install</span> -y nfs-utils rpcbind</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 创建目录</span></span><br><span class=\"line\">mkdir /<span class=\"keyword\">data</span>/nfs</span><br><span class=\"line\">echo <span class=\"string\">\"/data/nfs 172.16.76.0/24(rw,sync,no_root_squash) \"</span> &gt;&gt;/etc/exports</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 启动服务</span></span><br><span class=\"line\">systemctl <span class=\"keyword\">start</span> rpcbind</span><br><span class=\"line\">systemctl <span class=\"keyword\">start</span> nfs</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"k8s部署storageclass环境-nfs\"><a href=\"#k8s部署storageclass环境-nfs\" class=\"headerlink\" title=\"k8s部署storageclass环境-nfs\"></a>k8s部署storageclass环境-nfs</h3><h4 id=\"导入外部配置\"><a href=\"#导入外部配置\" class=\"headerlink\" title=\"导入外部配置\"></a>导入外部配置</h4><figure class=\"highlight crmsh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git <span class=\"keyword\">clone</span> <span class=\"title\">https</span>://github.com/kubernetes-incubator/external-storage.git</span><br><span class=\"line\">cd external-storage/nfs-client/deploy</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#注意</span></span><br><span class=\"line\"><span class=\"number\">1</span>  <span class=\"keyword\">node</span><span class=\"title\">节点需要安装nfs-utils</span>(centos7),nfs-common(ubuntu)</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"修改deployment-yaml\"><a href=\"#修改deployment-yaml\" class=\"headerlink\" title=\"修改deployment.yaml\"></a>修改deployment.yaml</h4><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ServiceAccount</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">nfs-client-provisioner</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Deployment</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">extensions/v1beta1</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">nfs-client-provisioner</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\">  replicas:</span> <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"attr\">  strategy:</span></span><br><span class=\"line\"><span class=\"attr\">    type:</span> <span class=\"string\">Recreate</span></span><br><span class=\"line\"><span class=\"attr\">  template:</span></span><br><span class=\"line\"><span class=\"attr\">    metadata:</span></span><br><span class=\"line\"><span class=\"attr\">      labels:</span></span><br><span class=\"line\"><span class=\"attr\">        app:</span> <span class=\"string\">nfs-client-provisioner</span></span><br><span class=\"line\"><span class=\"attr\">    spec:</span></span><br><span class=\"line\"><span class=\"attr\">      serviceAccountName:</span> <span class=\"string\">nfs-client-provisioner</span></span><br><span class=\"line\"><span class=\"attr\">      containers:</span></span><br><span class=\"line\"><span class=\"attr\">        - name:</span> <span class=\"string\">nfs-client-provisioner</span></span><br><span class=\"line\"><span class=\"attr\">          image:</span> <span class=\"string\">quay.io/external_storage/nfs-client-provisioner:latest</span></span><br><span class=\"line\"><span class=\"attr\">          volumeMounts:</span></span><br><span class=\"line\"><span class=\"attr\">            - name:</span> <span class=\"string\">nfs-client-root</span></span><br><span class=\"line\"><span class=\"attr\">              mountPath:</span> <span class=\"string\">/persistentvolumes</span></span><br><span class=\"line\"><span class=\"attr\">          env:</span></span><br><span class=\"line\"><span class=\"attr\">            - name:</span> <span class=\"string\">PROVISIONER_NAME</span></span><br><span class=\"line\"><span class=\"attr\">              value:</span> <span class=\"string\">nfs.com/nfs</span></span><br><span class=\"line\"><span class=\"attr\">            - name:</span> <span class=\"string\">NFS_SERVER</span></span><br><span class=\"line\"><span class=\"attr\">              value:</span> <span class=\"number\">172.16</span><span class=\"number\">.76</span><span class=\"number\">.134</span></span><br><span class=\"line\"><span class=\"attr\">            - name:</span> <span class=\"string\">NFS_PATH</span></span><br><span class=\"line\"><span class=\"attr\">              value:</span> <span class=\"string\">/data/nfs</span></span><br><span class=\"line\"><span class=\"attr\">      volumes:</span></span><br><span class=\"line\"><span class=\"attr\">        - name:</span> <span class=\"string\">nfs-client-root</span></span><br><span class=\"line\"><span class=\"attr\">          nfs:</span></span><br><span class=\"line\"><span class=\"attr\">            server:</span> <span class=\"number\">172.16</span><span class=\"number\">.76</span><span class=\"number\">.134</span></span><br><span class=\"line\"><span class=\"attr\">            path:</span> <span class=\"string\">/data/nfs</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"修改class-yaml\"><a href=\"#修改class-yaml\" class=\"headerlink\" title=\"修改class.yaml\"></a>修改class.yaml</h4><figure class=\"highlight dts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"symbol\">apiVersion:</span> storage.k8s.io/v1</span><br><span class=\"line\"><span class=\"symbol\">kind:</span> StorageClass</span><br><span class=\"line\"><span class=\"symbol\">metadata:</span></span><br><span class=\"line\"><span class=\"symbol\">  name:</span> nfs</span><br><span class=\"line\"><span class=\"symbol\">provisioner:</span> nfs.com/nfs</span><br><span class=\"line\"><span class=\"symbol\">parameters:</span></span><br><span class=\"line\"><span class=\"symbol\">  archiveOnDelete:</span> <span class=\"string\">\"false\"</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"rbac-yaml不用修改\"><a href=\"#rbac-yaml不用修改\" class=\"headerlink\" title=\"rbac.yaml不用修改\"></a>rbac.yaml不用修改</h4><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">rbac.yaml</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ServiceAccount</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">nfs-client-provisioner</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ClusterRole</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">rbac.authorization.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">nfs-client-provisioner-runner</span></span><br><span class=\"line\"><span class=\"attr\">rules:</span></span><br><span class=\"line\"><span class=\"attr\">  - apiGroups:</span> <span class=\"string\">[\"\"]</span></span><br><span class=\"line\"><span class=\"attr\">    resources:</span> <span class=\"string\">[\"persistentvolumes\"]</span></span><br><span class=\"line\"><span class=\"attr\">    verbs:</span> <span class=\"string\">[\"get\",</span> <span class=\"string\">\"list\"</span><span class=\"string\">,</span> <span class=\"string\">\"watch\"</span><span class=\"string\">,</span> <span class=\"string\">\"create\"</span><span class=\"string\">,</span> <span class=\"string\">\"delete\"</span><span class=\"string\">]</span></span><br><span class=\"line\"><span class=\"attr\">  - apiGroups:</span> <span class=\"string\">[\"\"]</span></span><br><span class=\"line\"><span class=\"attr\">    resources:</span> <span class=\"string\">[\"persistentvolumeclaims\"]</span></span><br><span class=\"line\"><span class=\"attr\">    verbs:</span> <span class=\"string\">[\"get\",</span> <span class=\"string\">\"list\"</span><span class=\"string\">,</span> <span class=\"string\">\"watch\"</span><span class=\"string\">,</span> <span class=\"string\">\"update\"</span><span class=\"string\">]</span></span><br><span class=\"line\"><span class=\"attr\">  - apiGroups:</span> <span class=\"string\">[\"storage.k8s.io\"]</span></span><br><span class=\"line\"><span class=\"attr\">    resources:</span> <span class=\"string\">[\"storageclasses\"]</span></span><br><span class=\"line\"><span class=\"attr\">    verbs:</span> <span class=\"string\">[\"get\",</span> <span class=\"string\">\"list\"</span><span class=\"string\">,</span> <span class=\"string\">\"watch\"</span><span class=\"string\">]</span></span><br><span class=\"line\"><span class=\"attr\">  - apiGroups:</span> <span class=\"string\">[\"\"]</span></span><br><span class=\"line\"><span class=\"attr\">    resources:</span> <span class=\"string\">[\"events\"]</span></span><br><span class=\"line\"><span class=\"attr\">    verbs:</span> <span class=\"string\">[\"create\",</span> <span class=\"string\">\"update\"</span><span class=\"string\">,</span> <span class=\"string\">\"patch\"</span><span class=\"string\">]</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ClusterRoleBinding</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">rbac.authorization.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">run-nfs-client-provisioner</span></span><br><span class=\"line\"><span class=\"attr\">subjects:</span></span><br><span class=\"line\"><span class=\"attr\">  - kind:</span> <span class=\"string\">ServiceAccount</span></span><br><span class=\"line\"><span class=\"attr\">    name:</span> <span class=\"string\">nfs-client-provisioner</span></span><br><span class=\"line\"><span class=\"attr\">    namespace:</span> <span class=\"string\">default</span></span><br><span class=\"line\"><span class=\"attr\">roleRef:</span></span><br><span class=\"line\"><span class=\"attr\">  kind:</span> <span class=\"string\">ClusterRole</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">nfs-client-provisioner-runner</span></span><br><span class=\"line\"><span class=\"attr\">  apiGroup:</span> <span class=\"string\">rbac.authorization.k8s.io</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Role</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">rbac.authorization.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">leader-locking-nfs-client-provisioner</span></span><br><span class=\"line\"><span class=\"attr\">rules:</span></span><br><span class=\"line\"><span class=\"attr\">  - apiGroups:</span> <span class=\"string\">[\"\"]</span></span><br><span class=\"line\"><span class=\"attr\">    resources:</span> <span class=\"string\">[\"endpoints\"]</span></span><br><span class=\"line\"><span class=\"attr\">    verbs:</span> <span class=\"string\">[\"get\",</span> <span class=\"string\">\"list\"</span><span class=\"string\">,</span> <span class=\"string\">\"watch\"</span><span class=\"string\">,</span> <span class=\"string\">\"create\"</span><span class=\"string\">,</span> <span class=\"string\">\"update\"</span><span class=\"string\">,</span> <span class=\"string\">\"patch\"</span><span class=\"string\">]</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">RoleBinding</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">rbac.authorization.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">leader-locking-nfs-client-provisioner</span></span><br><span class=\"line\"><span class=\"attr\">subjects:</span></span><br><span class=\"line\"><span class=\"attr\">  - kind:</span> <span class=\"string\">ServiceAccount</span></span><br><span class=\"line\"><span class=\"attr\">    name:</span> <span class=\"string\">nfs-client-provisioner</span></span><br><span class=\"line\">    <span class=\"comment\"># replace with namespace where provisioner is deployed</span></span><br><span class=\"line\"><span class=\"attr\">    namespace:</span> <span class=\"string\">default</span></span><br><span class=\"line\"><span class=\"attr\">roleRef:</span></span><br><span class=\"line\"><span class=\"attr\">  kind:</span> <span class=\"string\">Role</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">leader-locking-nfs-client-provisioner</span></span><br><span class=\"line\"><span class=\"attr\">  apiGroup:</span> <span class=\"string\">rbac.authorization.k8s.io</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"部署nfs环境-创建nfs存储类\"><a href=\"#部署nfs环境-创建nfs存储类\" class=\"headerlink\" title=\"部署nfs环境(创建nfs存储类)\"></a>部署nfs环境(创建nfs存储类)</h4><figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl apply -f rbac<span class=\"selector-class\">.yaml</span> -f class<span class=\"selector-class\">.yaml</span> -f deployment.yaml</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"k8s中部署nginx项目采用nfs存储\"><a href=\"#k8s中部署nginx项目采用nfs存储\" class=\"headerlink\" title=\"k8s中部署nginx项目采用nfs存储\"></a>k8s中部署nginx项目采用nfs存储</h3><h4 id=\"部署nginx-deployment-nfs-yaml-测试nfs\"><a href=\"#部署nginx-deployment-nfs-yaml-测试nfs\" class=\"headerlink\" title=\"部署nginx-deployment-nfs.yaml(测试nfs)\"></a>部署nginx-deployment-nfs.yaml(测试nfs)</h4><blockquote>\n<p>这种方式会创建一个pvc 挂载到多个pod中,这种方式适合nginx-html挂载</p>\n</blockquote>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">PersistentVolumeClaim</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">html0-deploy-nfs</span></span><br><span class=\"line\"><span class=\"attr\">  annotations:</span></span><br><span class=\"line\">    <span class=\"string\">volume.beta.kubernetes.io/storage-class:</span> <span class=\"string\">'nfs'</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\">  accessModes:</span></span><br><span class=\"line\"><span class=\"bullet\">    -</span> <span class=\"string\">ReadWriteMany</span></span><br><span class=\"line\"><span class=\"attr\">  resources:</span></span><br><span class=\"line\"><span class=\"attr\">    requests:</span></span><br><span class=\"line\"><span class=\"attr\">      storage:</span> <span class=\"number\">1</span><span class=\"string\">Gi</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">extensions/v1beta1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Deployment</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">nginx0-deploy</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\">  replicas:</span> <span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"attr\">  template:</span></span><br><span class=\"line\"><span class=\"attr\">    metadata:</span></span><br><span class=\"line\"><span class=\"attr\">      labels:</span></span><br><span class=\"line\"><span class=\"attr\">        app:</span> <span class=\"string\">nginx0-deploy</span></span><br><span class=\"line\"><span class=\"attr\">    spec:</span></span><br><span class=\"line\"><span class=\"attr\">      containers:</span></span><br><span class=\"line\"><span class=\"attr\">      - name:</span> <span class=\"string\">nginx0-deploy</span></span><br><span class=\"line\"><span class=\"attr\">        image:</span> <span class=\"string\">hub.boqii.com/bq/nginx:1.15.12</span></span><br><span class=\"line\"><span class=\"attr\">        ports:</span></span><br><span class=\"line\"><span class=\"attr\">        - containerPort:</span> <span class=\"number\">80</span></span><br><span class=\"line\"><span class=\"attr\">        volumeMounts:</span></span><br><span class=\"line\"><span class=\"attr\">        - name:</span> <span class=\"string\">html0-deploy-nfs</span></span><br><span class=\"line\"><span class=\"attr\">          mountPath:</span> <span class=\"string\">/usr/share/nginx/html</span></span><br><span class=\"line\"><span class=\"attr\">        - name:</span> <span class=\"string\">nginx-config</span></span><br><span class=\"line\"><span class=\"attr\">          mountPath:</span> <span class=\"string\">\"/etc/nginx/conf.d\"</span></span><br><span class=\"line\"><span class=\"attr\">      volumes:</span></span><br><span class=\"line\"><span class=\"attr\">      - name:</span> <span class=\"string\">nginx-config</span></span><br><span class=\"line\"><span class=\"attr\">        configMap:</span></span><br><span class=\"line\"><span class=\"attr\">            name:</span> <span class=\"string\">nginx-config</span></span><br><span class=\"line\"><span class=\"attr\">      - name:</span> <span class=\"string\">html0-deploy-nfs</span></span><br><span class=\"line\"><span class=\"attr\">        persistentVolumeClaim:</span></span><br><span class=\"line\"><span class=\"attr\">          claimName:</span> <span class=\"string\">html0-deploy-nfs</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ConfigMap</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">nginx-config</span></span><br><span class=\"line\"><span class=\"attr\">data:</span></span><br><span class=\"line\">  <span class=\"string\">default.conf:</span> <span class=\"string\">|</span></span><br><span class=\"line\"><span class=\"string\">            server &#123;</span></span><br><span class=\"line\"><span class=\"string\">              listen       80;</span></span><br><span class=\"line\"><span class=\"string\">              server_name  localhost;</span></span><br><span class=\"line\"><span class=\"string\">              root   /usr/share/nginx/html/;</span></span><br><span class=\"line\"><span class=\"string\">              access_log  /var/log/nginx/host_access.log;</span></span><br><span class=\"line\"><span class=\"string\">              error_log  /var/log/nginx/host_error.log debug;</span></span><br><span class=\"line\"><span class=\"string\">              location / &#123;</span></span><br><span class=\"line\"><span class=\"string\">                  root   /usr/share/nginx/html/;</span></span><br><span class=\"line\"><span class=\"string\">                  index  index.html index.htm index.php;</span></span><br><span class=\"line\"><span class=\"string\">              &#125;</span></span><br><span class=\"line\"><span class=\"string\">              error_page   500 502 503 504  /50x.html;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">              location = /50x.html &#123;</span></span><br><span class=\"line\"><span class=\"string\">                  root   /usr/share/nginx/html;</span></span><br><span class=\"line\"><span class=\"string\">              &#125;</span></span><br><span class=\"line\"><span class=\"string\">              &#125;</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"部署nginx-statefulset-nfs-yaml-测试nfs\"><a href=\"#部署nginx-statefulset-nfs-yaml-测试nfs\" class=\"headerlink\" title=\"部署nginx-statefulset-nfs.yaml(测试nfs)\"></a>部署nginx-statefulset-nfs.yaml(测试nfs)</h4><blockquote>\n<p>这里statefulset 方式会创建多个pvc, 每个pod的html就可以都不一样!</p>\n</blockquote>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1beta1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">StatefulSet</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">nginx3</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\">  serviceName:</span> <span class=\"string\">\"nginx\"</span></span><br><span class=\"line\"><span class=\"attr\">  replicas:</span> <span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"attr\">  volumeClaimTemplates:</span></span><br><span class=\"line\"><span class=\"attr\">  - metadata:</span></span><br><span class=\"line\"><span class=\"attr\">      name:</span> <span class=\"string\">html</span></span><br><span class=\"line\"><span class=\"attr\">      annotations:</span></span><br><span class=\"line\">        <span class=\"string\">volume.beta.kubernetes.io/storage-class:</span> <span class=\"string\">\"nfs\"</span> <span class=\"comment\"># 这里配置 上面创建的 storageclass 的名称</span></span><br><span class=\"line\"><span class=\"attr\">    spec:</span></span><br><span class=\"line\"><span class=\"attr\">      accessModes:</span> <span class=\"string\">[</span> <span class=\"string\">\"ReadWriteOnce\"</span> <span class=\"string\">]</span></span><br><span class=\"line\"><span class=\"attr\">      resources:</span></span><br><span class=\"line\"><span class=\"attr\">        requests:</span></span><br><span class=\"line\"><span class=\"attr\">          storage:</span> <span class=\"number\">2</span><span class=\"string\">Gi</span></span><br><span class=\"line\"><span class=\"attr\">  template:</span></span><br><span class=\"line\"><span class=\"attr\">    metadata:</span></span><br><span class=\"line\"><span class=\"attr\">      labels:</span></span><br><span class=\"line\"><span class=\"attr\">        app:</span> <span class=\"string\">nginx</span></span><br><span class=\"line\"><span class=\"attr\">    spec:</span></span><br><span class=\"line\"><span class=\"attr\">      containers:</span></span><br><span class=\"line\"><span class=\"attr\">      - name:</span> <span class=\"string\">nginx</span></span><br><span class=\"line\"><span class=\"attr\">        image:</span> <span class=\"string\">hub.boqii.com/bq/nginx:1.15.12</span></span><br><span class=\"line\"><span class=\"attr\">        volumeMounts:</span></span><br><span class=\"line\"><span class=\"attr\">        - mountPath:</span> <span class=\"string\">\"/usr/share/nginx/html/\"</span></span><br><span class=\"line\"><span class=\"attr\">          name:</span> <span class=\"string\">html</span></span><br><span class=\"line\"><span class=\"attr\">        - mountPath:</span> <span class=\"string\">\"/etc/nginx/conf.d\"</span></span><br><span class=\"line\"><span class=\"attr\">          name:</span> <span class=\"string\">nginx-config</span></span><br><span class=\"line\"><span class=\"attr\">      volumes:</span></span><br><span class=\"line\"><span class=\"attr\">      - name:</span> <span class=\"string\">nginx-config</span></span><br><span class=\"line\"><span class=\"attr\">        configMap:</span></span><br><span class=\"line\"><span class=\"attr\">            name:</span> <span class=\"string\">nginx-config</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ConfigMap</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">nginx-config</span></span><br><span class=\"line\"><span class=\"attr\">data:</span></span><br><span class=\"line\">  <span class=\"string\">default.conf:</span> <span class=\"string\">|</span></span><br><span class=\"line\"><span class=\"string\">            server &#123;</span></span><br><span class=\"line\"><span class=\"string\">              listen       80;</span></span><br><span class=\"line\"><span class=\"string\">              server_name  localhost;</span></span><br><span class=\"line\"><span class=\"string\">              root   /usr/share/nginx/html/;</span></span><br><span class=\"line\"><span class=\"string\">              access_log  /var/log/nginx/host_access.log;</span></span><br><span class=\"line\"><span class=\"string\">              error_log  /var/log/nginx/host_error.log debug;</span></span><br><span class=\"line\"><span class=\"string\">              location / &#123;</span></span><br><span class=\"line\"><span class=\"string\">                  root   /usr/share/nginx/html/;</span></span><br><span class=\"line\"><span class=\"string\">                  index  index.html index.htm index.php;</span></span><br><span class=\"line\"><span class=\"string\">              &#125;</span></span><br><span class=\"line\"><span class=\"string\">              error_page   500 502 503 504  /50x.html;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">              location = /50x.html &#123;</span></span><br><span class=\"line\"><span class=\"string\">                  root   /usr/share/nginx/html;</span></span><br><span class=\"line\"><span class=\"string\">              &#125;</span></span><br><span class=\"line\"><span class=\"string\">              &#125;</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"另外说明一下将nfs作为文件存储类似mount方式-这种方式不适用于多容器自动化部署-显然这种并不适合ceph-rbd存储-cephfs是可以的\"><a href=\"#另外说明一下将nfs作为文件存储类似mount方式-这种方式不适用于多容器自动化部署-显然这种并不适合ceph-rbd存储-cephfs是可以的\" class=\"headerlink\" title=\"另外说明一下将nfs作为文件存储类似mount方式,这种方式不适用于多容器自动化部署 ,显然这种并不适合ceph rbd存储, cephfs是可以的\"></a>另外说明一下将nfs作为文件存储类似mount方式,这种方式不适用于多容器自动化部署 ,显然这种并不适合ceph rbd存储, cephfs是可以的</h3><h4 id=\"首先需要在nfs目录创建需要挂载的目录\"><a href=\"#首先需要在nfs目录创建需要挂载的目录\" class=\"headerlink\" title=\"首先需要在nfs目录创建需要挂载的目录\"></a>首先需要在nfs目录创建需要挂载的目录</h4><figure class=\"highlight haskell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#例如</span></span><br><span class=\"line\"><span class=\"title\">mkdir</span> -p /<span class=\"class\"><span class=\"keyword\">data</span>/nfs/k8s-db-t/mysql-<span class=\"keyword\">data</span>-dev</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"在部署的yml中直接mount-nfs的目录\"><a href=\"#在部署的yml中直接mount-nfs的目录\" class=\"headerlink\" title=\"在部署的yml中直接mount nfs的目录\"></a>在部署的yml中直接mount nfs的目录</h4><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">extensions/v1beta1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Deployment</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">mysql-server</span></span><br><span class=\"line\"><span class=\"attr\">  namespace:</span> <span class=\"string\">devops</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\">  replicas:</span> <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"attr\">  template:</span></span><br><span class=\"line\"><span class=\"attr\">    metadata:</span></span><br><span class=\"line\"><span class=\"attr\">      labels:</span></span><br><span class=\"line\"><span class=\"attr\">        app:</span> <span class=\"string\">mysql-server</span></span><br><span class=\"line\"><span class=\"attr\">    spec:</span></span><br><span class=\"line\"><span class=\"attr\">      containers:</span></span><br><span class=\"line\"><span class=\"attr\">      - image:</span> <span class=\"attr\">mysql:5.7.16</span></span><br><span class=\"line\"><span class=\"attr\">        imagePullPolicy:</span> <span class=\"string\">Always</span></span><br><span class=\"line\"><span class=\"attr\">        name:</span> <span class=\"string\">mysql-server</span></span><br><span class=\"line\"><span class=\"attr\">        ports:</span></span><br><span class=\"line\"><span class=\"attr\">        - containerPort:</span> <span class=\"number\">3306</span></span><br><span class=\"line\"><span class=\"attr\">          protocol:</span> <span class=\"string\">TCP</span></span><br><span class=\"line\"><span class=\"attr\">        volumeMounts:</span></span><br><span class=\"line\"><span class=\"attr\">          - name:</span> <span class=\"string\">mysql-data</span></span><br><span class=\"line\"><span class=\"attr\">            mountPath:</span> <span class=\"string\">/var/lib/mysql</span></span><br><span class=\"line\"><span class=\"attr\">        resources:</span></span><br><span class=\"line\"><span class=\"attr\">          requests:</span></span><br><span class=\"line\"><span class=\"attr\">            cpu:</span> <span class=\"number\">40</span><span class=\"string\">m</span></span><br><span class=\"line\"><span class=\"attr\">            memory:</span> <span class=\"number\">32</span><span class=\"string\">Mi</span></span><br><span class=\"line\"><span class=\"attr\">          limits:</span></span><br><span class=\"line\"><span class=\"attr\">            cpu:</span> <span class=\"string\">\"300m\"</span></span><br><span class=\"line\"><span class=\"attr\">            memory:</span> <span class=\"number\">256</span><span class=\"string\">Mi</span></span><br><span class=\"line\"><span class=\"attr\">        env:</span></span><br><span class=\"line\"><span class=\"attr\">        - name:</span> <span class=\"string\">MYSQL_ROOT_PASSWORD</span></span><br><span class=\"line\"><span class=\"attr\">          value:</span> <span class=\"string\">\"boqii.123\"</span></span><br><span class=\"line\"><span class=\"attr\">        - name:</span> <span class=\"string\">MYSQL_DATABASE</span></span><br><span class=\"line\"><span class=\"attr\">          value:</span> <span class=\"string\">\"gogs\"</span></span><br><span class=\"line\"><span class=\"attr\">        - name:</span> <span class=\"string\">MYSQL_USER</span></span><br><span class=\"line\"><span class=\"attr\">          value:</span> <span class=\"string\">\"gogs\"</span></span><br><span class=\"line\"><span class=\"attr\">        - name:</span> <span class=\"string\">MYSQL_PASSWORD</span></span><br><span class=\"line\"><span class=\"attr\">          value:</span> <span class=\"string\">\"gogspass\"</span></span><br><span class=\"line\"><span class=\"attr\">        - name:</span> <span class=\"string\">TZ</span></span><br><span class=\"line\"><span class=\"attr\">          value:</span> <span class=\"string\">\"Asia/Shanghai\"</span></span><br><span class=\"line\"><span class=\"attr\">      volumes:</span></span><br><span class=\"line\"><span class=\"attr\">        - name:</span> <span class=\"string\">mysql-data</span></span><br><span class=\"line\"><span class=\"attr\">          nfs:</span></span><br><span class=\"line\"><span class=\"attr\">            server:</span> <span class=\"number\">172.16</span><span class=\"number\">.76</span><span class=\"number\">.134</span></span><br><span class=\"line\"><span class=\"attr\">            path:</span> <span class=\"string\">/data/nfs/k8s-db-t/mysql-data-dev</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Service</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">mysql-service</span></span><br><span class=\"line\"><span class=\"attr\">  namespace:</span> <span class=\"string\">devops</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\">  clusterIP:</span> <span class=\"string\">None</span></span><br><span class=\"line\"><span class=\"attr\">  selector:</span></span><br><span class=\"line\"><span class=\"attr\">    app:</span> <span class=\"string\">mysql-server</span></span><br><span class=\"line\"><span class=\"attr\">  ports:</span></span><br><span class=\"line\"><span class=\"attr\">  - name:</span> <span class=\"string\">http</span></span><br><span class=\"line\"><span class=\"attr\">    port:</span> <span class=\"number\">3306</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<h1 id=\"第二部分-ceph\"><a href=\"#第二部分-ceph\" class=\"headerlink\" title=\"第二部分 ceph\"></a>第二部分 ceph</h1><h3 id=\"k8s部署storageclass环境-ceph\"><a href=\"#k8s部署storageclass环境-ceph\" class=\"headerlink\" title=\"k8s部署storageclass环境-ceph\"></a>k8s部署storageclass环境-ceph</h3><h4 id=\"如果集群是用kubeadm部署的，由于controller-manager官方镜像中没有rbd命令，所以我们要导入外部配置\"><a href=\"#如果集群是用kubeadm部署的，由于controller-manager官方镜像中没有rbd命令，所以我们要导入外部配置\" class=\"headerlink\" title=\"如果集群是用kubeadm部署的，由于controller-manager官方镜像中没有rbd命令，所以我们要导入外部配置\"></a>如果集群是用kubeadm部署的，由于controller-manager官方镜像中没有rbd命令，所以我们要导入外部配置</h4><figure class=\"highlight awk\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git clone https:<span class=\"regexp\">//gi</span>thub.com<span class=\"regexp\">/kubernetes-incubator/</span>external-storage.git</span><br><span class=\"line\">cd external-storage<span class=\"regexp\">/ceph/</span>rbd<span class=\"regexp\">/deploy</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>以下整合在一个文件, 两个版本,默认 和retain</p>\n</blockquote>\n<h4 id=\"storageclass-cepm-com-rbd-yaml\"><a href=\"#storageclass-cepm-com-rbd-yaml\" class=\"headerlink\" title=\"storageclass-cepm.com-rbd.yaml\"></a>storageclass-cepm.com-rbd.yaml</h4><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">data:</span></span><br><span class=\"line\"><span class=\"attr\">  key:</span> <span class=\"string\">QVFEYzJRbGQ1VjI5THhBQU00WUtPUU5sUVJqdWtLSWJ2VDZ0a3c9PQ==</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Secret</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">ceph-secret-admin</span></span><br><span class=\"line\"><span class=\"attr\">type:</span> <span class=\"string\">kubernetes.io/rbd</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">data:</span></span><br><span class=\"line\"><span class=\"attr\">  key:</span> <span class=\"string\">QVFEYzJRbGQ1VjI5THhBQU00WUtPUU5sUVJqdWtLSWJ2VDZ0a3c9PQ==</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Secret</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">ceph-secret-admin</span></span><br><span class=\"line\"><span class=\"attr\">  namespace:</span> <span class=\"string\">ns-elastic</span></span><br><span class=\"line\"><span class=\"attr\">type:</span> <span class=\"string\">kubernetes.io/rbd</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">storage.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">StorageClass</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">rbd</span></span><br><span class=\"line\"><span class=\"attr\">  annotations:</span></span><br><span class=\"line\">    <span class=\"string\">storageclass.kubernetes.io/is-default-class:</span> <span class=\"string\">\"true\"</span></span><br><span class=\"line\"><span class=\"attr\">provisioner:</span> <span class=\"string\">ceph.com/rbd</span></span><br><span class=\"line\"><span class=\"attr\">parameters:</span></span><br><span class=\"line\"><span class=\"attr\">  monitors:</span> <span class=\"number\">172.16</span><span class=\"number\">.76</span><span class=\"number\">.134</span><span class=\"string\">:6789</span></span><br><span class=\"line\"><span class=\"attr\">  adminId:</span> <span class=\"string\">admin</span></span><br><span class=\"line\"><span class=\"attr\">  adminSecretName:</span> <span class=\"string\">ceph-secret-admin</span></span><br><span class=\"line\"><span class=\"attr\">  adminSecretNamespace:</span> <span class=\"string\">default</span></span><br><span class=\"line\"><span class=\"attr\">  pool:</span> <span class=\"string\">storageclass-rbd</span></span><br><span class=\"line\"><span class=\"attr\">  userId:</span> <span class=\"string\">admin</span></span><br><span class=\"line\"><span class=\"attr\">  userSecretName:</span> <span class=\"string\">ceph-secret-admin</span></span><br><span class=\"line\"><span class=\"attr\">  fsType:</span> <span class=\"string\">ext4</span></span><br><span class=\"line\"><span class=\"attr\">  imageFormat:</span> <span class=\"string\">\"2\"</span></span><br><span class=\"line\"><span class=\"attr\">  imageFeatures:</span> <span class=\"string\">\"layering\"</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"storageclass-cepm-com-rbd-retain-yaml\"><a href=\"#storageclass-cepm-com-rbd-retain-yaml\" class=\"headerlink\" title=\"storageclass-cepm.com-rbd-retain.yaml\"></a>storageclass-cepm.com-rbd-retain.yaml</h4><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">data:</span></span><br><span class=\"line\"><span class=\"attr\">  key:</span> <span class=\"string\">QVFEYzJRbGQ1VjI5THhBQU00WUtPUU5sUVJqdWtLSWJ2VDZ0a3c9PQ==</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Secret</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">ceph-secret-admin</span></span><br><span class=\"line\"><span class=\"attr\">type:</span> <span class=\"string\">kubernetes.io/rbd</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">data:</span></span><br><span class=\"line\"><span class=\"attr\">  key:</span> <span class=\"string\">QVFEYzJRbGQ1VjI5THhBQU00WUtPUU5sUVJqdWtLSWJ2VDZ0a3c9PQ==</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Secret</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">ceph-secret-admin</span></span><br><span class=\"line\"><span class=\"attr\">  namespace:</span> <span class=\"string\">ns-elastic</span></span><br><span class=\"line\"><span class=\"attr\">type:</span> <span class=\"string\">kubernetes.io/rbd</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">storage.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">StorageClass</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">rbd-retain</span></span><br><span class=\"line\"><span class=\"attr\">  annotations:</span></span><br><span class=\"line\">    <span class=\"string\">storageclass.kubernetes.io/is-default-class:</span> <span class=\"string\">\"false\"</span></span><br><span class=\"line\"><span class=\"attr\">provisioner:</span> <span class=\"string\">ceph.com/rbd</span></span><br><span class=\"line\"><span class=\"attr\">reclaimPolicy:</span> <span class=\"string\">Retain</span></span><br><span class=\"line\"><span class=\"attr\">parameters:</span></span><br><span class=\"line\"><span class=\"attr\">  monitors:</span> <span class=\"number\">172.16</span><span class=\"number\">.76</span><span class=\"number\">.134</span><span class=\"string\">:6789</span></span><br><span class=\"line\"><span class=\"attr\">  adminId:</span> <span class=\"string\">admin</span></span><br><span class=\"line\"><span class=\"attr\">  adminSecretName:</span> <span class=\"string\">ceph-secret-admin</span></span><br><span class=\"line\"><span class=\"attr\">  adminSecretNamespace:</span> <span class=\"string\">default</span></span><br><span class=\"line\"><span class=\"attr\">  pool:</span> <span class=\"string\">storageclass-rbd-retain</span></span><br><span class=\"line\"><span class=\"attr\">  userId:</span> <span class=\"string\">admin</span></span><br><span class=\"line\"><span class=\"attr\">  userSecretName:</span> <span class=\"string\">ceph-secret-admin</span></span><br><span class=\"line\"><span class=\"attr\">  fsType:</span> <span class=\"string\">ext4</span></span><br><span class=\"line\"><span class=\"attr\">  imageFormat:</span> <span class=\"string\">\"2\"</span></span><br><span class=\"line\"><span class=\"attr\">  imageFeatures:</span> <span class=\"string\">\"layering\"</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"k8s中部署nginx项目采用-ceph-com-rbd-和nfs类似-这里省略\"><a href=\"#k8s中部署nginx项目采用-ceph-com-rbd-和nfs类似-这里省略\" class=\"headerlink\" title=\"k8s中部署nginx项目采用 ceph.com/rbd 和nfs类似, 这里省略\"></a>k8s中部署nginx项目采用 ceph.com/rbd 和nfs类似, 这里省略</h4><blockquote>\n<p>以上采用的是persistentVolumeClaim 方式动态分配全部内容</p>\n</blockquote>"},{"title":"首次搭建hexo博客系统","date":"2019-09-19T09:24:53.000Z","copyright":true,"description":"介绍一些hexo常用的配置和优化","top":10,"_content":"\n### 1 安装hexo\n- 1.1 在mac上安装\n```\n# 安装node\nbrew install node npm\n```\n\n- 1.2 在linux安装\n```\n# 安装node10\ncurl -sL https://rpm.nodesource.com/setup_10.x | bash -\nyum install -y nodejs\n```\n\n- 1.3 安装hexo\n```\n# 安装hexo\nnpm install -g hexo\n```\n\n\n### 2 初始化\n```\ncd /data/github/\n# 初始化\n\nhexo init blog\n# 框架安装\nnpm install\n\n#安装 Hexo 关于启动服务器的插件\nnpm install hexo-server --save\n\n# 启动服务器, 本地查看效果, 如果不指定端口，默认为4000\nhexo server\n\n```\n\n### 3 主题和配置\n- 下载主题：[https://github.com/theme-next/hexo-theme-next](https://github.com/theme-next/hexo-theme-next)\n```\nunzip hexo-theme-next-master.zip\nmv hexo-theme-next-master $blog/themes/\n```\n\n- 修改主题配置 _config.yml 中的其他属性\n```\ntitle: Zhangzhiwei's Blog\n...\ntheme: hexo-theme-next\n...\nscheme: Mist\n```\n\n### 4. 编写更新博客\n\n- 创建博客\n```\nhexo new '第一个博客'\n```\n\n- cat source/_posts/第一个博客.md\n```\ntitle: 第一个博客\ndate: 2019-09-19 16:58:01\ntags:\n  - hexo\ncategories:\n  - hexo学习\n```\n\n- github 创建一个Repository仓库\n```\n1. 仓库名字必须是 xxx.github.io\n2. 在settings中 勾选Template repository\n3. 记得添加自己的ssh\n```\n\n\n\n- github配置\n```\n # 安装 hexo 关于 git 的组件\nnpm install hexo-deployer-git --save\n```\n\n- 在_config.yml 中为 git 添加配置\n```\ndeploy:\n  type: git\n  repository: git@github.com:*/*.github.io.git\n  branch: master\n```\n\n- 查看是否能提交代码github\n```\nssh -T -ai ~/.ssh/id_rsa git@github.com\n```\n\n- 部署\n```\nhexo g\nhexo d\n或者\nhexo d -g\n```\n\n### 5. next6让首页文字预览显示\n- 5.1 方法一: 自动形成摘要,默认截取的长度为 150 字符\n```\n1. 找到主题的配置文件(themes/next/_config.yml)\n2. 修改auto_excerpt,把enable改为对应的false改为true\n3. hexo d -g\n```\n\n- 5.2 方法二: 博客内容中添加 < !--more-->\n```\n# 安装node\nbrew install node npm\n <!-- more -->\n```\n\n- 5.3 方法三: 在文章中的front-matter中添加description，并提供文章摘录,这种方式只会在首页列表中显示文章的摘要内容，进入文章详情后不会再显示。\n```\ntitle: 部署elk7.2.0\ndate: 2019-09-19 17:59:53\ncopyright: true\ntags:\n  - k8s\n  - elk\n  - elk7\ncategories:\n  - 技术文档\n  - elk\ndescription: 本文主要是简单单机版部署elk7体验,  并非高可用集群方式部署, 部分安装步骤省略. 主要是记录yml配置文件, 仅供参考. 详细内容请点击下方阅读全文, 非常感谢!\n```\n\n\n### 6. next6添加搜索功能\n```\n1. npm install hexo-generator-searchdb --save\n2. 全局配置文件_config.yml\nsearch:\n  path: search.xml\n  field: post\n  format: html\n  limit: 10000\n3. 修改主题的_config.yml\nlocal_search:\n  enable: true\n```\n\n### 7. next6 Mist字体的 首页文章间距和首页页宽,字体\n- 7.1 首页文章间距\n\n\t```\n\t增加一些内容: source/css/_schemes/Mist/_posts-expanded.styl\n\t.posts-expand .post {\n\t  margin-top: 30px;\n\t  margin-bottom: 30px;\n\t}\n\t\n\t```\n\n- 7.2 页宽\n\n\t```\n\tsource/css/_variables/base.styl\n\t$content-desktop                = 900px\n\t$content-desktop-large          = 1000px\n\t$content-desktop-largest        = 1100px\n\t```\n\n- 7.3 字体大小\n\n\t```\n\tthemes/next/source/css/_variables/base.styl\n\t\n\t$font-size-base           = 0.95em;\n\t$font-size-base           = unit(hexo-config('font.global.size'), em) if hexo-config('font.global.size') is a 'unit';\n\t$font-size-smallest       = .75em;\n\t$font-size-smaller        = .8125em;\n\t$font-size-small          = .855em;\n\t$font-size-medium         = 0.95em;\n\t$font-size-large          = 0.975em;\n\t$font-size-larger         = 1.em;\n\t$font-size-largest        = 1.125em;\n\t```\n\n### 8. 添加网格\n-  8.1 自定义方式修改\n\n\t```\n\t# 新创建自定义文件\n\tcat themes/next/source/css/_custom/custom.styl\n\t// 主页文章添加阴影效果\n\t.post {\n\tmargin-top: 60px;\n\tmargin-bottom: 60px;\n\tpadding: 25px;\n\t-webkit-box-shadow: 0 0 5px rgba(202, 203, 203, .5);\n\t-moz-box-shadow: 0 0 5px rgba(202, 203, 204, .5);\n\t}\n\n\t# 修改config文件\n\tvim ./themes/next/_config.yml\n\tcustom: custom\n\t```\n\n- 8.2 next6版本修改方式\n\t> 参考: [hexo6--next美化整理](https://www.jianshu.com/p/ec2e6c8a1d89)\n\n\t1. 修改 themes/next/layout/_layout.swig\n\t```\n\t{% if theme.canvas_nest %}\n\t<script type=\"text/javascript\" src=\"//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js\">\n\t</script>\n\t{% endif %}\n\t```\n\n\t> 将上述代码防止在< /body> 前就可以了(注意不要放在< /head>的后面)。\n\n\t2. 修改主题的_config.yml\n\n\t```\n\tcanvas_nest: true\n\n\t//color: 线条颜色, 默认: '0,0,0'；三个数字分别为(R,G,B)\n\t//opacity: 线条透明度（0~1）, 默认: 0.5\n\t//count: 线条的总数量, 默认: 150\n\t//zIndex: 背景的z-index属性，css属性用于控制所在层的位置, 默认: -1\n\t```\n> 注意:\n我这里打开提示缺少 canvas-nest.min.js文件,这里是手动copy的一份写到 source/lib/canvas-nest/canvas-nest.min.js\n\n```\n!function(){function o(w,v,i){return w.getAttribute(v)||i}function j(i){return document.getElementsByTagName(i)}function l(){var i=j(\"script\"),w=i.length,v=i[w-1];return{l:w,z:o(v,\"zIndex\",-1),o:o(v,\"opacity\",0.5),c:o(v,\"color\",\"0,0,0\"),n:o(v,\"count\",99)}}function k(){r=u.width=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,n=u.height=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight}function b(){e.clearRect(0,0,r,n);var w=[f].concat(t);var x,v,A,B,z,y;t.forEach(function(i){i.x+=i.xa,i.y+=i.ya,i.xa*=i.x>r||i.x<0?-1:1,i.ya*=i.y>n||i.y<0?-1:1,e.fillRect(i.x-0.5,i.y-0.5,1,1);for(v=0;v<w.length;v++){x=w[v];if(i!==x&&null!==x.x&&null!==x.y){B=i.x-x.x,z=i.y-x.y,y=B*B+z*z;y<x.max&&(x===f&&y>=x.max/2&&(i.x-=0.03*B,i.y-=0.03*z),A=(x.max-y)/x.max,e.beginPath(),e.lineWidth=A/2,e.strokeStyle=\"rgba(\"+s.c+\",\"+(A+0.2)+\")\",e.moveTo(i.x,i.y),e.lineTo(x.x,x.y),e.stroke())}}w.splice(w.indexOf(i),1)}),m(b)}var u=document.createElement(\"canvas\"),s=l(),c=\"c_n\"+s.l,e=u.getContext(\"2d\"),r,n,m=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(i){window.setTimeout(i,1000/45)},a=Math.random,f={x:null,y:null,max:20000};u.id=c;u.style.cssText=\"position:fixed;top:0;left:0;z-index:\"+s.z+\";opacity:\"+s.o;j(\"body\")[0].appendChild(u);k(),window.onresize=k;window.onmousemove=function(i){i=i||window.event,f.x=i.clientX,f.y=i.clientY},window.onmouseout=function(){f.x=null,f.y=null};for(var t=[],p=0;s.n>p;p++){var h=a()*r,g=a()*n,q=2*a()-1,d=2*a()-1;t.push({x:h,y:g,xa:q,ya:d,max:6000})}setTimeout(function(){b()},100)}();%                                                                                                    zhangzw@MacBook-Pro  /data/github/blog   master ● \n```\n\n### 9. 添加评论功能\n\n- 9.1 注册leancloud\n ```\n 注册-> 验证邮箱-> 实名认证 -> 设置获取appid和appkey\n ```\n\n- 9.2 修改配置文件\n ```\n valine:\n   enable: true \n   appid: 'appid' \n   appkey: 'appkey' \n   placeholder: \"ヾﾉ≧∀≦)o 来呀！快活呀！~啦啦啦~ 啦啦啦啦~\" \n   visitor: true //这个打开页会统计文章阅读数\n ```\n\n\n\n\n### 10. next6添加字数统计 和阅读时长\n\n> [hexo-symbols-count-time](https://github.com/theme-next/hexo-symbols-count-time)\n\n- 10.1 安装node扩展\n ```\n npm install hexo-symbols-count-time --save\n ```\n\n- 10.2 修改全局配置 _config.yml\n ```\n symbols_count_time:\n   symbols: true\n   time: true\n   total_symbols: true\n   total_time: true\n   exclude_codeblock: false\n ```\n\n- 10.3 修改主题配置 _config.yml\n ```\n symbols_count_time:\n   separated_meta: true\n   item_text_post: true\n   item_text_total: false\n   awl: 4\n   wpm: 275\n   suffix: mins.\n ```\n\n\n\n### 11. next6 文章置顶功能\n\n- 11.1 安装node扩展 \n ```\n npm uninstall hexo-generator-index --save\n npm install hexo-generator-index-pin-top --save\n ```\n\n- 11.2 在文章开头添加置顶标识\n ```\n top: 10\n ```\n\n- 11.3 首页添加明显置顶标识\n ```\n themes/next/layout/_macro/post.swig 在<div class=\"post-meta\"> 下添加如下代码\n {% if post.top %}\n     <i class=\"fa fa-thumb-tack\"></i>\n     <font color=green>置顶</font>\n     <span class=\"post-meta-divider\">|</span>\n {% endif %}\n ```\n\n### 12. next6 开启标签和分类\n\n- 12.1 创建tags相关目录\n```\nhexo new page tags\nhexo new page categories\n```\n\n- 12.2 开启tags标签和分类\n```\nvim themes/next/_config.yml\ntags: /tags/ || tags\ncategories: /categories/ || th\n```\n\n- 12.3 修改tags站点文件\n```\ncat source/tags/index.md\n---\ntitle: tags\ndate: 2019-09-24 10:08:59\ntype: \"tags\"\nlayout: \"tags\"\ncomments: false\n---\n```\n\n- 12.4 修改categories站点文件\n```\ncat source/categories/index.md\n---\ntitle: categories\ndate: 2019-09-24 10:09:55\ntype: \"categories\"\nlayout: \"categories\"\ncomments: false\n---\n```\n\n- 12.5 去掉xxx.github.io/tags/ 页面的post-title(因为我的这个css左对齐了,默认是居中,所以很丑)\n```\n# 注释下面这段代码\nvim themes/nextv/layout/page.swig \n<!-- {% include '_partials/page/page-header.swig' %} -->\n```\n\n- 12.6 文章中多个tag和categories\n```\ntags:\n  - k8s\n  - k8s安装\ncategories:\n  - [k8s,安装]\n  - [技术文档]\n```\n","source":"_posts/首次搭建hexo博客系统.md","raw":"---\ntitle: 首次搭建hexo博客系统\ndate: 2019-09-19 17:24:53\ncopyright: true\ntags:\n  - hexo6\n  - hexo美化\ncategories: \n  - [有趣]\n  - [博客,美化]\ndescription: \"介绍一些hexo常用的配置和优化\"\ntop: 10\n---\n\n### 1 安装hexo\n- 1.1 在mac上安装\n```\n# 安装node\nbrew install node npm\n```\n\n- 1.2 在linux安装\n```\n# 安装node10\ncurl -sL https://rpm.nodesource.com/setup_10.x | bash -\nyum install -y nodejs\n```\n\n- 1.3 安装hexo\n```\n# 安装hexo\nnpm install -g hexo\n```\n\n\n### 2 初始化\n```\ncd /data/github/\n# 初始化\n\nhexo init blog\n# 框架安装\nnpm install\n\n#安装 Hexo 关于启动服务器的插件\nnpm install hexo-server --save\n\n# 启动服务器, 本地查看效果, 如果不指定端口，默认为4000\nhexo server\n\n```\n\n### 3 主题和配置\n- 下载主题：[https://github.com/theme-next/hexo-theme-next](https://github.com/theme-next/hexo-theme-next)\n```\nunzip hexo-theme-next-master.zip\nmv hexo-theme-next-master $blog/themes/\n```\n\n- 修改主题配置 _config.yml 中的其他属性\n```\ntitle: Zhangzhiwei's Blog\n...\ntheme: hexo-theme-next\n...\nscheme: Mist\n```\n\n### 4. 编写更新博客\n\n- 创建博客\n```\nhexo new '第一个博客'\n```\n\n- cat source/_posts/第一个博客.md\n```\ntitle: 第一个博客\ndate: 2019-09-19 16:58:01\ntags:\n  - hexo\ncategories:\n  - hexo学习\n```\n\n- github 创建一个Repository仓库\n```\n1. 仓库名字必须是 xxx.github.io\n2. 在settings中 勾选Template repository\n3. 记得添加自己的ssh\n```\n\n\n\n- github配置\n```\n # 安装 hexo 关于 git 的组件\nnpm install hexo-deployer-git --save\n```\n\n- 在_config.yml 中为 git 添加配置\n```\ndeploy:\n  type: git\n  repository: git@github.com:*/*.github.io.git\n  branch: master\n```\n\n- 查看是否能提交代码github\n```\nssh -T -ai ~/.ssh/id_rsa git@github.com\n```\n\n- 部署\n```\nhexo g\nhexo d\n或者\nhexo d -g\n```\n\n### 5. next6让首页文字预览显示\n- 5.1 方法一: 自动形成摘要,默认截取的长度为 150 字符\n```\n1. 找到主题的配置文件(themes/next/_config.yml)\n2. 修改auto_excerpt,把enable改为对应的false改为true\n3. hexo d -g\n```\n\n- 5.2 方法二: 博客内容中添加 < !--more-->\n```\n# 安装node\nbrew install node npm\n <!-- more -->\n```\n\n- 5.3 方法三: 在文章中的front-matter中添加description，并提供文章摘录,这种方式只会在首页列表中显示文章的摘要内容，进入文章详情后不会再显示。\n```\ntitle: 部署elk7.2.0\ndate: 2019-09-19 17:59:53\ncopyright: true\ntags:\n  - k8s\n  - elk\n  - elk7\ncategories:\n  - 技术文档\n  - elk\ndescription: 本文主要是简单单机版部署elk7体验,  并非高可用集群方式部署, 部分安装步骤省略. 主要是记录yml配置文件, 仅供参考. 详细内容请点击下方阅读全文, 非常感谢!\n```\n\n\n### 6. next6添加搜索功能\n```\n1. npm install hexo-generator-searchdb --save\n2. 全局配置文件_config.yml\nsearch:\n  path: search.xml\n  field: post\n  format: html\n  limit: 10000\n3. 修改主题的_config.yml\nlocal_search:\n  enable: true\n```\n\n### 7. next6 Mist字体的 首页文章间距和首页页宽,字体\n- 7.1 首页文章间距\n\n\t```\n\t增加一些内容: source/css/_schemes/Mist/_posts-expanded.styl\n\t.posts-expand .post {\n\t  margin-top: 30px;\n\t  margin-bottom: 30px;\n\t}\n\t\n\t```\n\n- 7.2 页宽\n\n\t```\n\tsource/css/_variables/base.styl\n\t$content-desktop                = 900px\n\t$content-desktop-large          = 1000px\n\t$content-desktop-largest        = 1100px\n\t```\n\n- 7.3 字体大小\n\n\t```\n\tthemes/next/source/css/_variables/base.styl\n\t\n\t$font-size-base           = 0.95em;\n\t$font-size-base           = unit(hexo-config('font.global.size'), em) if hexo-config('font.global.size') is a 'unit';\n\t$font-size-smallest       = .75em;\n\t$font-size-smaller        = .8125em;\n\t$font-size-small          = .855em;\n\t$font-size-medium         = 0.95em;\n\t$font-size-large          = 0.975em;\n\t$font-size-larger         = 1.em;\n\t$font-size-largest        = 1.125em;\n\t```\n\n### 8. 添加网格\n-  8.1 自定义方式修改\n\n\t```\n\t# 新创建自定义文件\n\tcat themes/next/source/css/_custom/custom.styl\n\t// 主页文章添加阴影效果\n\t.post {\n\tmargin-top: 60px;\n\tmargin-bottom: 60px;\n\tpadding: 25px;\n\t-webkit-box-shadow: 0 0 5px rgba(202, 203, 203, .5);\n\t-moz-box-shadow: 0 0 5px rgba(202, 203, 204, .5);\n\t}\n\n\t# 修改config文件\n\tvim ./themes/next/_config.yml\n\tcustom: custom\n\t```\n\n- 8.2 next6版本修改方式\n\t> 参考: [hexo6--next美化整理](https://www.jianshu.com/p/ec2e6c8a1d89)\n\n\t1. 修改 themes/next/layout/_layout.swig\n\t```\n\t{% if theme.canvas_nest %}\n\t<script type=\"text/javascript\" src=\"//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js\">\n\t</script>\n\t{% endif %}\n\t```\n\n\t> 将上述代码防止在< /body> 前就可以了(注意不要放在< /head>的后面)。\n\n\t2. 修改主题的_config.yml\n\n\t```\n\tcanvas_nest: true\n\n\t//color: 线条颜色, 默认: '0,0,0'；三个数字分别为(R,G,B)\n\t//opacity: 线条透明度（0~1）, 默认: 0.5\n\t//count: 线条的总数量, 默认: 150\n\t//zIndex: 背景的z-index属性，css属性用于控制所在层的位置, 默认: -1\n\t```\n> 注意:\n我这里打开提示缺少 canvas-nest.min.js文件,这里是手动copy的一份写到 source/lib/canvas-nest/canvas-nest.min.js\n\n```\n!function(){function o(w,v,i){return w.getAttribute(v)||i}function j(i){return document.getElementsByTagName(i)}function l(){var i=j(\"script\"),w=i.length,v=i[w-1];return{l:w,z:o(v,\"zIndex\",-1),o:o(v,\"opacity\",0.5),c:o(v,\"color\",\"0,0,0\"),n:o(v,\"count\",99)}}function k(){r=u.width=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,n=u.height=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight}function b(){e.clearRect(0,0,r,n);var w=[f].concat(t);var x,v,A,B,z,y;t.forEach(function(i){i.x+=i.xa,i.y+=i.ya,i.xa*=i.x>r||i.x<0?-1:1,i.ya*=i.y>n||i.y<0?-1:1,e.fillRect(i.x-0.5,i.y-0.5,1,1);for(v=0;v<w.length;v++){x=w[v];if(i!==x&&null!==x.x&&null!==x.y){B=i.x-x.x,z=i.y-x.y,y=B*B+z*z;y<x.max&&(x===f&&y>=x.max/2&&(i.x-=0.03*B,i.y-=0.03*z),A=(x.max-y)/x.max,e.beginPath(),e.lineWidth=A/2,e.strokeStyle=\"rgba(\"+s.c+\",\"+(A+0.2)+\")\",e.moveTo(i.x,i.y),e.lineTo(x.x,x.y),e.stroke())}}w.splice(w.indexOf(i),1)}),m(b)}var u=document.createElement(\"canvas\"),s=l(),c=\"c_n\"+s.l,e=u.getContext(\"2d\"),r,n,m=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(i){window.setTimeout(i,1000/45)},a=Math.random,f={x:null,y:null,max:20000};u.id=c;u.style.cssText=\"position:fixed;top:0;left:0;z-index:\"+s.z+\";opacity:\"+s.o;j(\"body\")[0].appendChild(u);k(),window.onresize=k;window.onmousemove=function(i){i=i||window.event,f.x=i.clientX,f.y=i.clientY},window.onmouseout=function(){f.x=null,f.y=null};for(var t=[],p=0;s.n>p;p++){var h=a()*r,g=a()*n,q=2*a()-1,d=2*a()-1;t.push({x:h,y:g,xa:q,ya:d,max:6000})}setTimeout(function(){b()},100)}();%                                                                                                    zhangzw@MacBook-Pro  /data/github/blog   master ● \n```\n\n### 9. 添加评论功能\n\n- 9.1 注册leancloud\n ```\n 注册-> 验证邮箱-> 实名认证 -> 设置获取appid和appkey\n ```\n\n- 9.2 修改配置文件\n ```\n valine:\n   enable: true \n   appid: 'appid' \n   appkey: 'appkey' \n   placeholder: \"ヾﾉ≧∀≦)o 来呀！快活呀！~啦啦啦~ 啦啦啦啦~\" \n   visitor: true //这个打开页会统计文章阅读数\n ```\n\n\n\n\n### 10. next6添加字数统计 和阅读时长\n\n> [hexo-symbols-count-time](https://github.com/theme-next/hexo-symbols-count-time)\n\n- 10.1 安装node扩展\n ```\n npm install hexo-symbols-count-time --save\n ```\n\n- 10.2 修改全局配置 _config.yml\n ```\n symbols_count_time:\n   symbols: true\n   time: true\n   total_symbols: true\n   total_time: true\n   exclude_codeblock: false\n ```\n\n- 10.3 修改主题配置 _config.yml\n ```\n symbols_count_time:\n   separated_meta: true\n   item_text_post: true\n   item_text_total: false\n   awl: 4\n   wpm: 275\n   suffix: mins.\n ```\n\n\n\n### 11. next6 文章置顶功能\n\n- 11.1 安装node扩展 \n ```\n npm uninstall hexo-generator-index --save\n npm install hexo-generator-index-pin-top --save\n ```\n\n- 11.2 在文章开头添加置顶标识\n ```\n top: 10\n ```\n\n- 11.3 首页添加明显置顶标识\n ```\n themes/next/layout/_macro/post.swig 在<div class=\"post-meta\"> 下添加如下代码\n {% if post.top %}\n     <i class=\"fa fa-thumb-tack\"></i>\n     <font color=green>置顶</font>\n     <span class=\"post-meta-divider\">|</span>\n {% endif %}\n ```\n\n### 12. next6 开启标签和分类\n\n- 12.1 创建tags相关目录\n```\nhexo new page tags\nhexo new page categories\n```\n\n- 12.2 开启tags标签和分类\n```\nvim themes/next/_config.yml\ntags: /tags/ || tags\ncategories: /categories/ || th\n```\n\n- 12.3 修改tags站点文件\n```\ncat source/tags/index.md\n---\ntitle: tags\ndate: 2019-09-24 10:08:59\ntype: \"tags\"\nlayout: \"tags\"\ncomments: false\n---\n```\n\n- 12.4 修改categories站点文件\n```\ncat source/categories/index.md\n---\ntitle: categories\ndate: 2019-09-24 10:09:55\ntype: \"categories\"\nlayout: \"categories\"\ncomments: false\n---\n```\n\n- 12.5 去掉xxx.github.io/tags/ 页面的post-title(因为我的这个css左对齐了,默认是居中,所以很丑)\n```\n# 注释下面这段代码\nvim themes/nextv/layout/page.swig \n<!-- {% include '_partials/page/page-header.swig' %} -->\n```\n\n- 12.6 文章中多个tag和categories\n```\ntags:\n  - k8s\n  - k8s安装\ncategories:\n  - [k8s,安装]\n  - [技术文档]\n```\n","slug":"首次搭建hexo博客系统","published":1,"updated":"2019-10-16T09:15:27.840Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck28uwzp2003ykerweiqnom1j","content":"<h3 id=\"1-安装hexo\"><a href=\"#1-安装hexo\" class=\"headerlink\" title=\"1 安装hexo\"></a>1 安装hexo</h3><ul>\n<li><p>1.1 在mac上安装</p>\n<figure class=\"highlight crmsh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 安装node</span></span><br><span class=\"line\">brew install <span class=\"keyword\">node</span> <span class=\"title\">npm</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>1.2 在linux安装</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 安装node10</span></span><br><span class=\"line\"><span class=\"attribute\">curl</span> -sL https://rpm.nodesource.com/setup_10.x | bash -</span><br><span class=\"line\">yum install -y nodejs</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>1.3 安装hexo</p>\n<figure class=\"highlight cmake\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 安装hexo</span></span><br><span class=\"line\">npm <span class=\"keyword\">install</span> -g hexo</span><br></pre></td></tr></table></figure>\n\n</li>\n</ul>\n<h3 id=\"2-初始化\"><a href=\"#2-初始化\" class=\"headerlink\" title=\"2 初始化\"></a>2 初始化</h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /data/github/</span><br><span class=\"line\"><span class=\"comment\"># 初始化</span></span><br><span class=\"line\"></span><br><span class=\"line\">hexo init blog</span><br><span class=\"line\"><span class=\"comment\"># 框架安装</span></span><br><span class=\"line\">npm <span class=\"keyword\">install</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#安装 Hexo 关于启动服务器的插件</span></span><br><span class=\"line\">npm <span class=\"keyword\">install</span> hexo-<span class=\"keyword\">server</span> <span class=\"comment\">--save</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 启动服务器, 本地查看效果, 如果不指定端口，默认为4000</span></span><br><span class=\"line\">hexo <span class=\"keyword\">server</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-主题和配置\"><a href=\"#3-主题和配置\" class=\"headerlink\" title=\"3 主题和配置\"></a>3 主题和配置</h3><ul>\n<li><p>下载主题：<a href=\"https://github.com/theme-next/hexo-theme-next\" target=\"_blank\" rel=\"noopener\">https://github.com/theme-next/hexo-theme-next</a></p>\n<figure class=\"highlight awk\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">unzip hexo-theme-<span class=\"keyword\">next</span>-master.zip</span><br><span class=\"line\">mv hexo-theme-<span class=\"keyword\">next</span>-master <span class=\"variable\">$blog</span><span class=\"regexp\">/themes/</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>修改主题配置 _config.yml 中的其他属性</p>\n<figure class=\"highlight ldif\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">title</span>: Zhangzhiwei's Blog</span><br><span class=\"line\">...</span><br><span class=\"line\"><span class=\"attribute\">theme</span>: hexo-theme-next</span><br><span class=\"line\">...</span><br><span class=\"line\"><span class=\"attribute\">scheme</span>: Mist</span><br></pre></td></tr></table></figure>\n\n</li>\n</ul>\n<h3 id=\"4-编写更新博客\"><a href=\"#4-编写更新博客\" class=\"headerlink\" title=\"4. 编写更新博客\"></a>4. 编写更新博客</h3><ul>\n<li><p>创建博客</p>\n<figure class=\"highlight actionscript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hexo <span class=\"keyword\">new</span> <span class=\"string\">'第一个博客'</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>cat source/_posts/第一个博客.md</p>\n<figure class=\"highlight subunit\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">title: 第一个博客</span><br><span class=\"line\">date: 2019<span class=\"string\">-09</span><span class=\"string\">-19</span> 16:58:01</span><br><span class=\"line\"><span class=\"keyword\">tags:</span></span><br><span class=\"line\">  - hexo</span><br><span class=\"line\">categories:</span><br><span class=\"line\">  - hexo学习</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>github 创建一个Repository仓库</p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"bullet\">1. </span>仓库名字必须是 xxx.github.io</span><br><span class=\"line\"><span class=\"bullet\">2. </span>在settings中 勾选Template repository</span><br><span class=\"line\"><span class=\"bullet\">3. </span>记得添加自己的ssh</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>github配置</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"comment\"># 安装 hexo 关于 git 的组件</span></span><br><span class=\"line\">npm <span class=\"keyword\">install</span> hexo-deployer-git <span class=\"comment\">--save</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>在_config.yml 中为 git 添加配置</p>\n<figure class=\"highlight less\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">deploy</span>:</span><br><span class=\"line\">  <span class=\"attribute\">type</span>: git</span><br><span class=\"line\">  <span class=\"attribute\">repository</span>: git<span class=\"variable\">@github</span>.<span class=\"attribute\">com</span>:*<span class=\"comment\">/*.github.io.git</span></span><br><span class=\"line\"><span class=\"comment\">  branch: master</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>查看是否能提交代码github</p>\n<figure class=\"highlight elixir\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh -T -ai ~<span class=\"regexp\">/.ssh/id</span>_rsa git<span class=\"variable\">@github</span>.com</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>部署</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">hexo</span> g</span><br><span class=\"line\">hexo d</span><br><span class=\"line\">或者</span><br><span class=\"line\">hexo d -g</span><br></pre></td></tr></table></figure>\n\n</li>\n</ul>\n<h3 id=\"5-next6让首页文字预览显示\"><a href=\"#5-next6让首页文字预览显示\" class=\"headerlink\" title=\"5. next6让首页文字预览显示\"></a>5. next6让首页文字预览显示</h3><ul>\n<li><p>5.1 方法一: 自动形成摘要,默认截取的长度为 150 字符</p>\n<figure class=\"highlight autoit\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">1.</span> 找到主题的配置文件(themes/<span class=\"keyword\">next</span>/_config.yml)</span><br><span class=\"line\"><span class=\"number\">2.</span> 修改auto_excerpt,把enable改为对应的<span class=\"literal\">false</span>改为<span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"number\">3.</span> hexo d -g</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>5.2 方法二: 博客内容中添加 &lt; !–more–&gt;</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 安装node</span><br><span class=\"line\">brew install node npm</span><br><span class=\"line\"> <span class=\"comment\">&lt;!-- more --&gt;</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>5.3 方法三: 在文章中的front-matter中添加description，并提供文章摘录,这种方式只会在首页列表中显示文章的摘要内容，进入文章详情后不会再显示。</p>\n<figure class=\"highlight subunit\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">title: 部署elk7.2.0</span><br><span class=\"line\">date: 2019<span class=\"string\">-09</span><span class=\"string\">-19</span> 17:59:53</span><br><span class=\"line\">copyright: true</span><br><span class=\"line\"><span class=\"keyword\">tags:</span></span><br><span class=\"line\">  - k8s</span><br><span class=\"line\">  - elk</span><br><span class=\"line\">  - elk7</span><br><span class=\"line\">categories:</span><br><span class=\"line\">  - 技术文档</span><br><span class=\"line\">  - elk</span><br><span class=\"line\">description: 本文主要是简单单机版部署elk7体验,  并非高可用集群方式部署, 部分安装步骤省略. 主要是记录yml配置文件, 仅供参考. 详细内容请点击下方阅读全文, 非常感谢!</span><br></pre></td></tr></table></figure>\n\n</li>\n</ul>\n<h3 id=\"6-next6添加搜索功能\"><a href=\"#6-next6添加搜索功能\" class=\"headerlink\" title=\"6. next6添加搜索功能\"></a>6. next6添加搜索功能</h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1. npm <span class=\"keyword\">install</span> hexo-generator-searchdb <span class=\"comment\">--save</span></span><br><span class=\"line\"><span class=\"number\">2.</span> 全局配置文件_config.yml</span><br><span class=\"line\"><span class=\"keyword\">search</span>:</span><br><span class=\"line\">  <span class=\"keyword\">path</span>: search.xml</span><br><span class=\"line\">  <span class=\"keyword\">field</span>: post</span><br><span class=\"line\">  <span class=\"keyword\">format</span>: html</span><br><span class=\"line\">  <span class=\"keyword\">limit</span>: <span class=\"number\">10000</span></span><br><span class=\"line\"><span class=\"number\">3.</span> 修改主题的_config.yml</span><br><span class=\"line\">local_search:</span><br><span class=\"line\">  <span class=\"keyword\">enable</span>: <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"7-next6-Mist字体的-首页文章间距和首页页宽-字体\"><a href=\"#7-next6-Mist字体的-首页文章间距和首页页宽-字体\" class=\"headerlink\" title=\"7. next6 Mist字体的 首页文章间距和首页页宽,字体\"></a>7. next6 Mist字体的 首页文章间距和首页页宽,字体</h3><ul>\n<li><p>7.1 首页文章间距</p>\n  <figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">增加一些内容: source/css/_schemes/Mist/_posts-expanded.styl</span><br><span class=\"line\"><span class=\"selector-class\">.posts-expand</span> <span class=\"selector-class\">.post</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">margin-top</span>: <span class=\"number\">30px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">margin-bottom</span>: <span class=\"number\">30px</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>7.2 页宽</p>\n  <figure class=\"highlight gams\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">source/css/_variables/base.styl</span><br><span class=\"line\"><span class=\"meta\"><span class=\"meta-keyword\">$content</span>-desktop                = 900px</span></span><br><span class=\"line\"><span class=\"meta\"><span class=\"meta-keyword\">$content</span>-desktop-large          = 1000px</span></span><br><span class=\"line\"><span class=\"meta\"><span class=\"meta-keyword\">$content</span>-desktop-largest        = 1100px</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>7.3 字体大小</p>\n  <figure class=\"highlight mel\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">themes/next/<span class=\"keyword\">source</span>/css/_variables/base.styl</span><br><span class=\"line\"></span><br><span class=\"line\">$font-<span class=\"keyword\">size</span>-base           = <span class=\"number\">0.95</span>em;</span><br><span class=\"line\">$font-<span class=\"keyword\">size</span>-base           = <span class=\"keyword\">unit</span>(hexo-config(<span class=\"string\">'font.global.size'</span>), em) <span class=\"keyword\">if</span> hexo-config(<span class=\"string\">'font.global.size'</span>) is a <span class=\"string\">'unit'</span>;</span><br><span class=\"line\">$font-<span class=\"keyword\">size</span>-smallest       = <span class=\"number\">.75</span>em;</span><br><span class=\"line\">$font-<span class=\"keyword\">size</span>-smaller        = <span class=\"number\">.8125</span>em;</span><br><span class=\"line\">$font-<span class=\"keyword\">size</span>-small          = <span class=\"number\">.855</span>em;</span><br><span class=\"line\">$font-<span class=\"keyword\">size</span>-medium         = <span class=\"number\">0.95</span>em;</span><br><span class=\"line\">$font-<span class=\"keyword\">size</span>-large          = <span class=\"number\">0.975</span>em;</span><br><span class=\"line\">$font-<span class=\"keyword\">size</span>-larger         = <span class=\"number\">1.</span>em;</span><br><span class=\"line\">$font-<span class=\"keyword\">size</span>-largest        = <span class=\"number\">1.125</span>em;</span><br></pre></td></tr></table></figure>\n\n</li>\n</ul>\n<h3 id=\"8-添加网格\"><a href=\"#8-添加网格\" class=\"headerlink\" title=\"8. 添加网格\"></a>8. 添加网格</h3><ul>\n<li><p>8.1 自定义方式修改</p>\n <figure class=\"highlight dts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\"># 新创建自定义文件</span></span><br><span class=\"line\">cat themes<span class=\"meta-keyword\">/next/</span>source<span class=\"meta-keyword\">/css/</span>_custom/custom.styl</span><br><span class=\"line\"><span class=\"comment\">// 主页文章添加阴影效果</span></span><br><span class=\"line\">.<span class=\"class\">post </span>&#123;</span><br><span class=\"line\">margin-top: <span class=\"number\">60</span>px;</span><br><span class=\"line\">margin-bottom: <span class=\"number\">60</span>px;</span><br><span class=\"line\"><span class=\"symbol\">padding:</span> <span class=\"number\">25</span>px;</span><br><span class=\"line\">-webkit-box-shadow: <span class=\"number\">0</span> <span class=\"number\">0</span> <span class=\"number\">5</span>px rgba(<span class=\"number\">202</span>, <span class=\"number\">203</span>, <span class=\"number\">203</span>, <span class=\"number\">.5</span>);</span><br><span class=\"line\">-moz-box-shadow: <span class=\"number\">0</span> <span class=\"number\">0</span> <span class=\"number\">5</span>px rgba(<span class=\"number\">202</span>, <span class=\"number\">203</span>, <span class=\"number\">204</span>, <span class=\"number\">.5</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\"># 修改config文件</span></span><br><span class=\"line\">vim .<span class=\"meta-keyword\">/themes/</span>next/_config.yml</span><br><span class=\"line\"><span class=\"symbol\">custom:</span> custom</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>8.2 next6版本修改方式</p>\n<blockquote>\n<p>参考: <a href=\"https://www.jianshu.com/p/ec2e6c8a1d89\" target=\"_blank\" rel=\"noopener\">hexo6–next美化整理</a></p>\n</blockquote>\n<ol>\n<li><p>修改 themes/next/layout/_layout.swig</p>\n<figure class=\"highlight django\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"xml\"></span><span class=\"template-tag\">&#123;% <span class=\"name\"><span class=\"name\">if</span></span> theme.canvas_nest %&#125;</span><span class=\"xml\"></span></span><br><span class=\"line\"><span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text/javascript\"</span> <span class=\"attr\">src</span>=<span class=\"string\">\"//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js\"</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\"></span><span class=\"template-tag\">&#123;% <span class=\"name\"><span class=\"name\">endif</span></span> %&#125;</span><span class=\"xml\"></span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>将上述代码防止在&lt; /body&gt; 前就可以了(注意不要放在&lt; /head&gt;的后面)。</p>\n</blockquote>\n</li>\n<li><p>修改主题的_config.yml</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">canvas_nest</span>: true</span><br><span class=\"line\"></span><br><span class=\"line\">//color: 线条颜色, 默认: '0,0,0'；三个数字分别为(R,G,B)</span><br><span class=\"line\">//opacity: 线条透明度（0~1）, 默认: 0.5</span><br><span class=\"line\">//count: 线条的总数量, 默认: 150</span><br><span class=\"line\">//zIndex: 背景的z-index属性，css属性用于控制所在层的位置, 默认: -1</span><br></pre></td></tr></table></figure>\n\n</li>\n</ol>\n</li>\n</ul>\n<blockquote>\n<p>注意:<br>我这里打开提示缺少 canvas-nest.min.js文件,这里是手动copy的一份写到 source/lib/canvas-nest/canvas-nest.min.js</p>\n</blockquote>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">!<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">o</span>(<span class=\"params\">w,v,i</span>)</span>&#123;<span class=\"keyword\">return</span> w.getAttribute(v)||i&#125;<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">j</span>(<span class=\"params\">i</span>)</span>&#123;<span class=\"keyword\">return</span> <span class=\"built_in\">document</span>.getElementsByTagName(i)&#125;<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">l</span>(<span class=\"params\"></span>)</span>&#123;<span class=\"keyword\">var</span> i=j(<span class=\"string\">\"script\"</span>),w=i.length,v=i[w<span class=\"number\">-1</span>];<span class=\"keyword\">return</span>&#123;<span class=\"attr\">l</span>:w,<span class=\"attr\">z</span>:o(v,<span class=\"string\">\"zIndex\"</span>,<span class=\"number\">-1</span>),<span class=\"attr\">o</span>:o(v,<span class=\"string\">\"opacity\"</span>,<span class=\"number\">0.5</span>),<span class=\"attr\">c</span>:o(v,<span class=\"string\">\"color\"</span>,<span class=\"string\">\"0,0,0\"</span>),<span class=\"attr\">n</span>:o(v,<span class=\"string\">\"count\"</span>,<span class=\"number\">99</span>)&#125;&#125;<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">k</span>(<span class=\"params\"></span>)</span>&#123;r=u.width=<span class=\"built_in\">window</span>.innerWidth||<span class=\"built_in\">document</span>.documentElement.clientWidth||<span class=\"built_in\">document</span>.body.clientWidth,n=u.height=<span class=\"built_in\">window</span>.innerHeight||<span class=\"built_in\">document</span>.documentElement.clientHeight||<span class=\"built_in\">document</span>.body.clientHeight&#125;<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">b</span>(<span class=\"params\"></span>)</span>&#123;e.clearRect(<span class=\"number\">0</span>,<span class=\"number\">0</span>,r,n);<span class=\"keyword\">var</span> w=[f].concat(t);<span class=\"keyword\">var</span> x,v,A,B,z,y;t.forEach(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">i</span>)</span>&#123;i.x+=i.xa,i.y+=i.ya,i.xa*=i.x&gt;r||i.x&lt;<span class=\"number\">0</span>?<span class=\"number\">-1</span>:<span class=\"number\">1</span>,i.ya*=i.y&gt;n||i.y&lt;<span class=\"number\">0</span>?<span class=\"number\">-1</span>:<span class=\"number\">1</span>,e.fillRect(i.x<span class=\"number\">-0.5</span>,i.y<span class=\"number\">-0.5</span>,<span class=\"number\">1</span>,<span class=\"number\">1</span>);<span class=\"keyword\">for</span>(v=<span class=\"number\">0</span>;v&lt;w.length;v++)&#123;x=w[v];<span class=\"keyword\">if</span>(i!==x&amp;&amp;<span class=\"literal\">null</span>!==x.x&amp;&amp;<span class=\"literal\">null</span>!==x.y)&#123;B=i.x-x.x,z=i.y-x.y,y=B*B+z*z;y&lt;x.max&amp;&amp;(x===f&amp;&amp;y&gt;=x.max/<span class=\"number\">2</span>&amp;&amp;(i.x-=<span class=\"number\">0.03</span>*B,i.y-=<span class=\"number\">0.03</span>*z),A=(x.max-y)/x.max,e.beginPath(),e.lineWidth=A/<span class=\"number\">2</span>,e.strokeStyle=<span class=\"string\">\"rgba(\"</span>+s.c+<span class=\"string\">\",\"</span>+(A+<span class=\"number\">0.2</span>)+<span class=\"string\">\")\"</span>,e.moveTo(i.x,i.y),e.lineTo(x.x,x.y),e.stroke())&#125;&#125;w.splice(w.indexOf(i),<span class=\"number\">1</span>)&#125;),m(b)&#125;<span class=\"keyword\">var</span> u=<span class=\"built_in\">document</span>.createElement(<span class=\"string\">\"canvas\"</span>),s=l(),c=<span class=\"string\">\"c_n\"</span>+s.l,e=u.getContext(<span class=\"string\">\"2d\"</span>),r,n,m=<span class=\"built_in\">window</span>.requestAnimationFrame||<span class=\"built_in\">window</span>.webkitRequestAnimationFrame||<span class=\"built_in\">window</span>.mozRequestAnimationFrame||<span class=\"built_in\">window</span>.oRequestAnimationFrame||<span class=\"built_in\">window</span>.msRequestAnimationFrame||<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">i</span>)</span>&#123;<span class=\"built_in\">window</span>.setTimeout(i,<span class=\"number\">1000</span>/<span class=\"number\">45</span>)&#125;,a=<span class=\"built_in\">Math</span>.random,f=&#123;<span class=\"attr\">x</span>:<span class=\"literal\">null</span>,<span class=\"attr\">y</span>:<span class=\"literal\">null</span>,<span class=\"attr\">max</span>:<span class=\"number\">20000</span>&#125;;u.id=c;u.style.cssText=<span class=\"string\">\"position:fixed;top:0;left:0;z-index:\"</span>+s.z+<span class=\"string\">\";opacity:\"</span>+s.o;j(<span class=\"string\">\"body\"</span>)[<span class=\"number\">0</span>].appendChild(u);k(),<span class=\"built_in\">window</span>.onresize=k;<span class=\"built_in\">window</span>.onmousemove=<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">i</span>)</span>&#123;i=i||<span class=\"built_in\">window</span>.event,f.x=i.clientX,f.y=i.clientY&#125;,<span class=\"built_in\">window</span>.onmouseout=<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;f.x=<span class=\"literal\">null</span>,f.y=<span class=\"literal\">null</span>&#125;;<span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> t=[],p=<span class=\"number\">0</span>;s.n&gt;p;p++)&#123;<span class=\"keyword\">var</span> h=a()*r,g=a()*n,q=<span class=\"number\">2</span>*a()<span class=\"number\">-1</span>,d=<span class=\"number\">2</span>*a()<span class=\"number\">-1</span>;t.push(&#123;<span class=\"attr\">x</span>:h,<span class=\"attr\">y</span>:g,<span class=\"attr\">xa</span>:q,<span class=\"attr\">ya</span>:d,<span class=\"attr\">max</span>:<span class=\"number\">6000</span>&#125;)&#125;setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;b()&#125;,<span class=\"number\">100</span>)&#125;();%                                                                                                    zhangzw@MacBook-Pro  /data/github/blog   master ● </span><br></pre></td></tr></table></figure>\n\n<h3 id=\"9-添加评论功能\"><a href=\"#9-添加评论功能\" class=\"headerlink\" title=\"9. 添加评论功能\"></a>9. 添加评论功能</h3><ul>\n<li><p>9.1 注册leancloud</p>\n<figure class=\"highlight clean\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">注册-&gt; 验证邮箱-&gt; 实名认证 -&gt; 设置获取appid和appkey</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>9.2 修改配置文件</p>\n<figure class=\"highlight less\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">valine</span>:</span><br><span class=\"line\">  <span class=\"attribute\">enable</span>: true </span><br><span class=\"line\">  <span class=\"attribute\">appid</span>: <span class=\"string\">'appid'</span> </span><br><span class=\"line\">  <span class=\"attribute\">appkey</span>: <span class=\"string\">'appkey'</span> </span><br><span class=\"line\">  <span class=\"attribute\">placeholder</span>: <span class=\"string\">\"ヾﾉ≧∀≦)o 来呀！快活呀！~啦啦啦~ 啦啦啦啦~\"</span> </span><br><span class=\"line\">  <span class=\"attribute\">visitor</span>: true <span class=\"comment\">//这个打开页会统计文章阅读数</span></span><br></pre></td></tr></table></figure>\n\n</li>\n</ul>\n<h3 id=\"10-next6添加字数统计-和阅读时长\"><a href=\"#10-next6添加字数统计-和阅读时长\" class=\"headerlink\" title=\"10. next6添加字数统计 和阅读时长\"></a>10. next6添加字数统计 和阅读时长</h3><blockquote>\n<p><a href=\"https://github.com/theme-next/hexo-symbols-count-time\" target=\"_blank\" rel=\"noopener\">hexo-symbols-count-time</a></p>\n</blockquote>\n<ul>\n<li><p>10.1 安装node扩展</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm <span class=\"keyword\">install</span> hexo-symbols-<span class=\"keyword\">count</span>-<span class=\"built_in\">time</span> <span class=\"comment\">--save</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>10.2 修改全局配置 _config.yml</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">symbols_count_time:</span></span><br><span class=\"line\"><span class=\"attr\">  symbols:</span> <span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"attr\">  time:</span> <span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"attr\">  total_symbols:</span> <span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"attr\">  total_time:</span> <span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"attr\">  exclude_codeblock:</span> <span class=\"literal\">false</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>10.3 修改主题配置 _config.yml</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">symbols_count_time:</span></span><br><span class=\"line\"><span class=\"attr\">  separated_meta:</span> <span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"attr\">  item_text_post:</span> <span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"attr\">  item_text_total:</span> <span class=\"literal\">false</span></span><br><span class=\"line\"><span class=\"attr\">  awl:</span> <span class=\"number\">4</span></span><br><span class=\"line\"><span class=\"attr\">  wpm:</span> <span class=\"number\">275</span></span><br><span class=\"line\"><span class=\"attr\">  suffix:</span> <span class=\"string\">mins.</span></span><br></pre></td></tr></table></figure>\n\n</li>\n</ul>\n<h3 id=\"11-next6-文章置顶功能\"><a href=\"#11-next6-文章置顶功能\" class=\"headerlink\" title=\"11. next6 文章置顶功能\"></a>11. next6 文章置顶功能</h3><ul>\n<li><p>11.1 安装node扩展 </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm <span class=\"keyword\">uninstall</span> hexo-generator-<span class=\"keyword\">index</span> <span class=\"comment\">--save</span></span><br><span class=\"line\">npm <span class=\"keyword\">install</span> hexo-generator-<span class=\"keyword\">index</span>-pin-top <span class=\"comment\">--save</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>11.2 在文章开头添加置顶标识</p>\n<figure class=\"highlight avrasm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"symbol\">top:</span> <span class=\"number\">10</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>11.3 首页添加明显置顶标识</p>\n<figure class=\"highlight django\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"xml\">themes/next/layout/_macro/post.swig 在<span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"post-meta\"</span>&gt;</span> 下添加如下代码</span></span><br><span class=\"line\"><span class=\"xml\"></span><span class=\"template-tag\">&#123;% <span class=\"name\"><span class=\"name\">if</span></span> post.top %&#125;</span><span class=\"xml\"></span></span><br><span class=\"line\"><span class=\"xml\">    <span class=\"tag\">&lt;<span class=\"name\">i</span> <span class=\"attr\">class</span>=<span class=\"string\">\"fa fa-thumb-tack\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">i</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">    <span class=\"tag\">&lt;<span class=\"name\">font</span> <span class=\"attr\">color</span>=<span class=\"string\">green</span>&gt;</span>置顶<span class=\"tag\">&lt;/<span class=\"name\">font</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">    <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">\"post-meta-divider\"</span>&gt;</span>|<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\"></span><span class=\"template-tag\">&#123;% <span class=\"name\"><span class=\"name\">endif</span></span> %&#125;</span><span class=\"xml\"></span></span><br></pre></td></tr></table></figure>\n\n</li>\n</ul>\n<h3 id=\"12-next6-开启标签和分类\"><a href=\"#12-next6-开启标签和分类\" class=\"headerlink\" title=\"12. next6 开启标签和分类\"></a>12. next6 开启标签和分类</h3><ul>\n<li><p>12.1 创建tags相关目录</p>\n<figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hexo new<span class=\"built_in\"> page </span>tags</span><br><span class=\"line\">hexo new<span class=\"built_in\"> page </span>categories</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>12.2 开启tags标签和分类</p>\n<figure class=\"highlight subunit\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim themes/next/_config.yml</span><br><span class=\"line\"><span class=\"keyword\">tags:</span> /tags/ || tags</span><br><span class=\"line\">categories: /categories/ || th</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>12.3 修改tags站点文件</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">cat</span> <span class=\"string\">source/tags/index.md</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">title:</span> <span class=\"string\">tags</span></span><br><span class=\"line\"><span class=\"attr\">date:</span> <span class=\"number\">2019</span><span class=\"bullet\">-09</span><span class=\"bullet\">-24</span> <span class=\"number\">10</span><span class=\"string\">:08:59</span></span><br><span class=\"line\"><span class=\"attr\">type:</span> <span class=\"string\">\"tags\"</span></span><br><span class=\"line\"><span class=\"attr\">layout:</span> <span class=\"string\">\"tags\"</span></span><br><span class=\"line\"><span class=\"attr\">comments:</span> <span class=\"literal\">false</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>12.4 修改categories站点文件</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">cat</span> <span class=\"string\">source/categories/index.md</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">title:</span> <span class=\"string\">categories</span></span><br><span class=\"line\"><span class=\"attr\">date:</span> <span class=\"number\">2019</span><span class=\"bullet\">-09</span><span class=\"bullet\">-24</span> <span class=\"number\">10</span><span class=\"string\">:09:55</span></span><br><span class=\"line\"><span class=\"attr\">type:</span> <span class=\"string\">\"categories\"</span></span><br><span class=\"line\"><span class=\"attr\">layout:</span> <span class=\"string\">\"categories\"</span></span><br><span class=\"line\"><span class=\"attr\">comments:</span> <span class=\"literal\">false</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>12.5 去掉xxx.github.io/tags/ 页面的post-title(因为我的这个css左对齐了,默认是居中,所以很丑)</p>\n<figure class=\"highlight django\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"xml\"># 注释下面这段代码</span></span><br><span class=\"line\"><span class=\"xml\">vim themes/nextv/layout/page.swig </span></span><br><span class=\"line\"><span class=\"xml\"><span class=\"comment\">&lt;!-- </span></span><span class=\"template-tag\">&#123;% <span class=\"name\"><span class=\"name\">include</span></span> '_partials/page/page-header.swig' %&#125;</span><span class=\"xml\"><span class=\"comment\"> --&gt;</span></span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>12.6 文章中多个tag和categories</p>\n<figure class=\"highlight subunit\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">tags:</span></span><br><span class=\"line\">  - k8s</span><br><span class=\"line\">  - k8s安装</span><br><span class=\"line\">categories:</span><br><span class=\"line\">  - [k8s,安装]</span><br><span class=\"line\">  - [技术文档]</span><br></pre></td></tr></table></figure>\n\n</li>\n</ul>\n","site":{"data":{}},"length":7364,"excerpt":"","more":"<h3 id=\"1-安装hexo\"><a href=\"#1-安装hexo\" class=\"headerlink\" title=\"1 安装hexo\"></a>1 安装hexo</h3><ul>\n<li><p>1.1 在mac上安装</p>\n<figure class=\"highlight crmsh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 安装node</span></span><br><span class=\"line\">brew install <span class=\"keyword\">node</span> <span class=\"title\">npm</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>1.2 在linux安装</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 安装node10</span></span><br><span class=\"line\"><span class=\"attribute\">curl</span> -sL https://rpm.nodesource.com/setup_10.x | bash -</span><br><span class=\"line\">yum install -y nodejs</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>1.3 安装hexo</p>\n<figure class=\"highlight cmake\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 安装hexo</span></span><br><span class=\"line\">npm <span class=\"keyword\">install</span> -g hexo</span><br></pre></td></tr></table></figure>\n\n</li>\n</ul>\n<h3 id=\"2-初始化\"><a href=\"#2-初始化\" class=\"headerlink\" title=\"2 初始化\"></a>2 初始化</h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /data/github/</span><br><span class=\"line\"><span class=\"comment\"># 初始化</span></span><br><span class=\"line\"></span><br><span class=\"line\">hexo init blog</span><br><span class=\"line\"><span class=\"comment\"># 框架安装</span></span><br><span class=\"line\">npm <span class=\"keyword\">install</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#安装 Hexo 关于启动服务器的插件</span></span><br><span class=\"line\">npm <span class=\"keyword\">install</span> hexo-<span class=\"keyword\">server</span> <span class=\"comment\">--save</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 启动服务器, 本地查看效果, 如果不指定端口，默认为4000</span></span><br><span class=\"line\">hexo <span class=\"keyword\">server</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-主题和配置\"><a href=\"#3-主题和配置\" class=\"headerlink\" title=\"3 主题和配置\"></a>3 主题和配置</h3><ul>\n<li><p>下载主题：<a href=\"https://github.com/theme-next/hexo-theme-next\" target=\"_blank\" rel=\"noopener\">https://github.com/theme-next/hexo-theme-next</a></p>\n<figure class=\"highlight awk\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">unzip hexo-theme-<span class=\"keyword\">next</span>-master.zip</span><br><span class=\"line\">mv hexo-theme-<span class=\"keyword\">next</span>-master <span class=\"variable\">$blog</span><span class=\"regexp\">/themes/</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>修改主题配置 _config.yml 中的其他属性</p>\n<figure class=\"highlight ldif\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">title</span>: Zhangzhiwei's Blog</span><br><span class=\"line\">...</span><br><span class=\"line\"><span class=\"attribute\">theme</span>: hexo-theme-next</span><br><span class=\"line\">...</span><br><span class=\"line\"><span class=\"attribute\">scheme</span>: Mist</span><br></pre></td></tr></table></figure>\n\n</li>\n</ul>\n<h3 id=\"4-编写更新博客\"><a href=\"#4-编写更新博客\" class=\"headerlink\" title=\"4. 编写更新博客\"></a>4. 编写更新博客</h3><ul>\n<li><p>创建博客</p>\n<figure class=\"highlight actionscript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hexo <span class=\"keyword\">new</span> <span class=\"string\">'第一个博客'</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>cat source/_posts/第一个博客.md</p>\n<figure class=\"highlight subunit\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">title: 第一个博客</span><br><span class=\"line\">date: 2019<span class=\"string\">-09</span><span class=\"string\">-19</span> 16:58:01</span><br><span class=\"line\"><span class=\"keyword\">tags:</span></span><br><span class=\"line\">  - hexo</span><br><span class=\"line\">categories:</span><br><span class=\"line\">  - hexo学习</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>github 创建一个Repository仓库</p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"bullet\">1. </span>仓库名字必须是 xxx.github.io</span><br><span class=\"line\"><span class=\"bullet\">2. </span>在settings中 勾选Template repository</span><br><span class=\"line\"><span class=\"bullet\">3. </span>记得添加自己的ssh</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>github配置</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"comment\"># 安装 hexo 关于 git 的组件</span></span><br><span class=\"line\">npm <span class=\"keyword\">install</span> hexo-deployer-git <span class=\"comment\">--save</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>在_config.yml 中为 git 添加配置</p>\n<figure class=\"highlight less\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">deploy</span>:</span><br><span class=\"line\">  <span class=\"attribute\">type</span>: git</span><br><span class=\"line\">  <span class=\"attribute\">repository</span>: git<span class=\"variable\">@github</span>.<span class=\"attribute\">com</span>:*<span class=\"comment\">/*.github.io.git</span></span><br><span class=\"line\"><span class=\"comment\">  branch: master</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>查看是否能提交代码github</p>\n<figure class=\"highlight elixir\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh -T -ai ~<span class=\"regexp\">/.ssh/id</span>_rsa git<span class=\"variable\">@github</span>.com</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>部署</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">hexo</span> g</span><br><span class=\"line\">hexo d</span><br><span class=\"line\">或者</span><br><span class=\"line\">hexo d -g</span><br></pre></td></tr></table></figure>\n\n</li>\n</ul>\n<h3 id=\"5-next6让首页文字预览显示\"><a href=\"#5-next6让首页文字预览显示\" class=\"headerlink\" title=\"5. next6让首页文字预览显示\"></a>5. next6让首页文字预览显示</h3><ul>\n<li><p>5.1 方法一: 自动形成摘要,默认截取的长度为 150 字符</p>\n<figure class=\"highlight autoit\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">1.</span> 找到主题的配置文件(themes/<span class=\"keyword\">next</span>/_config.yml)</span><br><span class=\"line\"><span class=\"number\">2.</span> 修改auto_excerpt,把enable改为对应的<span class=\"literal\">false</span>改为<span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"number\">3.</span> hexo d -g</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>5.2 方法二: 博客内容中添加 &lt; !–more–&gt;</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 安装node</span><br><span class=\"line\">brew install node npm</span><br><span class=\"line\"> <span class=\"comment\">&lt;!-- more --&gt;</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>5.3 方法三: 在文章中的front-matter中添加description，并提供文章摘录,这种方式只会在首页列表中显示文章的摘要内容，进入文章详情后不会再显示。</p>\n<figure class=\"highlight subunit\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">title: 部署elk7.2.0</span><br><span class=\"line\">date: 2019<span class=\"string\">-09</span><span class=\"string\">-19</span> 17:59:53</span><br><span class=\"line\">copyright: true</span><br><span class=\"line\"><span class=\"keyword\">tags:</span></span><br><span class=\"line\">  - k8s</span><br><span class=\"line\">  - elk</span><br><span class=\"line\">  - elk7</span><br><span class=\"line\">categories:</span><br><span class=\"line\">  - 技术文档</span><br><span class=\"line\">  - elk</span><br><span class=\"line\">description: 本文主要是简单单机版部署elk7体验,  并非高可用集群方式部署, 部分安装步骤省略. 主要是记录yml配置文件, 仅供参考. 详细内容请点击下方阅读全文, 非常感谢!</span><br></pre></td></tr></table></figure>\n\n</li>\n</ul>\n<h3 id=\"6-next6添加搜索功能\"><a href=\"#6-next6添加搜索功能\" class=\"headerlink\" title=\"6. next6添加搜索功能\"></a>6. next6添加搜索功能</h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1. npm <span class=\"keyword\">install</span> hexo-generator-searchdb <span class=\"comment\">--save</span></span><br><span class=\"line\"><span class=\"number\">2.</span> 全局配置文件_config.yml</span><br><span class=\"line\"><span class=\"keyword\">search</span>:</span><br><span class=\"line\">  <span class=\"keyword\">path</span>: search.xml</span><br><span class=\"line\">  <span class=\"keyword\">field</span>: post</span><br><span class=\"line\">  <span class=\"keyword\">format</span>: html</span><br><span class=\"line\">  <span class=\"keyword\">limit</span>: <span class=\"number\">10000</span></span><br><span class=\"line\"><span class=\"number\">3.</span> 修改主题的_config.yml</span><br><span class=\"line\">local_search:</span><br><span class=\"line\">  <span class=\"keyword\">enable</span>: <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"7-next6-Mist字体的-首页文章间距和首页页宽-字体\"><a href=\"#7-next6-Mist字体的-首页文章间距和首页页宽-字体\" class=\"headerlink\" title=\"7. next6 Mist字体的 首页文章间距和首页页宽,字体\"></a>7. next6 Mist字体的 首页文章间距和首页页宽,字体</h3><ul>\n<li><p>7.1 首页文章间距</p>\n  <figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">增加一些内容: source/css/_schemes/Mist/_posts-expanded.styl</span><br><span class=\"line\"><span class=\"selector-class\">.posts-expand</span> <span class=\"selector-class\">.post</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">margin-top</span>: <span class=\"number\">30px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">margin-bottom</span>: <span class=\"number\">30px</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>7.2 页宽</p>\n  <figure class=\"highlight gams\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">source/css/_variables/base.styl</span><br><span class=\"line\"><span class=\"meta\"><span class=\"meta-keyword\">$content</span>-desktop                = 900px</span></span><br><span class=\"line\"><span class=\"meta\"><span class=\"meta-keyword\">$content</span>-desktop-large          = 1000px</span></span><br><span class=\"line\"><span class=\"meta\"><span class=\"meta-keyword\">$content</span>-desktop-largest        = 1100px</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>7.3 字体大小</p>\n  <figure class=\"highlight mel\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">themes/next/<span class=\"keyword\">source</span>/css/_variables/base.styl</span><br><span class=\"line\"></span><br><span class=\"line\">$font-<span class=\"keyword\">size</span>-base           = <span class=\"number\">0.95</span>em;</span><br><span class=\"line\">$font-<span class=\"keyword\">size</span>-base           = <span class=\"keyword\">unit</span>(hexo-config(<span class=\"string\">'font.global.size'</span>), em) <span class=\"keyword\">if</span> hexo-config(<span class=\"string\">'font.global.size'</span>) is a <span class=\"string\">'unit'</span>;</span><br><span class=\"line\">$font-<span class=\"keyword\">size</span>-smallest       = <span class=\"number\">.75</span>em;</span><br><span class=\"line\">$font-<span class=\"keyword\">size</span>-smaller        = <span class=\"number\">.8125</span>em;</span><br><span class=\"line\">$font-<span class=\"keyword\">size</span>-small          = <span class=\"number\">.855</span>em;</span><br><span class=\"line\">$font-<span class=\"keyword\">size</span>-medium         = <span class=\"number\">0.95</span>em;</span><br><span class=\"line\">$font-<span class=\"keyword\">size</span>-large          = <span class=\"number\">0.975</span>em;</span><br><span class=\"line\">$font-<span class=\"keyword\">size</span>-larger         = <span class=\"number\">1.</span>em;</span><br><span class=\"line\">$font-<span class=\"keyword\">size</span>-largest        = <span class=\"number\">1.125</span>em;</span><br></pre></td></tr></table></figure>\n\n</li>\n</ul>\n<h3 id=\"8-添加网格\"><a href=\"#8-添加网格\" class=\"headerlink\" title=\"8. 添加网格\"></a>8. 添加网格</h3><ul>\n<li><p>8.1 自定义方式修改</p>\n <figure class=\"highlight dts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\"># 新创建自定义文件</span></span><br><span class=\"line\">cat themes<span class=\"meta-keyword\">/next/</span>source<span class=\"meta-keyword\">/css/</span>_custom/custom.styl</span><br><span class=\"line\"><span class=\"comment\">// 主页文章添加阴影效果</span></span><br><span class=\"line\">.<span class=\"class\">post </span>&#123;</span><br><span class=\"line\">margin-top: <span class=\"number\">60</span>px;</span><br><span class=\"line\">margin-bottom: <span class=\"number\">60</span>px;</span><br><span class=\"line\"><span class=\"symbol\">padding:</span> <span class=\"number\">25</span>px;</span><br><span class=\"line\">-webkit-box-shadow: <span class=\"number\">0</span> <span class=\"number\">0</span> <span class=\"number\">5</span>px rgba(<span class=\"number\">202</span>, <span class=\"number\">203</span>, <span class=\"number\">203</span>, <span class=\"number\">.5</span>);</span><br><span class=\"line\">-moz-box-shadow: <span class=\"number\">0</span> <span class=\"number\">0</span> <span class=\"number\">5</span>px rgba(<span class=\"number\">202</span>, <span class=\"number\">203</span>, <span class=\"number\">204</span>, <span class=\"number\">.5</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\"># 修改config文件</span></span><br><span class=\"line\">vim .<span class=\"meta-keyword\">/themes/</span>next/_config.yml</span><br><span class=\"line\"><span class=\"symbol\">custom:</span> custom</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>8.2 next6版本修改方式</p>\n<blockquote>\n<p>参考: <a href=\"https://www.jianshu.com/p/ec2e6c8a1d89\" target=\"_blank\" rel=\"noopener\">hexo6–next美化整理</a></p>\n</blockquote>\n<ol>\n<li><p>修改 themes/next/layout/_layout.swig</p>\n<figure class=\"highlight django\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"xml\"></span><span class=\"template-tag\">&#123;% <span class=\"name\"><span class=\"name\">if</span></span> theme.canvas_nest %&#125;</span><span class=\"xml\"></span></span><br><span class=\"line\"><span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text/javascript\"</span> <span class=\"attr\">src</span>=<span class=\"string\">\"//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js\"</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\"></span><span class=\"template-tag\">&#123;% <span class=\"name\"><span class=\"name\">endif</span></span> %&#125;</span><span class=\"xml\"></span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>将上述代码防止在&lt; /body&gt; 前就可以了(注意不要放在&lt; /head&gt;的后面)。</p>\n</blockquote>\n</li>\n<li><p>修改主题的_config.yml</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">canvas_nest</span>: true</span><br><span class=\"line\"></span><br><span class=\"line\">//color: 线条颜色, 默认: '0,0,0'；三个数字分别为(R,G,B)</span><br><span class=\"line\">//opacity: 线条透明度（0~1）, 默认: 0.5</span><br><span class=\"line\">//count: 线条的总数量, 默认: 150</span><br><span class=\"line\">//zIndex: 背景的z-index属性，css属性用于控制所在层的位置, 默认: -1</span><br></pre></td></tr></table></figure>\n\n</li>\n</ol>\n</li>\n</ul>\n<blockquote>\n<p>注意:<br>我这里打开提示缺少 canvas-nest.min.js文件,这里是手动copy的一份写到 source/lib/canvas-nest/canvas-nest.min.js</p>\n</blockquote>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">!<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">o</span>(<span class=\"params\">w,v,i</span>)</span>&#123;<span class=\"keyword\">return</span> w.getAttribute(v)||i&#125;<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">j</span>(<span class=\"params\">i</span>)</span>&#123;<span class=\"keyword\">return</span> <span class=\"built_in\">document</span>.getElementsByTagName(i)&#125;<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">l</span>(<span class=\"params\"></span>)</span>&#123;<span class=\"keyword\">var</span> i=j(<span class=\"string\">\"script\"</span>),w=i.length,v=i[w<span class=\"number\">-1</span>];<span class=\"keyword\">return</span>&#123;<span class=\"attr\">l</span>:w,<span class=\"attr\">z</span>:o(v,<span class=\"string\">\"zIndex\"</span>,<span class=\"number\">-1</span>),<span class=\"attr\">o</span>:o(v,<span class=\"string\">\"opacity\"</span>,<span class=\"number\">0.5</span>),<span class=\"attr\">c</span>:o(v,<span class=\"string\">\"color\"</span>,<span class=\"string\">\"0,0,0\"</span>),<span class=\"attr\">n</span>:o(v,<span class=\"string\">\"count\"</span>,<span class=\"number\">99</span>)&#125;&#125;<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">k</span>(<span class=\"params\"></span>)</span>&#123;r=u.width=<span class=\"built_in\">window</span>.innerWidth||<span class=\"built_in\">document</span>.documentElement.clientWidth||<span class=\"built_in\">document</span>.body.clientWidth,n=u.height=<span class=\"built_in\">window</span>.innerHeight||<span class=\"built_in\">document</span>.documentElement.clientHeight||<span class=\"built_in\">document</span>.body.clientHeight&#125;<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">b</span>(<span class=\"params\"></span>)</span>&#123;e.clearRect(<span class=\"number\">0</span>,<span class=\"number\">0</span>,r,n);<span class=\"keyword\">var</span> w=[f].concat(t);<span class=\"keyword\">var</span> x,v,A,B,z,y;t.forEach(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">i</span>)</span>&#123;i.x+=i.xa,i.y+=i.ya,i.xa*=i.x&gt;r||i.x&lt;<span class=\"number\">0</span>?<span class=\"number\">-1</span>:<span class=\"number\">1</span>,i.ya*=i.y&gt;n||i.y&lt;<span class=\"number\">0</span>?<span class=\"number\">-1</span>:<span class=\"number\">1</span>,e.fillRect(i.x<span class=\"number\">-0.5</span>,i.y<span class=\"number\">-0.5</span>,<span class=\"number\">1</span>,<span class=\"number\">1</span>);<span class=\"keyword\">for</span>(v=<span class=\"number\">0</span>;v&lt;w.length;v++)&#123;x=w[v];<span class=\"keyword\">if</span>(i!==x&amp;&amp;<span class=\"literal\">null</span>!==x.x&amp;&amp;<span class=\"literal\">null</span>!==x.y)&#123;B=i.x-x.x,z=i.y-x.y,y=B*B+z*z;y&lt;x.max&amp;&amp;(x===f&amp;&amp;y&gt;=x.max/<span class=\"number\">2</span>&amp;&amp;(i.x-=<span class=\"number\">0.03</span>*B,i.y-=<span class=\"number\">0.03</span>*z),A=(x.max-y)/x.max,e.beginPath(),e.lineWidth=A/<span class=\"number\">2</span>,e.strokeStyle=<span class=\"string\">\"rgba(\"</span>+s.c+<span class=\"string\">\",\"</span>+(A+<span class=\"number\">0.2</span>)+<span class=\"string\">\")\"</span>,e.moveTo(i.x,i.y),e.lineTo(x.x,x.y),e.stroke())&#125;&#125;w.splice(w.indexOf(i),<span class=\"number\">1</span>)&#125;),m(b)&#125;<span class=\"keyword\">var</span> u=<span class=\"built_in\">document</span>.createElement(<span class=\"string\">\"canvas\"</span>),s=l(),c=<span class=\"string\">\"c_n\"</span>+s.l,e=u.getContext(<span class=\"string\">\"2d\"</span>),r,n,m=<span class=\"built_in\">window</span>.requestAnimationFrame||<span class=\"built_in\">window</span>.webkitRequestAnimationFrame||<span class=\"built_in\">window</span>.mozRequestAnimationFrame||<span class=\"built_in\">window</span>.oRequestAnimationFrame||<span class=\"built_in\">window</span>.msRequestAnimationFrame||<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">i</span>)</span>&#123;<span class=\"built_in\">window</span>.setTimeout(i,<span class=\"number\">1000</span>/<span class=\"number\">45</span>)&#125;,a=<span class=\"built_in\">Math</span>.random,f=&#123;<span class=\"attr\">x</span>:<span class=\"literal\">null</span>,<span class=\"attr\">y</span>:<span class=\"literal\">null</span>,<span class=\"attr\">max</span>:<span class=\"number\">20000</span>&#125;;u.id=c;u.style.cssText=<span class=\"string\">\"position:fixed;top:0;left:0;z-index:\"</span>+s.z+<span class=\"string\">\";opacity:\"</span>+s.o;j(<span class=\"string\">\"body\"</span>)[<span class=\"number\">0</span>].appendChild(u);k(),<span class=\"built_in\">window</span>.onresize=k;<span class=\"built_in\">window</span>.onmousemove=<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">i</span>)</span>&#123;i=i||<span class=\"built_in\">window</span>.event,f.x=i.clientX,f.y=i.clientY&#125;,<span class=\"built_in\">window</span>.onmouseout=<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;f.x=<span class=\"literal\">null</span>,f.y=<span class=\"literal\">null</span>&#125;;<span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> t=[],p=<span class=\"number\">0</span>;s.n&gt;p;p++)&#123;<span class=\"keyword\">var</span> h=a()*r,g=a()*n,q=<span class=\"number\">2</span>*a()<span class=\"number\">-1</span>,d=<span class=\"number\">2</span>*a()<span class=\"number\">-1</span>;t.push(&#123;<span class=\"attr\">x</span>:h,<span class=\"attr\">y</span>:g,<span class=\"attr\">xa</span>:q,<span class=\"attr\">ya</span>:d,<span class=\"attr\">max</span>:<span class=\"number\">6000</span>&#125;)&#125;setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;b()&#125;,<span class=\"number\">100</span>)&#125;();%                                                                                                    zhangzw@MacBook-Pro  /data/github/blog   master ● </span><br></pre></td></tr></table></figure>\n\n<h3 id=\"9-添加评论功能\"><a href=\"#9-添加评论功能\" class=\"headerlink\" title=\"9. 添加评论功能\"></a>9. 添加评论功能</h3><ul>\n<li><p>9.1 注册leancloud</p>\n<figure class=\"highlight clean\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">注册-&gt; 验证邮箱-&gt; 实名认证 -&gt; 设置获取appid和appkey</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>9.2 修改配置文件</p>\n<figure class=\"highlight less\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">valine</span>:</span><br><span class=\"line\">  <span class=\"attribute\">enable</span>: true </span><br><span class=\"line\">  <span class=\"attribute\">appid</span>: <span class=\"string\">'appid'</span> </span><br><span class=\"line\">  <span class=\"attribute\">appkey</span>: <span class=\"string\">'appkey'</span> </span><br><span class=\"line\">  <span class=\"attribute\">placeholder</span>: <span class=\"string\">\"ヾﾉ≧∀≦)o 来呀！快活呀！~啦啦啦~ 啦啦啦啦~\"</span> </span><br><span class=\"line\">  <span class=\"attribute\">visitor</span>: true <span class=\"comment\">//这个打开页会统计文章阅读数</span></span><br></pre></td></tr></table></figure>\n\n</li>\n</ul>\n<h3 id=\"10-next6添加字数统计-和阅读时长\"><a href=\"#10-next6添加字数统计-和阅读时长\" class=\"headerlink\" title=\"10. next6添加字数统计 和阅读时长\"></a>10. next6添加字数统计 和阅读时长</h3><blockquote>\n<p><a href=\"https://github.com/theme-next/hexo-symbols-count-time\" target=\"_blank\" rel=\"noopener\">hexo-symbols-count-time</a></p>\n</blockquote>\n<ul>\n<li><p>10.1 安装node扩展</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm <span class=\"keyword\">install</span> hexo-symbols-<span class=\"keyword\">count</span>-<span class=\"built_in\">time</span> <span class=\"comment\">--save</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>10.2 修改全局配置 _config.yml</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">symbols_count_time:</span></span><br><span class=\"line\"><span class=\"attr\">  symbols:</span> <span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"attr\">  time:</span> <span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"attr\">  total_symbols:</span> <span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"attr\">  total_time:</span> <span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"attr\">  exclude_codeblock:</span> <span class=\"literal\">false</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>10.3 修改主题配置 _config.yml</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">symbols_count_time:</span></span><br><span class=\"line\"><span class=\"attr\">  separated_meta:</span> <span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"attr\">  item_text_post:</span> <span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"attr\">  item_text_total:</span> <span class=\"literal\">false</span></span><br><span class=\"line\"><span class=\"attr\">  awl:</span> <span class=\"number\">4</span></span><br><span class=\"line\"><span class=\"attr\">  wpm:</span> <span class=\"number\">275</span></span><br><span class=\"line\"><span class=\"attr\">  suffix:</span> <span class=\"string\">mins.</span></span><br></pre></td></tr></table></figure>\n\n</li>\n</ul>\n<h3 id=\"11-next6-文章置顶功能\"><a href=\"#11-next6-文章置顶功能\" class=\"headerlink\" title=\"11. next6 文章置顶功能\"></a>11. next6 文章置顶功能</h3><ul>\n<li><p>11.1 安装node扩展 </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm <span class=\"keyword\">uninstall</span> hexo-generator-<span class=\"keyword\">index</span> <span class=\"comment\">--save</span></span><br><span class=\"line\">npm <span class=\"keyword\">install</span> hexo-generator-<span class=\"keyword\">index</span>-pin-top <span class=\"comment\">--save</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>11.2 在文章开头添加置顶标识</p>\n<figure class=\"highlight avrasm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"symbol\">top:</span> <span class=\"number\">10</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>11.3 首页添加明显置顶标识</p>\n<figure class=\"highlight django\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"xml\">themes/next/layout/_macro/post.swig 在<span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"post-meta\"</span>&gt;</span> 下添加如下代码</span></span><br><span class=\"line\"><span class=\"xml\"></span><span class=\"template-tag\">&#123;% <span class=\"name\"><span class=\"name\">if</span></span> post.top %&#125;</span><span class=\"xml\"></span></span><br><span class=\"line\"><span class=\"xml\">    <span class=\"tag\">&lt;<span class=\"name\">i</span> <span class=\"attr\">class</span>=<span class=\"string\">\"fa fa-thumb-tack\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">i</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">    <span class=\"tag\">&lt;<span class=\"name\">font</span> <span class=\"attr\">color</span>=<span class=\"string\">green</span>&gt;</span>置顶<span class=\"tag\">&lt;/<span class=\"name\">font</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">    <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">\"post-meta-divider\"</span>&gt;</span>|<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\"></span><span class=\"template-tag\">&#123;% <span class=\"name\"><span class=\"name\">endif</span></span> %&#125;</span><span class=\"xml\"></span></span><br></pre></td></tr></table></figure>\n\n</li>\n</ul>\n<h3 id=\"12-next6-开启标签和分类\"><a href=\"#12-next6-开启标签和分类\" class=\"headerlink\" title=\"12. next6 开启标签和分类\"></a>12. next6 开启标签和分类</h3><ul>\n<li><p>12.1 创建tags相关目录</p>\n<figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hexo new<span class=\"built_in\"> page </span>tags</span><br><span class=\"line\">hexo new<span class=\"built_in\"> page </span>categories</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>12.2 开启tags标签和分类</p>\n<figure class=\"highlight subunit\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim themes/next/_config.yml</span><br><span class=\"line\"><span class=\"keyword\">tags:</span> /tags/ || tags</span><br><span class=\"line\">categories: /categories/ || th</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>12.3 修改tags站点文件</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">cat</span> <span class=\"string\">source/tags/index.md</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">title:</span> <span class=\"string\">tags</span></span><br><span class=\"line\"><span class=\"attr\">date:</span> <span class=\"number\">2019</span><span class=\"bullet\">-09</span><span class=\"bullet\">-24</span> <span class=\"number\">10</span><span class=\"string\">:08:59</span></span><br><span class=\"line\"><span class=\"attr\">type:</span> <span class=\"string\">\"tags\"</span></span><br><span class=\"line\"><span class=\"attr\">layout:</span> <span class=\"string\">\"tags\"</span></span><br><span class=\"line\"><span class=\"attr\">comments:</span> <span class=\"literal\">false</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>12.4 修改categories站点文件</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">cat</span> <span class=\"string\">source/categories/index.md</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">title:</span> <span class=\"string\">categories</span></span><br><span class=\"line\"><span class=\"attr\">date:</span> <span class=\"number\">2019</span><span class=\"bullet\">-09</span><span class=\"bullet\">-24</span> <span class=\"number\">10</span><span class=\"string\">:09:55</span></span><br><span class=\"line\"><span class=\"attr\">type:</span> <span class=\"string\">\"categories\"</span></span><br><span class=\"line\"><span class=\"attr\">layout:</span> <span class=\"string\">\"categories\"</span></span><br><span class=\"line\"><span class=\"attr\">comments:</span> <span class=\"literal\">false</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>12.5 去掉xxx.github.io/tags/ 页面的post-title(因为我的这个css左对齐了,默认是居中,所以很丑)</p>\n<figure class=\"highlight django\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"xml\"># 注释下面这段代码</span></span><br><span class=\"line\"><span class=\"xml\">vim themes/nextv/layout/page.swig </span></span><br><span class=\"line\"><span class=\"xml\"><span class=\"comment\">&lt;!-- </span></span><span class=\"template-tag\">&#123;% <span class=\"name\"><span class=\"name\">include</span></span> '_partials/page/page-header.swig' %&#125;</span><span class=\"xml\"><span class=\"comment\"> --&gt;</span></span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>12.6 文章中多个tag和categories</p>\n<figure class=\"highlight subunit\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">tags:</span></span><br><span class=\"line\">  - k8s</span><br><span class=\"line\">  - k8s安装</span><br><span class=\"line\">categories:</span><br><span class=\"line\">  - [k8s,安装]</span><br><span class=\"line\">  - [技术文档]</span><br></pre></td></tr></table></figure>\n\n</li>\n</ul>\n"},{"title":"linux遇到一些问题统计总结","copyright":true,"date":"2019-09-26T09:33:38.000Z","top":20,"_content":"记录一些Linux,nginx或其他服务一些问题\n\n<!-- more -->\n\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width = \"100\" height = \"100\" style=\"border: 0\"/>\n</center>\n\n### linux问题: tcpdump抓包tcp第三次握手ack为1\n- 执行命令监听: tcpdump -n port 80 (想要详细信息加 -vv)\n\n> 客户端 telnet x.x.x.x 80\n\n日志如下:\n```\ntcpdump  -n port 80\ntcpdump: verbose output suppressed, use -v or -vv for full protocol decode\nlistening on enp0s3, link-type EN10MB (Ethernet), capture size 262144 bytes\n11:16:40.689157 IP 172.16.54.141.53444 > 172.16.53.106.http: Flags [SEW], seq 1306124348, win 65535, options [mss 1460,nop,wscale 5,nop,nop,TS val 458678777 ecr 0,sackOK,eol], length 0\n11:16:40.689724 IP 172.16.53.106.http > 172.16.54.141.53444: Flags [S.E], seq 1553518959, ack 1306124349, win 64308, options [mss 1410,sackOK,TS val 4208119240 ecr 458678777,nop,wscale 7], length 0\n11:16:40.690320 IP 172.16.54.141.53444 > 172.16.53.106.http: Flags [.], ack 1, win 4106, options [nop,nop,TS val 458678778 ecr 4208119240], length 0\n```\n这里第一和第二次握手都没有问题, 第三次 ack 1, 并非是seq+1\n\n这里提一下ACK, ACK 是确认值, ack 是确认编号, 第一次握手ACK=0,在第二次握手开始ACK=1, 而ack是=seq+1(收到的随机数+1)\n\n那么这里ack 1 是啥呢?  ... 应该就是默认tcpdump 显示成相对值了, 通过-S 参数会显示绝对值\n\n- 执行命令监听: tcpdump -S  -n port 80\n```\ntcpdump: verbose output suppressed, use -v or -vv for full protocol decode\nlistening on enp0s3, link-type EN10MB (Ethernet), capture size 262144 bytes\n11:16:54.806628 IP 172.16.54.141.53516 > 172.16.53.106.http: Flags [S], seq 316359286, win 65535, options [mss 1460,nop,wscale 5,nop,nop,TS val 458692791 ecr 0,sackOK,eol], length 0\n11:16:54.806861 IP 172.16.53.106.http > 172.16.54.141.53516: Flags [S.], seq 1113466641, ack 316359287, win 64308, options [mss 1410,sackOK,TS val 4208133357 ecr 458692791,nop,wscale 7], length 0\n11:16:54.807576 IP 172.16.54.141.53516 > 172.16.53.106.http: Flags [.], ack 1113466642, win 4106, options [nop,nop,TS val 458692792 ecr 4208133357], length 0\n```\n\n三次握手图\n![三次握手图](/images/tcp三次握手图.png)\n\n四次挥手图\n![四次挥手图](/images/tcp四次挥手图.png)\n\n\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width = \"100\" height = \"100\" style=\"border: 0\"/>\n</center>\n\n### linux问题: 禁ping\n```\n# 一次性修改\necho 1 > /proc/sys/net/ipv4/icmp_echo_ignore_all\n\n# 开机自动修改\necho 1 > /proc/sys/net/ipv4/icmp_echo_ignore_all\n\n# 永久禁用,加入到/etc/sysctl.conf\nnet.ipv4.icmp_echo_ignore_all=1\n```\n\n---\n\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width = \"100\" height = \"100\" style=\"border: 0\"/>\n</center>\n\n### linux问题: 文件锁问题\n```\n问题描述: php slowlog 出现session_start() 慢\n问题原因: 我们这边有A 和B 两个二级域名,A 会请求 B, 并且由于测试环境在同一台服务器,公用一个php,所以在发生调用的时候同时写了session,而php的sessions配置是默认的file方式, 这就造成了锁的问题\n问题解决: \n1. 修改代码部分\n2. php的session配置改成redis\n    session.save_handler = redis\n    session.save_path = \"tcp://x.x.x.x:xxxx\"\n```\n\n---\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width = \"100\" height = \"100\" style=\"border: 0\"/>\n</center>\n\n### linux问题: 内存释放问题\n```\n问题描述: 开发这边写了个统计脚本, 占用49G内存, 从日志发现脚本已经全部执行完成, 但是php脚本依然存在\n问题原因: 通过 strace -p pid 观察进程, 发现是持续性的做内存释放操作 munmap(0x7f6db77ad000, 266240)          = 0\n持续执行munmap函数是因为一直在释放内存(毕竟49G), 结果 =0 说明内存释放执行函数是返回正常了\n问题解决: \n1. 修改代码降低内存\n2. 等待一段时间内存会释放完成(测试80分钟释放完毕)\n```\n---\n\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width = \"100\" height = \"100\" style=\"border: 0\"/>\n</center>\n\n### nginx问题: 静态文件分离\n\n对于一般的nginx+php的方式, 我们php采用nobody用户,而代码/lumen采用web-www用户, 这样的好处是页面访问到/lumen时是nobody用户, 是无法修改代码的\n\n可能我们需求是上用户upload图片等, 这时候就可能被传上某个a.php, 这就有可能被代码注入(一般来说图片是放cdn,配置单独域名回源的,这里是直接存在项目目录)\n\n所以为了防止代码注入,我们需要限制upload目录的访问权限\n\n```\n# nginx配置如下\n        location ~ /images/.*\\.(gif|jpg|jpeg|png)$ {\n            root /lumen/storage/uploads/;\n        }\n\n```\n\n这样我们图片传到 /lumen/storage/uploads/images/ 目录, 访问是 www.xxx.com/images/x.png 来访问 且不允许其他类型文件访问.\n\n\n---\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width = \"100\" height = \"100\" style=\"border: 0\"/>\n</center>\n\n### nginx问题: root 和alias\n在配置文件映射的时候，如果使用了正则表达式，那么可能会出现无法访问文件，nginx可能会将所有的\n文件都映射成为文件夹，导致文件映射失败的情况出现；\n\n- root的例子\n```\nlocation /a/ {\n\troot /lumen/public;\n}\n这里实际访问的路径: www.xxx.com/a/ -> /lumen/public/a/\n```\n\n- alias的例子\n```\n# 注意这里目录最后加上/\nlocation /a/ {\n        alias /lumen/public/;\n}\n这里实际访问的路径: www.xxx.com/a/ -> /lumen/public/\n```\n\n\n\n---\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width = \"100\" height = \"100\" style=\"border: 0\"/>\n</center>\n\n### nginx问题: 隐藏版本信息\n```\nSyntax:  server_tokens on | off | build | string;\nDefault:  server_tokens on;\nContext:  http, server, location\n```\n\n---\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width = \"100\" height = \"100\" style=\"border: 0\"/>\n</center>\n\n### nginx问题: 日志出现encode内容如何查看\n```\n# python2 执行decode\n>>> print \"\\x22content\\x22\\x0D\\x0A\\x0D\\x0A\\xE8\\x8A\\x8A\\xE8\\x8A\\x8A\\xE8\\xBF\\x98\\xE6\\x80\\x95\\xE5\\xA6\\x9E\\xE5\\xA6\\x9E\\xE4\\xB8\\x8D\\xE8\\x80\\x81\\xE5\\xAE\\x9E\\xEF\\xBC\\x8C\\xE7\\x89\\xB9\\xE5\\x9C\\xB0\\xE8\\xBF\\x87\\xE6\\x9D\\xA5\\xE8\\xA7\\x86\\xE5\\xAF\\x9F\\xE4\\xB8\\x80\\xE4\\xB8\\x8B\\x0D\\x0A\".decode('utf-8')\n```\n\n---\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width = \"100\" height = \"100\" style=\"border: 0\"/>\n</center>\n\n### nginx问题: default配置未设置\nnginx 未设置default时, 如果直接访问服务器外网ip, 会去请求到第一个匹配的server段, 有可能会请求到后端的服务器的内容, 这很有可能暴露我们不想暴露的服务\n一般来说开头添加如下配置\n\n```\n    server {\n        listen       80 default_server;\n        listen       [::]:80 default_server;\n        server_name  _;\n        deny all;\n\t}\n```\n\nnginx 配置已经配置域名方式访问, 如果访问ip会返回403, 正常来说返回403已经不会对服务器造成压力了\n\n> 可是万万没想到虽然返回了403, 但是也有700字节大小, 大量请求对小带宽来说还是有压力的\n\n```\n# \nserver {\n        listen       80 default_server;\n        listen       [::]:80 default_server;\n        server_name  _;\n        return 499;\n   }\n\n#其他location,if配置,\nif ($host != a.example.com) {\n    return 499;\n}\n\n```\n\n\n\n---\n\n\n\n\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width = \"100\" height = \"100\" style=\"border: 0\"/>\n</center>\n\n### mysql问题: navicat连接数据库很慢\n```\n报错: 2013-Lost connection to MYSQL server at 'reading for initial communication packet'\n说明: 只有windows 的navicat会出现上面报错, windows上通过mysql命令连接时 也很慢\n\n#添加如下内容:\n[mysqld]\nskip-name-resolve\n```\n\n\n---\n\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width = \"100\" height = \"100\" style=\"border: 0\"/>\n</center>\n\n### mysql问题: mysql5.7 错误总结-ERROR 1067 (42000): Invalid default value for TIMESTAMP\n```\nshow variables like 'sql_mode';\n+---------------+-------------------------------------------------------------------------------------------------------------------------------------------+\n| Variable_name | Value                                                                                                                                     |\n+---------------+-------------------------------------------------------------------------------------------------------------------------------------------+\n| sql_mode      | ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION |\n+---------------+-------------------------------------------------------------------------------------------------------------------------------------------+\n```\n这是因为sql_mode中的NO_ZEROR_DATE导制的，在strict mode中不允许'0000-00-00'作为合法日期\n\n将上面的NO_ZERO_DATE改为下面的 ALLOW_INVALID_DATES\n```\nset sql_mode='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,ALLOW_INVALID_DATES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION';\nset session  sql_mode='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION';\n\n```\n上面的设置是临时设置，在重新登陆后，该设置又恢复为NO_ZERO_DATE\n\n","source":"_posts/9-linux遇到一些问题统计总结.md","raw":"---\ntitle: linux遇到一些问题统计总结\ncopyright: true\ndate: 2019-09-26 17:33:38\ntags:\n  - linux\ncategories:\n  - [技术文档]\n  - [linux,问题总结]\ntop: 20\n---\n记录一些Linux,nginx或其他服务一些问题\n\n<!-- more -->\n\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width = \"100\" height = \"100\" style=\"border: 0\"/>\n</center>\n\n### linux问题: tcpdump抓包tcp第三次握手ack为1\n- 执行命令监听: tcpdump -n port 80 (想要详细信息加 -vv)\n\n> 客户端 telnet x.x.x.x 80\n\n日志如下:\n```\ntcpdump  -n port 80\ntcpdump: verbose output suppressed, use -v or -vv for full protocol decode\nlistening on enp0s3, link-type EN10MB (Ethernet), capture size 262144 bytes\n11:16:40.689157 IP 172.16.54.141.53444 > 172.16.53.106.http: Flags [SEW], seq 1306124348, win 65535, options [mss 1460,nop,wscale 5,nop,nop,TS val 458678777 ecr 0,sackOK,eol], length 0\n11:16:40.689724 IP 172.16.53.106.http > 172.16.54.141.53444: Flags [S.E], seq 1553518959, ack 1306124349, win 64308, options [mss 1410,sackOK,TS val 4208119240 ecr 458678777,nop,wscale 7], length 0\n11:16:40.690320 IP 172.16.54.141.53444 > 172.16.53.106.http: Flags [.], ack 1, win 4106, options [nop,nop,TS val 458678778 ecr 4208119240], length 0\n```\n这里第一和第二次握手都没有问题, 第三次 ack 1, 并非是seq+1\n\n这里提一下ACK, ACK 是确认值, ack 是确认编号, 第一次握手ACK=0,在第二次握手开始ACK=1, 而ack是=seq+1(收到的随机数+1)\n\n那么这里ack 1 是啥呢?  ... 应该就是默认tcpdump 显示成相对值了, 通过-S 参数会显示绝对值\n\n- 执行命令监听: tcpdump -S  -n port 80\n```\ntcpdump: verbose output suppressed, use -v or -vv for full protocol decode\nlistening on enp0s3, link-type EN10MB (Ethernet), capture size 262144 bytes\n11:16:54.806628 IP 172.16.54.141.53516 > 172.16.53.106.http: Flags [S], seq 316359286, win 65535, options [mss 1460,nop,wscale 5,nop,nop,TS val 458692791 ecr 0,sackOK,eol], length 0\n11:16:54.806861 IP 172.16.53.106.http > 172.16.54.141.53516: Flags [S.], seq 1113466641, ack 316359287, win 64308, options [mss 1410,sackOK,TS val 4208133357 ecr 458692791,nop,wscale 7], length 0\n11:16:54.807576 IP 172.16.54.141.53516 > 172.16.53.106.http: Flags [.], ack 1113466642, win 4106, options [nop,nop,TS val 458692792 ecr 4208133357], length 0\n```\n\n三次握手图\n![三次握手图](/images/tcp三次握手图.png)\n\n四次挥手图\n![四次挥手图](/images/tcp四次挥手图.png)\n\n\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width = \"100\" height = \"100\" style=\"border: 0\"/>\n</center>\n\n### linux问题: 禁ping\n```\n# 一次性修改\necho 1 > /proc/sys/net/ipv4/icmp_echo_ignore_all\n\n# 开机自动修改\necho 1 > /proc/sys/net/ipv4/icmp_echo_ignore_all\n\n# 永久禁用,加入到/etc/sysctl.conf\nnet.ipv4.icmp_echo_ignore_all=1\n```\n\n---\n\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width = \"100\" height = \"100\" style=\"border: 0\"/>\n</center>\n\n### linux问题: 文件锁问题\n```\n问题描述: php slowlog 出现session_start() 慢\n问题原因: 我们这边有A 和B 两个二级域名,A 会请求 B, 并且由于测试环境在同一台服务器,公用一个php,所以在发生调用的时候同时写了session,而php的sessions配置是默认的file方式, 这就造成了锁的问题\n问题解决: \n1. 修改代码部分\n2. php的session配置改成redis\n    session.save_handler = redis\n    session.save_path = \"tcp://x.x.x.x:xxxx\"\n```\n\n---\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width = \"100\" height = \"100\" style=\"border: 0\"/>\n</center>\n\n### linux问题: 内存释放问题\n```\n问题描述: 开发这边写了个统计脚本, 占用49G内存, 从日志发现脚本已经全部执行完成, 但是php脚本依然存在\n问题原因: 通过 strace -p pid 观察进程, 发现是持续性的做内存释放操作 munmap(0x7f6db77ad000, 266240)          = 0\n持续执行munmap函数是因为一直在释放内存(毕竟49G), 结果 =0 说明内存释放执行函数是返回正常了\n问题解决: \n1. 修改代码降低内存\n2. 等待一段时间内存会释放完成(测试80分钟释放完毕)\n```\n---\n\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width = \"100\" height = \"100\" style=\"border: 0\"/>\n</center>\n\n### nginx问题: 静态文件分离\n\n对于一般的nginx+php的方式, 我们php采用nobody用户,而代码/lumen采用web-www用户, 这样的好处是页面访问到/lumen时是nobody用户, 是无法修改代码的\n\n可能我们需求是上用户upload图片等, 这时候就可能被传上某个a.php, 这就有可能被代码注入(一般来说图片是放cdn,配置单独域名回源的,这里是直接存在项目目录)\n\n所以为了防止代码注入,我们需要限制upload目录的访问权限\n\n```\n# nginx配置如下\n        location ~ /images/.*\\.(gif|jpg|jpeg|png)$ {\n            root /lumen/storage/uploads/;\n        }\n\n```\n\n这样我们图片传到 /lumen/storage/uploads/images/ 目录, 访问是 www.xxx.com/images/x.png 来访问 且不允许其他类型文件访问.\n\n\n---\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width = \"100\" height = \"100\" style=\"border: 0\"/>\n</center>\n\n### nginx问题: root 和alias\n在配置文件映射的时候，如果使用了正则表达式，那么可能会出现无法访问文件，nginx可能会将所有的\n文件都映射成为文件夹，导致文件映射失败的情况出现；\n\n- root的例子\n```\nlocation /a/ {\n\troot /lumen/public;\n}\n这里实际访问的路径: www.xxx.com/a/ -> /lumen/public/a/\n```\n\n- alias的例子\n```\n# 注意这里目录最后加上/\nlocation /a/ {\n        alias /lumen/public/;\n}\n这里实际访问的路径: www.xxx.com/a/ -> /lumen/public/\n```\n\n\n\n---\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width = \"100\" height = \"100\" style=\"border: 0\"/>\n</center>\n\n### nginx问题: 隐藏版本信息\n```\nSyntax:  server_tokens on | off | build | string;\nDefault:  server_tokens on;\nContext:  http, server, location\n```\n\n---\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width = \"100\" height = \"100\" style=\"border: 0\"/>\n</center>\n\n### nginx问题: 日志出现encode内容如何查看\n```\n# python2 执行decode\n>>> print \"\\x22content\\x22\\x0D\\x0A\\x0D\\x0A\\xE8\\x8A\\x8A\\xE8\\x8A\\x8A\\xE8\\xBF\\x98\\xE6\\x80\\x95\\xE5\\xA6\\x9E\\xE5\\xA6\\x9E\\xE4\\xB8\\x8D\\xE8\\x80\\x81\\xE5\\xAE\\x9E\\xEF\\xBC\\x8C\\xE7\\x89\\xB9\\xE5\\x9C\\xB0\\xE8\\xBF\\x87\\xE6\\x9D\\xA5\\xE8\\xA7\\x86\\xE5\\xAF\\x9F\\xE4\\xB8\\x80\\xE4\\xB8\\x8B\\x0D\\x0A\".decode('utf-8')\n```\n\n---\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width = \"100\" height = \"100\" style=\"border: 0\"/>\n</center>\n\n### nginx问题: default配置未设置\nnginx 未设置default时, 如果直接访问服务器外网ip, 会去请求到第一个匹配的server段, 有可能会请求到后端的服务器的内容, 这很有可能暴露我们不想暴露的服务\n一般来说开头添加如下配置\n\n```\n    server {\n        listen       80 default_server;\n        listen       [::]:80 default_server;\n        server_name  _;\n        deny all;\n\t}\n```\n\nnginx 配置已经配置域名方式访问, 如果访问ip会返回403, 正常来说返回403已经不会对服务器造成压力了\n\n> 可是万万没想到虽然返回了403, 但是也有700字节大小, 大量请求对小带宽来说还是有压力的\n\n```\n# \nserver {\n        listen       80 default_server;\n        listen       [::]:80 default_server;\n        server_name  _;\n        return 499;\n   }\n\n#其他location,if配置,\nif ($host != a.example.com) {\n    return 499;\n}\n\n```\n\n\n\n---\n\n\n\n\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width = \"100\" height = \"100\" style=\"border: 0\"/>\n</center>\n\n### mysql问题: navicat连接数据库很慢\n```\n报错: 2013-Lost connection to MYSQL server at 'reading for initial communication packet'\n说明: 只有windows 的navicat会出现上面报错, windows上通过mysql命令连接时 也很慢\n\n#添加如下内容:\n[mysqld]\nskip-name-resolve\n```\n\n\n---\n\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width = \"100\" height = \"100\" style=\"border: 0\"/>\n</center>\n\n### mysql问题: mysql5.7 错误总结-ERROR 1067 (42000): Invalid default value for TIMESTAMP\n```\nshow variables like 'sql_mode';\n+---------------+-------------------------------------------------------------------------------------------------------------------------------------------+\n| Variable_name | Value                                                                                                                                     |\n+---------------+-------------------------------------------------------------------------------------------------------------------------------------------+\n| sql_mode      | ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION |\n+---------------+-------------------------------------------------------------------------------------------------------------------------------------------+\n```\n这是因为sql_mode中的NO_ZEROR_DATE导制的，在strict mode中不允许'0000-00-00'作为合法日期\n\n将上面的NO_ZERO_DATE改为下面的 ALLOW_INVALID_DATES\n```\nset sql_mode='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,ALLOW_INVALID_DATES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION';\nset session  sql_mode='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION';\n\n```\n上面的设置是临时设置，在重新登陆后，该设置又恢复为NO_ZERO_DATE\n\n","slug":"9-linux遇到一些问题统计总结","published":1,"updated":"2019-10-17T02:24:03.584Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck28uwzp3003zkerwlz3hld5x","content":"<p>记录一些Linux,nginx或其他服务一些问题</p>\n<a id=\"more\"></a>\n\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width=\"100\" height=\"100\" style=\"border: 0\">\n</center>\n\n<h3 id=\"linux问题-tcpdump抓包tcp第三次握手ack为1\"><a href=\"#linux问题-tcpdump抓包tcp第三次握手ack为1\" class=\"headerlink\" title=\"linux问题: tcpdump抓包tcp第三次握手ack为1\"></a>linux问题: tcpdump抓包tcp第三次握手ack为1</h3><ul>\n<li>执行命令监听: tcpdump -n port 80 (想要详细信息加 -vv)</li>\n</ul>\n<blockquote>\n<p>客户端 telnet x.x.x.x 80</p>\n</blockquote>\n<p>日志如下:</p>\n<figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tcpdump  -n<span class=\"built_in\"> port </span>80</span><br><span class=\"line\">tcpdump: verbose output suppressed, use -v <span class=\"keyword\">or</span> -vv <span class=\"keyword\">for</span> full protocol decode</span><br><span class=\"line\">listening on enp0s3, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class=\"line\">11:16:40.689157<span class=\"built_in\"> IP </span>172.16.54.141.53444 &gt; 172.16.53.106.http: Flags [SEW], seq 1306124348, win 65535, options [mss 1460,nop,wscale 5,nop,nop,TS val 458678777 ecr 0,sackOK,eol], length 0</span><br><span class=\"line\">11:16:40.689724<span class=\"built_in\"> IP </span>172.16.53.106.http &gt; 172.16.54.141.53444: Flags [S.E], seq 1553518959, ack 1306124349, win 64308, options [mss 1410,sackOK,TS val 4208119240 ecr 458678777,nop,wscale 7], length 0</span><br><span class=\"line\">11:16:40.690320<span class=\"built_in\"> IP </span>172.16.54.141.53444 &gt; 172.16.53.106.http: Flags [.], ack 1, win 4106, options [nop,nop,TS val 458678778 ecr 4208119240], length 0</span><br></pre></td></tr></table></figure>\n\n<p>这里第一和第二次握手都没有问题, 第三次 ack 1, 并非是seq+1</p>\n<p>这里提一下ACK, ACK 是确认值, ack 是确认编号, 第一次握手ACK=0,在第二次握手开始ACK=1, 而ack是=seq+1(收到的随机数+1)</p>\n<p>那么这里ack 1 是啥呢?  … 应该就是默认tcpdump 显示成相对值了, 通过-S 参数会显示绝对值</p>\n<ul>\n<li>执行命令监听: tcpdump -S  -n port 80<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">tcpdump</span>: <span class=\"selector-tag\">verbose</span> <span class=\"selector-tag\">output</span> <span class=\"selector-tag\">suppressed</span>, <span class=\"selector-tag\">use</span> <span class=\"selector-tag\">-v</span> <span class=\"selector-tag\">or</span> <span class=\"selector-tag\">-vv</span> <span class=\"selector-tag\">for</span> <span class=\"selector-tag\">full</span> <span class=\"selector-tag\">protocol</span> <span class=\"selector-tag\">decode</span></span><br><span class=\"line\"><span class=\"selector-tag\">listening</span> <span class=\"selector-tag\">on</span> <span class=\"selector-tag\">enp0s3</span>, <span class=\"selector-tag\">link-type</span> <span class=\"selector-tag\">EN10MB</span> (<span class=\"selector-tag\">Ethernet</span>), <span class=\"selector-tag\">capture</span> <span class=\"selector-tag\">size</span> 262144 <span class=\"selector-tag\">bytes</span></span><br><span class=\"line\">11<span class=\"selector-pseudo\">:16</span><span class=\"selector-pseudo\">:54.806628</span> <span class=\"selector-tag\">IP</span> 172<span class=\"selector-class\">.16</span><span class=\"selector-class\">.54</span><span class=\"selector-class\">.141</span><span class=\"selector-class\">.53516</span> &gt; 172<span class=\"selector-class\">.16</span><span class=\"selector-class\">.53</span><span class=\"selector-class\">.106</span><span class=\"selector-class\">.http</span>: <span class=\"selector-tag\">Flags</span> <span class=\"selector-attr\">[S]</span>, <span class=\"selector-tag\">seq</span> 316359286, <span class=\"selector-tag\">win</span> 65535, <span class=\"selector-tag\">options</span> <span class=\"selector-attr\">[mss 1460,nop,wscale 5,nop,nop,TS val 458692791 ecr 0,sackOK,eol]</span>, <span class=\"selector-tag\">length</span> 0</span><br><span class=\"line\">11<span class=\"selector-pseudo\">:16</span><span class=\"selector-pseudo\">:54.806861</span> <span class=\"selector-tag\">IP</span> 172<span class=\"selector-class\">.16</span><span class=\"selector-class\">.53</span><span class=\"selector-class\">.106</span><span class=\"selector-class\">.http</span> &gt; 172<span class=\"selector-class\">.16</span><span class=\"selector-class\">.54</span><span class=\"selector-class\">.141</span><span class=\"selector-class\">.53516</span>: <span class=\"selector-tag\">Flags</span> <span class=\"selector-attr\">[S.]</span>, <span class=\"selector-tag\">seq</span> 1113466641, <span class=\"selector-tag\">ack</span> 316359287, <span class=\"selector-tag\">win</span> 64308, <span class=\"selector-tag\">options</span> <span class=\"selector-attr\">[mss 1410,sackOK,TS val 4208133357 ecr 458692791,nop,wscale 7]</span>, <span class=\"selector-tag\">length</span> 0</span><br><span class=\"line\">11<span class=\"selector-pseudo\">:16</span><span class=\"selector-pseudo\">:54.807576</span> <span class=\"selector-tag\">IP</span> 172<span class=\"selector-class\">.16</span><span class=\"selector-class\">.54</span><span class=\"selector-class\">.141</span><span class=\"selector-class\">.53516</span> &gt; 172<span class=\"selector-class\">.16</span><span class=\"selector-class\">.53</span><span class=\"selector-class\">.106</span><span class=\"selector-class\">.http</span>: <span class=\"selector-tag\">Flags</span> <span class=\"selector-attr\">[.]</span>, <span class=\"selector-tag\">ack</span> 1113466642, <span class=\"selector-tag\">win</span> 4106, <span class=\"selector-tag\">options</span> <span class=\"selector-attr\">[nop,nop,TS val 458692792 ecr 4208133357]</span>, <span class=\"selector-tag\">length</span> 0</span><br></pre></td></tr></table></figure>\n\n</li>\n</ul>\n<p>三次握手图<br><img src=\"/images/tcp%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E5%9B%BE.png\" alt=\"三次握手图\"></p>\n<p>四次挥手图<br><img src=\"/images/tcp%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B%E5%9B%BE.png\" alt=\"四次挥手图\"></p>\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width=\"100\" height=\"100\" style=\"border: 0\">\n</center>\n\n<h3 id=\"linux问题-禁ping\"><a href=\"#linux问题-禁ping\" class=\"headerlink\" title=\"linux问题: 禁ping\"></a>linux问题: 禁ping</h3><figure class=\"highlight jboss-cli\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 一次性修改</span></span><br><span class=\"line\"><span class=\"keyword\">echo</span> 1 &gt; <span class=\"string\">/proc/sys/net/ipv4/icmp_echo_ignore_all</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 开机自动修改</span></span><br><span class=\"line\"><span class=\"keyword\">echo</span> 1 &gt; <span class=\"string\">/proc/sys/net/ipv4/icmp_echo_ignore_all</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 永久禁用,加入到/etc/sysctl.conf</span></span><br><span class=\"line\">net.ipv4.icmp_<span class=\"keyword\">echo</span>_ignore_all=1</span><br></pre></td></tr></table></figure>\n\n<hr>\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width=\"100\" height=\"100\" style=\"border: 0\">\n</center>\n\n<h3 id=\"linux问题-文件锁问题\"><a href=\"#linux问题-文件锁问题\" class=\"headerlink\" title=\"linux问题: 文件锁问题\"></a>linux问题: 文件锁问题</h3><figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">问题描述: php slowlog 出现session_start() 慢</span><br><span class=\"line\">问题原因: 我们这边有A 和B 两个二级域名,A 会请求 B, 并且由于测试环境在同一台服务器,公用一个php,所以在发生调用的时候同时写了session,而php的sessions配置是默认的file方式, 这就造成了锁的问题</span><br><span class=\"line\">问题解决: </span><br><span class=\"line\"><span class=\"number\">1</span>. 修改代码部分</span><br><span class=\"line\"><span class=\"number\">2</span>. php的session配置改成redis</span><br><span class=\"line\">    session<span class=\"selector-class\">.save_handler</span> = redis</span><br><span class=\"line\">    session<span class=\"selector-class\">.save_path</span> = <span class=\"string\">\"tcp://x.x.x.x:xxxx\"</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width=\"100\" height=\"100\" style=\"border: 0\">\n</center>\n\n<h3 id=\"linux问题-内存释放问题\"><a href=\"#linux问题-内存释放问题\" class=\"headerlink\" title=\"linux问题: 内存释放问题\"></a>linux问题: 内存释放问题</h3><figure class=\"highlight makefile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">问题描述: 开发这边写了个统计脚本, 占用49G内存, 从日志发现脚本已经全部执行完成, 但是php脚本依然存在</span></span><br><span class=\"line\"><span class=\"section\">问题原因: 通过 strace -p pid 观察进程, 发现是持续性的做内存释放操作 munmap(0x7f6db77ad000, 266240)          = 0</span></span><br><span class=\"line\">持续执行munmap函数是因为一直在释放内存(毕竟49G), 结果 =0 说明内存释放执行函数是返回正常了</span><br><span class=\"line\"><span class=\"section\">问题解决: </span></span><br><span class=\"line\">1. 修改代码降低内存</span><br><span class=\"line\">2. 等待一段时间内存会释放完成(测试80分钟释放完毕)</span><br></pre></td></tr></table></figure>\n\n<hr>\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width=\"100\" height=\"100\" style=\"border: 0\">\n</center>\n\n<h3 id=\"nginx问题-静态文件分离\"><a href=\"#nginx问题-静态文件分离\" class=\"headerlink\" title=\"nginx问题: 静态文件分离\"></a>nginx问题: 静态文件分离</h3><p>对于一般的nginx+php的方式, 我们php采用nobody用户,而代码/lumen采用web-www用户, 这样的好处是页面访问到/lumen时是nobody用户, 是无法修改代码的</p>\n<p>可能我们需求是上用户upload图片等, 这时候就可能被传上某个a.php, 这就有可能被代码注入(一般来说图片是放cdn,配置单独域名回源的,这里是直接存在项目目录)</p>\n<p>所以为了防止代码注入,我们需要限制upload目录的访问权限</p>\n<figure class=\"highlight awk\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># nginx配置如下</span></span><br><span class=\"line\">        location ~ <span class=\"regexp\">/images/</span>.*\\.(gif|jpg|jpeg|png)$ &#123;</span><br><span class=\"line\">            root <span class=\"regexp\">/lumen/</span>storage<span class=\"regexp\">/uploads/</span>;</span><br><span class=\"line\">        &#125;</span><br></pre></td></tr></table></figure>\n\n<p>这样我们图片传到 /lumen/storage/uploads/images/ 目录, 访问是 <a href=\"http://www.xxx.com/images/x.png\" target=\"_blank\" rel=\"noopener\">www.xxx.com/images/x.png</a> 来访问 且不允许其他类型文件访问.</p>\n<hr>\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width=\"100\" height=\"100\" style=\"border: 0\">\n</center>\n\n<h3 id=\"nginx问题-root-和alias\"><a href=\"#nginx问题-root-和alias\" class=\"headerlink\" title=\"nginx问题: root 和alias\"></a>nginx问题: root 和alias</h3><p>在配置文件映射的时候，如果使用了正则表达式，那么可能会出现无法访问文件，nginx可能会将所有的<br>文件都映射成为文件夹，导致文件映射失败的情况出现；</p>\n<ul>\n<li><p>root的例子</p>\n<figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">location <span class=\"regexp\">/a/</span> &#123;</span><br><span class=\"line\">\troot <span class=\"regexp\">/lumen/</span><span class=\"keyword\">public</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">这里实际访问的路径: www.xxx.com<span class=\"regexp\">/a/</span> -&gt; <span class=\"regexp\">/lumen/</span><span class=\"keyword\">public</span><span class=\"regexp\">/a/</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>alias的例子</p>\n<figure class=\"highlight livescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 注意这里目录最后加上/</span></span><br><span class=\"line\">location <span class=\"regexp\">/a/</span> &#123;</span><br><span class=\"line\">        alias <span class=\"regexp\">/lumen/public/</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">这里实际访问的路径: www.xxx.com<span class=\"regexp\">/a/</span><span class=\"function\"> -&gt;</span> <span class=\"regexp\">/lumen/public/</span></span><br></pre></td></tr></table></figure>\n\n</li>\n</ul>\n<hr>\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width=\"100\" height=\"100\" style=\"border: 0\">\n</center>\n\n<h3 id=\"nginx问题-隐藏版本信息\"><a href=\"#nginx问题-隐藏版本信息\" class=\"headerlink\" title=\"nginx问题: 隐藏版本信息\"></a>nginx问题: 隐藏版本信息</h3><figure class=\"highlight applescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Syntax:  server_tokens <span class=\"keyword\">on</span> | off | build | <span class=\"built_in\">string</span>;</span><br><span class=\"line\">Default:  server_tokens <span class=\"keyword\">on</span>;</span><br><span class=\"line\">Context:  http, server, location</span><br></pre></td></tr></table></figure>\n\n<hr>\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width=\"100\" height=\"100\" style=\"border: 0\">\n</center>\n\n<h3 id=\"nginx问题-日志出现encode内容如何查看\"><a href=\"#nginx问题-日志出现encode内容如何查看\" class=\"headerlink\" title=\"nginx问题: 日志出现encode内容如何查看\"></a>nginx问题: 日志出现encode内容如何查看</h3><figure class=\"highlight taggerscript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># python2 执行decode</span><br><span class=\"line\">&gt;&gt;&gt; print \"<span class=\"symbol\">\\x</span>22content<span class=\"symbol\">\\x</span>22<span class=\"symbol\">\\x</span>0D<span class=\"symbol\">\\x</span>0A<span class=\"symbol\">\\x</span>0D<span class=\"symbol\">\\x</span>0A<span class=\"symbol\">\\x</span>E8<span class=\"symbol\">\\x</span>8A<span class=\"symbol\">\\x</span>8A<span class=\"symbol\">\\x</span>E8<span class=\"symbol\">\\x</span>8A<span class=\"symbol\">\\x</span>8A<span class=\"symbol\">\\x</span>E8<span class=\"symbol\">\\x</span>BF<span class=\"symbol\">\\x</span>98<span class=\"symbol\">\\x</span>E6<span class=\"symbol\">\\x</span>80<span class=\"symbol\">\\x</span>95<span class=\"symbol\">\\x</span>E5<span class=\"symbol\">\\x</span>A6<span class=\"symbol\">\\x</span>9E<span class=\"symbol\">\\x</span>E5<span class=\"symbol\">\\x</span>A6<span class=\"symbol\">\\x</span>9E<span class=\"symbol\">\\x</span>E4<span class=\"symbol\">\\x</span>B8<span class=\"symbol\">\\x</span>8D<span class=\"symbol\">\\x</span>E8<span class=\"symbol\">\\x</span>80<span class=\"symbol\">\\x</span>81<span class=\"symbol\">\\x</span>E5<span class=\"symbol\">\\x</span>AE<span class=\"symbol\">\\x</span>9E<span class=\"symbol\">\\x</span>EF<span class=\"symbol\">\\x</span>BC<span class=\"symbol\">\\x</span>8C<span class=\"symbol\">\\x</span>E7<span class=\"symbol\">\\x</span>89<span class=\"symbol\">\\x</span>B9<span class=\"symbol\">\\x</span>E5<span class=\"symbol\">\\x</span>9C<span class=\"symbol\">\\x</span>B0<span class=\"symbol\">\\x</span>E8<span class=\"symbol\">\\x</span>BF<span class=\"symbol\">\\x</span>87<span class=\"symbol\">\\x</span>E6<span class=\"symbol\">\\x</span>9D<span class=\"symbol\">\\x</span>A5<span class=\"symbol\">\\x</span>E8<span class=\"symbol\">\\x</span>A7<span class=\"symbol\">\\x</span>86<span class=\"symbol\">\\x</span>E5<span class=\"symbol\">\\x</span>AF<span class=\"symbol\">\\x</span>9F<span class=\"symbol\">\\x</span>E4<span class=\"symbol\">\\x</span>B8<span class=\"symbol\">\\x</span>80<span class=\"symbol\">\\x</span>E4<span class=\"symbol\">\\x</span>B8<span class=\"symbol\">\\x</span>8B<span class=\"symbol\">\\x</span>0D<span class=\"symbol\">\\x</span>0A\".decode('utf-8')</span><br></pre></td></tr></table></figure>\n\n<hr>\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width=\"100\" height=\"100\" style=\"border: 0\">\n</center>\n\n<h3 id=\"nginx问题-default配置未设置\"><a href=\"#nginx问题-default配置未设置\" class=\"headerlink\" title=\"nginx问题: default配置未设置\"></a>nginx问题: default配置未设置</h3><p>nginx 未设置default时, 如果直接访问服务器外网ip, 会去请求到第一个匹配的server段, 有可能会请求到后端的服务器的内容, 这很有可能暴露我们不想暴露的服务<br>一般来说开头添加如下配置</p>\n<figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  <span class=\"built_in\"> server </span>&#123;</span><br><span class=\"line\">       listen       80 default_server;</span><br><span class=\"line\">       listen       [::]:80 default_server;</span><br><span class=\"line\">       server_name  _;</span><br><span class=\"line\">       deny all;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>nginx 配置已经配置域名方式访问, 如果访问ip会返回403, 正常来说返回403已经不会对服务器造成压力了</p>\n<blockquote>\n<p>可是万万没想到虽然返回了403, 但是也有700字节大小, 大量请求对小带宽来说还是有压力的</p>\n</blockquote>\n<figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">server &#123;</span><br><span class=\"line\">        listen       80 default_server;</span><br><span class=\"line\">        listen       [::]:80 default_server;</span><br><span class=\"line\">        server_name  _;</span><br><span class=\"line\">        return 499;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#其他location,if配置,</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"variable\">$host</span> != a.example.com) &#123;</span><br><span class=\"line\">    return 499;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width=\"100\" height=\"100\" style=\"border: 0\">\n</center>\n\n<h3 id=\"mysql问题-navicat连接数据库很慢\"><a href=\"#mysql问题-navicat连接数据库很慢\" class=\"headerlink\" title=\"mysql问题: navicat连接数据库很慢\"></a>mysql问题: navicat连接数据库很慢</h3><figure class=\"highlight applescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">报错: <span class=\"number\">2013</span>-Lost connection <span class=\"keyword\">to</span> MYSQL server <span class=\"keyword\">at</span> 'reading <span class=\"keyword\">for</span> initial communication packet'</span><br><span class=\"line\">说明: 只有windows 的navicat会出现上面报错, windows上通过mysql命令连接时 也很慢</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#添加如下内容:</span></span><br><span class=\"line\">[mysqld]</span><br><span class=\"line\">skip-<span class=\"built_in\">name</span>-resolve</span><br></pre></td></tr></table></figure>\n\n<hr>\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width=\"100\" height=\"100\" style=\"border: 0\">\n</center>\n\n<h3 id=\"mysql问题-mysql5-7-错误总结-ERROR-1067-42000-Invalid-default-value-for-TIMESTAMP\"><a href=\"#mysql问题-mysql5-7-错误总结-ERROR-1067-42000-Invalid-default-value-for-TIMESTAMP\" class=\"headerlink\" title=\"mysql问题: mysql5.7 错误总结-ERROR 1067 (42000): Invalid default value for TIMESTAMP\"></a>mysql问题: mysql5.7 错误总结-ERROR 1067 (42000): Invalid default value for TIMESTAMP</h3><figure class=\"highlight asciidoc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">show variables like <span class=\"emphasis\">'sql_mode'</span>;</span><br><span class=\"line\"><span class=\"code\">+---------------+</span>-------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class=\"line\">| Variable<span class=\"emphasis\">_name | Value                                                                                                                                     |</span></span><br><span class=\"line\"><span class=\"emphasis\">+---------------+-------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class=\"line\"><span class=\"emphasis\">| sql_</span>mode      | ONLY<span class=\"emphasis\">_FULL_</span>GROUP<span class=\"emphasis\">_BY,STRICT_</span>TRANS<span class=\"emphasis\">_TABLES,NO_</span>ZERO<span class=\"emphasis\">_IN_</span>DATE,NO<span class=\"emphasis\">_ZERO_</span>DATE,ERROR<span class=\"emphasis\">_FOR_</span>DIVISION<span class=\"emphasis\">_BY_</span>ZERO,NO<span class=\"emphasis\">_AUTO_</span>CREATE<span class=\"emphasis\">_USER,NO_</span>ENGINE<span class=\"emphasis\">_SUBSTITUTION |</span></span><br><span class=\"line\"><span class=\"emphasis\">+---------------+-------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br></pre></td></tr></table></figure>\n\n<p>这是因为sql_mode中的NO_ZEROR_DATE导制的，在strict mode中不允许’0000-00-00’作为合法日期</p>\n<p>将上面的NO_ZERO_DATE改为下面的 ALLOW_INVALID_DATES</p>\n<figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"builtin-name\">set</span> <span class=\"attribute\">sql_mode</span>=<span class=\"string\">'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,ALLOW_INVALID_DATES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION'</span>;</span><br><span class=\"line\"><span class=\"builtin-name\">set</span> session  <span class=\"attribute\">sql_mode</span>=<span class=\"string\">'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION'</span>;</span><br></pre></td></tr></table></figure>\n\n<p>上面的设置是临时设置，在重新登陆后，该设置又恢复为NO_ZERO_DATE</p>\n","site":{"data":{}},"length":5854,"excerpt":"<p>记录一些Linux,nginx或其他服务一些问题</p>","more":"<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width=\"100\" height=\"100\" style=\"border: 0\">\n</center>\n\n<h3 id=\"linux问题-tcpdump抓包tcp第三次握手ack为1\"><a href=\"#linux问题-tcpdump抓包tcp第三次握手ack为1\" class=\"headerlink\" title=\"linux问题: tcpdump抓包tcp第三次握手ack为1\"></a>linux问题: tcpdump抓包tcp第三次握手ack为1</h3><ul>\n<li>执行命令监听: tcpdump -n port 80 (想要详细信息加 -vv)</li>\n</ul>\n<blockquote>\n<p>客户端 telnet x.x.x.x 80</p>\n</blockquote>\n<p>日志如下:</p>\n<figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tcpdump  -n<span class=\"built_in\"> port </span>80</span><br><span class=\"line\">tcpdump: verbose output suppressed, use -v <span class=\"keyword\">or</span> -vv <span class=\"keyword\">for</span> full protocol decode</span><br><span class=\"line\">listening on enp0s3, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class=\"line\">11:16:40.689157<span class=\"built_in\"> IP </span>172.16.54.141.53444 &gt; 172.16.53.106.http: Flags [SEW], seq 1306124348, win 65535, options [mss 1460,nop,wscale 5,nop,nop,TS val 458678777 ecr 0,sackOK,eol], length 0</span><br><span class=\"line\">11:16:40.689724<span class=\"built_in\"> IP </span>172.16.53.106.http &gt; 172.16.54.141.53444: Flags [S.E], seq 1553518959, ack 1306124349, win 64308, options [mss 1410,sackOK,TS val 4208119240 ecr 458678777,nop,wscale 7], length 0</span><br><span class=\"line\">11:16:40.690320<span class=\"built_in\"> IP </span>172.16.54.141.53444 &gt; 172.16.53.106.http: Flags [.], ack 1, win 4106, options [nop,nop,TS val 458678778 ecr 4208119240], length 0</span><br></pre></td></tr></table></figure>\n\n<p>这里第一和第二次握手都没有问题, 第三次 ack 1, 并非是seq+1</p>\n<p>这里提一下ACK, ACK 是确认值, ack 是确认编号, 第一次握手ACK=0,在第二次握手开始ACK=1, 而ack是=seq+1(收到的随机数+1)</p>\n<p>那么这里ack 1 是啥呢?  … 应该就是默认tcpdump 显示成相对值了, 通过-S 参数会显示绝对值</p>\n<ul>\n<li>执行命令监听: tcpdump -S  -n port 80<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">tcpdump</span>: <span class=\"selector-tag\">verbose</span> <span class=\"selector-tag\">output</span> <span class=\"selector-tag\">suppressed</span>, <span class=\"selector-tag\">use</span> <span class=\"selector-tag\">-v</span> <span class=\"selector-tag\">or</span> <span class=\"selector-tag\">-vv</span> <span class=\"selector-tag\">for</span> <span class=\"selector-tag\">full</span> <span class=\"selector-tag\">protocol</span> <span class=\"selector-tag\">decode</span></span><br><span class=\"line\"><span class=\"selector-tag\">listening</span> <span class=\"selector-tag\">on</span> <span class=\"selector-tag\">enp0s3</span>, <span class=\"selector-tag\">link-type</span> <span class=\"selector-tag\">EN10MB</span> (<span class=\"selector-tag\">Ethernet</span>), <span class=\"selector-tag\">capture</span> <span class=\"selector-tag\">size</span> 262144 <span class=\"selector-tag\">bytes</span></span><br><span class=\"line\">11<span class=\"selector-pseudo\">:16</span><span class=\"selector-pseudo\">:54.806628</span> <span class=\"selector-tag\">IP</span> 172<span class=\"selector-class\">.16</span><span class=\"selector-class\">.54</span><span class=\"selector-class\">.141</span><span class=\"selector-class\">.53516</span> &gt; 172<span class=\"selector-class\">.16</span><span class=\"selector-class\">.53</span><span class=\"selector-class\">.106</span><span class=\"selector-class\">.http</span>: <span class=\"selector-tag\">Flags</span> <span class=\"selector-attr\">[S]</span>, <span class=\"selector-tag\">seq</span> 316359286, <span class=\"selector-tag\">win</span> 65535, <span class=\"selector-tag\">options</span> <span class=\"selector-attr\">[mss 1460,nop,wscale 5,nop,nop,TS val 458692791 ecr 0,sackOK,eol]</span>, <span class=\"selector-tag\">length</span> 0</span><br><span class=\"line\">11<span class=\"selector-pseudo\">:16</span><span class=\"selector-pseudo\">:54.806861</span> <span class=\"selector-tag\">IP</span> 172<span class=\"selector-class\">.16</span><span class=\"selector-class\">.53</span><span class=\"selector-class\">.106</span><span class=\"selector-class\">.http</span> &gt; 172<span class=\"selector-class\">.16</span><span class=\"selector-class\">.54</span><span class=\"selector-class\">.141</span><span class=\"selector-class\">.53516</span>: <span class=\"selector-tag\">Flags</span> <span class=\"selector-attr\">[S.]</span>, <span class=\"selector-tag\">seq</span> 1113466641, <span class=\"selector-tag\">ack</span> 316359287, <span class=\"selector-tag\">win</span> 64308, <span class=\"selector-tag\">options</span> <span class=\"selector-attr\">[mss 1410,sackOK,TS val 4208133357 ecr 458692791,nop,wscale 7]</span>, <span class=\"selector-tag\">length</span> 0</span><br><span class=\"line\">11<span class=\"selector-pseudo\">:16</span><span class=\"selector-pseudo\">:54.807576</span> <span class=\"selector-tag\">IP</span> 172<span class=\"selector-class\">.16</span><span class=\"selector-class\">.54</span><span class=\"selector-class\">.141</span><span class=\"selector-class\">.53516</span> &gt; 172<span class=\"selector-class\">.16</span><span class=\"selector-class\">.53</span><span class=\"selector-class\">.106</span><span class=\"selector-class\">.http</span>: <span class=\"selector-tag\">Flags</span> <span class=\"selector-attr\">[.]</span>, <span class=\"selector-tag\">ack</span> 1113466642, <span class=\"selector-tag\">win</span> 4106, <span class=\"selector-tag\">options</span> <span class=\"selector-attr\">[nop,nop,TS val 458692792 ecr 4208133357]</span>, <span class=\"selector-tag\">length</span> 0</span><br></pre></td></tr></table></figure>\n\n</li>\n</ul>\n<p>三次握手图<br><img src=\"/images/tcp%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E5%9B%BE.png\" alt=\"三次握手图\"></p>\n<p>四次挥手图<br><img src=\"/images/tcp%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B%E5%9B%BE.png\" alt=\"四次挥手图\"></p>\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width=\"100\" height=\"100\" style=\"border: 0\">\n</center>\n\n<h3 id=\"linux问题-禁ping\"><a href=\"#linux问题-禁ping\" class=\"headerlink\" title=\"linux问题: 禁ping\"></a>linux问题: 禁ping</h3><figure class=\"highlight jboss-cli\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 一次性修改</span></span><br><span class=\"line\"><span class=\"keyword\">echo</span> 1 &gt; <span class=\"string\">/proc/sys/net/ipv4/icmp_echo_ignore_all</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 开机自动修改</span></span><br><span class=\"line\"><span class=\"keyword\">echo</span> 1 &gt; <span class=\"string\">/proc/sys/net/ipv4/icmp_echo_ignore_all</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 永久禁用,加入到/etc/sysctl.conf</span></span><br><span class=\"line\">net.ipv4.icmp_<span class=\"keyword\">echo</span>_ignore_all=1</span><br></pre></td></tr></table></figure>\n\n<hr>\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width=\"100\" height=\"100\" style=\"border: 0\">\n</center>\n\n<h3 id=\"linux问题-文件锁问题\"><a href=\"#linux问题-文件锁问题\" class=\"headerlink\" title=\"linux问题: 文件锁问题\"></a>linux问题: 文件锁问题</h3><figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">问题描述: php slowlog 出现session_start() 慢</span><br><span class=\"line\">问题原因: 我们这边有A 和B 两个二级域名,A 会请求 B, 并且由于测试环境在同一台服务器,公用一个php,所以在发生调用的时候同时写了session,而php的sessions配置是默认的file方式, 这就造成了锁的问题</span><br><span class=\"line\">问题解决: </span><br><span class=\"line\"><span class=\"number\">1</span>. 修改代码部分</span><br><span class=\"line\"><span class=\"number\">2</span>. php的session配置改成redis</span><br><span class=\"line\">    session<span class=\"selector-class\">.save_handler</span> = redis</span><br><span class=\"line\">    session<span class=\"selector-class\">.save_path</span> = <span class=\"string\">\"tcp://x.x.x.x:xxxx\"</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width=\"100\" height=\"100\" style=\"border: 0\">\n</center>\n\n<h3 id=\"linux问题-内存释放问题\"><a href=\"#linux问题-内存释放问题\" class=\"headerlink\" title=\"linux问题: 内存释放问题\"></a>linux问题: 内存释放问题</h3><figure class=\"highlight makefile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">问题描述: 开发这边写了个统计脚本, 占用49G内存, 从日志发现脚本已经全部执行完成, 但是php脚本依然存在</span></span><br><span class=\"line\"><span class=\"section\">问题原因: 通过 strace -p pid 观察进程, 发现是持续性的做内存释放操作 munmap(0x7f6db77ad000, 266240)          = 0</span></span><br><span class=\"line\">持续执行munmap函数是因为一直在释放内存(毕竟49G), 结果 =0 说明内存释放执行函数是返回正常了</span><br><span class=\"line\"><span class=\"section\">问题解决: </span></span><br><span class=\"line\">1. 修改代码降低内存</span><br><span class=\"line\">2. 等待一段时间内存会释放完成(测试80分钟释放完毕)</span><br></pre></td></tr></table></figure>\n\n<hr>\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width=\"100\" height=\"100\" style=\"border: 0\">\n</center>\n\n<h3 id=\"nginx问题-静态文件分离\"><a href=\"#nginx问题-静态文件分离\" class=\"headerlink\" title=\"nginx问题: 静态文件分离\"></a>nginx问题: 静态文件分离</h3><p>对于一般的nginx+php的方式, 我们php采用nobody用户,而代码/lumen采用web-www用户, 这样的好处是页面访问到/lumen时是nobody用户, 是无法修改代码的</p>\n<p>可能我们需求是上用户upload图片等, 这时候就可能被传上某个a.php, 这就有可能被代码注入(一般来说图片是放cdn,配置单独域名回源的,这里是直接存在项目目录)</p>\n<p>所以为了防止代码注入,我们需要限制upload目录的访问权限</p>\n<figure class=\"highlight awk\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># nginx配置如下</span></span><br><span class=\"line\">        location ~ <span class=\"regexp\">/images/</span>.*\\.(gif|jpg|jpeg|png)$ &#123;</span><br><span class=\"line\">            root <span class=\"regexp\">/lumen/</span>storage<span class=\"regexp\">/uploads/</span>;</span><br><span class=\"line\">        &#125;</span><br></pre></td></tr></table></figure>\n\n<p>这样我们图片传到 /lumen/storage/uploads/images/ 目录, 访问是 <a href=\"http://www.xxx.com/images/x.png\" target=\"_blank\" rel=\"noopener\">www.xxx.com/images/x.png</a> 来访问 且不允许其他类型文件访问.</p>\n<hr>\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width=\"100\" height=\"100\" style=\"border: 0\">\n</center>\n\n<h3 id=\"nginx问题-root-和alias\"><a href=\"#nginx问题-root-和alias\" class=\"headerlink\" title=\"nginx问题: root 和alias\"></a>nginx问题: root 和alias</h3><p>在配置文件映射的时候，如果使用了正则表达式，那么可能会出现无法访问文件，nginx可能会将所有的<br>文件都映射成为文件夹，导致文件映射失败的情况出现；</p>\n<ul>\n<li><p>root的例子</p>\n<figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">location <span class=\"regexp\">/a/</span> &#123;</span><br><span class=\"line\">\troot <span class=\"regexp\">/lumen/</span><span class=\"keyword\">public</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">这里实际访问的路径: www.xxx.com<span class=\"regexp\">/a/</span> -&gt; <span class=\"regexp\">/lumen/</span><span class=\"keyword\">public</span><span class=\"regexp\">/a/</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>alias的例子</p>\n<figure class=\"highlight livescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 注意这里目录最后加上/</span></span><br><span class=\"line\">location <span class=\"regexp\">/a/</span> &#123;</span><br><span class=\"line\">        alias <span class=\"regexp\">/lumen/public/</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">这里实际访问的路径: www.xxx.com<span class=\"regexp\">/a/</span><span class=\"function\"> -&gt;</span> <span class=\"regexp\">/lumen/public/</span></span><br></pre></td></tr></table></figure>\n\n</li>\n</ul>\n<hr>\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width=\"100\" height=\"100\" style=\"border: 0\">\n</center>\n\n<h3 id=\"nginx问题-隐藏版本信息\"><a href=\"#nginx问题-隐藏版本信息\" class=\"headerlink\" title=\"nginx问题: 隐藏版本信息\"></a>nginx问题: 隐藏版本信息</h3><figure class=\"highlight applescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Syntax:  server_tokens <span class=\"keyword\">on</span> | off | build | <span class=\"built_in\">string</span>;</span><br><span class=\"line\">Default:  server_tokens <span class=\"keyword\">on</span>;</span><br><span class=\"line\">Context:  http, server, location</span><br></pre></td></tr></table></figure>\n\n<hr>\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width=\"100\" height=\"100\" style=\"border: 0\">\n</center>\n\n<h3 id=\"nginx问题-日志出现encode内容如何查看\"><a href=\"#nginx问题-日志出现encode内容如何查看\" class=\"headerlink\" title=\"nginx问题: 日志出现encode内容如何查看\"></a>nginx问题: 日志出现encode内容如何查看</h3><figure class=\"highlight taggerscript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># python2 执行decode</span><br><span class=\"line\">&gt;&gt;&gt; print \"<span class=\"symbol\">\\x</span>22content<span class=\"symbol\">\\x</span>22<span class=\"symbol\">\\x</span>0D<span class=\"symbol\">\\x</span>0A<span class=\"symbol\">\\x</span>0D<span class=\"symbol\">\\x</span>0A<span class=\"symbol\">\\x</span>E8<span class=\"symbol\">\\x</span>8A<span class=\"symbol\">\\x</span>8A<span class=\"symbol\">\\x</span>E8<span class=\"symbol\">\\x</span>8A<span class=\"symbol\">\\x</span>8A<span class=\"symbol\">\\x</span>E8<span class=\"symbol\">\\x</span>BF<span class=\"symbol\">\\x</span>98<span class=\"symbol\">\\x</span>E6<span class=\"symbol\">\\x</span>80<span class=\"symbol\">\\x</span>95<span class=\"symbol\">\\x</span>E5<span class=\"symbol\">\\x</span>A6<span class=\"symbol\">\\x</span>9E<span class=\"symbol\">\\x</span>E5<span class=\"symbol\">\\x</span>A6<span class=\"symbol\">\\x</span>9E<span class=\"symbol\">\\x</span>E4<span class=\"symbol\">\\x</span>B8<span class=\"symbol\">\\x</span>8D<span class=\"symbol\">\\x</span>E8<span class=\"symbol\">\\x</span>80<span class=\"symbol\">\\x</span>81<span class=\"symbol\">\\x</span>E5<span class=\"symbol\">\\x</span>AE<span class=\"symbol\">\\x</span>9E<span class=\"symbol\">\\x</span>EF<span class=\"symbol\">\\x</span>BC<span class=\"symbol\">\\x</span>8C<span class=\"symbol\">\\x</span>E7<span class=\"symbol\">\\x</span>89<span class=\"symbol\">\\x</span>B9<span class=\"symbol\">\\x</span>E5<span class=\"symbol\">\\x</span>9C<span class=\"symbol\">\\x</span>B0<span class=\"symbol\">\\x</span>E8<span class=\"symbol\">\\x</span>BF<span class=\"symbol\">\\x</span>87<span class=\"symbol\">\\x</span>E6<span class=\"symbol\">\\x</span>9D<span class=\"symbol\">\\x</span>A5<span class=\"symbol\">\\x</span>E8<span class=\"symbol\">\\x</span>A7<span class=\"symbol\">\\x</span>86<span class=\"symbol\">\\x</span>E5<span class=\"symbol\">\\x</span>AF<span class=\"symbol\">\\x</span>9F<span class=\"symbol\">\\x</span>E4<span class=\"symbol\">\\x</span>B8<span class=\"symbol\">\\x</span>80<span class=\"symbol\">\\x</span>E4<span class=\"symbol\">\\x</span>B8<span class=\"symbol\">\\x</span>8B<span class=\"symbol\">\\x</span>0D<span class=\"symbol\">\\x</span>0A\".decode('utf-8')</span><br></pre></td></tr></table></figure>\n\n<hr>\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width=\"100\" height=\"100\" style=\"border: 0\">\n</center>\n\n<h3 id=\"nginx问题-default配置未设置\"><a href=\"#nginx问题-default配置未设置\" class=\"headerlink\" title=\"nginx问题: default配置未设置\"></a>nginx问题: default配置未设置</h3><p>nginx 未设置default时, 如果直接访问服务器外网ip, 会去请求到第一个匹配的server段, 有可能会请求到后端的服务器的内容, 这很有可能暴露我们不想暴露的服务<br>一般来说开头添加如下配置</p>\n<figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  <span class=\"built_in\"> server </span>&#123;</span><br><span class=\"line\">       listen       80 default_server;</span><br><span class=\"line\">       listen       [::]:80 default_server;</span><br><span class=\"line\">       server_name  _;</span><br><span class=\"line\">       deny all;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>nginx 配置已经配置域名方式访问, 如果访问ip会返回403, 正常来说返回403已经不会对服务器造成压力了</p>\n<blockquote>\n<p>可是万万没想到虽然返回了403, 但是也有700字节大小, 大量请求对小带宽来说还是有压力的</p>\n</blockquote>\n<figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">server &#123;</span><br><span class=\"line\">        listen       80 default_server;</span><br><span class=\"line\">        listen       [::]:80 default_server;</span><br><span class=\"line\">        server_name  _;</span><br><span class=\"line\">        return 499;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#其他location,if配置,</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"variable\">$host</span> != a.example.com) &#123;</span><br><span class=\"line\">    return 499;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width=\"100\" height=\"100\" style=\"border: 0\">\n</center>\n\n<h3 id=\"mysql问题-navicat连接数据库很慢\"><a href=\"#mysql问题-navicat连接数据库很慢\" class=\"headerlink\" title=\"mysql问题: navicat连接数据库很慢\"></a>mysql问题: navicat连接数据库很慢</h3><figure class=\"highlight applescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">报错: <span class=\"number\">2013</span>-Lost connection <span class=\"keyword\">to</span> MYSQL server <span class=\"keyword\">at</span> 'reading <span class=\"keyword\">for</span> initial communication packet'</span><br><span class=\"line\">说明: 只有windows 的navicat会出现上面报错, windows上通过mysql命令连接时 也很慢</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#添加如下内容:</span></span><br><span class=\"line\">[mysqld]</span><br><span class=\"line\">skip-<span class=\"built_in\">name</span>-resolve</span><br></pre></td></tr></table></figure>\n\n<hr>\n<center>\n<img src=\"http://zhangzw001.github.io/images/dockerniu.jpeg\" width=\"100\" height=\"100\" style=\"border: 0\">\n</center>\n\n<h3 id=\"mysql问题-mysql5-7-错误总结-ERROR-1067-42000-Invalid-default-value-for-TIMESTAMP\"><a href=\"#mysql问题-mysql5-7-错误总结-ERROR-1067-42000-Invalid-default-value-for-TIMESTAMP\" class=\"headerlink\" title=\"mysql问题: mysql5.7 错误总结-ERROR 1067 (42000): Invalid default value for TIMESTAMP\"></a>mysql问题: mysql5.7 错误总结-ERROR 1067 (42000): Invalid default value for TIMESTAMP</h3><figure class=\"highlight asciidoc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">show variables like <span class=\"emphasis\">'sql_mode'</span>;</span><br><span class=\"line\"><span class=\"code\">+---------------+</span>-------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class=\"line\">| Variable<span class=\"emphasis\">_name | Value                                                                                                                                     |</span></span><br><span class=\"line\"><span class=\"emphasis\">+---------------+-------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class=\"line\"><span class=\"emphasis\">| sql_</span>mode      | ONLY<span class=\"emphasis\">_FULL_</span>GROUP<span class=\"emphasis\">_BY,STRICT_</span>TRANS<span class=\"emphasis\">_TABLES,NO_</span>ZERO<span class=\"emphasis\">_IN_</span>DATE,NO<span class=\"emphasis\">_ZERO_</span>DATE,ERROR<span class=\"emphasis\">_FOR_</span>DIVISION<span class=\"emphasis\">_BY_</span>ZERO,NO<span class=\"emphasis\">_AUTO_</span>CREATE<span class=\"emphasis\">_USER,NO_</span>ENGINE<span class=\"emphasis\">_SUBSTITUTION |</span></span><br><span class=\"line\"><span class=\"emphasis\">+---------------+-------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br></pre></td></tr></table></figure>\n\n<p>这是因为sql_mode中的NO_ZEROR_DATE导制的，在strict mode中不允许’0000-00-00’作为合法日期</p>\n<p>将上面的NO_ZERO_DATE改为下面的 ALLOW_INVALID_DATES</p>\n<figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"builtin-name\">set</span> <span class=\"attribute\">sql_mode</span>=<span class=\"string\">'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,ALLOW_INVALID_DATES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION'</span>;</span><br><span class=\"line\"><span class=\"builtin-name\">set</span> session  <span class=\"attribute\">sql_mode</span>=<span class=\"string\">'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION'</span>;</span><br></pre></td></tr></table></figure>\n\n<p>上面的设置是临时设置，在重新登陆后，该设置又恢复为NO_ZERO_DATE</p>"}],"PostAsset":[],"PostCategory":[{"post_id":"ck28uwzmn0008kerw1k8gzeat","category_id":"ck28uwzmz000jkerwvgw89qhp","_id":"ck28uwzn8000wkerw36khb96u"},{"post_id":"ck28uwzml0007kerwcpe96snb","category_id":"ck28uwzmj0006kerwpd6fgd2a","_id":"ck28uwznb0012kerwho7ehmmr"},{"post_id":"ck28uwzml0007kerwcpe96snb","category_id":"ck28uwzn2000nkerw5w07dtmc","_id":"ck28uwznb0014kerw58c23gel"},{"post_id":"ck28uwzm60001kerwcr8xhzq2","category_id":"ck28uwzmj0006kerwpd6fgd2a","_id":"ck28uwznd0017kerw19fe0pwp"},{"post_id":"ck28uwzm60001kerwcr8xhzq2","category_id":"ck28uwzn6000ukerwpuyhassj","_id":"ck28uwznd0019kerwzhpozb4e"},{"post_id":"ck28uwzn9000zkerwn91ilx0n","category_id":"ck28uwzmj0006kerwpd6fgd2a","_id":"ck28uwzne001dkerwagk672gd"},{"post_id":"ck28uwzn9000zkerwn91ilx0n","category_id":"ck28uwzn2000nkerw5w07dtmc","_id":"ck28uwzne001ekerwpt3672an"},{"post_id":"ck28uwzmc0003kerws6m9w78u","category_id":"ck28uwzmo000akerwqboo1kih","_id":"ck28uwznf001hkerw47o3pege"},{"post_id":"ck28uwzmc0003kerws6m9w78u","category_id":"ck28uwznc0015kerwe9kt3gzc","_id":"ck28uwzng001jkerw8p711wkh"},{"post_id":"ck28uwzmr000ckerwotj6yy7l","category_id":"ck28uwzne001bkerwx4cc51lb","_id":"ck28uwznh001mkerwi1xwv19u"},{"post_id":"ck28uwzmi0005kerwaxtcwx5c","category_id":"ck28uwzmj0006kerwpd6fgd2a","_id":"ck28uwznk001vkerwiq3dybvm"},{"post_id":"ck28uwzmi0005kerwaxtcwx5c","category_id":"ck28uwzn2000nkerw5w07dtmc","_id":"ck28uwznk001xkerwmaqwq8uk"},{"post_id":"ck28uwzmz000lkerwjsu2ffba","category_id":"ck28uwzmo000akerwqboo1kih","_id":"ck28uwznl0020kerwktoe27up"},{"post_id":"ck28uwzmz000lkerwjsu2ffba","category_id":"ck28uwzni001pkerwvva3gyu5","_id":"ck28uwznl0022kerwyvyg8j45"},{"post_id":"ck28uwzmp000bkerwgnlcajc7","category_id":"ck28uwzmz000jkerwvgw89qhp","_id":"ck28uwzns002lkerwijbugz9z"},{"post_id":"ck28uwzmp000bkerwgnlcajc7","category_id":"ck28uwznq002dkerwfj3p44ut","_id":"ck28uwznt002nkerw9f2sp2fj"},{"post_id":"ck28uwzmy000hkerw6m5rural","category_id":"ck28uwznf001gkerwyhyyg8qf","_id":"ck28uwznu002rkerwwv483v8g"},{"post_id":"ck28uwzmy000hkerw6m5rural","category_id":"ck28uwznr002hkerwwyfy0r6s","_id":"ck28uwznu002skerwkj6cmyoe"},{"post_id":"ck28uwzmu000fkerwhyqi6cku","category_id":"ck28uwzmj0006kerwpd6fgd2a","_id":"ck28uwznv002vkerw60o8m534"},{"post_id":"ck28uwzmu000fkerwhyqi6cku","category_id":"ck28uwznf001gkerwyhyyg8qf","_id":"ck28uwznw002xkerwslboex3k"},{"post_id":"ck28uwzmu000fkerwhyqi6cku","category_id":"ck28uwzns002jkerweoxdmwkf","_id":"ck28uwznx0031kerw51fckwvw"},{"post_id":"ck28uwzn1000mkerwgf3we2lk","category_id":"ck28uwznj001tkerw34yodyt7","_id":"ck28uwznx0032kerwzacaczoy"},{"post_id":"ck28uwzn1000mkerwgf3we2lk","category_id":"ck28uwznt002pkerwgw4wtvo1","_id":"ck28uwznz0035kerwc8z82lou"},{"post_id":"ck28uwzn1000mkerwgf3we2lk","category_id":"ck28uwzn2000nkerw5w07dtmc","_id":"ck28uwznz0036kerwki9qz53d"},{"post_id":"ck28uwzn3000pkerwoocywfph","category_id":"ck28uwzmj0006kerwpd6fgd2a","_id":"ck28uwzo00039kerwz8eih6rt"},{"post_id":"ck28uwzn3000pkerwoocywfph","category_id":"ck28uwznj001tkerw34yodyt7","_id":"ck28uwzo0003akerw303p5dke"},{"post_id":"ck28uwzn3000pkerwoocywfph","category_id":"ck28uwznw0030kerwtrv5zc2x","_id":"ck28uwzo1003dkerw1x2utpa5"},{"post_id":"ck28uwzn8000ykerwqj5qtgtp","category_id":"ck28uwzmj0006kerwpd6fgd2a","_id":"ck28uwzo2003ikerwlrvwcw28"},{"post_id":"ck28uwzn8000ykerwqj5qtgtp","category_id":"ck28uwzno002akerwtk4a6bue","_id":"ck28uwzo3003kkerw50nurhfd"},{"post_id":"ck28uwzn8000ykerwqj5qtgtp","category_id":"ck28uwznz0038kerw25q14wcw","_id":"ck28uwzo3003mkerw66qt460u"},{"post_id":"ck28uwzn4000rkerwskdd47h9","category_id":"ck28uwznk001ykerwzun94c97","_id":"ck28uwzo3003okerwwqh5jjgh"},{"post_id":"ck28uwzn4000rkerwskdd47h9","category_id":"ck28uwznv002ukerwo56civt8","_id":"ck28uwzo4003pkerwmi244w6s"},{"post_id":"ck28uwzn4000rkerwskdd47h9","category_id":"ck28uwzo1003ckerw7cdi2wm1","_id":"ck28uwzo4003qkerw05kuvoni"},{"post_id":"ck28uwzn5000tkerwo0lz3tm1","category_id":"ck28uwznk001ykerwzun94c97","_id":"ck28uwzo4003rkerwckx77f7f"},{"post_id":"ck28uwzn5000tkerwo0lz3tm1","category_id":"ck28uwzny0034kerw2snmz2sg","_id":"ck28uwzo5003skerwrt6ncpfv"},{"post_id":"ck28uwzn5000tkerwo0lz3tm1","category_id":"ck28uwznv002ukerwo56civt8","_id":"ck28uwzo5003tkerwn3tuqgca"},{"post_id":"ck28uwzn5000tkerwo0lz3tm1","category_id":"ck28uwzo1003ckerw7cdi2wm1","_id":"ck28uwzo5003ukerw97bii10u"},{"post_id":"ck28uwzp2003ykerweiqnom1j","category_id":"ck28uwznk001ykerwzun94c97","_id":"ck28uwzp60046kerwpzcijpig"},{"post_id":"ck28uwzp2003ykerweiqnom1j","category_id":"ck28uwznv002ukerwo56civt8","_id":"ck28uwzp70049kerwd3v1f9yb"},{"post_id":"ck28uwzp2003ykerweiqnom1j","category_id":"ck28uwzo1003ckerw7cdi2wm1","_id":"ck28uwzp7004ckerwxdmgpqx0"},{"post_id":"ck28uwzp0003vkerwk81m0lku","category_id":"ck28uwzmj0006kerwpd6fgd2a","_id":"ck28uwzp8004ekerwhaqj33eo"},{"post_id":"ck28uwzp0003vkerwk81m0lku","category_id":"ck28uwznj001tkerw34yodyt7","_id":"ck28uwzpa004gkerw2qjdbng7"},{"post_id":"ck28uwzp0003vkerwk81m0lku","category_id":"ck28uwzp50043kerwfe0w0e8t","_id":"ck28uwzpa004ikerw17b1v1ma"},{"post_id":"ck28uwzp3003zkerwlz3hld5x","category_id":"ck28uwzmj0006kerwpd6fgd2a","_id":"ck28uwzpa004kkerwwy7v8s1s"},{"post_id":"ck28uwzp3003zkerwlz3hld5x","category_id":"ck28uwzmo000akerwqboo1kih","_id":"ck28uwzpb004mkerwoclrvn2g"},{"post_id":"ck28uwzp3003zkerwlz3hld5x","category_id":"ck28uwzp60047kerwnc3w3w8g","_id":"ck28uwzpb004okerwb8jnjsqg"},{"post_id":"ck28uwzp1003wkerw9ua9nqra","category_id":"ck28uwznj001tkerw34yodyt7","_id":"ck28uwzpb004skerw0e9ddezo"},{"post_id":"ck28uwzp1003wkerw9ua9nqra","category_id":"ck28uwzp40040kerw42ubbpml","_id":"ck28uwzpb004tkerwaouudcxw"},{"post_id":"ck28uwzp1003wkerw9ua9nqra","category_id":"ck28uwzno002akerwtk4a6bue","_id":"ck28uwzpc004ukerwzaakd5v4"},{"post_id":"ck28uwzp1003wkerw9ua9nqra","category_id":"ck28uwzp7004dkerwc70ilii3","_id":"ck28uwzpc004vkerwacacprc8"},{"post_id":"ck28uwzp1003wkerw9ua9nqra","category_id":"ck28uwzno002akerwtk4a6bue","_id":"ck28uwzpc004wkerwkti37l65"},{"post_id":"ck28uwzp1003wkerw9ua9nqra","category_id":"ck28uwznz0038kerw25q14wcw","_id":"ck28uwzpc004xkerwz7j8y04j"},{"post_id":"ck28uwzp1003wkerw9ua9nqra","category_id":"ck28uwzmj0006kerwpd6fgd2a","_id":"ck28uwzpc004ykerw9ywc6v0j"}],"PostTag":[{"post_id":"ck28uwzm60001kerwcr8xhzq2","tag_id":"ck28uwzmg0004kerwbok68j3j","_id":"ck28uwzmx000gkerw2kbxac80"},{"post_id":"ck28uwzm60001kerwcr8xhzq2","tag_id":"ck28uwzmo0009kerwvd5dsdsi","_id":"ck28uwzmy000ikerwa3vor6as"},{"post_id":"ck28uwzmc0003kerws6m9w78u","tag_id":"ck28uwzms000dkerwas4hhw28","_id":"ck28uwzn4000qkerw6mu3kyz4"},{"post_id":"ck28uwzmc0003kerws6m9w78u","tag_id":"ck28uwzmz000kkerw22004pbz","_id":"ck28uwzn5000skerwv6jghomi"},{"post_id":"ck28uwzmi0005kerwaxtcwx5c","tag_id":"ck28uwzn2000okerwx0eunxoh","_id":"ck28uwzn8000xkerwfnkaazqh"},{"post_id":"ck28uwzml0007kerwcpe96snb","tag_id":"ck28uwzn2000okerwx0eunxoh","_id":"ck28uwznb0013kerw8np5m91n"},{"post_id":"ck28uwzmn0008kerw1k8gzeat","tag_id":"ck28uwzna0010kerw4bc4nv86","_id":"ck28uwznd0018kerwoxgksem6"},{"post_id":"ck28uwzmp000bkerwgnlcajc7","tag_id":"ck28uwzna0010kerw4bc4nv86","_id":"ck28uwzne001ckerwzfxyproe"},{"post_id":"ck28uwzmr000ckerwotj6yy7l","tag_id":"ck28uwznd001akerw4ck3gyx4","_id":"ck28uwznf001ikerwni4ry4nk"},{"post_id":"ck28uwzmu000fkerwhyqi6cku","tag_id":"ck28uwznf001fkerwsjc0jajd","_id":"ck28uwznj001rkerwf7no6y0e"},{"post_id":"ck28uwzmu000fkerwhyqi6cku","tag_id":"ck28uwzng001kkerw4sxtweir","_id":"ck28uwznj001skerwfl9coa0c"},{"post_id":"ck28uwzmu000fkerwhyqi6cku","tag_id":"ck28uwznh001okerwqm8ruwdo","_id":"ck28uwznk001wkerwa7lejskw"},{"post_id":"ck28uwzmy000hkerw6m5rural","tag_id":"ck28uwznj001qkerweol8lhf6","_id":"ck28uwznl0021kerwfbzzodb1"},{"post_id":"ck28uwzmy000hkerw6m5rural","tag_id":"ck28uwznk001ukerwyvqmp313","_id":"ck28uwznm0023kerwe2vypreh"},{"post_id":"ck28uwzmz000lkerwjsu2ffba","tag_id":"ck28uwzms000dkerwas4hhw28","_id":"ck28uwznn0026kerw0pby8u9z"},{"post_id":"ck28uwzmz000lkerwjsu2ffba","tag_id":"ck28uwznl001zkerwpjshajkq","_id":"ck28uwznn0028kerw0ocf353h"},{"post_id":"ck28uwzn1000mkerwgf3we2lk","tag_id":"ck28uwznm0025kerw4p84g05i","_id":"ck28uwznp002ckerw3w8rbjtp"},{"post_id":"ck28uwzn1000mkerwgf3we2lk","tag_id":"ck28uwzn2000okerwx0eunxoh","_id":"ck28uwznq002ekerwamiwcye8"},{"post_id":"ck28uwzn3000pkerwoocywfph","tag_id":"ck28uwznm0025kerw4p84g05i","_id":"ck28uwznr002gkerwwft7sjyq"},{"post_id":"ck28uwzn4000rkerwskdd47h9","tag_id":"ck28uwznq002fkerwo5iwdq6q","_id":"ck28uwznt002mkerwcbd6v4gq"},{"post_id":"ck28uwzn4000rkerwskdd47h9","tag_id":"ck28uwznr002ikerwtxzg4cdh","_id":"ck28uwznt002okerw5jxpzc1i"},{"post_id":"ck28uwzn5000tkerwo0lz3tm1","tag_id":"ck28uwznq002fkerwo5iwdq6q","_id":"ck28uwznv002wkerwfzfxpuey"},{"post_id":"ck28uwzn5000tkerwo0lz3tm1","tag_id":"ck28uwznr002ikerwtxzg4cdh","_id":"ck28uwznw002ykerw95f3fiif"},{"post_id":"ck28uwzn8000ykerwqj5qtgtp","tag_id":"ck28uwznv002tkerwbftbck6p","_id":"ck28uwzo1003ekerwv6h6un7w"},{"post_id":"ck28uwzn8000ykerwqj5qtgtp","tag_id":"ck28uwznw002zkerwa5x0y7iv","_id":"ck28uwzo1003fkerwg41asxkr"},{"post_id":"ck28uwzn8000ykerwqj5qtgtp","tag_id":"ck28uwznm0025kerw4p84g05i","_id":"ck28uwzo2003hkerw0fb5bj6v"},{"post_id":"ck28uwzn8000ykerwqj5qtgtp","tag_id":"ck28uwznz0037kerwub7wfvae","_id":"ck28uwzo2003jkerwkga0yyg7"},{"post_id":"ck28uwzn9000zkerwn91ilx0n","tag_id":"ck28uwzn2000okerwx0eunxoh","_id":"ck28uwzo3003lkerwjpc0cnrc"},{"post_id":"ck28uwzn9000zkerwn91ilx0n","tag_id":"ck28uwzo0003bkerwt7uge00r","_id":"ck28uwzo3003nkerwbvphnkck"},{"post_id":"ck28uwzp3003zkerwlz3hld5x","tag_id":"ck28uwzms000dkerwas4hhw28","_id":"ck28uwzp50042kerwssha8of0"},{"post_id":"ck28uwzp0003vkerwk81m0lku","tag_id":"ck28uwznm0025kerw4p84g05i","_id":"ck28uwzp60045kerw887io8r0"},{"post_id":"ck28uwzp0003vkerwk81m0lku","tag_id":"ck28uwzp2003xkerw2exahts4","_id":"ck28uwzp70048kerwuwq307ot"},{"post_id":"ck28uwzp0003vkerwk81m0lku","tag_id":"ck28uwzp50041kerws01gdrev","_id":"ck28uwzp7004bkerwc24k6yyf"},{"post_id":"ck28uwzp1003wkerw9ua9nqra","tag_id":"ck28uwznv002tkerwbftbck6p","_id":"ck28uwzpa004hkerwkcg216bq"},{"post_id":"ck28uwzp1003wkerw9ua9nqra","tag_id":"ck28uwzp60044kerwjulyehlr","_id":"ck28uwzpa004jkerwzpvt34h8"},{"post_id":"ck28uwzp1003wkerw9ua9nqra","tag_id":"ck28uwznm0025kerw4p84g05i","_id":"ck28uwzpa004lkerwchtl7g4u"},{"post_id":"ck28uwzp1003wkerw9ua9nqra","tag_id":"ck28uwznz0037kerwub7wfvae","_id":"ck28uwzpb004nkerwdb07j5gd"},{"post_id":"ck28uwzp1003wkerw9ua9nqra","tag_id":"ck28uwzp7004akerwnsh1kujp","_id":"ck28uwzpb004pkerwf6upsq13"},{"post_id":"ck28uwzp2003ykerweiqnom1j","tag_id":"ck28uwznq002fkerwo5iwdq6q","_id":"ck28uwzpb004qkerwkupy4h6x"},{"post_id":"ck28uwzp2003ykerweiqnom1j","tag_id":"ck28uwzp8004fkerwkdimfgst","_id":"ck28uwzpb004rkerwuge4elej"}],"Tag":[{"name":"nginx","_id":"ck28uwzmg0004kerwbok68j3j"},{"name":"php7","_id":"ck28uwzmo0009kerwvd5dsdsi"},{"name":"linux","_id":"ck28uwzms000dkerwas4hhw28"},{"name":"awk","_id":"ck28uwzmz000kkerw22004pbz"},{"name":"mysql","_id":"ck28uwzn2000okerwx0eunxoh"},{"name":"docker","_id":"ck28uwzna0010kerw4bc4nv86"},{"name":"markdown","_id":"ck28uwznd001akerw4ck3gyx4"},{"name":"云原生","_id":"ck28uwznf001fkerwsjc0jajd"},{"name":"cloud native","_id":"ck28uwzng001kkerw4sxtweir"},{"name":"大佬博客","_id":"ck28uwznh001okerwqm8ruwdo"},{"name":"收藏","_id":"ck28uwznj001qkerweol8lhf6"},{"name":"网址","_id":"ck28uwznk001ukerwyvqmp313"},{"name":"shell","_id":"ck28uwznl001zkerwpjshajkq"},{"name":"k8s","_id":"ck28uwznm0025kerw4p84g05i"},{"name":"hexo6","_id":"ck28uwznq002fkerwo5iwdq6q"},{"name":"特效","_id":"ck28uwznr002ikerwtxzg4cdh"},{"name":"ceph","_id":"ck28uwznv002tkerwbftbck6p"},{"name":"cephfs","_id":"ck28uwznw002zkerwa5x0y7iv"},{"name":"k8s存储","_id":"ck28uwznz0037kerwub7wfvae"},{"name":"mysql5.7","_id":"ck28uwzo0003bkerwt7uge00r"},{"name":"elk","_id":"ck28uwzp2003xkerw2exahts4"},{"name":"elk7","_id":"ck28uwzp50041kerws01gdrev"},{"name":"nfs","_id":"ck28uwzp60044kerwjulyehlr"},{"name":"storageclass","_id":"ck28uwzp7004akerwnsh1kujp"},{"name":"hexo美化","_id":"ck28uwzp8004fkerwkdimfgst"}]}}