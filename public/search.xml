<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[k8s‰∏ÄÊù°ÂëΩ‰ª§ÈÉ®ÁΩ≤es5.2.0ÈõÜÁæ§]]></title>
    <url>%2F2019%2F11%2F21%2F27-k8s%E4%B8%80%E6%9D%A1%E5%91%BD%E4%BB%A4%E9%83%A8%E7%BD%B2es5-2-0%E9%9B%86%E7%BE%A4%2F</url>
    <content type="text"><![CDATA[Áî±‰∫éËÄÅÈ°πÁõÆÊòØÂü∫‰∫ées5.2.0, ÊâÄ‰ª•ÂáÜÂ§áÂú®k8sÂü∫‰∫énfsÂ≠òÂÇ®Êê≠Âª∫‰∏ÄÂ•ó,‰∏ãÈù¢ÁÆÄÂçï‰ªãÁªç ÂáÜÂ§áÂ•ΩÁéØÂ¢ÉÂíåÂÆòÊñπÈïúÂÉè12341 ÈïúÂÉè: elasticsearch:5.2.02 k8sÁéØÂ¢É: k8s.1.103 Â≠òÂÇ®: nfs storageclass Â≠òÂÇ®4 Êèí‰ª∂: ikÂàÜËØçÂéãÁº©ÂåÖ(ËøôÈáåikÂàÜËØçÁõ¥Êé•‰ΩøÁî®ÊóßÁöÑesÈÖçÁΩÆ, ‰πüÂèØ‰ª•Ëá™Ë°å‰∏ã) ÂºÄÂßãÈÉ®ÁΩ≤ ÈÉ®ÁΩ≤ÂëΩ‰ª§1kubectl apply -f k8s-StatefulSet-es520-nfs.yml ÈÖçÁΩÆÊñá‰ª∂ k8s-StatefulSet-es520-nfs.yml123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149apiVersion: apps/v1beta1kind: StatefulSetmetadata: name: es520-2-dev namespace: ns-elastic5spec: serviceName: "es520-2-dev" replicas: 2 volumeClaimTemplates: - metadata: name: es520-2-dev-nfs annotations: volume.beta.kubernetes.io/storage-class: "nfs-retain" # ËøôÈáåÈÖçÁΩÆ ‰∏äÈù¢ÂàõÂª∫ÁöÑ storageclass ÁöÑÂêçÁß∞ spec: accessModes: [ "ReadWriteOnce" ] resources: requests: storage: 2Gi template: metadata: labels: app: es520-2-dev spec: containers: - name: es520-2-dev image: elasticsearch:5.2.0 ports: - containerPort: 9200 name: es520-2-9200 protocol: TCP - containerPort: 9300 name: es520-2-9300 protocol: TCP resources: requests: cpu: "50m" limits: cpu: "500m" volumeMounts: - name: es520-2-dev-nfs mountPath: /usr/share/elasticsearch/data/ - name: es520-2-dev-cfg mountPath: /usr/share/elasticsearch/config/elasticsearch.yml subPath: elasticsearch.yml - name: es520-2-dev-jvm mountPath: /usr/share/elasticsearch/config/jvm.options subPath: jvm.options - name: es520-2-dev-plu mountPath: /usr/share/elasticsearch/plugins volumes: - name: es520-2-dev-cfg configMap: name: es520-2-dev-cfg items: - key: elasticsearch.yml path: elasticsearch.yml - name: es520-2-dev-jvm configMap: name: es520-2-dev-jvm items: - key: jvm.options path: jvm.options - name: es520-2-dev-plu nfs: server: 172.16.53.106 path: /data/nfs/k3s/ns-elastic5-es520-2-dev-nfs-plugins---kind: ServiceapiVersion: v1metadata: labels: app: es520-2-dev name: es520-2-dev namespace: ns-elastic5spec: type: NodePort ports: - name: es520-2-9200 port: 9200 targetPort: 9200 nodePort: 31201 protocol: TCP - name: es520-2-9300 port: 9300 targetPort: 9300 nodePort: 31301 protocol: TCP selector: app: es520-2-dev---apiVersion: v1kind: Servicemetadata: name: es520-2-dev-hlspec: clusterIP: None selector: app: es520-2-dev ports: - name: es520-2-9200 port: 9200 - name: es520-2-9300 port: 9300---apiVersion: v1kind: ConfigMapmetadata: name: es520-2-dev-cfg namespace: ns-elastic5data: elasticsearch.yml: | cluster.name: k8s-test-nfs network.host: 0.0.0.0 bootstrap.system_call_filter: false discovery.zen.ping.unicast.hosts: ["es520-2-dev-0.es520-2-dev:9300","es520-2-dev-1.es520-2-dev:9300","es520-2-dev-2.es520-2-dev:9300"] http.cors.enabled: true http.cors.allow-origin: "*" thread_pool.bulk.queue_size: 3000---apiVersion: v1kind: ConfigMapmetadata: name: es520-2-dev-jvm namespace: ns-elastic5data: jvm.options: | -Xms512m -Xmx512m -XX:+UseConcMarkSweepGC -XX:CMSInitiatingOccupancyFraction=75 -XX:+UseCMSInitiatingOccupancyOnly -XX:+DisableExplicitGC -XX:+AlwaysPreTouch -server -Xss1m -Djava.awt.headless=true -Dfile.encoding=UTF-8 -Djna.nosys=true -Djdk.io.permissionsUseCanonicalPath=true -Dio.netty.noUnsafe=true -Dio.netty.noKeySetOptimization=true -Dio.netty.recycler.maxCapacityPerThread=0 -Dlog4j.shutdownHookEnabled=false -Dlog4j2.disable.jmx=true -Dlog4j.skipJansi=true -XX:+HeapDumpOnOutOfMemoryError ÊïàÊûúÂõæ rancher ‰∏äÊïàÊûú elasticsearch-head ‰∏äÊïàÊûúÂõæ]]></content>
      <categories>
        <category>ÊäÄÊúØÊñáÊ°£</category>
        <category>k8s</category>
        <category>elk</category>
        <category>elasticsearch5</category>
        <category>elk5</category>
      </categories>
      <tags>
        <tag>k8s</tag>
        <tag>elasticsearch5</tag>
        <tag>elk</tag>
        <tag>elk5</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[logstashÈÖçÁΩÆ]]></title>
    <url>%2F2019%2F11%2F08%2F26-logstash%E9%85%8D%E7%BD%AE%2F</url>
    <content type="text"><![CDATA[ËÆ∞ÂΩï‰∏Ä‰∫õlogstashÁöÑÈÖçÁΩÆÈóÆÈ¢ò logstashÊéíÈô§‰∏Ä‰∫õ‰ø°ÊÅØ123456789101112131415# ÊéíÈô§sqlDuring = 0 (Êï∞Â≠ó,Â¶ÇÊûúÊòØÂ≠óÁ¨¶ÈúÄË¶ÅÂºïÂè∑) ÁöÑÊï¥Êù°jsonÊï∞ÊçÆif [sqlDuring] == 0 &#123; drop &#123;&#125; &#125; &#125;# logstash5.5 ÂèØ‰ª•‰ΩøÁî®&lt;if [sqlDuring] &lt; 5 &#123; drop &#123;&#125; &#125; &#125;# Âú®logstash7.1 ÊµãËØïÂèëÁé∞‰ºöÊä•Èîô:[2019-11-14T15:43:03,001][FATAL][logstash.runner ] An unexpected error occurred! &#123;:error=&gt;java.lang.IllegalStateException: java.lang.NullPointerException, :backtrace=&gt;["org.logstash.execution.WorkerLoop.run(org/logstash/execution/WorkerLoop.java:85)", "java.lang.reflect.Method.invoke(java/lang/reflect/Method.java:498)", "org.jruby.javasupport.JavaMethod.invokeDirectWithExceptionHandling(org/jruby/javasupport/JavaMethod.java:440)", "org.jruby.javasupport.JavaMethod.invokeDirect(org/jruby/javasupport/JavaMethod.java:304)", "usr.local.logstash_minus_7_dot_1_dot_1.logstash_minus_core.lib.logstash.java_pipeline.start_workers(/usr/local/logstash-7.1.1/logstash-core/lib/logstash/java_pipeline.rb:235)", "org.jruby.RubyProc.call(org/jruby/RubyProc.java:295)", "org.jruby.RubyProc.call(org/jruby/RubyProc.java:274)", "org.jruby.RubyProc.call(org/jruby/RubyProc.java:270)", "java.lang.Thread.run(java/lang/Thread.java:748)"]&#125;[2019-11-14T15:43:03,063][ERROR][org.logstash.Logstash ] java.lang.IllegalStateException: Logstash stopped processing because of an error: (SystemExit) exit]]></content>
      <categories>
        <category>elk</category>
        <category>logstash</category>
      </categories>
      <tags>
        <tag>logstash</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[‰∏Ä‰∫õËÑöÊú¨Ê±áÊÄª]]></title>
    <url>%2F2019%2F11%2F01%2F25-%E4%B8%80%E4%BA%9B%E8%84%9A%E6%9C%AC%E6%B1%87%E6%80%BB%2F</url>
    <content type="text"><![CDATA[ËÆ∞ÂΩï‰∏Ä‰∫õshellËÑöÊú¨ 1 Ê∏ÖÁêÜesÂá†Â§©ÂâçÁöÑÁ¥¢ÂºïËÑöÊú¨2 ‰ªémysqlÂØºÂá∫Ë°®Âà∞clickhouseËÑöÊú¨]]></content>
      <categories>
        <category>linux</category>
        <category>shell</category>
      </categories>
      <tags>
        <tag>shell</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[filebeat7Êî∂ÈõÜmysqlÊÖ¢Êó•ÂøóÂà∞es]]></title>
    <url>%2F2019%2F10%2F30%2F24-filebeat7%E6%94%B6%E9%9B%86mysql%E6%85%A2%E6%97%A5%E5%BF%97%E5%88%B0es%2F</url>
    <content type="text"><![CDATA[ÊÖ¢Êó•ÂøóÊèê‰æõÁªôÂºÄÂèëÊü•Áúã, ÈááÁî®elkÁªü‰∏ÄÊèê‰æõ,ËøôÈáåÈááÁî®k8sÁéØÂ¢ÉÊê≠Âª∫ ÂéüÊñá: ELKÊî∂ÈõÜmysql_slow.logÂÖ∂‰ªñ: filebeat Ôºà7.1.0ÔºâdockerÂÆπÂô® slowlogÂÜÖÂÆπÂàÜÊûê 5.5 ÁâàÊú¨ÊÖ¢Êü•ËØ¢Êó•Âøó 12345# Time: 191030 17:03:13# User@Host: myuser[myuser] @ [10.10.0.1]# Query_time: 3.329673 Lock_time: 0.000107 Rows_sent: 0 Rows_examined: 3971182SET timestamp=1572426193;select * from a where name = 1 limit 1; 5.6 ÁâàÊú¨ÊÖ¢Êü•ËØ¢Êó•Âøó 123456# Time: 191030 17:03:13# User@Host: myuser[myuser] @ [10.10.0.1] Id: 1111# Query_time: 3.329673 Lock_time: 0.000107 Rows_sent: 0 Rows_examined: 3971182use db_name;SET timestamp=1572426193;select * from a where name = 1 limit 1; 5.7 ÁâàÊú¨ÊÖ¢Êü•ËØ¢Êó•Âøó 12345# Time: 2019-10-06T13:25:38.703546+08:00# User@Host: myuser[myuser] @ [10.10.0.1] Id: 1111# Query_time: 3.329673 Lock_time: 0.000107 Rows_sent: 0 Rows_examined: 3971182SET timestamp=1572426193;select * from a where name = 1 limit 1; Èô§‰ª•‰∏äÊ†ºÂºè‰ª•Â§ñ,ËøòÈúÄË¶ÅÊ≥®ÊÑèÊÖ¢Êü•ËØ¢‰ª£Á†ÅÂùó,ÂèØËÉΩÂπ∂‰∏çÊòØÊØèÊ¨°ÈÉΩÊúâ # Time ‰∏ÄÊù°ÂÆåÊï¥ÁöÑÊó•ÂøóÔºöÊúÄÁªàÂ∞Ü‰ª•# User@Host: ÂºÄÂßãÁöÑË°åÔºåÂíå‰ª•SQLËØ≠Âè•ÁªìÂ∞æÁöÑË°åÂêàÂπ∂‰∏∫‰∏ÄÊù°ÂÆåÊï¥ÁöÑÊÖ¢Êó•ÂøóËØ≠Âè• ÂºÄÂßãÈÉ®ÁΩ≤filebeat7 ÂáÜÂ§áÈïúÂÉè1docker pull store/elastic/filebeat:7.2.0 filebeatÈÖçÁΩÆÊñá‰ª∂1234567891011121314151617181920filebeat.inputs:- type: log enabled: true paths: - /opt/slow.log exclude_lines: ['^\# Time'] multiline.pattern: '^\# Time|^\# User' multiline.negate: true multiline.match: after tail_files: trueoutput.elasticsearch: enabled: true hosts: ["10.0.0.100:9200"] protocol: "http" indices: - index: "es-index-name" k8sÈÉ®ÁΩ≤Êñá‰ª∂12345678910111213141516171819202122232425262728293031323334k8s-filebeat-7.2.0.ymlkind: DeploymentapiVersion: apps/v1beta2metadata: labels: elastic-app: filebeat name: filebeat namespace: ns-elastic7spec: replicas: 1 revisionHistoryLimit: 10 selector: matchLabels: elastic-app: filebeat template: metadata: labels: elastic-app: filebeat spec: containers: - name: filebeat image: store/elastic/filebeat:7.2.0 volumeMounts: - name: filebeat-config mountPath: /usr/share/filebeat/filebeat.yml - name: mysql-dev-252 mountPath: /opt/php-mysql-dev-0-slow.log volumes: - name: filebeat-config hostPath: path: /data/k8s-container/elk-7.2.0/filebeat-7.2.0/filebeat.yml - name: mysql-dev-252 hostPath: path: /data/k8s-container/mysql5.5/slow.log]]></content>
      <categories>
        <category>k8s</category>
        <category>elk7</category>
        <category>filebeat7</category>
        <category>elk7</category>
      </categories>
      <tags>
        <tag>k8s</tag>
        <tag>elk</tag>
        <tag>filebeat7</tag>
        <tag>elk7</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[mysql5.5‰∏ª‰∏émysql5.7‰ªéÈÉ®ÁΩ≤ÈÖçÁΩÆ]]></title>
    <url>%2F2019%2F10%2F29%2F23-mysql5-5%E4%B8%BB%E4%B8%8Emysql5-7%E4%BB%8E%E9%83%A8%E7%BD%B2%E9%85%8D%E7%BD%AE%2F</url>
    <content type="text"><![CDATA[Áî±‰∫éÈúÄË¶ÅÂ∞ÜÊóßÁâàmysql5.5ÁöÑÊï∞ÊçÆÂêåÊ≠•Âà∞Êñ∞mysql5.7, Âπ∂‰∏î‰ºöÂØπÈÉ®ÂàÜË°®ÂàÜÂ∫ì ÂèÇËÄÉÊïôÁ®ã: mysql‰ªé5.5Áõ¥Êé•ÂçáÁ∫ßÂà∞5.7 mysql5.5ÂçáÁ∫ßÂà∞mysql5.7 ÈááÁî®mysql5.5Êï∞ÊçÆÁõÆÂΩïÂçáÁ∫ß‰∏∫mysql5.712345678910111 ‰ªémysql5.5ÁöÑ‰ªéÂ∫ì copy /dataÊï∞ÊçÆ2 ‰øÆÊîπÊñ∞ÁöÑmysql5.7ÈÖçÁΩÆÊñá‰ª∂ my.cnfÔºåÊ∑ªÂä†datadirÔºåÊåáÂêë5.5Êï∞ÊçÆÁõÆÂΩï3 Êñ∞ÂÆâË£ÖÊï∞ÊçÆÂ∫ìÊâßË°å(Êú¨Ê¨°‰∏çÈúÄË¶ÅÊâßË°å) /usr/local/mysql57/bin/mysqld --defaults-file=/etc/my57.cnf --initialize-insecure --user=mysql --basedir=/usr/local/mysql --datadir=/disk/u014 ÂêØÂä®mysql5 Ê≠§Êó∂Êï∞ÊçÆÁõÆÂΩïËøòÊòØ5.5ÁöÑÔºåÈúÄË¶ÅÊâßË°åmysql_upgradeËøõË°åÂçáÁ∫ßÔºåÂú®ÊâßË°åË°®‰øÆÂ§çÂâçÔºåÈúÄË¶ÅÁ°ÆËÆ§‰∏Ä‰∏™ÂèÇÊï∞innodb_file_per_tableÔºåmysqlÂÆòÁΩëÂØπËØ•ÂèÇÊï∞ÁöÑËß£ÈáäÂ¶Ç‰∏ã ËØ•ÂèÇÊï∞Âú®5.5ÁâàÊú¨ÈªòËÆ§‰∏∫OFFÔºåÊâÄÊúâË°®ÂíåÁ¥¢ÂºïÈÉΩÂØºÂÖ•‰∏Ä‰∏™ÂÖ±‰∫´Êñá‰ª∂‰∏≠ÔºåÂêç‰∏∫ibdata1,‰ΩÜÂú®5.6.7Âèä‰ª•ÂêéÁâàÊú¨ÔºåÊîπÂèÇÊï∞Ë¢´ÈªòËÆ§ËÆæÁΩÆ‰∏∫ONÔºåÂç≥ÊØèÂº†Ë°®ÈÉΩÊúâÂØπÂ∫îÁöÑË°®ÂíåÁ¥¢ÂºïÂ≠òÂÇ®Êñá‰ª∂ÔºåÊØè‰∏™schema‰∏ãÔºåÊØè‰∏™frmÊñá‰ª∂ÈÉΩÊúâÂØπÂ∫îÁöÑibdÊñá‰ª∂„ÄÇ Âú®ÊâßË°åmysql_upgradeÊó∂Ôºå‰ºö‰øÆÂ§çÁ≥ªÁªüË°®ÔºåÂπ∂‰∏îÂ¶ÇÊûúËØ•ÂèÇÊï∞Âú®5.5Âíå5.7ÁâàÊú¨Âùá‰ΩøÁî®ÈªòËÆ§ÂÄºÔºåÂàô‰ºöÂ∞Ü‰πãÂâçÂÖ±‰∫´Ë°®ÂíåÁ¥¢ÂºïÁöÑÂ≠òÂÇ®ÊñπÂºèÊîπ‰∏∫ÊØèÂº†Ë°®ÂçïÁã¨Â≠òÂÇ®Ë°®ÂíåÁ¥¢ÂºïÁöÑÂΩ¢ÂºèÔºåÊïÖ‰ºöÂá∫Áé∞Êã∑Ë¥ùÂ§çÂà∂ÁöÑÊìç‰ΩúÔºåÂ¶ÇÊûúÊï∞ÊçÆÈáèÊØîËæÉÂ§ßÔºåÂàôÁî®Êó∂Â∞±‰ºöÂæàÈïøÔºå ‰ΩøÁî®nnodb_file_per_table=1ÔºåÂèäË°®ÂíåÁ¥¢ÂºïÂçïÁã¨Â≠òÂÇ®ÁöÑ‰ºòÁº∫ÁÇπÔºåÂèØÊü•ÁúãmysqlÂÆòÁΩë‰ªãÁªç„ÄÇ6 ‰ΩøÁî®mysql_upgradeÊ£ÄÊµãÂπ∂‰øÆÂ§çË°® /usr/local/mysql57/bin/mysql_upgrade -S /disk/u01/mysql.sock ‰ª•‰∏äÂ∑≤ÁªèÂÆåÊàêÂØπmysql5.5Êï∞ÊçÆÂçáÁ∫ß Âú®mysql5.7ËøêË°åÁöÑÂäüËÉΩ ÈÖçÁΩÆmysql5.5‰∏ª‰∏émysql5.7‰ªé Â∞Ümsyql5.7‰Ωú‰∏∫mysql5.5ÁöÑ‰ªéÂ∫ì123456# ‰ªéÂ∫ìÊâßË°å, POS‰ΩçÁΩÆ‰ª• show master status\G Êü•ËØ¢‰∏∫ÂáÜstop slave;SET GLOBAL read_only=0;reset slave all;CHANGE MASTER TO MASTER_HOST='db_master.prod.boqii.com',MASTER_PORT=3306,MASTER_USER='boqii_repl_user',MASTER_PASSWORD='d79f25dfb70f315819edaa1d',MASTER_LOG_FILE='m1-master-bin.000001',MASTER_LOG_POS=107;start slave; Âú®‰∏ªÂ∫ìÊµãËØïÂàõÂª∫Ë°®, Êü•ÁúãÊòØÂê¶‰ºöÂêåÊ≠•Âà∞mysql5.7‰ªéÂ∫ì1234567create table tutorials_tbl( tutorial_id INT NOT NULL AUTO_INCREMENT, tutorial_title VARCHAR(100) NOT NULL, tutorial_author VARCHAR(40) NOT NULL, submission_date DATE, PRIMARY KEY ( tutorial_id )); ‰øÆÊîπmysql5.7Â∫ìÂêç Ê≤°ÈóÆÈ¢ò‰πãÂêé,Êàë‰ª¨ÈúÄË¶ÅÂ∞Ümysql5.7ÁöÑmydatabaseÂ∫ìÊîπÊàêmydatabasenewÂ∫ìÂêç, Êñ≠ÂºÄmysql5.5 Âíåmysql5.7‰∏ª‰ªéÂêåÊ≠•(ÊúÄÂ•ΩËÆæÁΩÆmysql5.5Âè™ËØª,Èò≤Ê≠¢Êï∞ÊçÆÂ∑ÆÂºÇ), Âú®mysql5.7‰∏äÊâßË°åÊîπÂ∫ìÂêç, ‰ª•‰∏ãÊúâËß¶ÂèëÂô®ÁöÑË°®‰ºö‰øÆÊîπÂ§±Ë¥• ÊµãËØïÊâßË°åÊó∂Èó¥Âú®15sÂ∑¶Âè≥ 123456789101112#!/bin/bash# ÂÅáËÆæÂ∞ÜsakilaÊï∞ÊçÆÂ∫ìÂêçÊîπ‰∏∫new_sakila# MyISAMÁõ¥Êé•Êõ¥ÊîπÊï∞ÊçÆÂ∫ìÁõÆÂΩï‰∏ãÁöÑÊñá‰ª∂Âç≥ÂèØnew_database=mydatabasenewold_database=mydatabasemysql -S /disk/u01/mysql.sock -e 'create database if not exists $&#123;new_database&#125;'list_table=$(mysql -S /disk/u01/mysql.sock -Nse "select table_name from information_schema.TABLES where TABLE_SCHEMA='$&#123;old_database&#125;'")for table in $list_tabledo mysql -S /disk/u01/mysql.sock -e "rename table $&#123;old_database&#125;.$table to $&#123;new_database&#125;.$table"done Ê≠§Êó∂Âú®ÈÖçÁΩÆÊñ∞ÁöÑmysql5.7ÁöÑ‰∏ª‰ªéÊú∫Âô®1234567891011121314```&lt;center&gt;&lt;img src="http://zhangzw001.github.io/images/dockerniu.jpeg" width = "100" height = "100" style="border: 0"/&gt;&lt;font color="blue" face="Èªë‰Ωì" size=5&gt; ‰∏Ä‰∫õÈÖçÁΩÆÈóÆÈ¢ò &lt;/font&gt;&lt;/center&gt;---### GTID_MODE ÈÖçÁΩÆ‰∏çÁªü‰∏Ä The replication receiver thread cannot start because the master has GTID_MODE = OFF and this server has GTID_MODE = ON. Ê∞∏‰πÖ‰øÆÊîπgtid_mode = off ‰∏ÄÊ¨°ÊÄßÂÖ≥Èó≠Ê≠•È™§Ôºöstop slave;SET GLOBAL GTID_MODE = ‚ÄòON_PERMISSIVE‚Äô;SET GLOBAL GTID_MODE = ‚ÄòOFF_PERMISSIVE‚Äô;SET GLOBAL GTID_MODE = ‚ÄòOFF‚Äô;start slave; 12### mysql5.7 sql_mode sql_mode=‚ÄôONLY_FULL_GROUP_BY,NO_ZERO_IN_DATE,ALLOW_INVALID_DATES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION‚Äô 1234---### Ê≥®ÊÑè‰∏ÄÂè∞Êú∫Âô®Â§ö‰∏™mysqlÂêØÂä®ËÑöÊú¨‰øÆÊîπÈóÆÈ¢ò #‰ª•‰∏ã‰∏§Â§Ñ‰øÆÊîπ /etc/init.d/mysqld57parse_server_arguments $print_defaults -c /etc/my57.cnf mysqld server mysql_server mysql.server$bindir/mysqld_safe ‚Äìdefaults-file=/etc/my57.cnf ‚Äìpid-file=‚Äù$mysqld_pid_file_path‚Äù $other_args &gt;/dev/null &amp; 12345678&lt;center&gt;&lt;img src="http://zhangzw001.github.io/images/dockerniu.jpeg" width = "100" height = "100" style="border: 0"/&gt;&lt;font color="blue" face="Èªë‰Ωì" size=5&gt; ‰∏Ä‰∫õinfo‰ø°ÊÅØ &lt;/font&gt;&lt;/center&gt;### /usr/local/mysql57/bin/mysql_upgrade -S /disk/u01/mysql.sock ÁöÑÈÉ®ÂàÜËÆ∞ÂΩï /usr/local/mysql57/bin/mysql_upgrade -S /disk/u01/mysql.sockChecking if update is needed.Checking server version.Running queries to upgrade MySQL server.mysql_upgrade: (non fatal) [WARNING] 1642: Pre-4.1 password hash found. It is deprecated and will be removed in a future release. Please upgrade it to a new format.Checking system database.mysql.columns_priv OKmysql.db OKmysql.engine_cost OKmysql.event OKmysql.func OKmysql.general_log OKmysql.gtid_executed OKmysql.help_category OKmysql.help_keyword OKmysql.help_relation OKmysql.help_topic OKmysql.host OKmysql.innodb_index_stats OKmysql.innodb_table_stats OKmysql.ndb_binlog_index OKmysql.plugin OKmysql.proc OKmysql.procs_priv OKmysql.proxies_priv OKmysql.server_cost OKmysql.servers OKmysql.slave_master_info OKmysql.slave_relay_log_info OKmysql.slave_worker_info OKmysql.slow_log OK‚Ä¶ 12### ÈôÑÂΩï my57.cnf [client]port = 3308socket = /disk/u01/mysql.sock [mysql]prompt=‚Äù\u@m1_618_u [\d]&gt; ‚Äúno-auto-rehash [mysqld]sql_mode=‚ÄôONLY_FULL_GROUP_BY,NO_ZERO_IN_DATE,ALLOW_INVALID_DATES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION‚Äôreplicate-wild-do-table=mydatabase.% binlog-ignore-db=information_schemabinlog-ignore-db=mysqlbinlog-ignore-db=performance_schemabinlog-ignore-db=test binlog-do-db=mydatabase user = mysqlport = 3308basedir = /usr/local/mysql57datadir = /disk/u01socket = /disk/u01/mysql.sockpid-file = /disk/u01/dbm1_u.pidtmpdir = /disk/u02server-id = 123character-set-server = utf8skip_name_resolve = 1innodb_file_per_table = 1explicit_defaults_for_timestamp = 0read_only = 1 buffer&amp;cachetable_open_cache = 100table_definition_cache = 400table_open_cache_instances = 64sort_buffer_size = 4Mjoin_buffer_size = 4Mread_buffer_size = 8Mread_rnd_buffer_size = 4M thread&amp;connectionthread_stack = 256Kthread_cache_size = 768back_log = 1024max_connections = 3000max_connect_errors = 1000000 temptabletmp_table_size = 32Mmax_heap_table_size = 32M networkmax_allowed_packet = 32M #lock_wait_timeout = 3600 #interactive_timeout = 600 #wait_timeout = 600 query cachequery_cache_size = 0query_cache_type = 0 ËÆæÁΩÆerrorlog„ÄÅslowlogÂíågenerallogÁöÑÊó∂Âå∫ÔºåÈªòËÆ§UTClog_timestamps = SYSTEM error-loglog_error = /disk/u02/mysqld.log slow-logslow_query_log = 1slow_query_log_file = /disk/u02/slow.loglong_query_time = 0.1log_queries_not_using_indexes =1log_throttle_queries_not_using_indexes = 60min_examined_row_limit = 100log_slow_admin_statements = 1log_slow_slave_statements = 1 general log#general-log = 1general_log_file=/disk/u02/query.log binlogbinlog_format = rowbinlog_checksum = 1log-bin = /disk/u02/m1-binlog-bin-index = /disk/u02/m1-bin.indexsync_binlog = 0binlog_cache_size = 4Mmax_binlog_cache_size = 1Gmax_binlog_size = 512Mexpire_logs_days = 15 GTIDgtid_mode = offenforce_gtid_consistency = 1log_slave_updates Replicationmaster_info_repository = TABLErelay_log_info_repository = TABLEslave-rows-search-algorithms = ‚ÄòINDEX_SCAN,HASH_SCAN‚Äôrelay_log_recovery = 1relay_log_purge = 1relay-log=/disk/u02/m1-relay-binrelay-log-index=/disk/u02/m1-relay-bin.index innodb-buffer&amp;cacheinnodb_buffer_pool_size = 1Ginnodb_buffer_pool_instances = 4 #innodb_additional_mem_pool_size = 16Minnodb_max_dirty_pages_pct = 50 innodb loginnodb_data_file_path = ibdata1:256M:autoextendinnodb_log_file_size = 256Minnodb_log_files_in_group = 2innodb_flush_log_at_trx_commit = 2innodb_log_buffer_size = 32M #innodb_max_undo_log_size = 4G #innodb_undo_directory = undologinnodb_undo_tablespaces = 0 innodb-ioinnodb_flush_method = O_DIRECTinnodb_io_capacity = 600innodb_io_capacity_max = 2000innodb_flush_sync = 0innodb_flush_neighbors = 0 #innodb_lru_scan_depth = 4000innodb_write_io_threads = 8innodb_read_io_threads = 8innodb_purge_threads = 4innodb_page_cleaners = 4 transaction,lock#innodb_sync_spin_loops = 100 #innodb_spin_wait_delay = 30innodb_lock_wait_timeout = 10innodb_print_all_deadlocks = 1innodb_rollback_on_timeout = 1 innodb_open_files = 65535 innodb_online_alter_log_max_size = 1G innodb statusinnodb_status_file = 1 Ê≥®ÊÑè: ÂºÄÂêØ innodb_status_output &amp; innodb_status_output_locks Âêé, ÂèØËÉΩ‰ºöÂØºËá¥log-errorÊñá‰ª∂Â¢ûÈïøËæÉÂø´innodb_status_output = 0innodb_status_output_locks = 0 #performance_schemaperformance_schema = 1performance_schema_instrument = ‚Äò%=on‚Äô #innodb monitorinnodb_monitor_enable=‚Äùmodule_innodb‚Äùinnodb_monitor_enable=‚Äùmodule_server‚Äùinnodb_monitor_enable=‚Äùmodule_dml‚Äùinnodb_monitor_enable=‚Äùmodule_ddl‚Äùinnodb_monitor_enable=‚Äùmodule_trx‚Äùinnodb_monitor_enable=‚Äùmodule_os‚Äùinnodb_monitor_enable=‚Äùmodule_purge‚Äùinnodb_monitor_enable=‚Äùmodule_log‚Äùinnodb_monitor_enable=‚Äùmodule_lock‚Äùinnodb_monitor_enable=‚Äùmodule_buffer‚Äùinnodb_monitor_enable=‚Äùmodule_index‚Äùinnodb_monitor_enable=‚Äùmodule_ibuf_system‚Äùinnodb_monitor_enable=‚Äùmodule_buffer_page‚Äùinnodb_monitor_enable=‚Äùmodule_adaptive_hash‚Äù MyISAMkey_buffer_size = 1024Mbulk_insert_buffer_size = 64Mmyisam_sort_buffer_size = 128Mmyisam_repair_threads = 1 [mysqldump]quickmax_allowed_packet = 32M]]></content>
      <categories>
        <category>ÊäÄÊúØÊñáÊ°£</category>
        <category>mysql</category>
        <category>‰∏ª‰ªé</category>
      </categories>
      <tags>
        <tag>mysql</tag>
        <tag>mysql5.7</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[es5ÈõÜÁæ§Á£ÅÁõòÊâ©ÂÆπ]]></title>
    <url>%2F2019%2F10%2F28%2F22-es%E9%9B%86%E7%BE%A4%E7%A3%81%E7%9B%98%E6%89%A9%E5%AE%B9%2F</url>
    <content type="text"><![CDATA[esÈõÜÁæ§Á£ÅÁõò‰∏çË∂≥,ÂØπÁ£ÅÁõòÊâ©ÂÆπÈÅáÂà∞‰∏Ä‰∫õÁöÑÈóÆÈ¢ò ÈáçÂêØÈõÜÁæ§ÂâçÔºåÂÖàËÆæÁΩÆÈõÜÁæ§ÂÅúÊ≠¢ÂàÜÁâáÁßªÂä®Ôºö12345curl -XPUT http://localhost:9200/_cluster/settings -d '&#123;"transient" : &#123;"cluster.routing.allocation.enable" : "none"&#125;&#125;' ÂØπÁ£ÅÁõòËøõË°åÊâ©ÂÆπ,ÊØèÊ¨°Êìç‰Ωú‰∏Ä‰∏™ËäÇÁÇπ123456789101112131415# Áõ¥Êé•Êâ©ÂÆπÁ£ÅÁõòÂà∞2T//ÈíàÂØπext4Êñá‰ª∂Ê†ºÂºèÁöÑÊìç‰ΩúÁ≥ªÁªüÔºàÂ¶ÇCentOS6ÔºâÔºö//umount /dev/vdbe2fsck -f /dev/vdbresize2fs /dev/vdbmount /dev/vdb /data# ÊàñËÄÖÊñ∞Â¢û 2T‰∫ëÁõò/dev/vdcumount /data/mkdir /data2mount /dev/vdb /data2mkfs.ext4 /dev/vdcmount /dev/vdc /datacp -ra /data2/* /data/ ÈáçÂêØ‰πãÂêéÔºåÊÅ¢Â§çÂàÜÁâáËá™Âä®ÂàÜÈÖçÔºö12345curl -XPUT http://localhost:9200/_cluster/settings -d '&#123;"transient" : &#123;"cluster.routing.allocation.enable" : "all"&#125;&#125;' Â¶ÇÊûúÈúÄË¶Å‰∏ãÁ∫øÂÖ∂‰∏≠ÁöÑËäÇÁÇπ, ÂÖàÂ∞ÜÂàÜÁâáÈÉΩËΩ¨‰πâÂà∞ÂÖ∂‰ªñËäÇÁÇπ123456# ÊâßË°å‰ª•‰∏ãÂëΩ‰ª§‰ºöËá™Âä®Â∞Ü10.10.0.1 ËäÇÁÇπ‰∏äÁöÑÂàÜÁâáÂÖ®ÈÉ®ËøÅÁßªÂà∞ÂÖ∂‰ªñÊú∫Âô®, Á≠âÂæÖËøÅÁßªÂÆåÊàê, Â∞ÜÊîπÁ©∫Êú∫Âô®‰∏ãÁ∫øÂç≥ÂèØcurl -XPUT 127.0.0.1:9200/_cluster/settings -d '&#123;"transient" :&#123;"cluster.routing.allocation.exclude._ip" : "10.10.0.1"&#125;&#125;' Âè¶Â§ñÂØπ‰∫é path.data ÈÖçÁΩÆÂ§öÂø´ÁõòÁöÑÈóÆÈ¢ò1234ÊØîÂ¶Çes8ÈÖçÁΩÆ‰∫Ü‰∏âÂùóÁõò:/disk4/data -&gt; sde, /disk5/data -&gt; sdf, disk6/data -&gt; sdgËøôÈáåÊ≥®ÊÑè es nodeÁöÑdata pathÂ∞ΩÈáè‰øùËØÅÁõòÁöÑÂ§ßÂ∞èÂ∑ÆÂà´‰∏çË¶ÅÂ§™Â§ß, sde,sdf,sdgÁöÑÂ§ßÂ∞è‰øùÈöúÂ∑Æ‰∏çÂ§ö, Âê¶ÂàôÁî±‰∫ées shard ÂùáË°°ÁöÑÊó∂ÂÄôÂèØËÉΩ‰ºö‰ºòÂÖàÂàÜÈÖçÂà∞Á£ÅÁõòÂ§ßÁöÑÁõÆÂΩï, ÂèØËÉΩ‰ºöÂØºËá¥sde(ÂÅáÂ¶ÇËøô‰∏™Á£ÅÁõòÊúÄÂ§ß)ÁöÑIOÈ´ò, ËÄåsdfÁ≠âIO‰Ωé ÁÆÄÂçïÁöÑÈÖçÁΩÆ‰ø°ÊÅØelasticsearch512345678910111213cluster.name: es-devnode.name: es1-upath.data: /data/es/datapath.logs: /data/es/logsnetwork.host: 0.0.0.0discovery.zen.ping.unicast.hosts: ["10.10.0.1:9300","10.10.0.2:9300","10.10.0.3:9300","10.10.0.4:9300"]http.cors.enabled: truehttp.cors.allow-origin: "*"xpack.security.enabled: falsebootstrap.system_call_filter: falsethread_pool.bulk.queue_size: 3000# Èò≤Ê≠¢ËÑëË£Çdiscovery.zen.minimum_master_nodes: 2]]></content>
      <categories>
        <category>elk</category>
        <category>elasticsearch5</category>
      </categories>
      <tags>
        <tag>elasticsearch5</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ÊµÅÈáèÂ§çÂà∂Â∑•ÂÖ∑gor]]></title>
    <url>%2F2019%2F10%2F28%2F21-%E6%B5%81%E9%87%8F%E5%A4%8D%E5%88%B6%E5%B7%A5%E5%85%B7gor%2F</url>
    <content type="text"><![CDATA[Gor ÊòØ‰∏ÄÊ¨ægoËØ≠Ë®ÄÂÆûÁé∞ÁöÑÁÆÄÂçïÁöÑhttpÊµÅÈáèÂ§çÂà∂Â∑•ÂÖ∑ÔºåÂÆÉÁöÑ‰∏ªË¶ÅÁõÆÁöÑÊòØ‰Ωø‰Ω†ÁöÑÁîü‰∫ßÁéØÂ¢ÉHTTPÁúüÂÆûÊµÅÈáèÂú®ÊµãËØïÁéØÂ¢ÉÂíåÈ¢ÑÂèëÂ∏ÉÁéØÂ¢ÉÈáçÁé∞ ÊµÅÈáèÂ§çÂà∂Â∑•ÂÖ∑ ‰∏ãËΩΩÂÆâË£Ögithub‰∏ãËΩΩÂú∞ÂùÄ: https://github.com/buger/goreplay/releases 1234tar -xvf gor_1.0.0_x64.tar.gzmv gor /usr/bin/which gor ÂëΩ‰ª§123456789101112131415161718192021222324252627282930311 ‰øùÂ≠òËØ∑Ê±ÇÂà∞Êñá‰ª∂# Â∞ÜÊú¨Êú∫ÊâÄÊúâ80ËØ∑Ê±Ç‰øùÂ≠òÂà∞gor-20171120_0.logÊñá‰ª∂(Ê≥®ÊÑè‰ºöÁîüÊàêÂæàÂ§öÊñá‰ª∂)gor --input-raw :80 --output-file gor-%Y%m%d.log# --output-file-append ‰ºöÁîüÊàêgor-20171120.logÊñá‰ª∂gor --input-raw :80 --output-file gor-%Y%m%d.log --output-file-append2 Ê†πÊçÆÊñá‰ª∂ÂõûÊîæËØ∑Ê±Ç# ÈïúÂÉèqpsÂõûÊîægor --input-file gor-aaaa-20171120.log --output-http aaaa-dev.test.com# ‰∏§ÂÄçÈïúÂÉèqpsÂõûÊîægor --input-file "gor-aaaa-20171120.log|200%" --output-http aaaa-dev.test.com3 ËøáÊª§urlÂêé‰øùÂ≠òËØ∑Ê±ÇÂà∞Êñá‰ª∂# ÊéíÈô§s.test.comÁöÑËØ∑Ê±Çgor --input-raw :80 --output-file gor-%Y%m%d.log --output-file-append --http-disallow-header "Host: s.test.com" --http-disallow-header "Host: www.test.com" --http-disallow-header "Host: bbs.test.com"# Âè™Â≠òÂÇ®aaaa.test.comÁöÑËØ∑Ê±Çgor --input-raw :80 --output-file gor-aaaa-%Y%m%d.log --output-file-append --http-allow-header "Host: aaaa.test.com"# httpsÁöÑ‰∏çËÉΩÊäìÂåÖgor --input-raw :443 --output-file gor-ssl-aaaa-%Y%m%d.log --output-file-append --http-allow-header "Host: aaaa.test.com"4 Âú®Á∫øÈïúÂÉèÂ§çÂà∂ËØ∑Ê±Ç# Â∞ÜÁîü‰∫ßaaaa.test.comÁöÑËØ∑Ê±ÇÂ§çÂà∂Âà∞ aaaa-dev.test.com ÁéØÂ¢É!gor --input-raw :80 --output-http "aaaa-dev.test.com" --http-allow-header "Host: aaaa.test.com" Á¶ªÁ∫øÊñá‰ª∂ÁºñËæë123456Êñá‰ª∂ÁöÑÊØè‰∏™ËØ∑Ê±ÇÈÄöËøá Â¶Ç‰∏ãÂ≠óÁ¨¶‰∏≤ÂàÜÂâ≤!√∞&lt;9f&gt;&lt;90&gt;¬µ√∞&lt;9f&gt;&lt;99&gt;&lt;88&gt;√∞&lt;9f&gt;&lt;99&gt;&lt;89&gt;Âπ∂‰∏îÁ¨¨‰∏ÄË°åÊòØ ËØ∑Ê±ÇÁöÑÂîØ‰∏ÄÁ†Å? ÂíåÊó∂Èó¥Êà≥!1 9b366a8eab8d6cb8e557cb3bf43f69c36612cffb 1511165572419843000ÊâÄ‰ª•ÂèØÂΩïÂà∂ÊØîÂ¶ÇÂçäÂ∞èÊó∂ÁöÑÁÑ∂ÂêéÁ™ÉÂèñÈúÄË¶ÅÁöÑÊó∂Èó¥ÊÆµ! ÈóÆÈ¢ò https ‰∏çËÉΩÊäìÂåÖ! ÈÄöËøáÊ∑ªÂä†‰ª£ÁêÜ, gorÊäìÂèñ8000Á´ØÂè£ 1234567891011121314151617181920212223# SSL terminationserver &#123; listen 443 ssl; server_name aaaa.test.com; ssl_certificate /etc/ssl/nginx/server.crt; ssl_certificate_key /etc/ssl/nginx/server.key; location / &#123; proxy_set_header Host $host; proxy_pass http://localhost:8000; &#125;&#125;server &#123; listen 8000; server_name aaaa.test.com; location / &#123; proxy_set_header Host $host; proxy_pass http://production_shop_api_site; &#125;&#125;]]></content>
      <categories>
        <category>ÊµÅÈáèÂ§çÂà∂Â∑•ÂÖ∑</category>
        <category>gor</category>
      </categories>
      <tags>
        <tag>gor</tag>
        <tag>httpÊµÅÈáèÂ§çÂà∂Â∑•ÂÖ∑</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[k8sÊê≠Âª∫mysql5.7.24‰∏ª‰ªé]]></title>
    <url>%2F2019%2F10%2F24%2F20-k8s%E6%90%AD%E5%BB%BAmysql5-7-24%E4%B8%BB%E4%BB%8E%2F</url>
    <content type="text"><![CDATA[k8s‰∏äÁÆÄÂçïÈÉ®ÁΩ≤mysql5.7.24‰∏ª‰ªé k8sÊê≠Âª∫mysql5.7.24‰∏ª‰ªé ÂèÇËÄÉÊñáÊ°£Âà©Áî®KubernetesÊê≠Âª∫mysql‰∏ª‰ªéÂ§çÂà∂ÈõÜÁæ§ÂÆòÊñπdockerfile ‰ªéhub.docker.comÊãâÂèñÂÆòÊñπÈïúÂÉè1docker pull mysql:5.7.24 buildÈïúÂÉè ‰∏ªÂ∫ìmasterÁöÑDockerfile12345from mysql:5.7.24run sed -i '/\[mysqld\]/a server-id=1\nlog-bin' /etc/mysql/mysql.conf.d/mysqld.cnfCOPY docker-entrypoint.sh /usr/local/bin/ ‰∏ªÂ∫ìÁöÑdocker-entrypoint.sh ÂÖà‰ªéÂàùÂßãÈïúÂÉèÂèñ ÊàñËÄÖ‰ªégithubÂØπÂ∫îÁâàÊú¨‰∏ä 123docker run -dti mysql:5.7.24 /bin/bashdocker cp 2bfa6209d120c23:/usr/local/bin/docker-entrypoint.sh . ‰øÆÊîπdocker-entrypoint.sh 12345678fi# Ê∑ªÂä†‰ª•‰∏ãÂÜÖÂÆπecho "CREATE USER '$MYSQL_REPLICATION_USER'@'%' IDENTIFIED BY '$MYSQL_REPLICATION_PASSWORD' ;" | "$&#123;mysql[@]&#125;"echo "GRANT REPLICATION SLAVE ON *.* TO '$MYSQL_REPLICATION_USER'@'%' IDENTIFIED BY '$MYSQL_REPLICATION_PASSWORD' ;" | "$&#123;mysql[@]&#125;"echo "FLUSH PRIVILEGES ;" | "$&#123;mysql[@]&#125;"# Ê∑ªÂä†‰ª•‰∏äÂÜÖÂÆπecho ls /docker-entrypoint-initdb.d/ &gt; /dev/null build‰∏ªÂ∫ìÈïúÂÉè 12docker build -t hub.boqii.com/bq/mysql-master:5.7.24 .docker push hub.boqii.com/bq/mysql-master:5.7.24 ‰ªéÂ∫ìÁöÑdocker-entrypoint.sh Âêå‰∏äÂÖà‰ªéÂàùÂßãÈïúÂÉèÂèñ ÊàñËÄÖ‰ªégithubÂØπÂ∫îÁâàÊú¨‰∏ä ÊàñÂ§çÂà∂‰∏äÈù¢ÁöÑÊñá‰ª∂ ‰øÆÊîπdocker-entrypoint.sh 12345678fi# Ê∑ªÂä†‰ª•‰∏ãÂÜÖÂÆπ echo "STOP SLAVE;" | "$&#123;mysql[@]&#125;" echo "CHANGE MASTER TO master_host='$MYSQL_MASTER_SERVICE_HOST', master_user='$MYSQL_REPLICATION_USER', master_password='$MYSQL_REPLICATION_PASSWORD' ;" | "$&#123;mysql[@]&#125;" echo "START SLAVE;" | "$&#123;mysql[@]&#125;" # Ê∑ªÂä†‰ª•‰∏äÂÜÖÂÆπecho ls /docker-entrypoint-initdb.d/ &gt; /dev/null build‰ªéÂ∫ìÈïúÂÉè 12docker build -t hub.boqii.com/bq/mysql-slave:5.7.24 .docker push hub.boqii.com/bq/mysql-slave:5.7.24 ÂºÄÂßãÈÉ®ÁΩ≤ k8s-master-mysql_5.7.24.yml 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869---apiVersion: apps/v1beta1kind: StatefulSetmetadata: labels: app: php-mysql-master-dev name: php-mysql-master-dev namespace: dbspec: serviceName: "php-mysql-master-dev" replicas: 1 selector: matchLabels: app: php-mysql-master-dev template: metadata: labels: app: php-mysql-master-dev spec: containers: - name: php-mysql-master-dev image: hub.boqii.com/bq/mysql-master:5.7.24 ports: - containerPort: 3306 name: db-port resources: requests: cpu: "50m" limits: cpu: "1000m" env: - name: MYSQL_ROOT_PASSWORD value: "Boqii.123" - name: MYSQL_REPLICATION_USER value: "repl" - name: MYSQL_REPLICATION_PASSWORD value: "7a5b21ac65712bd95e39d3c1" volumeMounts: - name: order-master-dev-data mountPath: /var/lib/mysql - name: order-master-dev-cfg mountPath: /etc/mysql volumes: - name: order-master-dev-data hostPath: path: /data/k8s-container/php-mysql-dev/master/data - name: order-master-dev-cfg hostPath: path: /data/k8s-container/php-mysql-dev/master/etc-mysql---kind: ServiceapiVersion: v1metadata: labels: app: php-mysql-master-dev name: php-mysql-master-dev-service namespace: dbspec: type: NodePort ports: - port: 3306 name: db-port targetPort: 3306 nodePort: 23306 protocol: TCP selector: app: php-mysql-master-dev k8s-slave-mysql_5.7.24.yml 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172---apiVersion: apps/v1beta1kind: StatefulSetmetadata: labels: app: php-mysql-slave-dev name: php-mysql-slave-dev namespace: dbspec: serviceName: "php-mysql-slave-dev" replicas: 1 selector: matchLabels: app: php-mysql-slave-dev template: metadata: labels: app: php-mysql-slave-dev spec: containers: - name: php-mysql-slave-dev image: hub.boqii.com/bq/mysql-slave:5.7.24 ports: - containerPort: 3306 name: db-port resources: requests: cpu: "50m" limits: cpu: "1000m" env: - name: MYSQL_ROOT_PASSWORD value: "Boqii.123" - name: MYSQL_REPLICATION_USER value: "repl" - name: MYSQL_REPLICATION_PASSWORD value: "7a5b21ac65712bd95e39d3c1" - name: MYSQL_MASTER_SERVICE_HOST value: "php-mysql-master-dev-service" volumeMounts: - name: order-slave-dev-data mountPath: /var/lib/mysql - name: order-slave-dev-cfg mountPath: /etc/mysql volumes: - name: order-slave-dev-data hostPath: path: /data/k8s-container/php-mysql-dev/slave/data - name: order-slave-dev-cfg hostPath: path: /data/k8s-container/php-mysql-dev/slave/etc-mysql---kind: ServiceapiVersion: v1metadata: labels: app: php-mysql-slave-dev name: php-mysql-slave-dev-service namespace: dbspec: type: NodePort ports: - port: 3306 name: db-port targetPort: 3306 nodePort: 23307 protocol: TCP selector: app: php-mysql-slave-dev ÈóÆÈ¢òÊÄªÁªì ‰ªéÂ∫ìÁöÑreplay logÂêçÂ≠ó‰ºöÊ†πÊçÆdocker‰∏ªÊú∫ÂêçÂèòÂåñ, ‰πüÂèØ‰ª•ÂÜôÂú®ÈÖçÁΩÆÊñá‰ª∂ 12# Dockerfile‰∏≠ÂèØ‰ª•Ê∑ªÂä†run sed -i '/\[mysqld\]/a relay-log-index=php-mysql-shoporder-slave-dev-relay-bin.index' /etc/mysql/mysql.conf.d/mysqld.cnf Ê≥®ÊÑèMYSQL_MASTER_SERVICE_HOST ÂèòÈáèÁöÑÈÖçÁΩÆ, Ê†πÊçÆ‰Ω†masterÁöÑserviceÂèòÂåñ ÂÖ∂Ê¨°Êàëdocker-entrypoint.sh Êñá‰ª∂Âá†Ê¨°ÊâãÂä®‰ªéÈ°µÈù¢Â§çÂà∂Á≤òË¥¥‰∏ãÊù•ÁöÑÂØºËá¥ÂêÑÁßçËØ≠Ê≥ïÈîôËØØ,ËøôÈáåÂª∫ËÆÆÊâæÂà∞ÂØπÁöÑÁâàÊú¨‰ªégithubÂÖãÈöÜ, ÊàñËÄÖ‰ªémysql:5.7.24ÈïúÂÉè‰∏≠cp ÈÖçÁΩÆetc-mysql/mysql.conf.d/mysqld.cnf 123456789[mysqld]# ‰ªéÂ∫ìÈÖçÁΩÆread_only=1super_read_only=1character-set-server=utf8# 1 ÂéªÊéâSTRICT_TRANS_TABLES Ë°®NOT NULLÊó∂Êó†Ê≥ïÂàõÂª∫Ë°®# 2 ‰øÆÊîπNO_ZERO_DATE‰∏∫ALLOW_INVALID_DATES ÂÖÅËÆ∏‚Äô0000-00-00‚Äô#sql_mode='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION'sql_mode='ONLY_FULL_GROUP_BY,NO_ZERO_IN_DATE,ALLOW_INVALID_DATES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' ÈÖçÁΩÆetc-mysql/conf.d/mysql.cnf 123[mysql]no-auto-rehashdefault-character-set=utf8 ÈôÑÂΩïmasterÈÖçÁΩÆdocker-entrypoint.shslaveÈÖçÁΩÆdocker-entrypoint.sh]]></content>
      <categories>
        <category>mysql</category>
        <category>k8s</category>
        <category>mysql</category>
      </categories>
      <tags>
        <tag>mysql</tag>
        <tag>k8s</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[shell‰∏≠gtÂíå>ÁöÑÂå∫Âà´]]></title>
    <url>%2F2019%2F10%2F17%2F19-shell%E4%B8%ADgt%E5%92%8C%3E%E7%9A%84%E5%8C%BA%E5%88%AB%2F</url>
    <content type="text"><![CDATA[shell‰∏≠ gt Âíå &gt; ÁöÑ‰∏Ä‰∫õÁõ∏ÂÖ≥ÈóÆÈ¢ò‰ªãÁªçÂíåÊµãËØï ‰ª•‰∏ãÊòØbashÁöÑÊµãËØï, Ê≥®ÊÑèÂ¶ÇÊûú‰Ω†ÊòØzshÂèØËÉΩ‰ºö‰∏çÂêåÂñîüòØ [[]] , [] ÂíåtestÊØîËæÉ [] Âíåtest: ‰∏§ËÄÖÊòØ‰∏ÄÊ†∑ÁöÑÔºåÂú®ÂëΩ‰ª§Ë°åÈáåtest exprÂíå[ expr ]ÁöÑÊïàÊûúÁõ∏Âêå„ÄÇtest‰∏≠ÂèØÁî®ÁöÑÊØîËæÉËøêÁÆóÁ¨¶Âè™Êúâ==Âíå!=Ôºå‰∏§ËÄÖÈÉΩÊòØÁî®‰∫éÂ≠óÁ¨¶‰∏≤ÊØîËæÉÁöÑÔºå‰∏çÂèØÁî®‰∫éÊï¥Êï∞ÊØîËæÉÔºåÊï¥Êï∞ÊØîËæÉÂè™ËÉΩ‰ΩøÁî®-eq, -gtËøôÁßçÂΩ¢Âºè„ÄÇÈÄöËøáwhich [ Âíåwhich test ÂèØ‰ª•ÁúãÂà∞ÊòØÂëΩ‰ª§ [] Âíåtest ‰æãÂ≠ê 1234567[root@dk-centos6 ~]# a="abcdef"[root@dk-centos6 ~]# test "$a" = "abcdef"[root@dk-centos6 ~]# echo $?0[root@dk-centos6 ~]# [ "$a" = "abcdef" ][root@dk-centos6 ~]# echo $?0 [[ ]]ÂÖ∑‰ΩìÂäüËÉΩ: [[ÊòØ bash Á®ãÂ∫èËØ≠Ë®ÄÁöÑÂÖ≥ÈîÆÂ≠ó„ÄÇÂπ∂‰∏çÊòØ‰∏Ä‰∏™ÂëΩ‰ª§Ôºå[[ ]] ÁªìÊûÑÊØî[ ]ÁªìÊûÑÊõ¥Âä†ÈÄöÁî®„ÄÇÂú®[[Âíå]]‰πãÈó¥ÊâÄÊúâÁöÑÂ≠óÁ¨¶ÈÉΩ‰∏ç‰ºöÂèëÁîüÊñá‰ª∂ÂêçÊâ©Â±ïÊàñËÄÖÂçïËØçÂàÜÂâ≤Ôºå‰ΩÜÊòØ‰ºöÂèëÁîüÂèÇÊï∞Êâ©Â±ïÂíåÂëΩ‰ª§ÊõøÊç¢„ÄÇ ÊîØÊåÅÂ≠óÁ¨¶‰∏≤ÁöÑÊ®°ÂºèÂåπÈÖçÔºà‰ΩøÁî®=~Êìç‰ΩúÁ¨¶Êó∂ÁîöËá≥ÊîØÊåÅshellÁöÑÊ≠£ÂàôË°®Ëææ ÂºèÔºâ,Âè≥ËæπÁöÑÂ≠óÁ¨¶‰∏≤‰∏çÂä†ÂèåÂºïÂè∑ÁöÑÊÉÖÂÜµ,ÂèØ‰ª•ÊääÂè≥Ëæπ‰Ωú‰∏∫Ê®°Âºè. ÊØîÂ¶Ç[[ hello == hell? ]]ÔºåÁªìÊûú‰∏∫Áúü„ÄÇÂΩìÁÑ∂Âä†ÂºïÂè∑Â∞±ÊòØÊñáÊú¨Â≠óÁ¨¶‰∏≤ÊØîËæÉ. ‰ΩøÁî®[[ ‚Ä¶ ]]Êù°‰ª∂Âà§Êñ≠ÁªìÊûÑÔºåËÄå‰∏çÊòØ[ ‚Ä¶ ]ÔºåËÉΩÂ§üÈò≤Ê≠¢ËÑöÊú¨‰∏≠ÁöÑËÆ∏Â§öÈÄªËæëÈîôËØØ„ÄÇÊØîÂ¶ÇÔºå&amp;&amp;„ÄÅ||„ÄÅ&lt;Âíå&gt; Êìç‰ΩúÁ¨¶ËÉΩÂ§üÊ≠£Â∏∏Â≠òÂú®‰∫é[[ ]]Êù°‰ª∂Âà§Êñ≠ÁªìÊûÑ‰∏≠Ôºå‰ΩÜÊòØÂ¶ÇÊûúÂá∫Áé∞Âú®[ ]ÁªìÊûÑ‰∏≠ÁöÑËØùÔºå‰ºöÊä•Èîô„ÄÇÊØîÂ¶ÇÂèØ‰ª•Áõ¥Êé•‰ΩøÁî®if [[ $a != 1 &amp;&amp; $a != 2 ]], Â¶ÇÊûú‰∏çÈÄÇÁî®ÂèåÊã¨Âè∑, Âàô‰∏∫if [ $a -ne 1] &amp;&amp; [ $a != 2 ]ÊàñËÄÖif [ $a -ne 1 -a $a != 2 ]„ÄÇ Á∫ØÊï∞Â≠óÊØîËæÉ &gt; ÈÄöËøáÊØîËæÉASCIIÂÄº,gt‰ªÖËÉΩÊØîËæÉÊï∞Â≠ó123456789101112[root@dk-centos6 ~]# [ 2 \&gt; 1 ][root@dk-centos6 ~]# echo $?0[root@dk-centos6 ~]# [ 2 -gt 1 ][root@dk-centos6 ~]# echo $?0[root@dk-centos6 ~]# [[ 2 &gt; 1 ]][root@dk-centos6 ~]# echo $?0[root@dk-centos6 ~]# [[ 2 -gt 1 ]][root@dk-centos6 ~]# echo $?0 Â≠óÁ¨¶‰∏≤ÊØîËæÉ ÂçïÊã¨Âè∑‰∏≠Â¶ÇÊûúË¶ÅÊØîËæÉÁ¨¶Âè∑ ‚Äú&lt;‚Äù ‚Äú&gt;‚Äù, ÈúÄË¶ÅËΩ¨‰πâ, Âê¶ÂàôÂà§Êñ≠ÁªìÊûúÈîôËØØ123456789[root@dk-centos6 ~]# [ "b" &gt; "a" ][root@dk-centos6 ~]# echo $?0[root@dk-centos6 ~]# [ "b" &lt; "a" ][root@dk-centos6 ~]# echo $?0[root@dk-centos6 ~]# [ "b" \&lt; "a" ][root@dk-centos6 ~]# echo $?1 ÂèåÊã¨Âè∑‰∏çÁî®ËΩ¨‰πâ , Áõ¥Êé•ÊâßË°åÂç≥ÂèØ123456[root@dk-centos6 ~]# [[ "b" &gt; "a" ]][root@dk-centos6 ~]# echo $?0[root@dk-centos6 ~]# [[ "b" &lt; "a" ]][root@dk-centos6 ~]# echo $?1]]></content>
      <categories>
        <category>linux</category>
        <category>shell</category>
      </categories>
      <tags>
        <tag>linux</tag>
        <tag>shell</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Êî∂ËóèÈìæÊé•]]></title>
    <url>%2F2019%2F10%2F17%2F18-%E6%94%B6%E8%97%8F%E9%93%BE%E6%8E%A5%2F</url>
    <content type="text"><![CDATA[ËÆ∞ÂΩï‰∏Ä‰∫õÂ•ΩÁöÑÁΩëÂùÄ ÂÆπÂô® ‰∫ëÂéüÁîüÂõæ‰π¶ÁºñÂπ¥Âè≤ ‰∫ëÂéüÁîüÂ§ß‰Ω¨ÂçöÂÆ¢Ê±áÊÄª LinuxÊúçÂä° MySQL 5.6, 5.7, 8.0ÁâàÊú¨ÁöÑÊñ∞ÁâπÊÄßÂ§ßÂÖ®]]></content>
      <categories>
        <category>ÁΩëÂùÄ</category>
        <category>Êî∂Ëóè</category>
      </categories>
      <tags>
        <tag>Êî∂Ëóè</tag>
        <tag>ÁΩëÂùÄ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[markdown‰∏Ä‰∫õÂÜôÊ≥ïËÆ∞ÂΩï]]></title>
    <url>%2F2019%2F10%2F16%2F17-markdown%E4%B8%80%E4%BA%9B%E5%86%99%E6%B3%95%E8%AE%B0%E5%BD%95%2F</url>
    <content type="text"><![CDATA[ËÆ∞ÂΩï‰∏Ä‰∫õÈúÄË¶ÅÊ≥®ÊÑèÁöÑÂÜôÊ≥ï,markdown ÊòØÊîØÊåÅhtmlËØ≠Ê≥ïÁöÑ ËøôÈáåÊÉ≥ÂÜô‰∏Ä‰∏™Â±Ö‰∏≠ÁöÑÊ†áÈ¢òÂíåÂõæÁâá1234&lt;center&gt;&lt;img src="http://zhangzw001.github.io/images/dockerniu.jpeg" width = "100" height = "100" style="border: 0"/&gt;&lt;font color="blue" face="Èªë‰Ωì" size=5&gt; Dockerfile &lt;/font&gt;&lt;/center&gt; ‰ª•‰∏ãÂç≥ÊïàÊûúÂõæ: Ëøô‰∏™Â∞±ÊòØÊïàÊûúÂõæÂíØ]]></content>
      <categories>
        <category>markdown</category>
      </categories>
      <tags>
        <tag>markdown</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Dockerfile‰ªãÁªç]]></title>
    <url>%2F2019%2F10%2F16%2F16-dockerfile%E4%BB%8B%E7%BB%8D%2F</url>
    <content type="text"><![CDATA[Dockerfile Êú¨ÊñáÊëòÂΩï‰∫é: Â¶Ç‰ΩïÂø´ÈÄüÂ∞ÜÂÆπÂô®‰∫ëÈïúÂÉèÂ§ßÂ∞èÁ≤æÁÆÄ98%Ôºü Dockerfile Êñá‰ª∂ÊúâËá™Â∑±ÁöÑ‰π¶ÂÜôÊ†ºÂºèÂíåÊîØÊåÅÁöÑÂëΩ‰ª§ÔºåÂ∏∏Áî®ÁöÑDockerfile Êåá‰ª§ÊúâÔºö FROM ÊåáÂÆöÂü∫ÈïúÂÉè„ÄÇ MAINTAINER ËÆæÁΩÆÈïúÂÉèÁöÑ‰ΩúËÄÖ‰ø°ÊÅØÔºåÂ¶Ç‰ΩúËÄÖÂßìÂêç„ÄÅÈÇÆÁÆ±Á≠â„ÄÇ COPY Â∞ÜÊñá‰ª∂‰ªéÊú¨Âú∞Â§çÂà∂Âà∞ÈïúÂÉèÔºåÊã∑Ë¥ùÂâçÈúÄË¶Å‰øùËØÅÊú¨Âú∞Ê∫êÊñá‰ª∂Â≠òÂú®„ÄÇ ADD ‰∏é COPY Á±ª‰ººÔºåÂ§çÂà∂Êñá‰ª∂Âà∞ÈïúÂÉè„ÄÇ‰∏çÂêåÁöÑÊòØÔºåÂ¶ÇÊûúÊñá‰ª∂ÊòØÂΩíÊ°£Êñá‰ª∂Ôºàtar, zip, tgz, xz Á≠âÔºâÔºå‰ºöË¢´Ëá™Âä®Ëß£Âéã„ÄÇ ENV ËÆæÁΩÆÁéØÂ¢ÉÂèòÈáèÔºåÊ†ºÂºè: ENV key=valueÊàñENV key valueÔºåËøêË°åÂÆπÂô®ÂêéÔºåÂèØÁõ¥Êé•Âú®ÂÆπÂô®‰∏≠‰ΩøÁî®„ÄÇ EXPOSE Êö¥Èú≤ÂÆπÂô®‰∏≠ÊåáÂÆöÁöÑÁ´ØÂè£ÔºåÂè™ÊòØ‰∏Ä‰∏™Â£∞ÊòéÔºå‰∏ªË¶ÅÁî®Êà∑‰∫ÜËß£Â∫îÁî®ÁõëÂê¨ÁöÑÁ´ØÂè£„ÄÇ VOLUME ÊåÇËΩΩÂç∑Âà∞ÂÆπÂô®ÔºåÈúÄË¶ÅÊ≥®ÊÑèÁöÑÊòØÔºå‰øùÂ≠òÈïúÂÉèÊó∂‰∏ç‰ºö‰øùÂ≠òÂç∑‰∏≠ÁöÑÊï∞ÊçÆ„ÄÇ WORKDIR ËÆæÁΩÆÂΩìÂâçÂ∑•‰ΩúÁõÆÂΩïÔºåÂêéÁª≠ÂêÑÂ±ÇÁöÑÂΩìÂâçÁõÆÂΩïÈÉΩË¢´ÊåáÂÆö„ÄÇ RUN Âú®ÂÆπÂô®‰∏≠ËøêË°åÊåáÂÆöÁöÑÂëΩ‰ª§„ÄÇ CMD ÂÆπÂô®ÂêØÂä®Êó∂ËøêË°åÁöÑÂëΩ‰ª§„ÄÇDockerfile ‰∏≠ÂèØ‰ª•ÊúâÂ§ö‰∏™ CMD Êåá‰ª§Ôºå‰ΩÜÂè™ÊúâÊúÄÂêé‰∏Ä‰∏™ÁîüÊïà„ÄÇCMD ÂèØ‰ª•Ë¢´ docker run ‰πãÂêéÁöÑÂèÇÊï∞ÊõøÊç¢„ÄÇ ENTRYPOINT ËÆæÁΩÆÂÆπÂô®ÂêØÂä®Êó∂ËøêË°åÁöÑÂëΩ‰ª§„ÄÇDockerfile ‰∏≠ÂèØ‰ª•ÊúâÂ§ö‰∏™ ENTRYPOINT Êåá‰ª§Ôºå‰ΩÜÂè™ÊúâÊúÄÂêé‰∏Ä‰∏™ÁîüÊïà„ÄÇCMD Êàñ docker run ‰πãÂêéÁöÑÂèÇÊï∞‰ºöË¢´ÂΩìÂÅöÂèÇÊï∞‰º†ÈÄíÁªô ENTRYPOINTÔºåËøô‰∏™ÊòØ‰∏éCMDÁöÑÂå∫Âà´„ÄÇ ÂÆπÂô®ÁöÑÂéüÁêÜ ÂÆπÂô®ÈïúÂÉè‰∏≠ÊúÄÈáçË¶ÅÁöÑÊ¶ÇÂøµÂ∞±ÊòØlayersÔºåÂç≥ÈïúÂÉèÂ±Ç„ÄÇ ÂÆπÂô®ÁöÑÂéüÁêÜ ÈïúÂÉèÂ±Ç‰æùËµñ‰∫é‰∏ÄÁ≥ªÂàóÁöÑÂ∫ïÂ±ÇÊäÄÊúØÔºåÊØîÂ¶ÇÊñá‰ª∂Á≥ªÁªü(filesystems)„ÄÅÂÜôÊó∂Â§çÂà∂(copy-on-write)„ÄÅËÅîÂêàÊåÇËΩΩ(union mounts)Á≠âÊäÄÊúØÊü•ÁúãDocker ÂÆòÊñπÊñáÊ°£https://docs.docker.com/storage/storagedriver/ËøõË°åÂ≠¶‰π†„ÄÇ ÊØèÊù°Êåá‰ª§ÈÉΩÂàõÂª∫‰∏Ä‰∏™ÈïúÂÉèÂ±ÇÔºå‰ºöÂ¢ûÂä†ÈïúÂÉèÁöÑÂ§ßÂ∞è ‰∏ãÈù¢Áúã‰∏™‰æãÂ≠êËøôÈáåÊàëÊúâ‰∏Ä‰∏™1.2MÁöÑÈïúÂÉè 12docker images|grep busyboxbusybox latest 19485c79a9bb 5 weeks ago 1.22MB Êàë‰ª¨Âü∫‰∫ébusyboxÂÜô‰∏Ä‰∏™DockerfileÊù•build 1234567#cat Dockerfilefrom busybox:latestrun mkdir /tmp/dir \ &amp;&amp; dd if=/dev/zero of=/tmp/dir/file1 bs=1M count=10run rm -f /tmp/dir/file1 ÊâßË°åbuild 1234567891011121314151617docker build -t busybox-test .Sending build context to Docker daemon 2.048kBStep 1/3 : from busybox:latest ---&gt; 19485c79a9bbStep 2/3 : run mkdir /tmp/dir &amp;&amp; dd if=/dev/zero of=/tmp/dir/file1 bs=1M count=10 ---&gt; Running in 0426f92c77ed10+0 records in10+0 records out10485760 bytes (10.0MB) copied, 0.003785 seconds, 2.6GB/sRemoving intermediate container 0426f92c77ed ---&gt; 5ec75db090c9Step 3/3 : run rm -f /tmp/dir/file1 ---&gt; Running in 540e7d0a5aeaRemoving intermediate container 540e7d0a5aea ---&gt; 00041489cc0eSuccessfully built 00041489cc0eSuccessfully tagged busybox-test:latest Êü•ÁúãimageÂ§ßÂ∞è 123docker images|grep busyboxbusybox-test latest 00041489cc0e 10 minutes ago 11.7MBbusybox latest 19485c79a9bb 5 weeks ago 1.22MB ??? Êàë‰∏çÊòØrmÂà†Èô§‰∫ÜÂàõÂª∫ÁöÑ/tmp/dir/file1 Êñá‰ª∂Âêó? ÈöæÈÅìÂÆÉËøòÂú®? Êù•,Êàë‰ª¨ÊµãËØï‰∏Ä‰∏ã 12# Êü•ÁúãÁõÆÂΩï‰∏ãÊòØÂê¶ÊúâÊñá‰ª∂docker run -ti busybox-test ls /tmp/dir ÁªìÊûúÊòæÁÑ∂ÊòØÁ©∫‚Ä¶ Âñî,,, Âõ†‰∏∫‚ÄùÂú®Dockerfile‰∏≠ÔºåÊØèÊù°Êåá‰ª§ÈÉΩ‰ºöÂàõÂª∫‰∏Ä‰∏™ÈïúÂÉèÂ±ÇÔºåÁªßËÄå‰ºöÂ¢ûÂä†ÈïúÂÉèÊï¥‰ΩìÁöÑÂ§ßÂ∞è‚Äù, Âú®ÁúãÊàë‰ª¨ÂÜôÁöÑDockerfile,Êàë‰ª¨Á¨¨‰∏Ä‰∏™run ÊâßË°åÁöÑÊó∂ÂÄô, ËøôÈáåÂÅáË£ÖÂè´ (run1Â±Ç), Êàë‰ª¨ÁîüÊàê‰∫Üfile1Êñá‰ª∂ÂΩìÊâßË°åÁ¨¨‰∫å‰∏™runÁöÑÊó∂ÂÄô, Êàë‰ª¨Â§ÑÂú®‰∫Ü (run2Â±Ç), (run1Â±Ç)Â∑≤ÁªèÊòØÁà∂Â±Ç,ÊòØ‰∏™Âè™ËØªÂ±Ç‰∫Ü,Âè™ÊúâÂΩìÂâçÂ±ÇÂèØÂÜô, ËôΩÁÑ∂Êàë‰ª¨Âú® (run2Â±Ç)Âà†Èô§‰∫ÜËøô‰∏™Êñá‰ª∂,‰ΩÜÂà†Èô§ÁöÑ‰ªÖ‰ªÖÊòØ‰ªΩÊã∑Ë¥ùËÄåÂ∑≤, ËøôÂ∞±ÊòØÂÜôÊó∂Â§çÂà∂. ÊâÄ‰ª•‰ª•‰∏äÁöÑ‰ºòÂåñÂ∫îËØ•ÊòØ: ÂÜôÊàê‰∏ÄÊù°run 123456789#cat Dockerfilefrom busybox:latestrun mkdir /tmp/dir \ &amp;&amp; dd if=/dev/zero of=/tmp/dir/file1 bs=1M count=10 \ &amp;&amp; rm -f /tmp/dir/file1# builddocker build -t busybox-test2 . ÁªìÊûúÊòæÁÑ∂ 1234docker images|grep busyboxbusybox-test2 latest faf8b7d4f140 3 seconds ago 1.22MBbusybox-test latest 00041489cc0e 10 minutes ago 11.7MBbusybox latest 19485c79a9bb 5 weeks ago 1.22MB ËôΩÁÑ∂ËØ¥ËøôÈáåÁöÑÊµãËØïÊ≤°ÊúâÂπ≤‰ªª‰Ωï‰∫ãÊÉÖ, ‰ΩÜÊàë‰ª¨Âú®ÂÜôDockerfileÁöÑÊó∂ÂÄôÈúÄË¶ÅÊ≥®ÊÑè, ‰∏§‰∏™run‰πãÈó¥ÊòØ‰∏§‰∏™‰∏çÂêåÁöÑ ÂèØÂÜôÂ±Ç! ÁÆÄÂçïÊÄªÁªìÁ≤æÁÆÄÈïúÂÉèÂ§ßÂ∞èÁöÑÊñπÊ≥ï: 121 ‰ΩøÁî®Êõ¥Â∞èÁöÑÂü∫Á°ÄÈïúÂÉè,Ê≥®ÊÑè‰∏Ä‰∫õÂæàÂ∞èÁöÑÈïúÂÉèÂèØËÉΩÁº∫Â∞ëÂæàÂ§ö‰æùËµñÂ∫ì,‰æãÂ¶ÇÊü•Áúãredis‰æùËµñÂ∫ì ldd /usr/bin/redis-cli2 ÂêàÂπ∂DockerfilecÊåá‰ª§Á≤æÁÆÄ(ÂèØ‰ª•ÁöÑËØùÂÜôÊàê‰∏ÄÊù°run) ‰∏Ä‰∫õÂ∞èÁöÑÈïúÂÉè 1 scratch: ‰∏Ä‰∏™Á©∫ÁöÑÈïúÂÉè, Êó†Ê≥ïpull -.-!!! , ÂÜôÂú®DockerfileÊòØÂèØ‰ª•ÁöÑ 2 alpine: 5MÁöÑlinuxÈïúÂÉè,ÊúâÂåÖÁÆ°ÁêÜÂ∑•ÂÖ∑apk 123FROM scratchADD alpine-minirootfs-3.10.2-x86_64.tar.gz /CMD ["/bin/sh"] 3 busybox: 1MÂ§öÁöÑÈïúÂÉè,Áß∞‰∏∫ÂµåÂÖ•ÂºèlinuxÁöÑÁëûÂ£´ÂÜõÂàÄ, LinuxÂíåunix‰∏Ä‰∫õÂ∏∏Áî®ÁöÑÂëΩ‰ª§]]></content>
      <categories>
        <category>docker</category>
        <category>Dockerfile</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[dockerÁÆÄ‰ªãÂíå‰ΩøÁî®]]></title>
    <url>%2F2019%2F10%2F16%2F15-docker%E7%AE%80%E4%BB%8B%E5%92%8C%E4%BD%BF%E7%94%A8%2F</url>
    <content type="text"><![CDATA[ÁÆÄÂçï‰ªãÁªçdocker docker]]></content>
      <categories>
        <category>docker</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[mysql5.5ÁõÆÂΩïcopyÊñπÂºèËøÅÁßª]]></title>
    <url>%2F2019%2F10%2F15%2F14-mysql%E7%9B%AE%E5%BD%95copy%E6%96%B9%E5%BC%8F%E8%BF%81%E7%A7%BB%2F</url>
    <content type="text"><![CDATA[‰ªéÁé∞ÊúâÁöÑ‰∏ÄÂè∞ ‰ªéÂ∫ì ÂÖ®copy dataÁõÆÂΩïÂà∞2Âè∞Êñ∞Êú∫Âô®‰∏ä, ÂÜçÈÖçÁΩÆmysql‰∏ª‰ªé ÁõÆÂΩïcopyÊñπÂºèËøÅÁßª Ê≥®ÊÑè ‰∏çË¶ÅÂà†Èô§ibdata1,‰ºöÂØºËá¥innodbË°®‰∏çÂ≠òÂú® ÂèØ‰ª•‰∏çÂà†Èô§ib_logfile0,ib_logfile1, ‰ΩÜmy.cnfÈÖçÁΩÆÂ§ßÂ∞è‰∏ÄËá¥ Âå∫Âà´ÁõÆÂΩïÊùÉÈôê‰∏∫mysql,tmpÁõÆÂΩïÂ≠òÂú® ËØ∑Ëá™Ë°åÂÆâË£ÖÂ•Ωmysql5.5 1234567891 È¶ñÂÖàÂÅúÊ≠¢mysql/etc/init.d/mysqld stop2 ÂêåÊ≠•Êï∞ÊçÆÁõÆÂΩïÂà∞Êñ∞Êú∫Âô®/data/u013 Á°ÆËÆ§Êñ∞Êú∫Âô®‰∏ämysqlÁâàÊú¨Âπ∂ÈÖçÁΩÆ/etc/my.cof4 ÂÆåÊï¥ËøÅÁßªÊó∂‰∏çÈúÄË¶ÅÂà†Èô§ÂÜÖÂÆπ(innodb_log_file_size = 256M ÈÖçÁΩÆË¶Å‰∏ÄËá¥)5 ÂêØÂä®mysql ÈÖçÁΩÆ‰∏ª‰ªé 1 È¶ñÂÖà ÁõÆÂΩïcopyÊñπÂºè ÂêåÊ≠•Êüê‰∏™‰ªéÂ∫ìÂà∞2Âè∞Êñ∞Êú∫Âô®Âπ∂ÂêØÂä®ÂÆåÊàê, Ê≠§Êó∂‰∏§‰∏™mysqlÈÉΩÂºÄÂêØ‰∫Üslave 2 ÊöÇÂÅúÂêåÊ≠•ÔºåÂπ∂ËÆæÁΩÆËØªÂÜôÔºõ 123456stop slave;# ËØ•ÊâßË°å‰ªÖ‰∏ªÂ∫ì‰∏äÊâßË°å(ÈÖçÁΩÆÂèØÂÜô)SET GLOBAL read_only=0;reset slave all;-- RESET SLAVE ALLÊòØÊ∏ÖÈô§‰ªéÂ∫ìÁöÑÂêåÊ≠•Â§çÂà∂‰ø°ÊÅØ„ÄÅÂåÖÊã¨ËøûÊé•‰ø°ÊÅØÂíå‰∫åËøõÂà∂Êñá‰ª∂Âêç„ÄÅ‰ΩçÁΩÆ-- ‰ªéÂ∫ì‰∏äÊâßË°åËøô‰∏™ÂëΩ‰ª§ÂêéÔºå‰ΩøÁî®show slave statusÂ∞Ü‰∏ç‰ºöÊúâËæìÂá∫„ÄÇ 3 2Âè∞Êñ∞ÁöÑmysql‰∏≠‰øÆÊîπ‰ªéÂ∫ìslaveÈÖçÁΩÆ, ËøûÊé•Âà∞Êñ∞ÁöÑ‰∏ªÂ∫ìÂú∞ÂùÄ(ÊàëËøôÈáåÈÄöËøáÂüüÂêçËß£Êûê) 12CHANGE MASTER TO MASTER_HOST='a_master.b.com',MASTER_PORT=3306,MASTER_USER='repl_user',MASTER_PASSWORD='xxxx',MASTER_LOG_FILE='m1-master-bin.000001',MASTER_LOG_POS=88; 4 Áî±‰∫éÊú¨Êú∫ÈúÄË¶ÅÂÆâË£Ömysql5.5Âíåmysql5.7ÊâÄ‰ª•Ê≥®ÊÑè‰∏Ä‰∏ã 123456# ÂàùÂßãÂåñÊåáÂÆöÈÖçÁΩÆÊñá‰ª∂/usr/local/mysql57/bin/mysqld --defaults-file=/etc/my57.cnf --initialize-insecure --user=mysql --basedir=/usr/local/mysql57 --datadir=/data/u001# ‰øÆÊîπ/etc/init.d/mysqld57parse_server_arguments `$print_defaults -c /etc/my57.cnf mysqld server mysql_server mysql.server`$bindir/mysqld_safe --defaults-file=/etc/my57.cnf --pid-file="$mysqld_pid_file_path" $other_args &gt;/dev/null &amp; Êä•ÈîôÁªüËÆ° ERROR 1840 (HY000) at line 24: @@GLOBAL.GTID_PURGED can only be set when @@GLOBAL.GTID_EXECUTED is empty. 1ÊâßË°åreset master; The MySQL server is running with the‚Äìread-only option so it cannot execute this statement 1ÊâßË°å set global read_only=0;]]></content>
      <categories>
        <category>ÊäÄÊúØÊñáÊ°£</category>
        <category>mysql</category>
      </categories>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[‰∫ëÂéüÁîüÂçöÂÆ¢Ê±áÊÄª]]></title>
    <url>%2F2019%2F10%2F12%2F13-%E4%BA%91%E5%8E%9F%E7%94%9F%E5%8D%9A%E5%AE%A2%E6%B1%87%E6%80%BB%2F</url>
    <content type="text"><![CDATA[ËÆ∞ÂΩï‰∏Ä‰∫õ‰∫ëÂéüÁîüÊäÄÊúØÂçöÂÆ¢ Êù•Ëá™ServiceMesher[8] Áæ§KaiRen‚Äôs Blog Zlatan Eevee ÂõΩÂçó‰πãÂ¢É ÂçöÂÆ¢ | È´òÁ≠ñ Kakashi‚Äôs Blog Alex Wu‚Äôs blog | THINK BIG, START SMALL, DELIVER VALUE TO THE BUSINESS ÂºÄÂÖÉDevOpsÁü•ËØÜÂ∫ì - Áü•ËØÜÁÆ°ÁêÜÔºåÊó∂Èó¥ÁÆ°ÁêÜÔºåËá™ÊàëÁÆ°ÁêÜ Ëµ∑È£é‰∫Ü Ëå∂Ê≠áÈ©øÁ´ô - Gopher, OpenSource Fans, ÊàêÈïø‰πãË∑ØÊúâÊàëÁõ∏‰º¥„ÄÇ Polar Snow Documentation ‰∫ëÂéüÁîüÂÆûÈ™åÂÆ§ - Á±≥ÂºÄÊúóÂü∫Êù®ÁöÑÂçöÂÆ¢ Jimmy Song - ÂÆãÂáÄË∂ÖÁöÑÂçöÂÆ¢|Cloud Native|‰∫ëÂéüÁîüÂ∏ÉÈÅìÂ∏à Êº†ÁÑ∂ÁöÑÂçöÂÆ¢ | mritd Blog DevOps ‚Äì ÊàêÈïø‰πãË∑Ø birdben ÊµÆÁîüËã•Ê¢¶ CNCF Cloud Native Interactive Landscape ÊùúÂ±π‰∏úÁöÑÂçöÂÆ¢ | Â≠¶Êó†Ê≠¢Â¢É Ê¢¶Êó≠ÈöèÊÉ≥ ictfox blog CloudNative Êû∂ÊûÑ ÊàëÁà±Ë•øÁ∫¢Êüø Doublemine Bingo Huang Arthur Chunqi Li‚Äôs Blog Archive | Arthur Chunqi Li‚Äôs Blog ITÊäÄÊúØÂ∑•‰ΩúÂ≠¶‰π†ÊäòËÖæÁ¨îËÆ∞ Êùé‰Ω∂Êæ≥ÁöÑÂçöÂÆ¢ Â¢®Ëç∑ÁêºÊûóÂÆòÁΩë-ÁºñÁ®ãÊó•Âøó Archive - Nolla Tomoya‚Äôs Blog ÂêõÊó†Ê≠¢Â¢É Jamin Zhang roc - imroc.io|rocÁöÑÂçöÂÆ¢|Cloud Native|Kubernetes|Go|Golang Blog | Sysdig sleeleÁöÑÂçöÂÆ¢ TauCeti blog ¬∑ TauCeti blog Ê∞¥Êô∂ÂëΩÂå£ | ÁîüÂëΩÂú®‰∫éÊäòËÖæÔºåÊäòËÖæ‰∏áÂ≤ÅÔºÅ ËãèÊ¥ãÂçöÂÆ¢ LinuxTOY Infvie‚Äôs Blog | ËøêÁª¥SREÁ§æÂå∫ÂçöÂÆ¢ Solar MoeLove Hwchiu Learning Notekubernetes/SDN/DevOps Â≠òÂÇ®È¢ÜÂüü yangguanjun]]></content>
      <categories>
        <category>ÊäÄÊúØÊñáÊ°£</category>
        <category>ÁΩëÂùÄ</category>
        <category>Â§ß‰Ω¨ÂçöÂÆ¢</category>
      </categories>
      <tags>
        <tag>‰∫ëÂéüÁîü</tag>
        <tag>cloud native</tag>
        <tag>Â§ß‰Ω¨ÂçöÂÆ¢</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[awkÁÆÄÂçïËÆ∞ÂΩï]]></title>
    <url>%2F2019%2F10%2F11%2F12-awk%E7%AE%80%E5%8D%95%E8%AE%B0%E5%BD%95%2F</url>
    <content type="text"><![CDATA[ËÆ∞ÂΩï‰∏Ä‰∫õÁÆÄÂçï‰ΩøÁî® ÂÆû‰æã1: ËÆ°ÁÆónginxÊó•Âøó‰∏≠Êüê‰∏™Êé•Âè£ÁöÑÊ¨°Êï∞ÂíåÂπ≥ÂùáÂìçÂ∫îÊó∂Èó¥‰æãÂ¶ÇÊàëÁöÑa.txt nginxÊó•ÂøóÊ†ºÂºèÂ¶Ç‰∏ã12a.b.com 1.1.1.1 [08/Sep/2019:23:57:01 +0800] "GET /v1/actionname?xxxx HTTP/1.1" 200 386 "-" "Mozilla/5.0 (Linux; Android 9; V1831A Build/P00610; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/68.0.3440.91 Mobile Safari/537.36" "-" "0.023"a.b.com 1.1.1.1 [08/Sep/2019:23:57:01 +0800] "GET /v1/actionname2?xxxx HTTP/1.1" 200 386 "-" "Mozilla/5.0 (Linux; Android 9; V1831A Build/P00610; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/68.0.3440.91 Mobile Safari/537.36" "-" "0.016" ËøôÈáåÊàëÂè™ÊÉ≥ÂèñÂá∫Êé•Âè£Âêç: /v1/actionname Âíå 0.023 ÂìçÂ∫îÊó∂Èó¥ È¶ñÂÖàÊàëÂèñÂá∫Ëøô‰∏§Âàó1234567cat a.txt|awk -F '"' '&#123;print $(NF-1),$2&#125;'|awk -F '?' '&#123;print $1&#125;'|awk '&#123;print $1" "$3&#125;' &gt; b.txtcat b.txt0.023 /v1/actionname0.016 /v1/actionname2... ÂëΩ‰ª§ËØ¶Ëß£12345678&gt; Á¨¨‰∏ÄÊ≠• ÂìçÂ∫îÊó∂Èó¥Ê±ÇÂíå&#123;s[$2]+=$1&#125;: ÊØèÈÅáÂà∞‰∏Ä‰∏™$2,ÊØîÂ¶ÇÈÅáÂà∞/v1/actionname,ËÆ∞ÂΩï‰∏Ä‰∏™Êï∞ÁªÑs[/v1/actionname] = ÊâÄÊúâ$1ÁöÑÂÄºÁöÑÊÄªÂíå&gt; Á¨¨‰∫åÊ≠• ÁÆóÊé•Âè£ÁöÑÊ¨°Êï∞&#123;m[$2]++&#125;: ÊØèÈÅáÂà∞‰∏Ä‰∏™$2,ÊØîÂ¶ÇÈÅáÂà∞/v1/actionname,ËÆ∞ÂΩï‰∏Ä‰∏™Êï∞ÁªÑm[/v1/actionname] = ÊâÄÊúâ$1ÁöÑ‰∏™Êï∞&gt; Á¨¨‰∏âÊ≠• ÂèñÂπ≥ÂùáÂÄº# ËøôÈáåËæìÂá∫csvÊñá‰ª∂cat b.txt|awk '&#123;m[$2]++&#125; &#123;s[$2]+=$1&#125; ; END &#123;for(i in m) &#123;print s[i]/m[i] "," m[i] "," i&#125;&#125;'|awk -F "," '$2 &gt; 20'|sort -k2nr &gt; test.csv]]></content>
      <categories>
        <category>linux</category>
        <category>awk</category>
      </categories>
      <tags>
        <tag>linux</tag>
        <tag>awk</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[mysqlÁÆÄÂçïËÆ∞ÂΩï]]></title>
    <url>%2F2019%2F10%2F10%2F11-mysql%E7%AE%80%E5%8D%95%E8%AE%B0%E5%BD%95%2F</url>
    <content type="text"><![CDATA[ÁÆÄÂçïËÆ∞ÂΩï‰∏Ä‰∫õmysqlÁü•ËØÜÁÇπ SQL ËØ≠Âè•‰∏ªË¶ÅÂèØ‰ª•ÂàíÂàÜ‰∏∫‰ª•‰∏ã 3 ‰∏™Á±ªÂà´123DDLÔºàData Definition LanguagesÔºâËØ≠Âè•ÔºöÊï∞ÊçÆÂÆö‰πâËØ≠Ë®ÄÔºåËøô‰∫õËØ≠Âè•ÂÆö‰πâ‰∫Ü‰∏çÂêåÁöÑÊï∞ÊçÆÊÆµ„ÄÅÊï∞ÊçÆÂ∫ì„ÄÅË°®„ÄÅÂàó„ÄÅÁ¥¢ÂºïÁ≠âÊï∞ÊçÆÂ∫ìÂØπË±°ÁöÑÂÆö‰πâ„ÄÇÂ∏∏Áî®ÁöÑËØ≠Âè•ÂÖ≥ÈîÆÂ≠ó‰∏ªË¶ÅÂåÖÊã¨ create„ÄÅdrop„ÄÅalterÁ≠â„ÄÇDMLÔºàData Manipulation LanguageÔºâËØ≠Âè•ÔºöÊï∞ÊçÆÊìçÁ∫µËØ≠Âè•ÔºåÁî®‰∫éÊ∑ªÂä†„ÄÅÂà†Èô§„ÄÅÊõ¥Êñ∞ÂíåÊü•ËØ¢Êï∞ÊçÆÂ∫ìËÆ∞ÂΩïÔºåÂπ∂Ê£ÄÊü•Êï∞ÊçÆÂÆåÊï¥ÊÄßÔºåÂ∏∏Áî®ÁöÑËØ≠Âè•ÂÖ≥ÈîÆÂ≠ó‰∏ªË¶ÅÂåÖÊã¨ insert„ÄÅdelete„ÄÅudpate Âíåselect Á≠â„ÄÇ(Â¢ûÊ∑ªÊîπÊü•ÔºâDCLÔºàData Control LanguageÔºâËØ≠Âè•ÔºöÊï∞ÊçÆÊéßÂà∂ËØ≠Âè•ÔºåÁî®‰∫éÊéßÂà∂‰∏çÂêåÊï∞ÊçÆÊÆµÁõ¥Êé•ÁöÑËÆ∏ÂèØÂíåËÆøÈóÆÁ∫ßÂà´ÁöÑËØ≠Âè•„ÄÇËøô‰∫õËØ≠Âè•ÂÆö‰πâ‰∫ÜÊï∞ÊçÆÂ∫ì„ÄÅË°®„ÄÅÂ≠óÊÆµ„ÄÅÁî®Êà∑ÁöÑËÆøÈóÆÊùÉÈôêÂíåÂÆâÂÖ®Á∫ßÂà´„ÄÇ‰∏ªË¶ÅÁöÑËØ≠Âè•ÂÖ≥ÈîÆÂ≠óÂåÖÊã¨ grant„ÄÅrevoke Á≠â„ÄÇ Ê∏ÖÁ©∫Ë°®123456789Âà†Èô§Ë°®‰ø°ÊÅØÁöÑÊñπÂºèÊúâ‰∏§Áßç :truncate table table_name;delete * from table_name;Ê≥® : truncateÊìç‰Ωú‰∏≠ÁöÑtableÂèØ‰ª•ÁúÅÁï•ÔºådeleteÊìç‰Ωú‰∏≠ÁöÑ*ÂèØ‰ª•ÁúÅÁï•truncate„ÄÅdelete Ê∏ÖÁ©∫Ë°®Êï∞ÊçÆÁöÑÂå∫Âà´ :1&gt; truncate ÊòØÊï¥‰ΩìÂà†Èô§ (ÈÄüÂ∫¶ËæÉÂø´)ÔºådeleteÊòØÈÄêÊù°Âà†Èô§ (ÈÄüÂ∫¶ËæÉÊÖ¢)2&gt; truncate ‰∏çÂÜôÊúçÂä°Âô® logÔºådelete ÂÜôÊúçÂä°Âô® logÔºå‰πüÂ∞±ÊòØ truncate ÊïàÁéáÊØî deleteÈ´òÁöÑÂéüÂõ†3&gt; truncate ‰∏çÊøÄÊ¥ªtrigger (Ëß¶ÂèëÂô®)Ôºå‰ΩÜÊòØ‰ºöÈáçÁΩÆIdentity (Ê†áËØÜÂàó„ÄÅËá™Â¢ûÂ≠óÊÆµ)ÔºåÁõ∏ÂΩì‰∫éËá™Â¢ûÂàó‰ºöË¢´ÁΩÆ‰∏∫ÂàùÂßãÂÄºÔºåÂèàÈáçÊñ∞‰ªé1ÂºÄÂßãËÆ∞ÂΩïÔºåËÄå‰∏çÊòØÊé•ÁùÄÂéüÊù•ÁöÑ IDÊï∞„ÄÇËÄå delete Âà†Èô§‰ª•ÂêéÔºåidentity ‰æùÊóßÊòØÊé•ÁùÄË¢´Âà†Èô§ÁöÑÊúÄËøëÁöÑÈÇ£‰∏ÄÊù°ËÆ∞ÂΩïIDÂä†1ÂêéËøõË°åËÆ∞ÂΩï„ÄÇÂ¶ÇÊûúÂè™ÈúÄÂà†Èô§Ë°®‰∏≠ÁöÑÈÉ®ÂàÜËÆ∞ÂΩïÔºåÂè™ËÉΩ‰ΩøÁî® DELETEËØ≠Âè•ÈÖçÂêà whereÊù°‰ª∂ Â§á‰ªΩ12345# ÂÖ®ÈáèÈîÅË°®Â§á‰ªΩ(‰∏çÂèØÂÜô)mysqldump --lock-all-tables --all-databases &gt; ALLDB.sql# ‰ªÖÂØºÂá∫ÊâÄÊúâË°®ÁöÑÁªìÊûÑmysqldump --opt -d Êï∞ÊçÆÂ∫ìÂêç -u root -p &gt; xxx.sql slave ‰∏≠‰øÆÊîπmaster_host12345678910# Êü•Áúã master.info‰∏≠‰ø°ÊÅØ# Êü•Áúã show slave status\G ‰∏≠ Master_Host# ‰øÆÊîπÁöÑÊ≠•È™§ÈúÄË¶ÅÂÖàÂÅúÊ≠¢slave1 stop slave ;2 change master to master_host='xxx.xxx.xxx'; È¶ñÊ¨°ÈÖçÁΩÆ‰∏ªÂ∫ì: CHANGE MASTER TO MASTER_HOST='a_master.b.com',MASTER_PORT=3306,MASTER_USER='repl_user',MASTER_PASSWORD='xxxx',MASTER_LOG_FILE='m1-master-bin.000001',MASTER_LOG_POS=88;3 start slave ; mysqlÈóÆÈ¢ò: navicatËøûÊé•Êï∞ÊçÆÂ∫ìÂæàÊÖ¢123456Êä•Èîô: 2013-Lost connection to MYSQL server at 'reading for initial communication packet'ËØ¥Êòé: Âè™Êúâwindows ÁöÑnavicat‰ºöÂá∫Áé∞‰∏äÈù¢Êä•Èîô, windows‰∏äÈÄöËøámysqlÂëΩ‰ª§ËøûÊé•Êó∂ ‰πüÂæàÊÖ¢#Ê∑ªÂä†Â¶Ç‰∏ãÂÜÖÂÆπ:[mysqld]skip-name-resolve mysqlÈóÆÈ¢ò: mysql5.7 ÈîôËØØÊÄªÁªì-ERROR 1067 (42000): Invalid default value for TIMESTAMP123456show variables like 'sql_mode';+---------------+-------------------------------------------------------------------------------------------------------------------------------------------+| Variable_name | Value |+---------------+-------------------------------------------------------------------------------------------------------------------------------------------+| sql_mode | ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION |+---------------+-------------------------------------------------------------------------------------------------------------------------------------------+ ËøôÊòØÂõ†‰∏∫sql_mode‰∏≠ÁöÑNO_ZEROR_DATEÂØºÂà∂ÁöÑÔºåÂú®strict mode‰∏≠‰∏çÂÖÅËÆ∏‚Äô0000-00-00‚Äô‰Ωú‰∏∫ÂêàÊ≥ïÊó•Êúü Â∞Ü‰∏äÈù¢ÁöÑNO_ZERO_DATEÊîπ‰∏∫‰∏ãÈù¢ÁöÑ ALLOW_INVALID_DATES 12set sql_mode='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,ALLOW_INVALID_DATES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION';set session sql_mode='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION'; ‰∏äÈù¢ÁöÑËÆæÁΩÆÊòØ‰∏¥Êó∂ËÆæÁΩÆÔºåÂú®ÈáçÊñ∞ÁôªÈôÜÂêéÔºåËØ•ËÆæÁΩÆÂèàÊÅ¢Â§ç‰∏∫NO_ZERO_DATE mysql5.5‰∏ª+mysql5.7‰ªé ÈóÆÈ¢ò123ERROR 1794 (HY000): Slave is not configured or failed to initialize properly. You must at least set --server-id to enable either a master or a slave. Additional error messages can be found in the MySQL error log.server_uuidÊòØ5.6ÁöÑgtidÁâπÊÄßÂºïÂÖ•ÁöÑ‰∏Ä‰∏™ÈÖçÁΩÆÔºåÊäämysql5.7ÁöÑ rpl_slave.ccÊñá‰ª∂‰∏≠get_master_uuidÂáΩÊï∞Êç¢Êàê5.6ÂØπÂ∫îÁöÑÂáΩÊï∞Â∞±ÂèØ‰ª•‰∫Ü„ÄÇ mysql‰∏Ä‰∫õinfo‰ø°ÊÅØÁªüËÆ°123456789101112131415161718#tbl_size.sqluse information_schema;SELECT TABLE_NAME, ENGINE, ROUND((DATA_LENGTH/1024/1024),2) as DataM , ROUND((INDEX_LENGTH/1024/1024),2) as IndexM, ROUND(((DATA_LENGTH+INDEX_LENGTH)/1024/1024),2) as AllM, TABLE_ROWS, TABLE_COMMENTFROM TABLESWHERE TABLE_SCHEMA = 'hzkj_zh'ORDER BY AllM DESC;# ÁîüÊàêexcelË°®Ê†ºmysql test &lt;tbl_size.sql &gt;tbl_info_20191028.txt Ë∑≥Ëøá‰∏ª‰ªéÂêåÊ≠•ÈîôËØØ1234stop slave;SET GLOBAL sql_slave_skip_counter =1;start slave;show slave status\G; mysql information_schema.TABLESË°®‰∏≠ÁöÑtable_rows Â≠óÊÆµÂÄº‰∏é‚Äôcount(*)‚Äô ÂÄº‰∏çÂêå Êü•Áúãinformation_schema 123456789101112131415use information_schema;SELECT TABLE_NAME, TABLE_ROWSFROM TABLESWHERE TABLE_SCHEMA = 'zz' and TABLE_NAME = 'zzz';+---------------------+------------+| TABLE_NAME | TABLE_ROWS |+---------------------+------------+| zzz | 42411396 |+---------------------+------------+ ‰ΩÜÊòØ‰ºöÂèëÁé∞Âíå 1" select count(*) from ÊüêÂº†Ë°®; " ÊâßË°åÂæóÂà∞ÁöÑÂÄºÊòØ‰∏çÁõ∏ÂêåÁöÑÔºÅÈÇ£ÊòØÂõ†‰∏∫Ôºö 1: ÈªòËÆ§ÊÉÖÂÜµ‰∏ã mysql ÂØπË°®ËøõË°åÂ¢ûÂà†Êìç‰ΩúÊó∂ÔºåÊòØ‰∏ç‰ºöËá™Âä®Êõ¥Êñ∞ information_schema Â∫ì‰∏≠ tables Ë°®ÁöÑ table_rows Â≠óÊÆµÁöÑÔºåÂú®ÁΩë‰∏äÊêúÁ¥¢‰∏Ä‰∏ãÂèëÁé∞ËØ¥ÔºöÂè™Êúâ10%ÁöÑË°åÊï∞ÂèëÁîüÂèòÂåñÊâç‰ºöËá™Âä®Êî∂ÈõÜÔºàÊ≤°Êúâ‰∫≤Ëá™È™åËØÅËøáÔºÅÔºâÔºõ 2: ÊâßË°å Analyze table tableName; ‰ºöÁªüËÆ°ÊâÄÊúâË°®Êï∞ÊçÆÔºàÂú®Áîü‰∫ßÁéØÂ¢É‰∏≠‰∏çÂª∫ËÆÆ‰ΩøÁî®ÔºåÂõ†‰∏∫‰ºöÈîÅË°®ÔºÅÔºâÔºõÂéüÊñáÈìæÊé•Ôºömysql information_schema.TABLESË°®‰∏≠ÁöÑtable_rows Â≠óÊÆµÂÄº‰∏écountÂÄº‰∏çÂêå]]></content>
      <categories>
        <category>ÊäÄÊúØÊñáÊ°£</category>
        <category>mysql</category>
      </categories>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[centos6ÂÆâË£Önginx1.16+php7.2]]></title>
    <url>%2F2019%2F09%2F27%2F10-centos6%E5%AE%89%E8%A3%85nginx1-16-php7-2%2F</url>
    <content type="text"><![CDATA[ËÆ∞ÂΩïÁÆÄÂçïÁöÑÂÆâË£ÖnginxÂíåphpÁöÑÈÖçÁΩÆ,‰ªÖ‰æõÂèÇËÄÉ ÂÖàÂáÜÂ§áÁéØÂ¢É123456789# Êõ¥Êñ∞Ê∫êmv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.bakcurl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-6.repoyum clean allyum makecacheyum install -y epel-release# ÂÆâË£Ö‰∏Ä‰∫õ‰æùËµñÂåÖyum -y install gcc make cmake ncurses-devel libxml2-devel libtool-ltdl-devel gcc-c++ autoconf automake bison zlib-devel openssl-devel pcre-devel libxml2 libxml2-devel libcurl libcurl-devel autoconf automake libtool-ltdl libtool-ltdl-devel libjpeg libjpeg-turbo-devel libmcrypt-devel libpng-devel centos6ÁºñËØëÂÆâË£Önginx123456789101112131415#È¶ñÂÖàÂÆòÁΩë‰∏ãËΩΩ1.16cd /usr/local/src/wget http://nginx.org/download/nginx-1.16.0.tar.gztar -xvf nginx-1.16.0.tar.gz# ÁºñËØëÁÆÄÂçïÁöÑÊ®°Âùó./configure --prefix=/usr/local/nginx/ --with-http_ssl_module --with-http_stub_status_module --with-http_stub_status_modulemake -j4make install# ÈÄöËøáÂêØÂä®ËÑöÊú¨ÂêØÂä®chmod +x /etc/init.d/nginxservice nginx start# ÂºÄÊú∫ÂêØÂä®chkconfig nginx on nginx ÂêØÂä®ËÑöÊú¨ /etc/init.d/nginx12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576#!/bin/bash# nginx Startup script for the Nginx HTTP Server# it is v.0.0.2 version.# chkconfig: - 85 15# description: Nginx is a high-performance web and proxy server.# It has a lot of features, but it's not for everyone.# processname: nginx# pidfile: /var/run/nginx.pid# config: /usr/local/nginx/conf/nginx.confnginx=/usr/local/nginx/sbin/nginxnginx_config=/usr/local/nginx/conf/nginx.confnginx_pid=/var/run/nginx.pidRETVAL=0prog="nginx"# Source function library.. /etc/rc.d/init.d/functions# Source networking configuration.. /etc/sysconfig/network# Check that networking is up.[ $&#123;NETWORKING&#125; = "no" ] &amp;&amp; exit 0[ -x $nginx ] || exit 0# Start nginx daemons functions.start() &#123;if [ -e $nginx_pid ];then echo "nginx already running...." exit 1fi echo -n $"Starting $prog: " daemon $nginx -c $&#123;nginx_config&#125; RETVAL=$? echo [ $RETVAL = 0 ] &amp;&amp; touch /var/lock/subsys/nginx return $RETVAL&#125;# Stop nginx daemons functions.stop() &#123; echo -n $"Stopping $prog: " killproc $nginx RETVAL=$? echo [ $RETVAL = 0 ] &amp;&amp; rm -f /var/lock/subsys/nginx /usr/local//nginx/logs/nginx.pid&#125;reload() &#123; echo -n $"Reloading $prog: " #kill -HUP `cat $&#123;nginx_pid&#125;` killproc $nginx -HUP RETVAL=$? echo&#125;# See how we were called.case "$1" instart) start ;;stop) stop ;;reload) reload ;;restart) stop start ;;status) status $prog RETVAL=$? ;;*) echo $"Usage: $prog &#123;start|stop|restart|reload|status|help&#125;" exit 1esacexit $RETVAL nginx.confÁÆÄÂçïÈÖçÁΩÆ12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394959697user nobody nobody;worker_processes auto;worker_rlimit_nofile 102400;pid /var/run/nginx.pid;events &#123; use epoll; worker_connections 102400;&#125;http &#123; log_format main '$remote_addr - $remote_user [$time_local] "$request" ' '$status $body_bytes_sent "$http_referer" ' '"$http_user_agent" "$http_x_forwarded_for"'; ###ÂÆö‰πâ‰∏Ä‰∏™log_format log_format main '[ $host $request_time $upstream_addr $upstream_response_time ] ' '$status ' '$remote_addr - $remote_user [$time_local] "$request" ' '$body_bytes_sent "$http_referer" "$http_user_agent" "$http_x_forwarded_for " "$bytes_sent" " $request_body"' ; ###Êó•ÂøóÁõÆÂΩïÈÖçÁΩÆ #Êó•ÂøóÂÖ®ÈÉ®ÂÜôÂÖ•/nginx_logs/access.log Êñá‰ª∂‰∏≠„ÄÇÂÖ≥Èó≠ÊúÄÂêé‰∏§‰∏™server_nameÁöÑÊó•Âøó access_log /data/nginx_logs/access.log server_name_main; error_log /data/nginx_logs/error.log notice; ###ÊùÇÈ°πÈÖçÁΩÆ charset utf-8; #server nameÁöÑhashË°®Ôºå server_names_hash_bucket_size 128; #ËØ∑Ê±ÇÂ§¥Â¶ÇÊûúËøáÂ∞èÔºåÈÇ£‰πà‰ºöÂºïËµ∑400ÈîôËØØ„ÄÇ‰∏ÄËà¨Â¶ÇÊûúcookieËøáÂ§ßÔºå‰ºöÂºïËµ∑ÈóÆÈ¢ò„ÄÇgetconf PAGESIZEÁ≥ªÁªüÂàÜÈ°µ client_header_buffer_size 8k; client_body_buffer_size 512k; large_client_header_buffers 16 16k; client_max_body_size 30m; sendfile on; tcp_nopush on; keepalive_timeout 60; tcp_nodelay on; #fastcgiÈÄöÁî®ÈÖçÁΩÆ fastcgi_connect_timeout 600; fastcgi_send_timeout 600; fastcgi_read_timeout 600; fastcgi_buffer_size 128k; fastcgi_buffers 8 256k; fastcgi_busy_buffers_size 256k; fastcgi_temp_file_write_size 256k; ###‰ª£ÁêÜÊúâÂÖ≥ÁöÑÈÖçÁΩÆ proxy_connect_timeout 600; proxy_read_timeout 600; proxy_send_timeout 600; proxy_buffer_size 512k; proxy_buffers 6 512k; proxy_busy_buffers_size 512k; proxy_temp_file_write_size 512k; #ÊàñËÆ∏Âú®‰∫éÊµãËØï,‰ª£ÁêÜÊúçÂä°Âô®‰∏ç‰∏ªÂä®ÂÖ≥Èó≠ÂÆ¢Êà∑Á´ØÔºåÈò≤Ê≠¢499ÈîôËØØ proxy_ignore_client_abort on; ###gzipÈÖçÁΩÆ gzip on; gzip_min_length 1k; gzip_buffers 4 16k; gzip_http_version 1.0; gzip_comp_level 2; gzip_types text/plain application/x-javascript text/css application/xml; gzip_vary on; include /usr/local/nginx/conf/mime.types; default_type application/octet-stream; # ÈöêËóènginxÁâàÊú¨‰ø°ÊÅØ server_tokens off; server &#123; listen 80 default_server; server_name _; #server_name localhost; index index.html index.htm; root html; deny all; location / &#123; &#125; error_page 500 502 503 504 /50x.html; location = /50x.html &#123; root html; &#125; &#125;&#125; centos6ÁºñËØëÂÆâË£Öphp712345678910111213141516# È¶ñÂÖàÂÆâË£Öfreetype2.4tar -xvf freetype-2.4.0.tar.gzcd freetype-2.4.0./configure --prefix=/usr/local/freetypemake -j4 &amp;&amp; make install# ÁºñËØëphp7(‰∏çÈúÄË¶ÅÁöÑÂèØ‰ª•ÂéªÊéâ)tar -xvf php-7.2.2.tar.gzcd php-7.2.2./configure --prefix=/usr/local/php --with-libxml-dir=/usr/ --with-pdo-mysql=mysqlnd --with-zlib --with-libxml-dir --with-openssl --enable-mysqlnd --enable-mbstring --with-config-file-path=/usr/local/php/etc/ --with-config-file-scan-dir=/usr/local/php/etc/conf.d --enable-fpm --with-freetype-dir=/usr/local/freetype --with-jpeg-dir --with-png-dir --with-gd --enable-gd-native-ttf --enable-pdo --enable-mbstring --enable-bcmathmake -j 4 &amp;&amp; make install# ÂÆâË£Öcomposercurl -sS https://getcomposer.org/installer | php &amp;&amp; mv composer.phar /usr/bin/composer ÈÖçÁΩÆ1234567891011# php.iniÈÖçÁΩÆ(ÂÖ∑‰ΩìÈÖçÁΩÆÂÜÖÂÆπËá™Ë°å‰øÆÊîπ)cp php.ini-production /usr/local/php7/etc/php.inicp /usr/local/php7/etc/php-fpm.conf.default /usr/local/php7/etc/php-fpm.confcp /usr/local/php7/etc/php-fpm.d/www.conf.default /usr/local/php7/etc/php-fpm.d/www.conf# ÂêØÂä®ËÑöÊú¨cp ./sapi/fpm/init.d.php-fpm /etc/init.d/php-fpmchmod +x /etc/init.d/php-fpm# ÂàõÂª∫linkln -s /usr/local/php7 /usr/local/php ÂêØÂä®php-fpm12service php-fpm startchkconfig php-fpm on]]></content>
      <categories>
        <category>ÊäÄÊúØÊñáÊ°£</category>
        <category>nginx</category>
      </categories>
      <tags>
        <tag>nginx</tag>
        <tag>php7</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[linuxÈÅáÂà∞‰∏Ä‰∫õÈóÆÈ¢òÁªüËÆ°ÊÄªÁªì]]></title>
    <url>%2F2019%2F09%2F26%2F9-linux%E9%81%87%E5%88%B0%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98%E7%BB%9F%E8%AE%A1%E6%80%BB%E7%BB%93%2F</url>
    <content type="text"><![CDATA[ËÆ∞ÂΩï‰∏Ä‰∫õLinux,nginxÊàñÂÖ∂‰ªñÊúçÂä°‰∏Ä‰∫õÈóÆÈ¢ò linuxÈóÆÈ¢ò: tcpdumpÊäìÂåÖtcpÁ¨¨‰∏âÊ¨°Êè°Êâãack‰∏∫1 ÊâßË°åÂëΩ‰ª§ÁõëÂê¨: tcpdump -n port 80 (ÊÉ≥Ë¶ÅËØ¶ÁªÜ‰ø°ÊÅØÂä† -vv) ÂÆ¢Êà∑Á´Ø telnet x.x.x.x 80 Êó•ÂøóÂ¶Ç‰∏ã: 123456tcpdump -n port 80tcpdump: verbose output suppressed, use -v or -vv for full protocol decodelistening on enp0s3, link-type EN10MB (Ethernet), capture size 262144 bytes11:16:40.689157 IP 172.16.54.141.53444 &gt; 172.16.53.106.http: Flags [SEW], seq 1306124348, win 65535, options [mss 1460,nop,wscale 5,nop,nop,TS val 458678777 ecr 0,sackOK,eol], length 011:16:40.689724 IP 172.16.53.106.http &gt; 172.16.54.141.53444: Flags [S.E], seq 1553518959, ack 1306124349, win 64308, options [mss 1410,sackOK,TS val 4208119240 ecr 458678777,nop,wscale 7], length 011:16:40.690320 IP 172.16.54.141.53444 &gt; 172.16.53.106.http: Flags [.], ack 1, win 4106, options [nop,nop,TS val 458678778 ecr 4208119240], length 0 ËøôÈáåÁ¨¨‰∏ÄÂíåÁ¨¨‰∫åÊ¨°Êè°ÊâãÈÉΩÊ≤°ÊúâÈóÆÈ¢ò, Á¨¨‰∏âÊ¨° ack 1, Âπ∂ÈùûÊòØseq+1 ËøôÈáåÊèê‰∏Ä‰∏ãACK, ACK ÊòØÁ°ÆËÆ§ÂÄº, ack ÊòØÁ°ÆËÆ§ÁºñÂè∑, Á¨¨‰∏ÄÊ¨°Êè°ÊâãACK=0,Âú®Á¨¨‰∫åÊ¨°Êè°ÊâãÂºÄÂßãACK=1, ËÄåackÊòØ=seq+1(Êî∂Âà∞ÁöÑÈöèÊú∫Êï∞+1) ÈÇ£‰πàËøôÈáåack 1 ÊòØÂï•Âë¢? ‚Ä¶ Â∫îËØ•Â∞±ÊòØÈªòËÆ§tcpdump ÊòæÁ§∫ÊàêÁõ∏ÂØπÂÄº‰∫Ü, ÈÄöËøá-S ÂèÇÊï∞‰ºöÊòæÁ§∫ÁªùÂØπÂÄº ÊâßË°åÂëΩ‰ª§ÁõëÂê¨: tcpdump -S -n port 8012345tcpdump: verbose output suppressed, use -v or -vv for full protocol decodelistening on enp0s3, link-type EN10MB (Ethernet), capture size 262144 bytes11:16:54.806628 IP 172.16.54.141.53516 &gt; 172.16.53.106.http: Flags [S], seq 316359286, win 65535, options [mss 1460,nop,wscale 5,nop,nop,TS val 458692791 ecr 0,sackOK,eol], length 011:16:54.806861 IP 172.16.53.106.http &gt; 172.16.54.141.53516: Flags [S.], seq 1113466641, ack 316359287, win 64308, options [mss 1410,sackOK,TS val 4208133357 ecr 458692791,nop,wscale 7], length 011:16:54.807576 IP 172.16.54.141.53516 &gt; 172.16.53.106.http: Flags [.], ack 1113466642, win 4106, options [nop,nop,TS val 458692792 ecr 4208133357], length 0 ‰∏âÊ¨°Êè°ÊâãÂõæ ÂõõÊ¨°Êå•ÊâãÂõæ linuxÈóÆÈ¢ò: Á¶Åping12345678# ‰∏ÄÊ¨°ÊÄß‰øÆÊîπecho 1 &gt; /proc/sys/net/ipv4/icmp_echo_ignore_all# ÂºÄÊú∫Ëá™Âä®‰øÆÊîπecho 1 &gt; /proc/sys/net/ipv4/icmp_echo_ignore_all# Ê∞∏‰πÖÁ¶ÅÁî®,Âä†ÂÖ•Âà∞/etc/sysctl.confnet.ipv4.icmp_echo_ignore_all=1 linuxÈóÆÈ¢ò: Êñá‰ª∂ÈîÅÈóÆÈ¢ò1234567ÈóÆÈ¢òÊèèËø∞: php slowlog Âá∫Áé∞session_start() ÊÖ¢ÈóÆÈ¢òÂéüÂõ†: Êàë‰ª¨ËøôËæπÊúâA ÂíåB ‰∏§‰∏™‰∫åÁ∫ßÂüüÂêç,A ‰ºöËØ∑Ê±Ç B, Âπ∂‰∏îÁî±‰∫éÊµãËØïÁéØÂ¢ÉÂú®Âêå‰∏ÄÂè∞ÊúçÂä°Âô®,ÂÖ¨Áî®‰∏Ä‰∏™php,ÊâÄ‰ª•Âú®ÂèëÁîüË∞ÉÁî®ÁöÑÊó∂ÂÄôÂêåÊó∂ÂÜô‰∫Üsession,ËÄåphpÁöÑsessionsÈÖçÁΩÆÊòØÈªòËÆ§ÁöÑfileÊñπÂºè, ËøôÂ∞±ÈÄ†Êàê‰∫ÜÈîÅÁöÑÈóÆÈ¢òÈóÆÈ¢òËß£ÂÜ≥: 1. ‰øÆÊîπ‰ª£Á†ÅÈÉ®ÂàÜ2. phpÁöÑsessionÈÖçÁΩÆÊîπÊàêredis session.save_handler = redis session.save_path = "tcp://x.x.x.x:xxxx" linuxÈóÆÈ¢ò: ÂÜÖÂ≠òÈáäÊîæÈóÆÈ¢ò123456ÈóÆÈ¢òÊèèËø∞: ÂºÄÂèëËøôËæπÂÜô‰∫Ü‰∏™ÁªüËÆ°ËÑöÊú¨, Âç†Áî®49GÂÜÖÂ≠ò, ‰ªéÊó•ÂøóÂèëÁé∞ËÑöÊú¨Â∑≤ÁªèÂÖ®ÈÉ®ÊâßË°åÂÆåÊàê, ‰ΩÜÊòØphpËÑöÊú¨‰æùÁÑ∂Â≠òÂú®ÈóÆÈ¢òÂéüÂõ†: ÈÄöËøá strace -p pid ËßÇÂØüËøõÁ®ã, ÂèëÁé∞ÊòØÊåÅÁª≠ÊÄßÁöÑÂÅöÂÜÖÂ≠òÈáäÊîæÊìç‰Ωú munmap(0x7f6db77ad000, 266240) = 0ÊåÅÁª≠ÊâßË°åmunmapÂáΩÊï∞ÊòØÂõ†‰∏∫‰∏ÄÁõ¥Âú®ÈáäÊîæÂÜÖÂ≠ò(ÊØïÁ´ü49G), ÁªìÊûú =0 ËØ¥ÊòéÂÜÖÂ≠òÈáäÊîæÊâßË°åÂáΩÊï∞ÊòØËøîÂõûÊ≠£Â∏∏‰∫ÜÈóÆÈ¢òËß£ÂÜ≥: 1. ‰øÆÊîπ‰ª£Á†ÅÈôç‰ΩéÂÜÖÂ≠ò2. Á≠âÂæÖ‰∏ÄÊÆµÊó∂Èó¥ÂÜÖÂ≠ò‰ºöÈáäÊîæÂÆåÊàê(ÊµãËØï80ÂàÜÈíüÈáäÊîæÂÆåÊØï) nginxÈóÆÈ¢ò: ÈùôÊÄÅÊñá‰ª∂ÂàÜÁ¶ªÂØπ‰∫é‰∏ÄËà¨ÁöÑnginx+phpÁöÑÊñπÂºè, Êàë‰ª¨phpÈááÁî®nobodyÁî®Êà∑,ËÄå‰ª£Á†Å/lumenÈááÁî®web-wwwÁî®Êà∑, ËøôÊ†∑ÁöÑÂ•ΩÂ§ÑÊòØÈ°µÈù¢ËÆøÈóÆÂà∞/lumenÊó∂ÊòØnobodyÁî®Êà∑, ÊòØÊó†Ê≥ï‰øÆÊîπ‰ª£Á†ÅÁöÑ ÂèØËÉΩÊàë‰ª¨ÈúÄÊ±ÇÊòØ‰∏äÁî®Êà∑uploadÂõæÁâáÁ≠â, ËøôÊó∂ÂÄôÂ∞±ÂèØËÉΩË¢´‰º†‰∏äÊüê‰∏™a.php, ËøôÂ∞±ÊúâÂèØËÉΩË¢´‰ª£Á†ÅÊ≥®ÂÖ•(‰∏ÄËà¨Êù•ËØ¥ÂõæÁâáÊòØÊîæcdn,ÈÖçÁΩÆÂçïÁã¨ÂüüÂêçÂõûÊ∫êÁöÑ,ËøôÈáåÊòØÁõ¥Êé•Â≠òÂú®È°πÁõÆÁõÆÂΩï) ÊâÄ‰ª•‰∏∫‰∫ÜÈò≤Ê≠¢‰ª£Á†ÅÊ≥®ÂÖ•,Êàë‰ª¨ÈúÄË¶ÅÈôêÂà∂uploadÁõÆÂΩïÁöÑËÆøÈóÆÊùÉÈôê 1234# nginxÈÖçÁΩÆÂ¶Ç‰∏ã location ~ /images/.*\.(gif|jpg|jpeg|png)$ &#123; root /lumen/storage/uploads/; &#125; ËøôÊ†∑Êàë‰ª¨ÂõæÁâá‰º†Âà∞ /lumen/storage/uploads/images/ ÁõÆÂΩï, ËÆøÈóÆÊòØ www.xxx.com/images/x.png Êù•ËÆøÈóÆ ‰∏î‰∏çÂÖÅËÆ∏ÂÖ∂‰ªñÁ±ªÂûãÊñá‰ª∂ËÆøÈóÆ. nginxÈóÆÈ¢ò: root ÂíåaliasÂú®ÈÖçÁΩÆÊñá‰ª∂Êò†Â∞ÑÁöÑÊó∂ÂÄôÔºåÂ¶ÇÊûú‰ΩøÁî®‰∫ÜÊ≠£ÂàôË°®ËææÂºèÔºåÈÇ£‰πàÂèØËÉΩ‰ºöÂá∫Áé∞Êó†Ê≥ïËÆøÈóÆÊñá‰ª∂ÔºånginxÂèØËÉΩ‰ºöÂ∞ÜÊâÄÊúâÁöÑÊñá‰ª∂ÈÉΩÊò†Â∞ÑÊàê‰∏∫Êñá‰ª∂Â§πÔºåÂØºËá¥Êñá‰ª∂Êò†Â∞ÑÂ§±Ë¥•ÁöÑÊÉÖÂÜµÂá∫Áé∞Ôºõ rootÁöÑ‰æãÂ≠ê 1234location /a/ &#123; root /lumen/public;&#125;ËøôÈáåÂÆûÈôÖËÆøÈóÆÁöÑË∑ØÂæÑ: www.xxx.com/a/ -&gt; /lumen/public/a/ aliasÁöÑ‰æãÂ≠ê 12345# Ê≥®ÊÑèËøôÈáåÁõÆÂΩïÊúÄÂêéÂä†‰∏ä/location /a/ &#123; alias /lumen/public/;&#125;ËøôÈáåÂÆûÈôÖËÆøÈóÆÁöÑË∑ØÂæÑ: www.xxx.com/a/ -&gt; /lumen/public/ nginxÈóÆÈ¢ò: ÈöêËóèÁâàÊú¨‰ø°ÊÅØ123Syntax: server_tokens on | off | build | string;Default: server_tokens on;Context: http, server, location nginxÈóÆÈ¢ò: Êó•ÂøóÂá∫Áé∞encodeÂÜÖÂÆπÂ¶Ç‰ΩïÊü•Áúã12# python2 ÊâßË°ådecode&gt;&gt;&gt; print "\x22content\x22\x0D\x0A\x0D\x0A\xE8\x8A\x8A\xE8\x8A\x8A\xE8\xBF\x98\xE6\x80\x95\xE5\xA6\x9E\xE5\xA6\x9E\xE4\xB8\x8D\xE8\x80\x81\xE5\xAE\x9E\xEF\xBC\x8C\xE7\x89\xB9\xE5\x9C\xB0\xE8\xBF\x87\xE6\x9D\xA5\xE8\xA7\x86\xE5\xAF\x9F\xE4\xB8\x80\xE4\xB8\x8B\x0D\x0A".decode('utf-8') nginxÈóÆÈ¢ò: defaultÈÖçÁΩÆÊú™ËÆæÁΩÆnginx Êú™ËÆæÁΩÆdefaultÊó∂, Â¶ÇÊûúÁõ¥Êé•ËÆøÈóÆÊúçÂä°Âô®Â§ñÁΩëip, ‰ºöÂéªËØ∑Ê±ÇÂà∞Á¨¨‰∏Ä‰∏™ÂåπÈÖçÁöÑserverÊÆµ, ÊúâÂèØËÉΩ‰ºöËØ∑Ê±ÇÂà∞ÂêéÁ´ØÁöÑÊúçÂä°Âô®ÁöÑÂÜÖÂÆπ, ËøôÂæàÊúâÂèØËÉΩÊö¥Èú≤Êàë‰ª¨‰∏çÊÉ≥Êö¥Èú≤ÁöÑÊúçÂä°‰∏ÄËà¨Êù•ËØ¥ÂºÄÂ§¥Ê∑ªÂä†Â¶Ç‰∏ãÈÖçÁΩÆ 123456 server &#123; listen 80 default_server; listen [::]:80 default_server; server_name _; deny all;&#125; nginx ÈÖçÁΩÆÂ∑≤ÁªèÈÖçÁΩÆÂüüÂêçÊñπÂºèËÆøÈóÆ, Â¶ÇÊûúËÆøÈóÆip‰ºöËøîÂõû403, Ê≠£Â∏∏Êù•ËØ¥ËøîÂõû403Â∑≤Áªè‰∏ç‰ºöÂØπÊúçÂä°Âô®ÈÄ†ÊàêÂéãÂäõ‰∫Ü ÂèØÊòØ‰∏á‰∏áÊ≤°ÊÉ≥Âà∞ËôΩÁÑ∂ËøîÂõû‰∫Ü403, ‰ΩÜÊòØ‰πüÊúâ700Â≠óËäÇÂ§ßÂ∞è, Â§ßÈáèËØ∑Ê±ÇÂØπÂ∞èÂ∏¶ÂÆΩÊù•ËØ¥ËøòÊòØÊúâÂéãÂäõÁöÑ 123456789101112# server &#123; listen 80 default_server; listen [::]:80 default_server; server_name _; return 499; &#125;#ÂÖ∂‰ªñlocation,ifÈÖçÁΩÆ,if ($host != a.example.com) &#123; return 499;&#125; nginx1.11‰ª•Ââçtrace_id ÁîüÊàêÈóÆÈ¢ò Â¶ÇÊûúÊòØÂâçÁ´Ø(upstream) 123456789101112131415161718log_format server_name_main '"$request_trace_id" [ $host $request_time ] ' '[ $upstream_addr $upstream_response_time ] ' '$status ' '$remote_addr - $remote_user [$time_local] "$request" ' '$body_bytes_sent "$http_referer" ' '"$http_user_agent" "$http_x_forwarded_for" "$bytes_sent"' '&#123;$request_body&#125;' ;...server &#123; set $request_trace_id $pid$connection$bytes_sent$msec; if ( $http_x_request_id != "" )&#123; set $request_trace_id $http_x_request_id; &#125; add_header Bq_F_Traceid $request_trace_id; # ‰∏ÄÂÆöË¶ÅÂÜôÂà∞location‰∏≠, Âõ†‰∏∫proxy_pass location / &#123; proxy_pass http://xxxx; proxy_set_header X-Request-Id $request_trace_id; &#125;&#125; Â¶ÇÊûúÊòØÂêéÁ´ØËäÇÁÇπ 12345678910111213141516171819# ‰∏ÄÂÆöË¶ÅÂÜôÂà∞serverÊÆµ, Âê¶ÂàôÂêéÁ´ØÂèØËÉΩÊä•404ÈîôËØØserver &#123; listen 80; server_name openapi-community-alpha.boqii.com ; set $request_trace_id trace-id-$pid-$connection-$bytes_sent-$msec; # Â¶ÇÊûúËØ∑Ê±ÇÂ§¥‰∏≠Â∑≤ÊúâËØ•ÂèÇÊï∞,ÂàôËé∑ÂèñÂç≥ÂèØ;Â¶ÇÊûúÊ≤°Êúâ,Âàô‰ΩøÁî®$request_idËøõË°åÂ°´ÂÖÖ set $temp_request_id $http_x_request_id; if ($temp_request_id = "") &#123; set $temp_request_id $request_trace_id; &#125; # Â±èËîΩÊéâÂéüÊù•ÁöÑËØ∑Ê±ÇÂ§¥ÂèÇÊï∞ # proxy_set_header x_request_id ""; proxy_set_header X-Request-Id ""; # ËÆæÁΩÆÂêëÂêéËΩ¨ÂèëÁöÑËØ∑Ê±ÇÂ§¥ÂèÇÊï∞ proxy_set_header X-Request-Id $temp_request_id; location / &#123; try_files $uri $uri/ /index.php?$query_string; &#125;&#125; ‰øÆÊîπswap123456789dd if=/dev/zero of=/data/swapfilenew bs=4096 count=4096000swapoff -a /sbin/mkswap /data/swapfilenew/sbin/swapon /data/swapfilenewvim /etc/fstab/data/swapfilenew none swap defaults 0 0]]></content>
      <categories>
        <category>ÊäÄÊúØÊñáÊ°£</category>
        <category>linux</category>
        <category>ÈóÆÈ¢òÊÄªÁªì</category>
      </categories>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[mysql5.7‰∫åËøõÂà∂ÈÉ®ÁΩ≤]]></title>
    <url>%2F2019%2F09%2F26%2F8-mysql5-7%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%83%A8%E7%BD%B2%2F</url>
    <content type="text"><![CDATA[‰∫åËøõÂà∂ÊñπÂºèÈÉ®ÁΩ≤mysql5.7 ‰∏ãËΩΩglibc‰∫åËøõÂà∂ÂåÖ12345#ÊâìÂºÄ‰∏ãËΩΩÈ°µÈù¢, ÂèØËÉΩ‰ºöÊúâÂ∞èÁâàÊú¨Êõ¥Êñ∞(Ê≥®ÊÑèÔºöÈÄâÊã©Êìç‰ΩúÁ≥ªÁªüÊó∂ÈÄâLinux-GenericÔºâhttps://dev.mysql.com/downloads/mysql/5.7.html#downloads# ÊúÄÊñ∞ÁöÑÂèØËÉΩÊúâÂ∞èÁâàÊú¨ÂèòÂåñwget https://cdn.mysql.com/Downloads/MySQL-5.7/mysql-5.7.24-linux-glibc2.12-x86_64.tar.gz ÂÆâË£ÖÈÖçÁΩÆ1234567891011121314151617181920212223242526272829303132333435363738394041tar -xvf mysql-5.7.24-linux-glibc2.12-x86_64.tar.gzmv mysql-5.7.24-linux-glibc2.12-x86_64 /usr/local/cd /usr/local/# ÊàëÁöÑÈïúÂÉèÊòØÂÆâË£ÖËøá5.5mysql, ÊâÄ‰ª•ÈúÄË¶Åmv‰∏Ä‰∏ãmv mysql mysql-5.5.37# Áî±‰∫é‰ª•ÂâçÂÆâË£ÖËøáphpÊåáÂÆö‰∫ÜËØ•mysqÁõÆÂΩï, ËøôÂèØËÉΩÂØºËá¥‰ª•ÂâçÂÆâË£ÖÁöÑphpÁº∫Â∞ëlibmysqlclient.so.18ln -s /usr/local/mysql-5.5.37/lib/libmysqlclient.so.18 /usr/local/mysql-5.7.24-linux-glibc2.12-x86_64/lib/libmysqlclient.so.18ln -s mysql-5.7.24-linux-glibc2.12-x86_64 mysql# Ê∑ªÂä†ÂêØÂä®Êñá‰ª∂\cp mysql/support-files/mysql.server /etc/init.d/mysqldecho "PATH=$PATH:/usr/local/mysql/bin/" &gt;&gt;~/.bashrc# ÂèØÈÄâwget http://centos.mirrors.ucloud.cn/centos/6/os/x86_64/Packages/numactl-2.0.9-2.el6.x86_64.rpmyum localinstall numactl-2.0.9-2.el6.x86_64.rpm\rm numactl-2.0.9-2.el6.x86_64.rpmuseradd mysql# ÈÖçÁΩÆ‰∏ãmysqlÁöÑÊï∞ÊçÆÁõÆÂΩïcd /data/mkdir u01mkdir u02chown -R mysql.mysql u01chown -R mysql.mysql u02chmod 750 u01chmod 750 u02cd /data/u01/# ÂàùÂßãÂåñ/usr/local/mysql/bin/mysqld --initialize-insecure --user=mysql --basedir=/usr/local/mysql --datadir=/data/u01cat auto.cnf# ÂêØÂä®ÊúçÂä° (Âú®Ëøô‰πãÂâçÂáÜÂ§áÂ•Ω /etc/my.cnf)/etc/init.d/mysqld start# ËÆ∞ÂΩï‰∏ãvariablesmysql -e "show global variables" &gt;mysql_option_default.log my.cnf123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172[client]port = 3306socket = /data/u01/mysql.sock[mysql]prompt="\u@m1-u [\d]&gt; "no-auto-rehash[mysqld]user = mysqlport = 3306basedir = /usr/local/mysqldatadir = /data/u01socket = /data/u01/mysql.sockpid-file = /data/u01/m1-u.pidtmpdir = /data/u02server-id = 1001character-set-server = utf8skip_name_resolve = 1innodb_file_per_table = 1explicit_defaults_for_timestamp = 0# buffer&amp;cachetable_open_cache = 100table_definition_cache = 400table_open_cache_instances = 64sort_buffer_size = 4Mjoin_buffer_size = 4Mread_buffer_size = 8Mread_rnd_buffer_size = 4M# thread&amp;connectionthread_stack = 256Kthread_cache_size = 768back_log = 1024max_connections = 3000max_connect_errors = 1000000# temptabletmp_table_size = 32Mmax_heap_table_size = 32M# networkmax_allowed_packet = 32M#lock_wait_timeout = 3600#interactive_timeout = 600#wait_timeout = 600# query cachequery_cache_size = 0query_cache_type = 0# ËÆæÁΩÆerrorlog„ÄÅslowlogÂíågenerallogÁöÑÊó∂Âå∫ÔºåÈªòËÆ§UTClog_timestamps = SYSTEM# error-loglog_error = /data/u02/mysqld.log# slow-logslow_query_log = 1slow_query_log_file = /data/u02/slow.loglong_query_time = 0.1log_queries_not_using_indexes =1log_throttle_queries_not_using_indexes = 60min_examined_row_limit = 100log_slow_admin_statements = 1log_slow_slave_statements = 1# general log#general-log = 1general_log_file=/data/u02/query.log# binlogbinlog_format = rowbinlog_checksum = 1log-bin = /data/u02/bdm1-binlog-bin-index = /data/u02/bdm1-bin.indexsync_binlog = 0binlog_cache_size = 4Mmax_binlog_cache_size = 2Gmax_binlog_size = 512Mexpire_logs_days = 15# GTIDgtid_mode = onenforce_gtid_consistency = 1log_slave_updates# Replicationmaster_info_repository = TABLErelay_log_info_repository = TABLEslave-rows-search-algorithms = 'INDEX_SCAN,HASH_SCAN'relay_log_recovery = 1relay_log_purge = 1relay-log=/data/u02/bdm1-relay-binrelay-log-index=/data/u02/bdm1-relay-bin.index# innodb-buffer&amp;cacheinnodb_buffer_pool_size = 2Ginnodb_buffer_pool_instances = 4#innodb_additional_mem_pool_size = 16Minnodb_max_dirty_pages_pct = 50# innodb loginnodb_data_file_path = ibdata1:1G:autoextendinnodb_log_file_size = 1Ginnodb_log_files_in_group = 2innodb_flush_log_at_trx_commit = 2innodb_log_buffer_size = 32M#innodb_max_undo_log_size = 4G#innodb_undo_directory = undologinnodb_undo_tablespaces = 4# innodb-ioinnodb_flush_method = O_DIRECTinnodb_io_capacity = 600innodb_io_capacity_max = 2000innodb_flush_sync = 0innodb_flush_neighbors = 0#innodb_lru_scan_depth = 4000innodb_write_io_threads = 8innodb_read_io_threads = 8innodb_purge_threads = 4innodb_page_cleaners = 4# transaction,lock#innodb_sync_spin_loops = 100#innodb_spin_wait_delay = 30innodb_lock_wait_timeout = 10innodb_print_all_deadlocks = 1innodb_rollback_on_timeout = 1innodb_open_files = 65535innodb_online_alter_log_max_size = 2G# innodb statusinnodb_status_file = 1# Ê≥®ÊÑè: ÂºÄÂêØ innodb_status_output &amp; innodb_status_output_locks Âêé, ÂèØËÉΩ‰ºöÂØºËá¥log-errorÊñá‰ª∂Â¢ûÈïøËæÉÂø´innodb_status_output = 0innodb_status_output_locks = 0#performance_schemaperformance_schema = 1performance_schema_instrument = '%=on'#innodb monitorinnodb_monitor_enable="module_innodb"innodb_monitor_enable="module_server"innodb_monitor_enable="module_dml"innodb_monitor_enable="module_ddl"innodb_monitor_enable="module_trx"innodb_monitor_enable="module_os"innodb_monitor_enable="module_purge"innodb_monitor_enable="module_log"innodb_monitor_enable="module_lock"innodb_monitor_enable="module_buffer"innodb_monitor_enable="module_index"innodb_monitor_enable="module_ibuf_system"innodb_monitor_enable="module_buffer_page"innodb_monitor_enable="module_adaptive_hash"# MyISAMkey_buffer_size = 1024Mbulk_insert_buffer_size = 64Mmyisam_sort_buffer_size = 128Mmyisam_repair_threads = 1[mysqldump]quickmax_allowed_packet = 32M]]></content>
      <categories>
        <category>ÊäÄÊúØÊñáÊ°£</category>
        <category>mysql</category>
      </categories>
      <tags>
        <tag>mysql</tag>
        <tag>mysql5.7</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[k8sÈÉ®ÁΩ≤storageclassÂä®ÊÄÅÂàõÂª∫pv(nfs&rbd)]]></title>
    <url>%2F2019%2F09%2F26%2F7-k8s%E9%83%A8%E7%BD%B2storageclass%E5%8A%A8%E6%80%81%E5%88%9B%E5%BB%BApv-nfs-rbd%2F</url>
    <content type="text"><![CDATA[ËÄÉËôëÂà∞k8sÂ≠òÂÇ®ÁöÑÈóÆÈ¢ò, Êú¨Êú∫ÁõÆÂΩïÊåÇËΩΩÂ≠òÂú®Â§™Â§ßÂ±ÄÈôêÊÄß, Â§önodeÂ§öpodÁöÑÊúçÂä°Â≠òÂÇ®ÊÄ•Ëø´ÈúÄË¶ÅÂÖ±‰∫´Â≠òÂÇ®, ËøôÈáåÁÆÄÂçïÂ∫îÁî®k8s storageclass nfsÂíårbdÂ≠òÂÇ® Á¨¨‰∏ÄÈÉ®ÂàÜ nfsËøôÈáåÂçïËäÇÁÇπÁÆÄÂçïÈÖçÁΩÆnfs(È´òÂπ∂ÂèëÂèØÈááÁî®nfs+rsync+inotifyÊàñSersync) È´òÂπ∂ÂèëÂèÇËÄÉ NFSÈ´òÂèØÁî®(NFS+keepalive+Sersync)inotify+rsyncÂÆûÊó∂Â§á‰ªΩÊÄªÁªì 12345678910#ÂÆâË£Önfsyum install -y nfs-utils rpcbind# ÂàõÂª∫ÁõÆÂΩïmkdir /data/nfsecho "/data/nfs 172.16.76.0/24(rw,sync,no_root_squash) " &gt;&gt;/etc/exports# ÂêØÂä®ÊúçÂä°systemctl start rpcbindsystemctl start nfs k8sÈÉ®ÁΩ≤storageclassÁéØÂ¢É-nfsÂØºÂÖ•Â§ñÈÉ®ÈÖçÁΩÆ12345git clone https://github.com/kubernetes-incubator/external-storage.gitcd external-storage/nfs-client/deploy#Ê≥®ÊÑè1 nodeËäÇÁÇπÈúÄË¶ÅÂÆâË£Önfs-utils(centos7),nfs-common(ubuntu) ‰øÆÊîπdeployment.yaml12345678910111213141516171819202122232425262728293031323334353637apiVersion: v1kind: ServiceAccountmetadata: name: nfs-client-provisioner---kind: DeploymentapiVersion: extensions/v1beta1metadata: name: nfs-client-provisionerspec: replicas: 1 strategy: type: Recreate template: metadata: labels: app: nfs-client-provisioner spec: serviceAccountName: nfs-client-provisioner containers: - name: nfs-client-provisioner image: quay.io/external_storage/nfs-client-provisioner:latest volumeMounts: - name: nfs-client-root mountPath: /persistentvolumes env: - name: PROVISIONER_NAME value: nfs.com/nfs - name: NFS_SERVER value: 172.16.76.134 - name: NFS_PATH value: /data/nfs volumes: - name: nfs-client-root nfs: server: 172.16.76.134 path: /data/nfs ‰øÆÊîπclass.yaml1234567apiVersion: storage.k8s.io/v1kind: StorageClassmetadata: name: nfsprovisioner: nfs.com/nfsparameters: archiveOnDelete: "false" rbac.yaml‰∏çÁî®‰øÆÊîπ1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859rbac.yamlkind: ServiceAccountapiVersion: v1metadata: name: nfs-client-provisioner---kind: ClusterRoleapiVersion: rbac.authorization.k8s.io/v1metadata: name: nfs-client-provisioner-runnerrules: - apiGroups: [""] resources: ["persistentvolumes"] verbs: ["get", "list", "watch", "create", "delete"] - apiGroups: [""] resources: ["persistentvolumeclaims"] verbs: ["get", "list", "watch", "update"] - apiGroups: ["storage.k8s.io"] resources: ["storageclasses"] verbs: ["get", "list", "watch"] - apiGroups: [""] resources: ["events"] verbs: ["create", "update", "patch"]---kind: ClusterRoleBindingapiVersion: rbac.authorization.k8s.io/v1metadata: name: run-nfs-client-provisionersubjects: - kind: ServiceAccount name: nfs-client-provisioner namespace: defaultroleRef: kind: ClusterRole name: nfs-client-provisioner-runner apiGroup: rbac.authorization.k8s.io---kind: RoleapiVersion: rbac.authorization.k8s.io/v1metadata: name: leader-locking-nfs-client-provisionerrules: - apiGroups: [""] resources: ["endpoints"] verbs: ["get", "list", "watch", "create", "update", "patch"]---kind: RoleBindingapiVersion: rbac.authorization.k8s.io/v1metadata: name: leader-locking-nfs-client-provisionersubjects: - kind: ServiceAccount name: nfs-client-provisioner # replace with namespace where provisioner is deployed namespace: defaultroleRef: kind: Role name: leader-locking-nfs-client-provisioner apiGroup: rbac.authorization.k8s.io ÈÉ®ÁΩ≤nfsÁéØÂ¢É(ÂàõÂª∫nfsÂ≠òÂÇ®Á±ª)1kubectl apply -f rbac.yaml -f class.yaml -f deployment.yaml k8s‰∏≠ÈÉ®ÁΩ≤nginxÈ°πÁõÆÈááÁî®nfsÂ≠òÂÇ®ÈÉ®ÁΩ≤nginx-deployment-nfs.yaml(ÊµãËØïnfs) ËøôÁßçÊñπÂºè‰ºöÂàõÂª∫‰∏Ä‰∏™pvc ÊåÇËΩΩÂà∞Â§ö‰∏™pod‰∏≠,ËøôÁßçÊñπÂºèÈÄÇÂêànginx-htmlÊåÇËΩΩ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465---kind: PersistentVolumeClaimapiVersion: v1metadata: name: html0-deploy-nfs annotations: volume.beta.kubernetes.io/storage-class: 'nfs'spec: accessModes: - ReadWriteMany resources: requests: storage: 1Gi---apiVersion: extensions/v1beta1kind: Deploymentmetadata: name: nginx0-deployspec: replicas: 2 template: metadata: labels: app: nginx0-deploy spec: containers: - name: nginx0-deploy image: hub.boqii.com/bq/nginx:1.15.12 ports: - containerPort: 80 volumeMounts: - name: html0-deploy-nfs mountPath: /usr/share/nginx/html - name: nginx-config mountPath: "/etc/nginx/conf.d" volumes: - name: nginx-config configMap: name: nginx-config - name: html0-deploy-nfs persistentVolumeClaim: claimName: html0-deploy-nfs---apiVersion: v1kind: ConfigMapmetadata: name: nginx-configdata: default.conf: | server &#123; listen 80; server_name localhost; root /usr/share/nginx/html/; access_log /var/log/nginx/host_access.log; error_log /var/log/nginx/host_error.log debug; location / &#123; root /usr/share/nginx/html/; index index.html index.htm index.php; &#125; error_page 500 502 503 504 /50x.html; location = /50x.html &#123; root /usr/share/nginx/html; &#125; &#125; ÈÉ®ÁΩ≤nginx-statefulset-nfs.yaml(ÊµãËØïnfs) ËøôÈáåstatefulset ÊñπÂºè‰ºöÂàõÂª∫Â§ö‰∏™pvc, ÊØè‰∏™podÁöÑhtmlÂ∞±ÂèØ‰ª•ÈÉΩ‰∏ç‰∏ÄÊ†∑! 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758---apiVersion: apps/v1beta1kind: StatefulSetmetadata: name: nginx3spec: serviceName: "nginx" replicas: 2 volumeClaimTemplates: - metadata: name: html annotations: volume.beta.kubernetes.io/storage-class: "nfs" # ËøôÈáåÈÖçÁΩÆ ‰∏äÈù¢ÂàõÂª∫ÁöÑ storageclass ÁöÑÂêçÁß∞ spec: accessModes: [ "ReadWriteOnce" ] resources: requests: storage: 2Gi template: metadata: labels: app: nginx spec: containers: - name: nginx image: hub.boqii.com/bq/nginx:1.15.12 volumeMounts: - mountPath: "/usr/share/nginx/html/" name: html - mountPath: "/etc/nginx/conf.d" name: nginx-config volumes: - name: nginx-config configMap: name: nginx-config---apiVersion: v1kind: ConfigMapmetadata: name: nginx-configdata: default.conf: | server &#123; listen 80; server_name localhost; root /usr/share/nginx/html/; access_log /var/log/nginx/host_access.log; error_log /var/log/nginx/host_error.log debug; location / &#123; root /usr/share/nginx/html/; index index.html index.htm index.php; &#125; error_page 500 502 503 504 /50x.html; location = /50x.html &#123; root /usr/share/nginx/html; &#125; &#125; Âè¶Â§ñËØ¥Êòé‰∏Ä‰∏ãÂ∞Ünfs‰Ωú‰∏∫Êñá‰ª∂Â≠òÂÇ®Á±ª‰ººmountÊñπÂºè,ËøôÁßçÊñπÂºè‰∏çÈÄÇÁî®‰∫éÂ§öÂÆπÂô®Ëá™Âä®ÂåñÈÉ®ÁΩ≤ ,ÊòæÁÑ∂ËøôÁßçÂπ∂‰∏çÈÄÇÂêàceph rbdÂ≠òÂÇ®, cephfsÊòØÂèØ‰ª•ÁöÑÈ¶ñÂÖàÈúÄË¶ÅÂú®nfsÁõÆÂΩïÂàõÂª∫ÈúÄË¶ÅÊåÇËΩΩÁöÑÁõÆÂΩï12#‰æãÂ¶Çmkdir -p /data/nfs/k8s-db-t/mysql-data-dev Âú®ÈÉ®ÁΩ≤ÁöÑyml‰∏≠Áõ¥Êé•mount nfsÁöÑÁõÆÂΩï1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859apiVersion: extensions/v1beta1kind: Deploymentmetadata: name: mysql-server namespace: devopsspec: replicas: 1 template: metadata: labels: app: mysql-server spec: containers: - image: mysql:5.7.16 imagePullPolicy: Always name: mysql-server ports: - containerPort: 3306 protocol: TCP volumeMounts: - name: mysql-data mountPath: /var/lib/mysql resources: requests: cpu: 40m memory: 32Mi limits: cpu: "300m" memory: 256Mi env: - name: MYSQL_ROOT_PASSWORD value: "boqii.123" - name: MYSQL_DATABASE value: "gogs" - name: MYSQL_USER value: "gogs" - name: MYSQL_PASSWORD value: "gogspass" - name: TZ value: "Asia/Shanghai" volumes: - name: mysql-data nfs: server: 172.16.76.134 path: /data/nfs/k8s-db-t/mysql-data-dev---apiVersion: v1kind: Servicemetadata: name: mysql-service namespace: devopsspec: clusterIP: None selector: app: mysql-server ports: - name: http port: 3306 Á¨¨‰∫åÈÉ®ÂàÜ cephk8sÈÉ®ÁΩ≤storageclassÁéØÂ¢É-cephÂ¶ÇÊûúÈõÜÁæ§ÊòØÁî®kubeadmÈÉ®ÁΩ≤ÁöÑÔºåÁî±‰∫écontroller-managerÂÆòÊñπÈïúÂÉè‰∏≠Ê≤°ÊúârbdÂëΩ‰ª§ÔºåÊâÄ‰ª•Êàë‰ª¨Ë¶ÅÂØºÂÖ•Â§ñÈÉ®ÈÖçÁΩÆ12git clone https://github.com/kubernetes-incubator/external-storage.gitcd external-storage/ceph/rbd/deploy ‰ª•‰∏ãÊï¥ÂêàÂú®‰∏Ä‰∏™Êñá‰ª∂, ‰∏§‰∏™ÁâàÊú¨,ÈªòËÆ§ Âíåretain storageclass-cepm.com-rbd.yaml123456789101112131415161718192021222324252627282930313233343536---apiVersion: v1data: key: QVFEYzJRbGQ1VjI5THhBQU00WUtPUU5sUVJqdWtLSWJ2VDZ0a3c9PQ==kind: Secretmetadata: name: ceph-secret-admintype: kubernetes.io/rbd---apiVersion: v1data: key: QVFEYzJRbGQ1VjI5THhBQU00WUtPUU5sUVJqdWtLSWJ2VDZ0a3c9PQ==kind: Secretmetadata: name: ceph-secret-admin namespace: ns-elastictype: kubernetes.io/rbd---apiVersion: storage.k8s.io/v1kind: StorageClassmetadata: name: rbd annotations: storageclass.kubernetes.io/is-default-class: "true"provisioner: ceph.com/rbdparameters: monitors: 172.16.76.134:6789 adminId: admin adminSecretName: ceph-secret-admin adminSecretNamespace: default pool: storageclass-rbd userId: admin userSecretName: ceph-secret-admin fsType: ext4 imageFormat: "2" imageFeatures: "layering" storageclass-cepm.com-rbd-retain.yaml12345678910111213141516171819202122232425262728293031323334353637---apiVersion: v1data: key: QVFEYzJRbGQ1VjI5THhBQU00WUtPUU5sUVJqdWtLSWJ2VDZ0a3c9PQ==kind: Secretmetadata: name: ceph-secret-admintype: kubernetes.io/rbd---apiVersion: v1data: key: QVFEYzJRbGQ1VjI5THhBQU00WUtPUU5sUVJqdWtLSWJ2VDZ0a3c9PQ==kind: Secretmetadata: name: ceph-secret-admin namespace: ns-elastictype: kubernetes.io/rbd---apiVersion: storage.k8s.io/v1kind: StorageClassmetadata: name: rbd-retain annotations: storageclass.kubernetes.io/is-default-class: "false"provisioner: ceph.com/rbdreclaimPolicy: Retainparameters: monitors: 172.16.76.134:6789 adminId: admin adminSecretName: ceph-secret-admin adminSecretNamespace: default pool: storageclass-rbd-retain userId: admin userSecretName: ceph-secret-admin fsType: ext4 imageFormat: "2" imageFeatures: "layering" k8s‰∏≠ÈÉ®ÁΩ≤nginxÈ°πÁõÆÈááÁî® ceph.com/rbd ÂíånfsÁ±ª‰ºº, ËøôÈáåÁúÅÁï• ‰ª•‰∏äÈááÁî®ÁöÑÊòØpersistentVolumeClaim ÊñπÂºèÂä®ÊÄÅÂàÜÈÖçÂÖ®ÈÉ®ÂÜÖÂÆπ]]></content>
      <categories>
        <category>ÊäÄÊúØÊñáÊ°£</category>
        <category>k8s</category>
        <category>Â≠òÂÇ®</category>
        <category>ceph</category>
        <category>storageclass</category>
        <category>nfs</category>
      </categories>
      <tags>
        <tag>k8s</tag>
        <tag>ceph</tag>
        <tag>k8sÂ≠òÂÇ®</tag>
        <tag>nfs</tag>
        <tag>storageclass</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[cephÂÆâË£ÖÈÉ®ÁΩ≤]]></title>
    <url>%2F2019%2F09%2F26%2F6-ceph%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2%2F</url>
    <content type="text"><![CDATA[CephÊòØ‰∏Ä‰∏™Áªü‰∏ÄÁöÑÂàÜÂ∏ÉÂºèÂ≠òÂÇ®Á≥ªÁªüÔºåËÆæËÆ°ÂàùË°∑ÊòØÊèê‰æõËæÉÂ•ΩÁöÑÊÄßËÉΩ„ÄÅÂèØÈù†ÊÄßÂíåÂèØÊâ©Â±ïÊÄß„ÄÇ ÁÆÄÂçï‰∫ÜËß£‰ªÄ‰πàÊòØÂùóÂ≠òÂÇ®/ÂØπË±°Â≠òÂÇ®/Êñá‰ª∂Á≥ªÁªüÂ≠òÂÇ®Ôºüceph ÁõÆÂâçÊèê‰æõÂØπË±°Â≠òÂÇ®ÔºàRADOSGWÔºâ„ÄÅÂùóÂ≠òÂÇ®RDB‰ª•Âèä CephFS Êñá‰ª∂Á≥ªÁªüËøô 3 ÁßçÂäüËÉΩ„ÄÇÂØπ‰∫éËøô3ÁßçÂäüËÉΩ‰ªãÁªçÔºåÂàÜÂà´Â¶Ç‰∏ãÔºö ÂØπË±°Â≠òÂÇ®Ôºå‰πüÂ∞±ÊòØÈÄöÂ∏∏ÊÑè‰πâÁöÑÈîÆÂÄºÂ≠òÂÇ®ÔºåÂÖ∂Êé•Âè£Â∞±ÊòØÁÆÄÂçïÁöÑGET„ÄÅPUT„ÄÅDEL ÂíåÂÖ∂‰ªñÊâ©Â±ïÔºå‰ª£Ë°®‰∏ªË¶ÅÊúâ Swift „ÄÅS3 ‰ª•Âèä Gluster Á≠âÔºõ ÂùóÂ≠òÂÇ®ÔºåËøôÁßçÊé•Âè£ÈÄöÂ∏∏‰ª• QEMU Driver ÊàñËÄÖ Kernel Module ÁöÑÊñπÂºèÂ≠òÂú®ÔºåËøôÁßçÊé•Âè£ÈúÄË¶ÅÂÆûÁé∞ Linux ÁöÑ Block Device ÁöÑÊé•Âè£ÊàñËÄÖ QEMU Êèê‰æõÁöÑ Block Driver Êé•Âè£ÔºåÂ¶Ç SheepdogÔºåAWS ÁöÑ EBSÔºåÈùí‰∫ëÁöÑ‰∫ëÁ°¨ÁõòÂíåÈòøÈáå‰∫ëÁöÑÁõòÂè§Á≥ªÁªüÔºåËøòÊúâ Ceph ÁöÑ RBDÔºàRBDÊòØCephÈù¢ÂêëÂùóÂ≠òÂÇ®ÁöÑÊé•Âè£Ôºâ„ÄÇÂú®Â∏∏ËßÅÁöÑÂ≠òÂÇ®‰∏≠ DAS„ÄÅSAN Êèê‰æõÁöÑ‰πüÊòØÂùóÂ≠òÂÇ®Ôºõ Êñá‰ª∂Â≠òÂÇ®ÔºåÈÄöÂ∏∏ÊÑè‰πâÊòØÊîØÊåÅ POSIX Êé•Âè£ÔºåÂÆÉË∑ü‰º†ÁªüÁöÑÊñá‰ª∂Á≥ªÁªüÂ¶Ç Ext4 ÊòØ‰∏Ä‰∏™Á±ªÂûãÁöÑÔºå‰ΩÜÂå∫Âà´Âú®‰∫éÂàÜÂ∏ÉÂºèÂ≠òÂÇ®Êèê‰æõ‰∫ÜÂπ∂Ë°åÂåñÁöÑËÉΩÂäõÔºåÂ¶Ç Ceph ÁöÑ CephFS (CephFSÊòØCephÈù¢ÂêëÊñá‰ª∂Â≠òÂÇ®ÁöÑÊé•Âè£)Ôºå‰ΩÜÊòØÊúâÊó∂ÂÄôÂèà‰ºöÊää GlusterFS ÔºåHDFS ËøôÁßçÈùûPOSIXÊé•Âè£ÁöÑÁ±ªÊñá‰ª∂Â≠òÂÇ®Êé•Âè£ÂΩíÂÖ•Ê≠§Á±ª„ÄÇÂΩìÁÑ∂ NFS„ÄÅNAS‰πüÊòØÂ±û‰∫éÊñá‰ª∂Á≥ªÁªüÂ≠òÂÇ®Ôºõ ÂèÇËÄÉÊïôÁ®ãKubernetes ÈõÜÊàê Ceph ÂêéÁ´ØÂ≠òÂÇ®ÊïôÁ®ãcentos7ÂÆâË£ÖcephÈõÜÁæ§ ÂáÜÂ§áÈÖçÁΩÆÊ∫ê12345678910111213141516171819202122cat &gt;/etc/yum.repos.d/ceph.repo&lt;&lt;EOF[ceph]name=cephbaseurl=http://mirrors.aliyun.com/ceph/rpm-jewel/el7/x86_64/gpgcheck=0priority=1[ceph-noarch]name=cephnoarchbaseurl=http://mirrors.aliyun.com/ceph/rpm-jewel/el7/noarch/gpgcheck=0priority=1[ceph-source]name=Ceph source packagesbaseurl=http://mirrors.163.com/ceph/rpm-jewel/el7/SRPMSenabled=0gpgcheck=1type=rpm-mdgpgkey=http://mirrors.163.com/ceph/keys/release.ascpriority=1EOF ÂÆâË£ÖËøáÂç∏ËΩΩ123ceph-deploy purge dk1-t dk2-tceph-deploy purgedata dk1-t dk2-tceph-deploy forgetkeys Âú®dk2-tËäÇÁÇπÂàõÂª∫ÈõÜÁæ§ monÊ®°Âùó1234567891011121314151617181920212223242526272829303132333435363738394041424344454647yum install ceph-deploy -yceph-deploy --versionmkdir /data/cephcd /data/cephceph-deploy new dk2-t# Êü•ÁúãÈÖçÁΩÆÊñá‰ª∂ls -l# ÈÖçÁΩÆceph.conf[global]...# Â¶ÇÊûúÊúâÂ§ö‰∏™ÁΩëÂç°ÔºåÂ∫îËØ•ÈÖçÁΩÆÂ¶Ç‰∏ãÈÄâÈ°πÔºå# public networkÊòØÂÖ¨ÂÖ±ÁΩëÁªúÔºåË¥üË¥£ÈõÜÁæ§ÂØπÂ§ñÊèê‰æõÊúçÂä°ÁöÑÊµÅÈáè# cluster networkÊòØÈõÜÁæ§ÁΩëÁªúÔºåË¥üËΩΩÈõÜÁæ§‰∏≠Êï∞ÊçÆÂ§çÂà∂‰º†ËæìÈÄö‰ø°Á≠â# Êú¨Ê¨°ÂÆûÈ™å‰ΩøÁî®Âêå‰∏ÄÂùóÁΩëÂç°ÔºåÁîüÂ¢ÉÁéØÂ¢ÉÂª∫ËÆÆÂàÜÂà´‰ΩøÁî®‰∏ÄÂùóÁΩëÂç°public network = 172.16.76.0/22cluster network = 172.16.76.0/22osd pool default size = 2# ÂÆâË£Ö ceph ÂåÖ# Â¶ÇÊûúÊåâÁÖßÂÆòÊñπÊñáÊ°£ÂÆâË£ÖÊñπÊ≥ï ‰ºöÈáçÊñ∞ÈÖçÁΩÆÂÆâË£ÖÂÆòÊñπcephÊ∫ê# Áî±‰∫éÁΩëÁªúÈóÆÈ¢òÔºåÂÆâË£ÖÂèØËÉΩ‰ºöÂá∫ÈîôÔºåÈúÄË¶ÅÂ§öÊ¨°ÊâßË°å# ceph-deploy install ÂÖ∂ÂÆûÂè™ÊòØ‰ºöÂÆâË£Ö ceph ceph-radosgw ‰∏§‰∏™ÂåÖ# ceph-deploy install lab1 lab2 lab3# Êé®Ëçê‰ΩøÁî®ÈòøÈáåÊ∫êÂÆâË£ÖÔºåÂõ†‰∏∫‰ΩøÁî®ceph-deployÂÆâË£Ö‰ºöÂæàÊÖ¢# ‰ΩøÁî®Â¶Ç‰∏ãÂëΩ‰ª§ÊâãÂä®ÂÆâË£ÖÂåÖÔºåÊõø‰ª£ÂÆòÊñπÁöÑ ceph-deploy install ÂëΩ‰ª§# Â¶Ç‰∏ãÊìç‰ΩúÂú®ÊâÄÊúânodeËäÇÁÇπ‰∏äÊâßË°åexport CEPH_DEPLOY_REPO_URL=http://mirrors.163.com/ceph/rpm-luminous/el7export CEPH_DEPLOY_GPG_URL=http://mirrors.163.com/ceph/keys/release.asc# ÂÖàÊâßË°åÊòØÂõ†‰∏∫ ceph-deploy installÂ§™ÊÖ¢yum install -y ceph ceph-radosgwceph-deploy install dk2-t# ÈÉ®ÁΩ≤monitorÂíåÁîüÊàêkeysceph-deploy mon create-initialls -l *.keyring# Â§çÂà∂Êñá‰ª∂Âà∞nodeËäÇÁÇπceph-deploy dk1-t dk2-t# È¢ùÂ§ñmonËäÇÁÇπÔºåmonËäÇÁÇπ‰πüÈúÄË¶ÅÈ´òÂèØÁî®ceph-deploy mon add dk1-t Âú®dk2-tËäÇÁÇπÂàõÂª∫ÈõÜÁæ§ mgrÊ®°Âùó123# ÈÉ®ÁΩ≤manager Ôºàluminous+Ôºâ12Âèä‰ª•ÂêéÁöÑÁâàÊú¨ÈúÄË¶ÅÈÉ®ÁΩ≤# Êú¨Ê¨°ÈÉ®ÁΩ≤ jewel ÁâàÊú¨ Ôºå‰∏çÈúÄË¶ÅÊâßË°åÂ¶Ç‰∏ãÂëΩ‰ª§ ceph-deploy mgr create dk2-t Âú®dk2-tËäÇÁÇπÂàõÂª∫ÈõÜÁæ§ osdÊ®°Âùó1234# 12ÁöÑÁâàÊú¨(ËøôÈáåÊåÇËΩΩ‰∏Ä‰∏™ 10GÁöÑÁ£ÅÁõò /dev/sdb)# create ÂëΩ‰ª§‰∏ÄÊ¨°ÂÆåÊàêÂáÜÂ§á OSD „ÄÅÈÉ®ÁΩ≤Âà∞ OSD ËäÇÁÇπ„ÄÅÂπ∂ÊøÄÊ¥ªÂÆÉ„ÄÇ create ÂëΩ‰ª§ÊòØ‰æùÊ¨°ÊâßË°å prepare Âíå activate ÂëΩ‰ª§ÁöÑÊç∑ÂæÑ„ÄÇceph-deploy osd create --data /dev/sdb dk2-tceph-deploy osd create --data /dev/sdc dk1-t Â¶Ç‰ΩïÂç∏ËΩΩosd1234567891011121314# Êü•Áúãceph osd tree# ËäÇÁÇπÁä∂ÊÄÅÊ†áËÆ∞‰∏∫outceph osd out osd.0# ‰ªécrush‰∏≠ÁßªÈô§ËäÇÁÇπceph osd crush remove osd.0# Âà†Èô§ËäÇÁÇπceph osd rm osd.0# Âà†Èô§ËäÇÁÇπËÆ§ËØÅÔºà‰∏çÂà†Èô§ÁºñÂè∑‰ºöÂç†‰ΩèÔºâceph auth del osd.0 Êü•Áúã mon ‰ø°ÊÅØ12345678ceph mon dumpdumped monmap epoch 1epoch 1fsid 4620d0c7-4458-4ff9-9296-d1318058bafclast_changed 2019-06-19 14:44:41.361005created 2019-06-19 14:44:41.3610050: 172.16.76.134:6789/0 mon.dk2-t ÈÖçÁΩÆÊñá‰ª∂ÂÜÖÂÆπ /etc/ceph/ceph.conf1234567891011[global]public network = 172.16.76.0/22cluster network = 172.16.76.0/22osd pool default size = 2fsid = 4620d0c7-4458-4ff9-9296-d1318058bafcmon_initial_members = dk2-tmon_host = 172.16.76.134auth_cluster_required = cephxauth_service_required = cephxauth_client_required = cephxmon_max_pg_per_osd = 1000 ceph ‰∏Ä‰∫õÊµãËØïÂëΩ‰ª§ÂàõÂª∫ rbd poolÔºåÂêçÂ≠óÂè´ÂÅö kube1ceph osd pool create kube 256 256 Â¶Ç‰ΩïÂèñÂæóadminÁöÑÂØÜÈí•12ceph auth get client.admin 2&gt;&amp;1 |grep "key = " |awk '&#123;print $3&#125;'AQAn/19bbb21GBAA1kc0HRWoGjeoPTRQziA03A== ÊµãËØïcephÊòØÂê¶Ê≠£Â∏∏12345678910111213rbd create kube/test --size 1024 --image-format 2rbd ls kuberbd map kube/test # Â¶ÇÊûúÊä•Èîô, Ë≠¶Áî® rbd info kube/test rbd feature disable kube/test exclusive-lock object-map fast-diff deep-flattenrbd map kube/testrbd showmappedmkfs.ext4 /dev/rbd0mkdir /data/rbd0mount /dev/rbd0 /data/rbd0cd /data/rbd0 &amp;&amp; echo test &gt; test.txt Âú®k8s ÊâãÂä®ÂàõÂª∫Â≠òÂÇ®Á±ªÂàõÂª∫ceph pg123456789101112131415161718192021# Total PGs = (Total_number_of_OSD * 100) / max_replication_count# pg = 1 * 100 /2 ~ 64(Âèñ2ÁöÑÊ¨°ÊñπÊï∞)# ËøôÈáåÂáÜÂ§áÂàõÂª∫2‰∏™pool, ÊØè‰∏™poolceph osd pool create rbd-k8s 16# Êü•Áúãceph osd lspools# ÂàõÂª∫imagerbd create rbd-k8s/cephimageredis --size 500M# Êü•Áúãlistrbd list rbd-k8s# Â§ÑÁêÜÊñ∞ÁâπÊÄß# Êü•Áúãinforbd info rbd-k8s/cephimageredis# ÂÖ≥Èó≠exclusive-lock object-map fast-diff deep-flatten Ëøô‰∫õÁâπÊÄßrbd feature disable rbd-k8s/cephimageredis exclusive-lock object-map fast-diff deep-flatten È¶ñÂÖàÂàõÂª∫secret12#Ëé∑Âèñkeygrep key /etc/ceph/ceph.client.admin.keyring |awk '&#123;printf "%s", $NF&#125;'|base64 ceph-secret.yaml1234567apiVersion: v1kind: Secretmetadata: name: ceph-secrettype: "kubernetes.io/rbd"data: key: QVFCTFo2dGNGNXFLRnhBQXBGTXJEdm5CY2k2UGtwZmZrN0JSVEE9PQ== ÂÖ∂Ê¨°ÂàõÂª∫pv, pvÊòØÊ≤°ÊúânamespaceÊ¶ÇÂøµÁöÑ persistentVolumeReclaimPolicyÊòØÊ∏ÖÁêÜËßÑÂàô (retain: ‰∏çÊ∏ÖÁêÜ, Recycle: ÂõûÊî∂) redis-ceph-pv.yml 1234567891011121314151617181920apiVersion: v1kind: PersistentVolumemetadata: name: redis2-ceph-rbd-pvspec: capacity: storage: 100Mi accessModes: - ReadWriteOnce rbd: monitors: - '172.16.76.134:6789' pool: rbd-k8s image: cephimageredis user: admin secretRef: name: ceph-secret fsType: ext4 readOnly: false persistentVolumeReclaimPolicy: Recycle ÊâßË°åÈÉ®ÁΩ≤pv1kubectl create -f redis-ceph-pv.yml ÁÑ∂ÂêéÂàõÂª∫pvc redis-ceph-pvc.yml 12345678910apiVersion: v1kind: PersistentVolumeClaimmetadata: name: redis2-ceph-rbd-pvcspec: accessModes: - ReadWriteOnce resources: requests: storage: 100Mi ÊâßË°åÈÉ®ÁΩ≤pvc1kubectl create -f redis-ceph-pvc.yml ÊúÄÂêéÂú®rancher‰∏äÈÄâÊã©ÊåÇËΩΩrbd]]></content>
      <categories>
        <category>ÊäÄÊúØÊñáÊ°£</category>
        <category>Â≠òÂÇ®</category>
        <category>ceph</category>
      </categories>
      <tags>
        <tag>k8s</tag>
        <tag>ceph</tag>
        <tag>cephfs</tag>
        <tag>k8sÂ≠òÂÇ®</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[hexoÊ∑ªÂä†ÁúãÊùøÂ®ò]]></title>
    <url>%2F2019%2F09%2F24%2F5-hexo%E6%B7%BB%E5%8A%A0%E7%9C%8B%E6%9D%BF%E5%A8%98%2F</url>
    <content type="text"><![CDATA[hexo6 Â∑¶‰∏ãËßíÊ∑ªÂä†ÁúãÊùøÂ®ò githubÂú∞ÂùÄ: Âº†‰π¶Ê®µÂ§ßÁ•û ‰∏ãËΩΩÂ§ßÁ•ûÈ°πÁõÆ (‰ºöËØ¥ËØù,Êç¢‰∫∫Áâ©,Â∞èÊ∏∏ÊàèÁ≠âÂäüËÉΩ)12cd themes/nextv6/sourcegit clone https://github.com/stevenjoezhang/live2d-widget.git githubËØ¥ÊòéÊØîËæÉËØ¶ÁªÜ, ËøôÈáåÁÆÄÂçïËØ¥Êòé Áî±‰∫éËøôÈáåÊòØÂÖãÈöÜÂà∞‰∫ÜsourceÁõÆÂΩï, hexo d -gÁöÑÊó∂ÂÄô‰ºöÁîüÊàêÂà∞publicÁõÆÂΩï, Áõ∏ÂΩì‰∫éÁ´ôÁÇπÊ†πÁõÆÂΩï‰∫Ü 123456# Áõ¥Êé•ÂºÄÂêØautoload.jsÊ≥®Èáäconst live2d_path = "/live2d-widget/";# ‰øÆÊîπ themes/nextv6/layout/_layout.swig, ÊúÄÂêé‰∏ÄË°åÊ∑ªÂä†Â¶Ç‰∏ã&lt;!-- ÁúãÊùøÂ®ò --&gt;&lt;script src="/live2d-widget/autoload.js"&gt;&lt;/script&gt; ‰∏ÄËà¨Â∞èÁôΩÁÆÄÂçïÊïôÁ®ã(Âè™ÊúâÁúãÈº†Ê†áÊñπÂêëÂäüËÉΩ) hexo ÂÆòÊñπÊîØÊåÅÁâà ÈúÄË¶ÅÂÆâË£ÖÊ®°Êùø1npm install --save hexo-helper-live2d ‰øÆÊîπ‰∏ªÈ¢òÈÖçÁΩÆÊñá‰ª∂ÂêÑÁßçÂÆ†Áâ©È¢ÑËßà 12345678910111213141516171819202122232425# Live2D## https://github.com/EYHN/hexo-helper-live2dlive2d: enable: true # enable: false scriptFrom: local # ÈªòËÆ§ pluginRootPath: live2dw/ # Êèí‰ª∂Âú®Á´ôÁÇπ‰∏äÁöÑÊ†πÁõÆÂΩï(Áõ∏ÂØπË∑ØÂæÑ) pluginJsPath: lib/ # ËÑöÊú¨Êñá‰ª∂Áõ∏ÂØπ‰∏éÊèí‰ª∂Ê†πÁõÆÂΩïË∑ØÂæÑ pluginModelPath: assets/ # Ê®°ÂûãÊñá‰ª∂Áõ∏ÂØπ‰∏éÊèí‰ª∂Ê†πÁõÆÂΩïË∑ØÂæÑ # scriptFrom: jsdelivr # jsdelivr CDN # scriptFrom: unpkg # unpkg CDN # scriptFrom: https://cdn.jsdelivr.net/npm/live2d-widget@3.x/lib/L2Dwidget.min.js # ‰Ω†ÁöÑËá™ÂÆö‰πâ url tagMode: false # Ê†áÁ≠æÊ®°Âºè, ÊòØÂê¶‰ªÖÊõøÊç¢ live2d tagÊ†áÁ≠æËÄåÈùûÊèíÂÖ•Âà∞ÊâÄÊúâÈ°µÈù¢‰∏≠ debug: false # Ë∞ÉËØï, ÊòØÂê¶Âú®ÊéßÂà∂Âè∞ËæìÂá∫Êó•Âøó model: use: live2d-widget-model-haruto # npm-module package name # use: wanko # ÂçöÂÆ¢Ê†πÁõÆÂΩï/live2d_models/ ‰∏ãÁöÑÁõÆÂΩïÂêç # use: ./wives/wanko # Áõ∏ÂØπ‰∫éÂçöÂÆ¢Ê†πÁõÆÂΩïÁöÑË∑ØÂæÑ # use: https://cdn.jsdelivr.net/npm/live2d-widget-model-wanko@1.0.5/assets/wanko.model.json # ‰Ω†ÁöÑËá™ÂÆö‰πâ url display: position: left width: 150 height: 300 mobile: show: true # ÊâãÊú∫‰∏≠ÊòØÂê¶Â±ïÁ§∫]]></content>
      <categories>
        <category>ÊúâË∂£</category>
        <category>ÂçöÂÆ¢</category>
        <category>‰∫åÊ¨°ÂÖÉ</category>
        <category>ÁæéÂåñ</category>
      </categories>
      <tags>
        <tag>hexo6</tag>
        <tag>ÁâπÊïà</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[hexoÈº†Ê†áÁßªÂä®ÂíåÈº†Ê†áÁÇπÂáªÁâπÊïà]]></title>
    <url>%2F2019%2F09%2F24%2F4-hexo%E9%BC%A0%E6%A0%87%E7%A7%BB%E5%8A%A8%E5%92%8C%E9%BC%A0%E6%A0%87%E7%82%B9%E5%87%BB%E7%89%B9%E6%95%88%2F</url>
    <content type="text"><![CDATA[hexo6 Èº†Ê†áÊ∑ªÂä†ÁÇπÂáªÂá∫Áé∞Ê°ÉÂøÉÁöÑÁâπÊïà Êù•Ëá™: Next‰∏ªÈ¢ò‰∏™ÊÄßÂåñ ÊâÄÈúÄË¶ÅÁöÑjsÊñá‰ª∂ Êú™ÂéãÁº© 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051! function(e, t, a) &#123; function n() &#123; c( ".heart&#123;width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);&#125;.heart:after,.heart:before&#123;content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: fixed;&#125;.heart:after&#123;top: -5px;&#125;.heart:before&#123;left: -5px;&#125;"), o(), r() &#125; function r() &#123; for (var e = 0; e &lt; d.length; e++) d[e].alpha &lt;= 0 ? (t.body.removeChild(d[e].el), d.splice(e, 1)) : (d[e].y--, d[e].scale += .004, d[e].alpha -= .013, d[e].el.style.cssText = "left:" + d[e].x + "px;top:" + d[e].y + "px;opacity:" + d[e].alpha + ";transform:scale(" + d[e].scale + "," + d[e].scale + ") rotate(45deg);background:" + d[e].color + ";z-index:99999"); requestAnimationFrame(r) &#125; function o() &#123; var t = "function" == typeof e.onclick &amp;&amp; e.onclick; e.onclick = function(e) &#123; t &amp;&amp; t(), i(e) &#125; &#125; function i(e) &#123; var a = t.createElement("div"); a.className = "heart", d.push(&#123; el: a, x: e.clientX - 5, y: e.clientY - 5, scale: 1, alpha: 1, color: s() &#125;), t.body.appendChild(a) &#125; function c(e) &#123; var a = t.createElement("style"); a.type = "text/css"; try &#123; a.appendChild(t.createTextNode(e)) &#125; catch (t) &#123; a.styleSheet.cssText = e &#125; t.getElementsByTagName("head")[0].appendChild(a) &#125; function s() &#123; return "rgb(" + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + ")" &#125; var d = []; e.requestAnimationFrame = function() &#123; return e.requestAnimationFrame || e.webkitRequestAnimationFrame || e.mozRequestAnimationFrame || e.oRequestAnimationFrame || e.msRequestAnimationFrame || function(e) &#123; setTimeout(e, 1e3 / 60) &#125; &#125;(), n()&#125;(window, document); ÂéãÁº©Âêé 1!function(e,t,a)&#123;function n()&#123;c(".heart&#123;width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);&#125;.heart:after,.heart:before&#123;content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: fixed;&#125;.heart:after&#123;top: -5px;&#125;.heart:before&#123;left: -5px;&#125;"),o(),r()&#125;function r()&#123;for(var e=0;e&lt;d.length;e++)d[e].alpha&lt;=0?(t.body.removeChild(d[e].el),d.splice(e,1)):(d[e].y--,d[e].scale+=.004,d[e].alpha-=.013,d[e].el.style.cssText="left:"+d[e].x+"px;top:"+d[e].y+"px;opacity:"+d[e].alpha+";transform:scale("+d[e].scale+","+d[e].scale+") rotate(45deg);background:"+d[e].color+";z-index:99999");requestAnimationFrame(r)&#125;function o()&#123;var t="function"==typeof e.onclick&amp;&amp;e.onclick;e.onclick=function(e)&#123;t&amp;&amp;t(),i(e)&#125;&#125;function i(e)&#123;var a=t.createElement("div");a.className="heart",d.push(&#123;el:a,x:e.clientX-5,y:e.clientY-5,scale:1,alpha:1,color:s()&#125;),t.body.appendChild(a)&#125;function c(e)&#123;var a=t.createElement("style");a.type="text/css";try&#123;a.appendChild(t.createTextNode(e))&#125;catch(t)&#123;a.styleSheet.cssText=e&#125;t.getElementsByTagName("head")[0].appendChild(a)&#125;function s()&#123;return"rgb("+~~(255*Math.random())+","+~~(255*Math.random())+","+~~(255*Math.random())+")"&#125;var d=[];e.requestAnimationFrame=function()&#123;return e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame||function(e)&#123;setTimeout(e,1e3/60)&#125;&#125;(),n()&#125;(window,document); Â∞Ü‰∏äÈù¢ÁöÑÂÜÖÂÆπË¥¥Âà∞Êñ∞Â¢ûÁöÑthemes/nextv6/source/js/src/love.js Êñá‰ª∂‰∏≠‰øÆÊîπthemes/nextv6/layout/_layout.swigÊñá‰ª∂, Êú´Â∞æÊ∑ªÂä†Â¶Ç‰∏ãÂÜÖÂÆπ12&lt;!-- Èº†Ê†áÊ°ÉÂøÉÂä®Áîª --&gt;&lt;script type="text/javascript" src="/js/src/love.js"&gt;&lt;/script&gt; hexo6 Èº†Ê†áÁßªÂä®Ê∑ªÂä†ÊòüÊòüÁâπÊïàÊù•Ëá™: ÊÑö‰∫∫ËäÇÈº†Ê†áË∑üÈöèÁâπÊïà Êñ∞Â¢ûjsÊñá‰ª∂ themes/nextv6/source/js/src/love2.js123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143/*! * Fairy Dust Cursor.js * - 90's cursors collection * -- https://github.com/tholman/90s-cursor-effects * -- http://codepen.io/tholman/full/jWmZxZ/ */(function fairyDustCursor() &#123; var possibleColors = ["#D61C59", "#E7D84B", "#1B8798"] var width = window.innerWidth; var height = window.innerHeight; var cursor = &#123;x: width/2, y: width/2&#125;; var particles = []; function init() &#123; bindEvents(); loop(); &#125; // Bind events that are needed function bindEvents() &#123; document.addEventListener('mousemove', onMouseMove); document.addEventListener('touchmove', onTouchMove); document.addEventListener('touchstart', onTouchMove); window.addEventListener('resize', onWindowResize); &#125; function onWindowResize(e) &#123; width = window.innerWidth; height = window.innerHeight; &#125; function onTouchMove(e) &#123; if( e.touches.length &gt; 0 ) &#123; for( var i = 0; i &lt; e.touches.length; i++ ) &#123; addParticle( e.touches[i].clientX, e.touches[i].clientY, possibleColors[Math.floor(Math.random()*possibleColors.length)]); &#125; &#125; &#125; function onMouseMove(e) &#123; cursor.x = e.clientX; cursor.y = e.clientY; addParticle( cursor.x, cursor.y, possibleColors[Math.floor(Math.random()*possibleColors.length)]); &#125; function addParticle(x, y, color) &#123; var particle = new Particle(); particle.init(x, y, color); particles.push(particle); &#125; function updateParticles() &#123; // Updated for( var i = 0; i &lt; particles.length; i++ ) &#123; particles[i].update(); &#125; // Remove dead particles for( var i = particles.length -1; i &gt;= 0; i-- ) &#123; if( particles[i].lifeSpan &lt; 0 ) &#123; particles[i].die(); particles.splice(i, 1); &#125; &#125; &#125; function loop() &#123; requestAnimationFrame(loop); updateParticles(); &#125; /** * Particles */ function Particle() &#123; this.character = "*"; this.lifeSpan = 120; //ms this.initialStyles =&#123; "position": "fixed", "top": "0", //ÂøÖÈ°ªÂä† "display": "block", "pointerEvents": "none", "z-index": "10000000", "fontSize": "20px", "will-change": "transform" &#125;; // Init, and set properties this.init = function(x, y, color) &#123; this.velocity = &#123; x: (Math.random() &lt; 0.5 ? -1 : 1) * (Math.random() / 2), y: 1 &#125;; this.position = &#123;x: x - 10, y: y - 20&#125;; this.initialStyles.color = color; console.log(color); this.element = document.createElement('span'); this.element.innerHTML = this.character; applyProperties(this.element, this.initialStyles); this.update(); document.body.appendChild(this.element); &#125;; this.update = function() &#123; this.position.x += this.velocity.x; this.position.y += this.velocity.y; this.lifeSpan--; this.element.style.transform = "translate3d(" + this.position.x + "px," + this.position.y + "px,0) scale(" + (this.lifeSpan / 120) + ")"; &#125; this.die = function() &#123; this.element.parentNode.removeChild(this.element); &#125; &#125; /** * Utils */ // Applies css `properties` to an element. function applyProperties( target, properties ) &#123; for( var key in properties ) &#123; target.style[ key ] = properties[ key ]; &#125; &#125; init();&#125;)(); ‰øÆÊîπthemes/nextv6/layout/_layout.swigÊñá‰ª∂, Êú´Â∞æÊ∑ªÂä†Â¶Ç‰∏ãÂÜÖÂÆπ12&lt;!-- Èº†Ê†áÁßªÂä®ÊòüÊòüÁâπÊïà --&gt;&lt;script type="text/javascript" src="/js/src/love2.js"&gt;&lt;/script&gt;]]></content>
      <categories>
        <category>ÊúâË∂£</category>
        <category>ÂçöÂÆ¢</category>
        <category>ÁæéÂåñ</category>
      </categories>
      <tags>
        <tag>hexo6</tag>
        <tag>ÁâπÊïà</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[k8sÈÅáÂà∞ÁöÑ‰∏Ä‰∫õÈóÆÈ¢òÁªüËÆ°ÊÄªÁªì]]></title>
    <url>%2F2019%2F09%2F20%2F3-k8s%E9%81%87%E5%88%B0%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98%E7%BB%9F%E8%AE%A1%E6%80%BB%E7%BB%93%2F</url>
    <content type="text"><![CDATA[‰∏çÂÆöÊó∂Êõ¥Êñ∞,ÊñáÁ´†ÂèØËÉΩÊØîËæÉÊï£‰π±,&gt;_&lt; 1. ÂçïÊú∫Áâàk8s pod‰∏ÄÁõ¥ÊòØpendingÁöÑÈóÆÈ¢ò describe‰∏Ä‰∏ãpod‰ºöÂèëÁé∞ÈîôËØØ: 1 node(s) had taints that the pod didn‚Äôt tolerate.ËøôÊòØÂõ†‰∏∫master‰∏äÂ≠òÂú®Ê±°ÁÇπ,pod‰∏ç‰ºöÂÜçÊîπËäÇÁÇπ‰∏äÂàõÂª∫‰∏§ÁßçÂäûÊ≥ï: deploy ÁöÑÊó∂ÂÄôÂä†‰∏ä ÂÆπÂøçËØ•Ê±°ÁÇπ Áõ¥Êé•ÂèñÊ∂àmaster‰∏äÁöÑÊ±°ÁÇπ 12345# ÂèñÊ∂àmaster‰∏äÊ±°ÁÇπ kubectl taint nodes --all node-role.kubernetes.io/master-# Êü•Áúãtaintkubectl describe node node1 2. ‰øÆÊîπservice-node-port-range Áî±‰∫étraefikÈÉ®ÁΩ≤ÈúÄË¶ÅÂØπÂ§ñÂºÄÊîæ80Á´ØÂè£, ‰ΩÜÈªòËÆ§‰ªÖÂÖÅËÆ∏30000‰ª•‰∏äÁ´ØÂè£ 123456789# kubeadm 1.14 ÈÖçÁΩÆapiServer: extraArgs: authorization-mode: Node,RBAC service-node-port-range: 79-33000# kubeadm 1.10ÈÖçÁΩÆapiServerExtraArgs: service-node-port-range: 79-33000 3. traefikÊñ≠ÁîµÂêéÈáçÊñ∞ÂêØÂä®Êä•Èîô command traefik error: field not found, node: redirect12345ÁúãÂà∞Ëøô‰∏™ÈîôËØØÁåúÊµãÂèØËÉΩÊòØÁî®ÁöÑlatestÈïúÂÉèÈóÆÈ¢ò, ‰ªéhub.docker.com Êü•ÁúãÊõ¥Êñ∞‰∫Üv2.0+ÁöÑÁâàÊú¨Â∞ÜtraefikÁöÑdeploymentÈÖçÁΩÆ‰∏≠ imageÊîπÊàê traefik:1.7ÈáçÊñ∞ÈÉ®ÁΩ≤Âêé ÈóÆÈ¢òËß£ 4. Êü•ÁúãÂΩìÂâçÈõÜÁæ§ÁöÑ(CustomResourceDefinition)12345678# Êü•Áúãk8sÊúâÂì™‰∫õapikubectl api-versions# Êü•ÁúãÂΩìÂâçcrdkubectl get crd# ÂÖ∂Ê¨°Êü•ÁúãËØ•apiÊòØ‰ªÄ‰πàÁâàÊú¨kubectl describe crd destinationrules.networking.istio.io]]></content>
      <categories>
        <category>ÊäÄÊúØÊñáÊ°£</category>
        <category>k8s</category>
        <category>ÈóÆÈ¢òÊÄªÁªì</category>
      </categories>
      <tags>
        <tag>k8s</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ÈÉ®ÁΩ≤elk7.2.0]]></title>
    <url>%2F2019%2F09%2F19%2F2-%E9%83%A8%E7%BD%B2elk7-2-0%2F</url>
    <content type="text"><![CDATA[ËØ¥Êòé: 121 ÂçïÂè∞k8s,Êú¨Êú∫ÁõÆÂΩïÊåÇËΩΩ(Êú™ÈÖçÁΩÆcephfs)2 Â¶ÇÊûúreplicasÂ§ß‰∫é1, Â∞±‰ºöÂá∫Áé∞Â§ö‰∏™esÊåÇËΩΩÂêå‰∏Ä‰∏™ÁõÆÂΩï,‰ºöÂá∫Áé∞Êä•Èîô(uuid block) 1. esÈÖçÁΩÆÊú¨Âú∞ÊåÇËΩΩ k8s-es-7.2.0.yml123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128---apiVersion: v1kind: ServiceAccountmetadata: labels: app: elasticsearch name: elasticsearch7-admin namespace: ns-elastic7---apiVersion: rbac.authorization.k8s.io/v1kind: ClusterRoleBindingmetadata: name: elasticsearch7-admin labels: app: elasticsearchroleRef: apiGroup: rbac.authorization.k8s.io kind: ClusterRole name: cluster-adminsubjects: - kind: ServiceAccount name: elasticsearch7-admin namespace: ns-elastic7---apiVersion: apps/v1kind: StatefulSetmetadata: labels: app: elasticsearch role: master name: elasticsearch-master namespace: ns-elastic7spec: replicas: 1 serviceName: elasticsearch-master selector: matchLabels: app: elasticsearch role: master template: metadata: labels: app: elasticsearch role: master spec: serviceAccountName: elasticsearch7-admin restartPolicy: Always securityContext: fsGroup: 1000 containers: - name: elasticsearch-master image: hub.boqii.com/bq/elasticsearch:7.2.0 command: ["bash", "-c", "ulimit -l unlimited &amp;&amp; sysctl -w vm.max_map_count=262144 &amp;&amp; chown -R elasticsearch:elasticsearch /usr/share/elasticsearch/data &amp;&amp; exec su elasticsearch docker-entrypoint.sh"] imagePullPolicy: IfNotPresent securityContext: privileged: true ports: - containerPort: 9200 protocol: TCP - containerPort: 9300 protocol: TCP resources: requests: cpu: "50m" limits: cpu: "800m" env: - name: cluster.name value: "es_cluster" - name: node.master value: "true" - name: node.data value: "true" - name: cluster.initial_master_nodes value: "elasticsearch-master-0" # Ê†πÊçÆÂâØÊú¨Êï∞ÂíånameÈÖçÁΩÆ - name: discovery.zen.ping_timeout value: "5s" - name: node.ingest value: "false" - name: ES_JAVA_OPTS value: "-Xms1g -Xmx1g" - name: "discovery.zen.ping.unicast.hosts" value: "elasticsearch-discovery" # Disvocery Service - name: "http.cors.enabled" value: "true" - name: "http.cors.allow-origin" value: "*" volumeMounts: - name: elasticsearch-data-volume mountPath: /usr/share/elasticsearch/data volumes: - name: elasticsearch-data-volume hostPath: path: /data/k8s-container/elk-7.2.0/es-7.2.0/data---apiVersion: v1kind: Servicemetadata: labels: app: elasticsearch name: elasticsearch-discovery namespace: ns-elastic7spec: publishNotReadyAddresses: true ports: - name: transport port: 9300 targetPort: 9300 selector: app: elasticsearch role: master---kind: ServiceapiVersion: v1metadata: labels: app: elasticsearch name: elasticsearch-service namespace: ns-elastic7spec: type: NodePort ports: - port: 9200 targetPort: 9200 nodePort: 19230 protocol: TCP selector: app: elasticsearch 2. esÈÖçÁΩÆnfsÂä®ÊÄÅÊåÇËΩΩ k8s-es-7.2.0-nfs.yml123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129---apiVersion: v1kind: ServiceAccountmetadata: labels: app: elasticsearch name: elasticsearch-admin namespace: ns-elastic---apiVersion: rbac.authorization.k8s.io/v1kind: ClusterRoleBindingmetadata: name: elasticsearch-admin labels: app: elasticsearchroleRef: apiGroup: rbac.authorization.k8s.io kind: ClusterRole name: cluster-adminsubjects: - kind: ServiceAccount name: elasticsearch-admin namespace: ns-elastic---apiVersion: apps/v1kind: StatefulSetmetadata: labels: app: elasticsearch role: master name: elasticsearch-master namespace: ns-elasticspec: replicas: 2 volumeClaimTemplates: - metadata: name: elasticsearch-data-nfs annotations: volume.beta.kubernetes.io/storage-class: "nfs" spec: accessModes: [ "ReadWriteOnce" ] resources: requests: storage: 2Gi serviceName: elasticsearch-master selector: matchLabels: app: elasticsearch role: master template: metadata: labels: app: elasticsearch role: master spec: serviceAccountName: elasticsearch-admin restartPolicy: Always securityContext: fsGroup: 1000 containers: - name: elasticsearch-master image: elasticsearch:7.2.0 command: ["bash", "-c", "ulimit -l unlimited &amp;&amp; sysctl -w vm.max_map_count=262144 &amp;&amp; chown -R elasticsearch:elasticsearch /usr/share/elasticsearch/data &amp;&amp; exec su elasticsearch docker-entrypoint.sh"] imagePullPolicy: IfNotPresent volumeMounts: - name: elasticsearch-data-nfs mountPath: /usr/share/elasticsearch/data securityContext: privileged: true ports: - containerPort: 9200 protocol: TCP - containerPort: 9300 protocol: TCP env: - name: cluster.name value: "es_cluster" - name: node.master value: "true" - name: node.data value: "true" - name: cluster.initial_master_nodes value: "elasticsearch-master-0,elasticsearch-master-1" # Ê†πÊçÆÂâØÊú¨Êï∞ÂíånameÈÖçÁΩÆ - name: discovery.zen.ping_timeout value: "5s" - name: node.ingest value: "false" - name: ES_JAVA_OPTS value: "-Xms1g -Xmx1g" - name: "discovery.zen.ping.unicast.hosts" value: "elasticsearch-discovery" # Disvocery Service - name: "http.cors.enabled" value: "true" - name: "http.cors.allow-origin" value: "*"---apiVersion: v1kind: Servicemetadata: labels: app: elasticsearch name: elasticsearch-discovery namespace: ns-elasticspec: publishNotReadyAddresses: true ports: - name: transport port: 9300 targetPort: 9300 selector: app: elasticsearch role: master---kind: ServiceapiVersion: v1metadata: labels: app: elasticsearch name: elasticsearch-service namespace: ns-elasticspec: type: NodePort ports: - port: 9200 targetPort: 9200 nodePort: 19220 protocol: TCP selector: app: elasticsearch 3. kibanaÈÖçÁΩÆk8s-kibana-7.2.0.yml12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485apiVersion: v1kind: ConfigMapmetadata: name: kibana-config namespace: ns-elastic7 labels: elastic-app: kibanadata: kibana.yml: | server.name: kibana server.host: "0" elasticsearch.hosts: [ "http://elasticsearch-service:9200" ] xpack.monitoring.ui.container.elasticsearch.enabled: true---kind: DeploymentapiVersion: apps/v1beta2metadata: labels: elastic-app: kibana name: kibana namespace: ns-elastic7spec: replicas: 1 revisionHistoryLimit: 10 selector: matchLabels: elastic-app: kibana template: metadata: labels: elastic-app: kibana spec: containers: - name: kibana image: hub.boqii.com/bq/kibana:7.2.0 ports: - containerPort: 5601 protocol: TCP resources: requests: cpu: "50m" limits: cpu: "800m" volumeMounts: - name: kibana-config mountPath: /usr/share/kibana/config volumes: - name: kibana-config configMap: name: kibana-config tolerations: - key: node-role.kubernetes.io/master effect: NoSchedule---kind: ServiceapiVersion: v1metadata: labels: elastic-app: kibana name: kibana-service namespace: ns-elastic7spec: ports: - port: 5601 targetPort: 5601 selector: elastic-app: kibana type: NodePort---apiVersion: extensions/v1beta1kind: Ingressmetadata: labels: elastic-app: kibana name: kibana-ingress namespace: ns-elastic7spec: rules: - host: elk-kibana-dev.boqii.com http: paths: - backend: serviceName: kibana-service servicePort: 5601 4. logstashÈÖçÁΩÆ Êú¨Âú∞ÊåÇËΩΩ k8s-logstash-7.2.0.yml 4.1 config/pipelines.yml 12- pipeline.id: main path.config: "/usr/share/logstash/config/pipeline/*.conf" 4.2 È¶ñÂÖàÈÖçÁΩÆgrokËßÑÂàô config/pipeline/logstash.conf 12345678910111213141516171819202122input &#123; udp &#123; port =&gt; "10000" &#125; &#125; filter &#123; grok &#123; match =&gt; &#123; "message" =&gt; "\&#123;\"id\":\"(?&lt;id&gt;(.)*)\",\"tag\":\"(?&lt;tag&gt;(.)*)\",\"title\":\"%&#123;GREEDYDATA:title&#125;(?&lt;title&gt;(.|\r|\n)*)\",\"value\":\"%&#123;GREEDYDATA:value&#125;(?&lt;value&gt;(.|\r|\n)*)\",\"createdAt\":\"(?&lt;createdAt&gt;\S+ \S+)\",\"Telephone\":\"(?&lt;Telephone&gt;(.)*)\",\"uid\":\"(?&lt;uid&gt;(.)*)\",\"updateTime\":\"(?&lt;updateTime&gt;(.)*)\",\"appVersion\":\"(?&lt;appVersion&gt;(.)*)\",\"mobileModel\":\"(?&lt;mobileModel&gt;(.)*)\",\"osVersion\":\"(?&lt;osVersion&gt;(.)*)\",\"channel\":\"(?&lt;channel&gt;(.)*)\",\"UDID\":\"(?&lt;UDID&gt;(.)*)\"\&#125;" &#125; &#125; &#125;output &#123; elasticsearch &#123; hosts =&gt; [ "http://elasticsearch-service:9200" ] index =&gt; "k8s2-dev-%&#123;+YYYY.MM.dd&#125;" &#125; &#125; 4.3 ÈÖçÁΩÆÊñá‰ª∂ k8s-logstash-7.2.0.yml 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455---kind: DeploymentapiVersion: apps/v1beta2metadata: labels: elastic-app: logstash name: logstash namespace: ns-elasticspec: replicas: 1 revisionHistoryLimit: 10 selector: matchLabels: elastic-app: logstash template: metadata: labels: elastic-app: logstash spec: containers: - name: logstash image: hub.boqii.com/bq/logstash:7.2.0 ports: - containerPort: 10000 protocol: UDP volumeMounts: - name: logstash-config mountPath: /usr/share/logstash/config volumes: - name: logstash-config hostPath: path: /data/k8s-pod/elk-7.2.0/logstash-7.2.0/config tolerations: - key: node-role.kubernetes.io/master effect: NoSchedule---kind: ServiceapiVersion: v1metadata: labels: elastic-app: logstash name: logstash-service namespace: ns-elasticspec: type: NodePort ports: - port: 10000 targetPort: 10000 nodePort: 10000 protocol: UDP selector: elastic-app: logstash type: NodePort---]]></content>
      <categories>
        <category>ÊäÄÊúØÊñáÊ°£</category>
        <category>k8s</category>
        <category>elk</category>
        <category>elk7</category>
        <category>elasticsearch7</category>
      </categories>
      <tags>
        <tag>k8s</tag>
        <tag>elk</tag>
        <tag>elk7</tag>
        <tag>elasticsearch7</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[È¶ñÊ¨°Êê≠Âª∫hexoÂçöÂÆ¢Á≥ªÁªü]]></title>
    <url>%2F2019%2F09%2F19%2F%E9%A6%96%E6%AC%A1%E6%90%AD%E5%BB%BAhexo%E5%8D%9A%E5%AE%A2%E7%B3%BB%E7%BB%9F%2F</url>
    <content type="text"><![CDATA[1 ÂÆâË£Öhexo 1.1 Âú®mac‰∏äÂÆâË£Ö 12# ÂÆâË£Önodebrew install node npm 1.2 Âú®linuxÂÆâË£Ö 123# ÂÆâË£Önode10curl -sL https://rpm.nodesource.com/setup_10.x | bash -yum install -y nodejs 1.3 ÂÆâË£Öhexo 12# ÂÆâË£Öhexonpm install -g hexo 2 ÂàùÂßãÂåñ123456789101112cd /data/github/# ÂàùÂßãÂåñhexo init blog# Ê°ÜÊû∂ÂÆâË£Önpm install#ÂÆâË£Ö Hexo ÂÖ≥‰∫éÂêØÂä®ÊúçÂä°Âô®ÁöÑÊèí‰ª∂npm install hexo-server --save# ÂêØÂä®ÊúçÂä°Âô®, Êú¨Âú∞Êü•ÁúãÊïàÊûú, Â¶ÇÊûú‰∏çÊåáÂÆöÁ´ØÂè£ÔºåÈªòËÆ§‰∏∫4000hexo server 3 ‰∏ªÈ¢òÂíåÈÖçÁΩÆ ‰∏ãËΩΩ‰∏ªÈ¢òÔºöhttps://github.com/theme-next/hexo-theme-next 12unzip hexo-theme-next-master.zipmv hexo-theme-next-master $blog/themes/ ‰øÆÊîπ‰∏ªÈ¢òÈÖçÁΩÆ _config.yml ‰∏≠ÁöÑÂÖ∂‰ªñÂ±ûÊÄß 12345title: Zhangzhiwei's Blog...theme: hexo-theme-next...scheme: Mist 4. ÁºñÂÜôÊõ¥Êñ∞ÂçöÂÆ¢ ÂàõÂª∫ÂçöÂÆ¢ 1hexo new 'Á¨¨‰∏Ä‰∏™ÂçöÂÆ¢' cat source/_posts/Á¨¨‰∏Ä‰∏™ÂçöÂÆ¢.md 123456title: Á¨¨‰∏Ä‰∏™ÂçöÂÆ¢date: 2019-09-19 16:58:01tags: - hexocategories: - hexoÂ≠¶‰π† github ÂàõÂª∫‰∏Ä‰∏™Repository‰ªìÂ∫ì 1231. ‰ªìÂ∫ìÂêçÂ≠óÂøÖÈ°ªÊòØ xxx.github.io2. Âú®settings‰∏≠ ÂãæÈÄâTemplate repository3. ËÆ∞ÂæóÊ∑ªÂä†Ëá™Â∑±ÁöÑssh githubÈÖçÁΩÆ 12 # ÂÆâË£Ö hexo ÂÖ≥‰∫é git ÁöÑÁªÑ‰ª∂npm install hexo-deployer-git --save Âú®_config.yml ‰∏≠‰∏∫ git Ê∑ªÂä†ÈÖçÁΩÆ 1234deploy: type: git repository: git@github.com:*/*.github.io.git branch: master Êü•ÁúãÊòØÂê¶ËÉΩÊèê‰∫§‰ª£Á†Ågithub 1ssh -T -ai ~/.ssh/id_rsa git@github.com ÈÉ®ÁΩ≤ 1234hexo ghexo dÊàñËÄÖhexo d -g 5. next6ËÆ©È¶ñÈ°µÊñáÂ≠óÈ¢ÑËßàÊòæÁ§∫ 5.1 ÊñπÊ≥ï‰∏Ä: Ëá™Âä®ÂΩ¢ÊàêÊëòË¶Å,ÈªòËÆ§Êà™ÂèñÁöÑÈïøÂ∫¶‰∏∫ 150 Â≠óÁ¨¶ 1231. ÊâæÂà∞‰∏ªÈ¢òÁöÑÈÖçÁΩÆÊñá‰ª∂(themes/next/_config.yml)2. ‰øÆÊîπauto_excerpt,ÊääenableÊîπ‰∏∫ÂØπÂ∫îÁöÑfalseÊîπ‰∏∫true3. hexo d -g 5.2 ÊñπÊ≥ï‰∫å: ÂçöÂÆ¢ÂÜÖÂÆπ‰∏≠Ê∑ªÂä† &lt; !‚Äìmore‚Äì&gt; 123# ÂÆâË£Önodebrew install node npm &lt;!-- more --&gt; 5.3 ÊñπÊ≥ï‰∏â: Âú®ÊñáÁ´†‰∏≠ÁöÑfront-matter‰∏≠Ê∑ªÂä†descriptionÔºåÂπ∂Êèê‰æõÊñáÁ´†ÊëòÂΩï,ËøôÁßçÊñπÂºèÂè™‰ºöÂú®È¶ñÈ°µÂàóË°®‰∏≠ÊòæÁ§∫ÊñáÁ´†ÁöÑÊëòË¶ÅÂÜÖÂÆπÔºåËøõÂÖ•ÊñáÁ´†ËØ¶ÊÉÖÂêé‰∏ç‰ºöÂÜçÊòæÁ§∫„ÄÇ 1234567891011title: ÈÉ®ÁΩ≤elk7.2.0date: 2019-09-19 17:59:53copyright: truetags: - k8s - elk - elk7categories: - ÊäÄÊúØÊñáÊ°£ - elkdescription: Êú¨Êñá‰∏ªË¶ÅÊòØÁÆÄÂçïÂçïÊú∫ÁâàÈÉ®ÁΩ≤elk7‰ΩìÈ™å, Âπ∂ÈùûÈ´òÂèØÁî®ÈõÜÁæ§ÊñπÂºèÈÉ®ÁΩ≤, ÈÉ®ÂàÜÂÆâË£ÖÊ≠•È™§ÁúÅÁï•. ‰∏ªË¶ÅÊòØËÆ∞ÂΩïymlÈÖçÁΩÆÊñá‰ª∂, ‰ªÖ‰æõÂèÇËÄÉ. ËØ¶ÁªÜÂÜÖÂÆπËØ∑ÁÇπÂáª‰∏ãÊñπÈòÖËØªÂÖ®Êñá, ÈùûÂ∏∏ÊÑüË∞¢! 6. next6Ê∑ªÂä†ÊêúÁ¥¢ÂäüËÉΩ123456789101. npm install hexo-generator-searchdb --save2. ÂÖ®Â±ÄÈÖçÁΩÆÊñá‰ª∂_config.ymlsearch: path: search.xml field: post format: html limit: 100003. ‰øÆÊîπ‰∏ªÈ¢òÁöÑ_config.ymllocal_search: enable: true 7. next6 MistÂ≠ó‰ΩìÁöÑ È¶ñÈ°µÊñáÁ´†Èó¥Ë∑ùÂíåÈ¶ñÈ°µÈ°µÂÆΩ,Â≠ó‰Ωì 7.1 È¶ñÈ°µÊñáÁ´†Èó¥Ë∑ù 12345Â¢ûÂä†‰∏Ä‰∫õÂÜÖÂÆπ: source/css/_schemes/Mist/_posts-expanded.styl.posts-expand .post &#123; margin-top: 30px; margin-bottom: 30px;&#125; 7.2 È°µÂÆΩ 1234source/css/_variables/base.styl$content-desktop = 900px$content-desktop-large = 1000px$content-desktop-largest = 1100px 7.3 Â≠ó‰ΩìÂ§ßÂ∞è 1234567891011themes/next/source/css/_variables/base.styl$font-size-base = 0.95em;$font-size-base = unit(hexo-config('font.global.size'), em) if hexo-config('font.global.size') is a 'unit';$font-size-smallest = .75em;$font-size-smaller = .8125em;$font-size-small = .855em;$font-size-medium = 0.95em;$font-size-large = 0.975em;$font-size-larger = 1.em;$font-size-largest = 1.125em; 8. Ê∑ªÂä†ÁΩëÊ†º 8.1 Ëá™ÂÆö‰πâÊñπÂºè‰øÆÊîπ 1234567891011121314# Êñ∞ÂàõÂª∫Ëá™ÂÆö‰πâÊñá‰ª∂cat themes/next/source/css/_custom/custom.styl// ‰∏ªÈ°µÊñáÁ´†Ê∑ªÂä†Èò¥ÂΩ±ÊïàÊûú.post &#123;margin-top: 60px;margin-bottom: 60px;padding: 25px;-webkit-box-shadow: 0 0 5px rgba(202, 203, 203, .5);-moz-box-shadow: 0 0 5px rgba(202, 203, 204, .5);&#125;# ‰øÆÊîπconfigÊñá‰ª∂vim ./themes/next/_config.ymlcustom: custom 8.2 next6ÁâàÊú¨‰øÆÊîπÊñπÂºè ÂèÇËÄÉ: hexo6‚ÄìnextÁæéÂåñÊï¥ÁêÜ ‰øÆÊîπ themes/next/layout/_layout.swig 1234&#123;% if theme.canvas_nest %&#125;&lt;script type="text/javascript" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"&gt;&lt;/script&gt;&#123;% endif %&#125; Â∞Ü‰∏äËø∞‰ª£Á†ÅÈò≤Ê≠¢Âú®&lt; /body&gt; ÂâçÂ∞±ÂèØ‰ª•‰∫Ü(Ê≥®ÊÑè‰∏çË¶ÅÊîæÂú®&lt; /head&gt;ÁöÑÂêéÈù¢)„ÄÇ ‰øÆÊîπ‰∏ªÈ¢òÁöÑ_config.yml 123456canvas_nest: true//color: Á∫øÊù°È¢úËâ≤, ÈªòËÆ§: '0,0,0'Ôºõ‰∏â‰∏™Êï∞Â≠óÂàÜÂà´‰∏∫(R,G,B)//opacity: Á∫øÊù°ÈÄèÊòéÂ∫¶Ôºà0~1Ôºâ, ÈªòËÆ§: 0.5//count: Á∫øÊù°ÁöÑÊÄªÊï∞Èáè, ÈªòËÆ§: 150//zIndex: ËÉåÊôØÁöÑz-indexÂ±ûÊÄßÔºåcssÂ±ûÊÄßÁî®‰∫éÊéßÂà∂ÊâÄÂú®Â±ÇÁöÑ‰ΩçÁΩÆ, ÈªòËÆ§: -1 Ê≥®ÊÑè:ÊàëËøôÈáåÊâìÂºÄÊèêÁ§∫Áº∫Â∞ë canvas-nest.min.jsÊñá‰ª∂,ËøôÈáåÊòØÊâãÂä®copyÁöÑ‰∏Ä‰ªΩÂÜôÂà∞ source/lib/canvas-nest/canvas-nest.min.js 1!function()&#123;function o(w,v,i)&#123;return w.getAttribute(v)||i&#125;function j(i)&#123;return document.getElementsByTagName(i)&#125;function l()&#123;var i=j("script"),w=i.length,v=i[w-1];return&#123;l:w,z:o(v,"zIndex",-1),o:o(v,"opacity",0.5),c:o(v,"color","0,0,0"),n:o(v,"count",99)&#125;&#125;function k()&#123;r=u.width=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,n=u.height=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight&#125;function b()&#123;e.clearRect(0,0,r,n);var w=[f].concat(t);var x,v,A,B,z,y;t.forEach(function(i)&#123;i.x+=i.xa,i.y+=i.ya,i.xa*=i.x&gt;r||i.x&lt;0?-1:1,i.ya*=i.y&gt;n||i.y&lt;0?-1:1,e.fillRect(i.x-0.5,i.y-0.5,1,1);for(v=0;v&lt;w.length;v++)&#123;x=w[v];if(i!==x&amp;&amp;null!==x.x&amp;&amp;null!==x.y)&#123;B=i.x-x.x,z=i.y-x.y,y=B*B+z*z;y&lt;x.max&amp;&amp;(x===f&amp;&amp;y&gt;=x.max/2&amp;&amp;(i.x-=0.03*B,i.y-=0.03*z),A=(x.max-y)/x.max,e.beginPath(),e.lineWidth=A/2,e.strokeStyle="rgba("+s.c+","+(A+0.2)+")",e.moveTo(i.x,i.y),e.lineTo(x.x,x.y),e.stroke())&#125;&#125;w.splice(w.indexOf(i),1)&#125;),m(b)&#125;var u=document.createElement("canvas"),s=l(),c="c_n"+s.l,e=u.getContext("2d"),r,n,m=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(i)&#123;window.setTimeout(i,1000/45)&#125;,a=Math.random,f=&#123;x:null,y:null,max:20000&#125;;u.id=c;u.style.cssText="position:fixed;top:0;left:0;z-index:"+s.z+";opacity:"+s.o;j("body")[0].appendChild(u);k(),window.onresize=k;window.onmousemove=function(i)&#123;i=i||window.event,f.x=i.clientX,f.y=i.clientY&#125;,window.onmouseout=function()&#123;f.x=null,f.y=null&#125;;for(var t=[],p=0;s.n&gt;p;p++)&#123;var h=a()*r,g=a()*n,q=2*a()-1,d=2*a()-1;t.push(&#123;x:h,y:g,xa:q,ya:d,max:6000&#125;)&#125;setTimeout(function()&#123;b()&#125;,100)&#125;();% 9. Ê∑ªÂä†ËØÑËÆ∫ÂäüËÉΩ 9.1 Ê≥®ÂÜåleancloud 1Ê≥®ÂÜå-&gt; È™åËØÅÈÇÆÁÆ±-&gt; ÂÆûÂêçËÆ§ËØÅ -&gt; ËÆæÁΩÆËé∑ÂèñappidÂíåappkey 9.2 ‰øÆÊîπÈÖçÁΩÆÊñá‰ª∂ 123456valine: enable: true appid: 'appid' appkey: 'appkey' placeholder: "„ÉæÔæâ‚âß‚àÄ‚â¶)o Êù•ÂëÄÔºÅÂø´Ê¥ªÂëÄÔºÅ~Âï¶Âï¶Âï¶~ Âï¶Âï¶Âï¶Âï¶~" visitor: true //Ëøô‰∏™ÊâìÂºÄÈ°µ‰ºöÁªüËÆ°ÊñáÁ´†ÈòÖËØªÊï∞ 10. next6Ê∑ªÂä†Â≠óÊï∞ÁªüËÆ° ÂíåÈòÖËØªÊó∂Èïø hexo-symbols-count-time 10.1 ÂÆâË£ÖnodeÊâ©Â±ï 1npm install hexo-symbols-count-time --save 10.2 ‰øÆÊîπÂÖ®Â±ÄÈÖçÁΩÆ _config.yml 123456symbols_count_time: symbols: true time: true total_symbols: true total_time: true exclude_codeblock: false 10.3 ‰øÆÊîπ‰∏ªÈ¢òÈÖçÁΩÆ _config.yml 1234567symbols_count_time: separated_meta: true item_text_post: true item_text_total: false awl: 4 wpm: 275 suffix: mins. 11. next6 ÊñáÁ´†ÁΩÆÈ°∂ÂäüËÉΩ 11.1 ÂÆâË£ÖnodeÊâ©Â±ï 12npm uninstall hexo-generator-index --savenpm install hexo-generator-index-pin-top --save 11.2 Âú®ÊñáÁ´†ÂºÄÂ§¥Ê∑ªÂä†ÁΩÆÈ°∂Ê†áËØÜ 1top: 10 11.3 È¶ñÈ°µÊ∑ªÂä†ÊòéÊòæÁΩÆÈ°∂Ê†áËØÜ 123456themes/next/layout/_macro/post.swig Âú®&lt;div class="post-meta"&gt; ‰∏ãÊ∑ªÂä†Â¶Ç‰∏ã‰ª£Á†Å&#123;% if post.top %&#125; &lt;i class="fa fa-thumb-tack"&gt;&lt;/i&gt; &lt;font color=green&gt;ÁΩÆÈ°∂&lt;/font&gt; &lt;span class="post-meta-divider"&gt;|&lt;/span&gt;&#123;% endif %&#125; 12. next6 ÂºÄÂêØÊ†áÁ≠æÂíåÂàÜÁ±ª 12.1 ÂàõÂª∫tagsÁõ∏ÂÖ≥ÁõÆÂΩï 12hexo new page tagshexo new page categories 12.2 ÂºÄÂêØtagsÊ†áÁ≠æÂíåÂàÜÁ±ª 123vim themes/next/_config.ymltags: /tags/ || tagscategories: /categories/ || th 12.3 ‰øÆÊîπtagsÁ´ôÁÇπÊñá‰ª∂ 12345678cat source/tags/index.md---title: tagsdate: 2019-09-24 10:08:59type: "tags"layout: "tags"comments: false--- 12.4 ‰øÆÊîπcategoriesÁ´ôÁÇπÊñá‰ª∂ 12345678cat source/categories/index.md---title: categoriesdate: 2019-09-24 10:09:55type: "categories"layout: "categories"comments: false--- 12.5 ÂéªÊéâxxx.github.io/tags/ È°µÈù¢ÁöÑpost-title(Âõ†‰∏∫ÊàëÁöÑËøô‰∏™cssÂ∑¶ÂØπÈΩê‰∫Ü,ÈªòËÆ§ÊòØÂ±Ö‰∏≠,ÊâÄ‰ª•Âæà‰∏ë) 123# Ê≥®Èáä‰∏ãÈù¢ËøôÊÆµ‰ª£Á†Åvim themes/nextv/layout/page.swig &lt;!-- &#123;% include '_partials/page/page-header.swig' %&#125; --&gt; 12.6 ÊñáÁ´†‰∏≠Â§ö‰∏™tagÂíåcategories 123456tags: - k8s - k8sÂÆâË£Öcategories: - [k8s,ÂÆâË£Ö] - [ÊäÄÊúØÊñáÊ°£]]]></content>
      <categories>
        <category>ÊúâË∂£</category>
        <category>ÂçöÂÆ¢</category>
        <category>ÁæéÂåñ</category>
      </categories>
      <tags>
        <tag>hexo6</tag>
        <tag>hexoÁæéÂåñ</tag>
      </tags>
  </entry>
</search>
