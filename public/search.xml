<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[es5é›†ç¾¤ç£ç›˜æ‰©å®¹]]></title>
    <url>%2F2019%2F10%2F28%2F22-es%E9%9B%86%E7%BE%A4%E7%A3%81%E7%9B%98%E6%89%A9%E5%AE%B9%2F</url>
    <content type="text"><![CDATA[esé›†ç¾¤ç£ç›˜ä¸è¶³,å¯¹ç£ç›˜æ‰©å®¹é‡åˆ°ä¸€äº›çš„é—®é¢˜ é‡å¯é›†ç¾¤å‰ï¼Œå…ˆè®¾ç½®é›†ç¾¤åœæ­¢åˆ†ç‰‡ç§»åŠ¨ï¼š12345curl -XPUT http://localhost:9200/_cluster/settings -d '&#123;"transient" : &#123;"cluster.routing.allocation.enable" : "none"&#125;&#125;' å¯¹ç£ç›˜è¿›è¡Œæ‰©å®¹,æ¯æ¬¡æ“ä½œä¸€ä¸ªèŠ‚ç‚¹123456789101112131415# ç›´æ¥æ‰©å®¹ç£ç›˜åˆ°2T//é’ˆå¯¹ext4æ–‡ä»¶æ ¼å¼çš„æ“ä½œç³»ç»Ÿï¼ˆå¦‚CentOS6ï¼‰ï¼š//umount /dev/vdbe2fsck -f /dev/vdbresize2fs /dev/vdbmount /dev/vdb /data# æˆ–è€…æ–°å¢ 2Täº‘ç›˜/dev/vdcumount /data/mkdir /data2mount /dev/vdb /data2mkfs.ext4 /dev/vdcmount /dev/vdc /datacp -ra /data2/* /data/ é‡å¯ä¹‹åï¼Œæ¢å¤åˆ†ç‰‡è‡ªåŠ¨åˆ†é…ï¼š12345curl -XPUT http://localhost:9200/_cluster/settings -d '&#123;"transient" : &#123;"cluster.routing.allocation.enable" : "all"&#125;&#125;' å¦‚æœéœ€è¦ä¸‹çº¿å…¶ä¸­çš„èŠ‚ç‚¹, å…ˆå°†åˆ†ç‰‡éƒ½è½¬ä¹‰åˆ°å…¶ä»–èŠ‚ç‚¹123456# æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä¼šè‡ªåŠ¨å°†10.10.0.1 èŠ‚ç‚¹ä¸Šçš„åˆ†ç‰‡å…¨éƒ¨è¿ç§»åˆ°å…¶ä»–æœºå™¨, ç­‰å¾…è¿ç§»å®Œæˆ, å°†æ”¹ç©ºæœºå™¨ä¸‹çº¿å³å¯curl -XPUT 127.0.0.1:9200/_cluster/settings -d '&#123;"transient" :&#123;"cluster.routing.allocation.exclude._ip" : "10.10.0.1"&#125;&#125;' å¦å¤–å¯¹äº path.data é…ç½®å¤šå¿«ç›˜çš„é—®é¢˜1234æ¯”å¦‚es8é…ç½®äº†ä¸‰å—ç›˜:/disk4/data -&gt; sde, /disk5/data -&gt; sdf, disk6/data -&gt; sdgè¿™é‡Œæ³¨æ„ es nodeçš„data pathå°½é‡ä¿è¯ç›˜çš„å¤§å°å·®åˆ«ä¸è¦å¤ªå¤§, sde,sdf,sdgçš„å¤§å°ä¿éšœå·®ä¸å¤š, å¦åˆ™ç”±äºes shard å‡è¡¡çš„æ—¶å€™å¯èƒ½ä¼šä¼˜å…ˆåˆ†é…åˆ°ç£ç›˜å¤§çš„ç›®å½•, å¯èƒ½ä¼šå¯¼è‡´sde(å‡å¦‚è¿™ä¸ªç£ç›˜æœ€å¤§)çš„IOé«˜, è€Œsdfç­‰IOä½ ç®€å•çš„é…ç½®ä¿¡æ¯elasticsearch512345678910111213cluster.name: es-devnode.name: es1-upath.data: /data/es/datapath.logs: /data/es/logsnetwork.host: 0.0.0.0discovery.zen.ping.unicast.hosts: ["10.10.0.1:9300","10.10.0.2:9300","10.10.0.3:9300","10.10.0.4:9300"]http.cors.enabled: truehttp.cors.allow-origin: "*"xpack.security.enabled: falsebootstrap.system_call_filter: falsethread_pool.bulk.queue_size: 3000# é˜²æ­¢è„‘è£‚discovery.zen.minimum_master_nodes: 2]]></content>
      <categories>
        <category>elk</category>
        <category>elasticsearch5</category>
      </categories>
      <tags>
        <tag>elasticsearch5</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æµé‡å¤åˆ¶å·¥å…·gor]]></title>
    <url>%2F2019%2F10%2F28%2F21-%E6%B5%81%E9%87%8F%E5%A4%8D%E5%88%B6%E5%B7%A5%E5%85%B7gor%2F</url>
    <content type="text"><![CDATA[Gor æ˜¯ä¸€æ¬¾goè¯­è¨€å®ç°çš„ç®€å•çš„httpæµé‡å¤åˆ¶å·¥å…·ï¼Œå®ƒçš„ä¸»è¦ç›®çš„æ˜¯ä½¿ä½ çš„ç”Ÿäº§ç¯å¢ƒHTTPçœŸå®æµé‡åœ¨æµ‹è¯•ç¯å¢ƒå’Œé¢„å‘å¸ƒç¯å¢ƒé‡ç° æµé‡å¤åˆ¶å·¥å…· ä¸‹è½½å®‰è£…githubä¸‹è½½åœ°å€: https://github.com/buger/goreplay/releases 1234tar -xvf gor_1.0.0_x64.tar.gzmv gor /usr/bin/which gor å‘½ä»¤123456789101112131415161718192021222324252627282930311 ä¿å­˜è¯·æ±‚åˆ°æ–‡ä»¶# å°†æœ¬æœºæ‰€æœ‰80è¯·æ±‚ä¿å­˜åˆ°gor-20171120_0.logæ–‡ä»¶(æ³¨æ„ä¼šç”Ÿæˆå¾ˆå¤šæ–‡ä»¶)gor --input-raw :80 --output-file gor-%Y%m%d.log# --output-file-append ä¼šç”Ÿæˆgor-20171120.logæ–‡ä»¶gor --input-raw :80 --output-file gor-%Y%m%d.log --output-file-append2 æ ¹æ®æ–‡ä»¶å›æ”¾è¯·æ±‚# é•œåƒqpså›æ”¾gor --input-file gor-aaaa-20171120.log --output-http aaaa-dev.test.com# ä¸¤å€é•œåƒqpså›æ”¾gor --input-file "gor-aaaa-20171120.log|200%" --output-http aaaa-dev.test.com3 è¿‡æ»¤urlåä¿å­˜è¯·æ±‚åˆ°æ–‡ä»¶# æ’é™¤s.test.comçš„è¯·æ±‚gor --input-raw :80 --output-file gor-%Y%m%d.log --output-file-append --http-disallow-header "Host: s.test.com" --http-disallow-header "Host: www.test.com" --http-disallow-header "Host: bbs.test.com"# åªå­˜å‚¨aaaa.test.comçš„è¯·æ±‚gor --input-raw :80 --output-file gor-aaaa-%Y%m%d.log --output-file-append --http-allow-header "Host: aaaa.test.com"# httpsçš„ä¸èƒ½æŠ“åŒ…gor --input-raw :443 --output-file gor-ssl-aaaa-%Y%m%d.log --output-file-append --http-allow-header "Host: aaaa.test.com"4 åœ¨çº¿é•œåƒå¤åˆ¶è¯·æ±‚# å°†ç”Ÿäº§aaaa.test.comçš„è¯·æ±‚å¤åˆ¶åˆ° aaaa-dev.test.com ç¯å¢ƒ!gor --input-raw :80 --output-http "aaaa-dev.test.com" --http-allow-header "Host: aaaa.test.com" ç¦»çº¿æ–‡ä»¶ç¼–è¾‘123456æ–‡ä»¶çš„æ¯ä¸ªè¯·æ±‚é€šè¿‡ å¦‚ä¸‹å­—ç¬¦ä¸²åˆ†å‰²!Ã°&lt;9f&gt;&lt;90&gt;ÂµÃ°&lt;9f&gt;&lt;99&gt;&lt;88&gt;Ã°&lt;9f&gt;&lt;99&gt;&lt;89&gt;å¹¶ä¸”ç¬¬ä¸€è¡Œæ˜¯ è¯·æ±‚çš„å”¯ä¸€ç ? å’Œæ—¶é—´æˆ³!1 9b366a8eab8d6cb8e557cb3bf43f69c36612cffb 1511165572419843000æ‰€ä»¥å¯å½•åˆ¶æ¯”å¦‚åŠå°æ—¶çš„ç„¶åçªƒå–éœ€è¦çš„æ—¶é—´æ®µ! é—®é¢˜ https ä¸èƒ½æŠ“åŒ…! é€šè¿‡æ·»åŠ ä»£ç†, goræŠ“å–8000ç«¯å£ 1234567891011121314151617181920212223# SSL terminationserver &#123; listen 443 ssl; server_name aaaa.test.com; ssl_certificate /etc/ssl/nginx/server.crt; ssl_certificate_key /etc/ssl/nginx/server.key; location / &#123; proxy_set_header Host $host; proxy_pass http://localhost:8000; &#125;&#125;server &#123; listen 8000; server_name aaaa.test.com; location / &#123; proxy_set_header Host $host; proxy_pass http://production_shop_api_site; &#125;&#125;]]></content>
      <categories>
        <category>æµé‡å¤åˆ¶å·¥å…·</category>
        <category>gor</category>
      </categories>
      <tags>
        <tag>gor</tag>
        <tag>httpæµé‡å¤åˆ¶å·¥å…·</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[k8sæ­å»ºmysql5.7.24ä¸»ä»]]></title>
    <url>%2F2019%2F10%2F24%2F20-k8s%E6%90%AD%E5%BB%BAmysql5-7-24%E4%B8%BB%E4%BB%8E%2F</url>
    <content type="text"><![CDATA[k8sä¸Šç®€å•éƒ¨ç½²mysql5.7.24ä¸»ä» k8sæ­å»ºmysql5.7.24ä¸»ä» å‚è€ƒæ–‡æ¡£åˆ©ç”¨Kubernetesæ­å»ºmysqlä¸»ä»å¤åˆ¶é›†ç¾¤å®˜æ–¹dockerfile ä»hub.docker.comæ‹‰å–å®˜æ–¹é•œåƒ1docker pull mysql:5.7.24 buildé•œåƒ ä¸»åº“masterçš„Dockerfile12345from mysql:5.7.24run sed -i '/\[mysqld\]/a server-id=1\nlog-bin' /etc/mysql/mysql.conf.d/mysqld.cnfCOPY docker-entrypoint.sh /usr/local/bin/ ä¸»åº“çš„docker-entrypoint.sh å…ˆä»åˆå§‹é•œåƒå– æˆ–è€…ä»githubå¯¹åº”ç‰ˆæœ¬ä¸Š 123docker run -dti mysql:5.7.24 /bin/bashdocker cp 2bfa6209d120c23:/usr/local/bin/docker-entrypoint.sh . ä¿®æ”¹docker-entrypoint.sh 12345678fi# æ·»åŠ ä»¥ä¸‹å†…å®¹echo "CREATE USER '$MYSQL_REPLICATION_USER'@'%' IDENTIFIED BY '$MYSQL_REPLICATION_PASSWORD' ;" | "$&#123;mysql[@]&#125;"echo "GRANT REPLICATION SLAVE ON *.* TO '$MYSQL_REPLICATION_USER'@'%' IDENTIFIED BY '$MYSQL_REPLICATION_PASSWORD' ;" | "$&#123;mysql[@]&#125;"echo "FLUSH PRIVILEGES ;" | "$&#123;mysql[@]&#125;"# æ·»åŠ ä»¥ä¸Šå†…å®¹echo ls /docker-entrypoint-initdb.d/ &gt; /dev/null buildä¸»åº“é•œåƒ 12docker build -t hub.boqii.com/bq/mysql-master:5.7.24 .docker push hub.boqii.com/bq/mysql-master:5.7.24 ä»åº“çš„docker-entrypoint.sh åŒä¸Šå…ˆä»åˆå§‹é•œåƒå– æˆ–è€…ä»githubå¯¹åº”ç‰ˆæœ¬ä¸Š æˆ–å¤åˆ¶ä¸Šé¢çš„æ–‡ä»¶ ä¿®æ”¹docker-entrypoint.sh 12345678fi# æ·»åŠ ä»¥ä¸‹å†…å®¹ echo "STOP SLAVE;" | "$&#123;mysql[@]&#125;" echo "CHANGE MASTER TO master_host='$MYSQL_MASTER_SERVICE_HOST', master_user='$MYSQL_REPLICATION_USER', master_password='$MYSQL_REPLICATION_PASSWORD' ;" | "$&#123;mysql[@]&#125;" echo "START SLAVE;" | "$&#123;mysql[@]&#125;" # æ·»åŠ ä»¥ä¸Šå†…å®¹echo ls /docker-entrypoint-initdb.d/ &gt; /dev/null buildä»åº“é•œåƒ 12docker build -t hub.boqii.com/bq/mysql-slave:5.7.24 .docker push hub.boqii.com/bq/mysql-slave:5.7.24 å¼€å§‹éƒ¨ç½² k8s-master-mysql_5.7.24.yml 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869---apiVersion: apps/v1beta1kind: StatefulSetmetadata: labels: app: php-mysql-master-dev name: php-mysql-master-dev namespace: dbspec: serviceName: "php-mysql-master-dev" replicas: 1 selector: matchLabels: app: php-mysql-master-dev template: metadata: labels: app: php-mysql-master-dev spec: containers: - name: php-mysql-master-dev image: hub.boqii.com/bq/mysql-master:5.7.24 ports: - containerPort: 3306 name: db-port resources: requests: cpu: "50m" limits: cpu: "1000m" env: - name: MYSQL_ROOT_PASSWORD value: "Boqii.123" - name: MYSQL_REPLICATION_USER value: "repl" - name: MYSQL_REPLICATION_PASSWORD value: "7a5b21ac65712bd95e39d3c1" volumeMounts: - name: order-master-dev-data mountPath: /var/lib/mysql - name: order-master-dev-cfg mountPath: /etc/mysql volumes: - name: order-master-dev-data hostPath: path: /data/k8s-container/php-mysql-dev/master/data - name: order-master-dev-cfg hostPath: path: /data/k8s-container/php-mysql-dev/master/etc-mysql---kind: ServiceapiVersion: v1metadata: labels: app: php-mysql-master-dev name: php-mysql-master-dev-service namespace: dbspec: type: NodePort ports: - port: 3306 name: db-port targetPort: 3306 nodePort: 23306 protocol: TCP selector: app: php-mysql-master-dev k8s-slave-mysql_5.7.24.yml 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172---apiVersion: apps/v1beta1kind: StatefulSetmetadata: labels: app: php-mysql-slave-dev name: php-mysql-slave-dev namespace: dbspec: serviceName: "php-mysql-slave-dev" replicas: 1 selector: matchLabels: app: php-mysql-slave-dev template: metadata: labels: app: php-mysql-slave-dev spec: containers: - name: php-mysql-slave-dev image: hub.boqii.com/bq/mysql-slave:5.7.24 ports: - containerPort: 3306 name: db-port resources: requests: cpu: "50m" limits: cpu: "1000m" env: - name: MYSQL_ROOT_PASSWORD value: "Boqii.123" - name: MYSQL_REPLICATION_USER value: "repl" - name: MYSQL_REPLICATION_PASSWORD value: "7a5b21ac65712bd95e39d3c1" - name: MYSQL_MASTER_SERVICE_HOST value: "php-mysql-master-dev-service" volumeMounts: - name: order-slave-dev-data mountPath: /var/lib/mysql - name: order-slave-dev-cfg mountPath: /etc/mysql volumes: - name: order-slave-dev-data hostPath: path: /data/k8s-container/php-mysql-dev/slave/data - name: order-slave-dev-cfg hostPath: path: /data/k8s-container/php-mysql-dev/slave/etc-mysql---kind: ServiceapiVersion: v1metadata: labels: app: php-mysql-slave-dev name: php-mysql-slave-dev-service namespace: dbspec: type: NodePort ports: - port: 3306 name: db-port targetPort: 3306 nodePort: 23307 protocol: TCP selector: app: php-mysql-slave-dev é—®é¢˜æ€»ç»“ ä»åº“çš„replay logåå­—ä¼šæ ¹æ®dockerä¸»æœºåå˜åŒ–, ä¹Ÿå¯ä»¥å†™åœ¨é…ç½®æ–‡ä»¶ 12# Dockerfileä¸­å¯ä»¥æ·»åŠ run sed -i '/\[mysqld\]/a relay-log-index=php-mysql-shoporder-slave-dev-relay-bin.index' /etc/mysql/mysql.conf.d/mysqld.cnf æ³¨æ„MYSQL_MASTER_SERVICE_HOST å˜é‡çš„é…ç½®, æ ¹æ®ä½ masterçš„serviceå˜åŒ– å…¶æ¬¡æˆ‘docker-entrypoint.sh æ–‡ä»¶å‡ æ¬¡æ‰‹åŠ¨ä»é¡µé¢å¤åˆ¶ç²˜è´´ä¸‹æ¥çš„å¯¼è‡´å„ç§è¯­æ³•é”™è¯¯,è¿™é‡Œå»ºè®®æ‰¾åˆ°å¯¹çš„ç‰ˆæœ¬ä»githubå…‹éš†, æˆ–è€…ä»mysql:5.7.24é•œåƒä¸­cp é…ç½®etc-mysql/mysql.conf.d/mysqld.cnf 12345678[mysqld]# ä»åº“é…ç½®read_only=1character-set-server=utf8# 1 å»æ‰STRICT_TRANS_TABLES è¡¨NOT NULLæ—¶æ— æ³•åˆ›å»ºè¡¨# 2 ä¿®æ”¹NO_ZERO_DATEä¸ºALLOW_INVALID_DATES å…è®¸â€™0000-00-00â€™#sql_mode='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION'sql_mode='ONLY_FULL_GROUP_BY,NO_ZERO_IN_DATE,ALLOW_INVALID_DATES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' é…ç½®etc-mysql/conf.d/mysql.cnf 123[mysql]no-auto-rehashdefault-character-set=utf8 é™„å½•masteré…ç½®docker-entrypoint.shslaveé…ç½®docker-entrypoint.sh]]></content>
      <categories>
        <category>mysql</category>
        <category>k8s</category>
        <category>mysql</category>
      </categories>
      <tags>
        <tag>mysql</tag>
        <tag>k8s</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[shellä¸­gtå’Œ>çš„åŒºåˆ«]]></title>
    <url>%2F2019%2F10%2F17%2F19-shell%E4%B8%ADgt%E5%92%8C%3E%E7%9A%84%E5%8C%BA%E5%88%AB%2F</url>
    <content type="text"><![CDATA[shellä¸­ gt å’Œ &gt; çš„ä¸€äº›ç›¸å…³é—®é¢˜ä»‹ç»å’Œæµ‹è¯• ä»¥ä¸‹æ˜¯bashçš„æµ‹è¯•, æ³¨æ„å¦‚æœä½ æ˜¯zshå¯èƒ½ä¼šä¸åŒå–”ğŸ˜¯ [[]] , [] å’Œtestæ¯”è¾ƒ [] å’Œtest: ä¸¤è€…æ˜¯ä¸€æ ·çš„ï¼Œåœ¨å‘½ä»¤è¡Œé‡Œtest exprå’Œ[ expr ]çš„æ•ˆæœç›¸åŒã€‚testä¸­å¯ç”¨çš„æ¯”è¾ƒè¿ç®—ç¬¦åªæœ‰==å’Œ!=ï¼Œä¸¤è€…éƒ½æ˜¯ç”¨äºå­—ç¬¦ä¸²æ¯”è¾ƒçš„ï¼Œä¸å¯ç”¨äºæ•´æ•°æ¯”è¾ƒï¼Œæ•´æ•°æ¯”è¾ƒåªèƒ½ä½¿ç”¨-eq, -gtè¿™ç§å½¢å¼ã€‚é€šè¿‡which [ å’Œwhich test å¯ä»¥çœ‹åˆ°æ˜¯å‘½ä»¤ [] å’Œtest ä¾‹å­ 1234567[root@dk-centos6 ~]# a="abcdef"[root@dk-centos6 ~]# test "$a" = "abcdef"[root@dk-centos6 ~]# echo $?0[root@dk-centos6 ~]# [ "$a" = "abcdef" ][root@dk-centos6 ~]# echo $?0 [[ ]]å…·ä½“åŠŸèƒ½: [[æ˜¯ bash ç¨‹åºè¯­è¨€çš„å…³é”®å­—ã€‚å¹¶ä¸æ˜¯ä¸€ä¸ªå‘½ä»¤ï¼Œ[[ ]] ç»“æ„æ¯”[ ]ç»“æ„æ›´åŠ é€šç”¨ã€‚åœ¨[[å’Œ]]ä¹‹é—´æ‰€æœ‰çš„å­—ç¬¦éƒ½ä¸ä¼šå‘ç”Ÿæ–‡ä»¶åæ‰©å±•æˆ–è€…å•è¯åˆ†å‰²ï¼Œä½†æ˜¯ä¼šå‘ç”Ÿå‚æ•°æ‰©å±•å’Œå‘½ä»¤æ›¿æ¢ã€‚ æ”¯æŒå­—ç¬¦ä¸²çš„æ¨¡å¼åŒ¹é…ï¼ˆä½¿ç”¨=~æ“ä½œç¬¦æ—¶ç”šè‡³æ”¯æŒshellçš„æ­£åˆ™è¡¨è¾¾ å¼ï¼‰,å³è¾¹çš„å­—ç¬¦ä¸²ä¸åŠ åŒå¼•å·çš„æƒ…å†µ,å¯ä»¥æŠŠå³è¾¹ä½œä¸ºæ¨¡å¼. æ¯”å¦‚[[ hello == hell? ]]ï¼Œç»“æœä¸ºçœŸã€‚å½“ç„¶åŠ å¼•å·å°±æ˜¯æ–‡æœ¬å­—ç¬¦ä¸²æ¯”è¾ƒ. ä½¿ç”¨[[ â€¦ ]]æ¡ä»¶åˆ¤æ–­ç»“æ„ï¼Œè€Œä¸æ˜¯[ â€¦ ]ï¼Œèƒ½å¤Ÿé˜²æ­¢è„šæœ¬ä¸­çš„è®¸å¤šé€»è¾‘é”™è¯¯ã€‚æ¯”å¦‚ï¼Œ&amp;&amp;ã€||ã€&lt;å’Œ&gt; æ“ä½œç¬¦èƒ½å¤Ÿæ­£å¸¸å­˜åœ¨äº[[ ]]æ¡ä»¶åˆ¤æ–­ç»“æ„ä¸­ï¼Œä½†æ˜¯å¦‚æœå‡ºç°åœ¨[ ]ç»“æ„ä¸­çš„è¯ï¼Œä¼šæŠ¥é”™ã€‚æ¯”å¦‚å¯ä»¥ç›´æ¥ä½¿ç”¨if [[ $a != 1 &amp;&amp; $a != 2 ]], å¦‚æœä¸é€‚ç”¨åŒæ‹¬å·, åˆ™ä¸ºif [ $a -ne 1] &amp;&amp; [ $a != 2 ]æˆ–è€…if [ $a -ne 1 -a $a != 2 ]ã€‚ çº¯æ•°å­—æ¯”è¾ƒ &gt; é€šè¿‡æ¯”è¾ƒASCIIå€¼,gtä»…èƒ½æ¯”è¾ƒæ•°å­—123456789101112[root@dk-centos6 ~]# [ 2 \&gt; 1 ][root@dk-centos6 ~]# echo $?0[root@dk-centos6 ~]# [ 2 -gt 1 ][root@dk-centos6 ~]# echo $?0[root@dk-centos6 ~]# [[ 2 &gt; 1 ]][root@dk-centos6 ~]# echo $?0[root@dk-centos6 ~]# [[ 2 -gt 1 ]][root@dk-centos6 ~]# echo $?0 å­—ç¬¦ä¸²æ¯”è¾ƒ å•æ‹¬å·ä¸­å¦‚æœè¦æ¯”è¾ƒç¬¦å· â€œ&lt;â€ â€œ&gt;â€, éœ€è¦è½¬ä¹‰, å¦åˆ™åˆ¤æ–­ç»“æœé”™è¯¯123456789[root@dk-centos6 ~]# [ "b" &gt; "a" ][root@dk-centos6 ~]# echo $?0[root@dk-centos6 ~]# [ "b" &lt; "a" ][root@dk-centos6 ~]# echo $?0[root@dk-centos6 ~]# [ "b" \&lt; "a" ][root@dk-centos6 ~]# echo $?1 åŒæ‹¬å·ä¸ç”¨è½¬ä¹‰ , ç›´æ¥æ‰§è¡Œå³å¯123456[root@dk-centos6 ~]# [[ "b" &gt; "a" ]][root@dk-centos6 ~]# echo $?0[root@dk-centos6 ~]# [[ "b" &lt; "a" ]][root@dk-centos6 ~]# echo $?1]]></content>
      <categories>
        <category>linux</category>
        <category>shell</category>
      </categories>
      <tags>
        <tag>linux</tag>
        <tag>shell</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ”¶è—é“¾æ¥]]></title>
    <url>%2F2019%2F10%2F17%2F18-%E6%94%B6%E8%97%8F%E9%93%BE%E6%8E%A5%2F</url>
    <content type="text"><![CDATA[è®°å½•ä¸€äº›å¥½çš„ç½‘å€ äº‘åŸç”Ÿ äº‘åŸç”Ÿå›¾ä¹¦ç¼–å¹´å² äº‘åŸç”Ÿå¤§ä½¬åšå®¢æ±‡æ€»]]></content>
      <categories>
        <category>ç½‘å€</category>
        <category>æ”¶è—</category>
      </categories>
      <tags>
        <tag>æ”¶è—</tag>
        <tag>ç½‘å€</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[markdownä¸€äº›å†™æ³•è®°å½•]]></title>
    <url>%2F2019%2F10%2F16%2F17-markdown%E4%B8%80%E4%BA%9B%E5%86%99%E6%B3%95%E8%AE%B0%E5%BD%95%2F</url>
    <content type="text"><![CDATA[è®°å½•ä¸€äº›éœ€è¦æ³¨æ„çš„å†™æ³•,markdown æ˜¯æ”¯æŒhtmlè¯­æ³•çš„ è¿™é‡Œæƒ³å†™ä¸€ä¸ªå±…ä¸­çš„æ ‡é¢˜å’Œå›¾ç‰‡1234&lt;center&gt;&lt;img src="http://zhangzw001.github.io/images/dockerniu.jpeg" width = "100" height = "100" style="border: 0"/&gt;&lt;font color="blue" face="é»‘ä½“" size=5&gt; Dockerfile &lt;/font&gt;&lt;/center&gt; æ•ˆæœç‚¹å‡»æŸ¥çœ‹]]></content>
      <categories>
        <category>markdown</category>
      </categories>
      <tags>
        <tag>markdown</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Dockerfileä»‹ç»]]></title>
    <url>%2F2019%2F10%2F16%2F16-dockerfile%E4%BB%8B%E7%BB%8D%2F</url>
    <content type="text"><![CDATA[Dockerfile æœ¬æ–‡æ‘˜å½•äº: å¦‚ä½•å¿«é€Ÿå°†å®¹å™¨äº‘é•œåƒå¤§å°ç²¾ç®€98%ï¼Ÿ Dockerfile æ–‡ä»¶æœ‰è‡ªå·±çš„ä¹¦å†™æ ¼å¼å’Œæ”¯æŒçš„å‘½ä»¤ï¼Œå¸¸ç”¨çš„Dockerfile æŒ‡ä»¤æœ‰ï¼š FROM æŒ‡å®šåŸºé•œåƒã€‚ MAINTAINER è®¾ç½®é•œåƒçš„ä½œè€…ä¿¡æ¯ï¼Œå¦‚ä½œè€…å§“åã€é‚®ç®±ç­‰ã€‚ COPY å°†æ–‡ä»¶ä»æœ¬åœ°å¤åˆ¶åˆ°é•œåƒï¼Œæ‹·è´å‰éœ€è¦ä¿è¯æœ¬åœ°æºæ–‡ä»¶å­˜åœ¨ã€‚ ADD ä¸ COPY ç±»ä¼¼ï¼Œå¤åˆ¶æ–‡ä»¶åˆ°é•œåƒã€‚ä¸åŒçš„æ˜¯ï¼Œå¦‚æœæ–‡ä»¶æ˜¯å½’æ¡£æ–‡ä»¶ï¼ˆtar, zip, tgz, xz ç­‰ï¼‰ï¼Œä¼šè¢«è‡ªåŠ¨è§£å‹ã€‚ ENV è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œæ ¼å¼: ENV key=valueæˆ–ENV key valueï¼Œè¿è¡Œå®¹å™¨åï¼Œå¯ç›´æ¥åœ¨å®¹å™¨ä¸­ä½¿ç”¨ã€‚ EXPOSE æš´éœ²å®¹å™¨ä¸­æŒ‡å®šçš„ç«¯å£ï¼Œåªæ˜¯ä¸€ä¸ªå£°æ˜ï¼Œä¸»è¦ç”¨æˆ·äº†è§£åº”ç”¨ç›‘å¬çš„ç«¯å£ã€‚ VOLUME æŒ‚è½½å·åˆ°å®¹å™¨ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¿å­˜é•œåƒæ—¶ä¸ä¼šä¿å­˜å·ä¸­çš„æ•°æ®ã€‚ WORKDIR è®¾ç½®å½“å‰å·¥ä½œç›®å½•ï¼Œåç»­å„å±‚çš„å½“å‰ç›®å½•éƒ½è¢«æŒ‡å®šã€‚ RUN åœ¨å®¹å™¨ä¸­è¿è¡ŒæŒ‡å®šçš„å‘½ä»¤ã€‚ CMD å®¹å™¨å¯åŠ¨æ—¶è¿è¡Œçš„å‘½ä»¤ã€‚Dockerfile ä¸­å¯ä»¥æœ‰å¤šä¸ª CMD æŒ‡ä»¤ï¼Œä½†åªæœ‰æœ€åä¸€ä¸ªç”Ÿæ•ˆã€‚CMD å¯ä»¥è¢« docker run ä¹‹åçš„å‚æ•°æ›¿æ¢ã€‚ ENTRYPOINT è®¾ç½®å®¹å™¨å¯åŠ¨æ—¶è¿è¡Œçš„å‘½ä»¤ã€‚Dockerfile ä¸­å¯ä»¥æœ‰å¤šä¸ª ENTRYPOINT æŒ‡ä»¤ï¼Œä½†åªæœ‰æœ€åä¸€ä¸ªç”Ÿæ•ˆã€‚CMD æˆ– docker run ä¹‹åçš„å‚æ•°ä¼šè¢«å½“åšå‚æ•°ä¼ é€’ç»™ ENTRYPOINTï¼Œè¿™ä¸ªæ˜¯ä¸CMDçš„åŒºåˆ«ã€‚ å®¹å™¨çš„åŸç† å®¹å™¨é•œåƒä¸­æœ€é‡è¦çš„æ¦‚å¿µå°±æ˜¯layersï¼Œå³é•œåƒå±‚ã€‚ å®¹å™¨çš„åŸç† é•œåƒå±‚ä¾èµ–äºä¸€ç³»åˆ—çš„åº•å±‚æŠ€æœ¯ï¼Œæ¯”å¦‚æ–‡ä»¶ç³»ç»Ÿ(filesystems)ã€å†™æ—¶å¤åˆ¶(copy-on-write)ã€è”åˆæŒ‚è½½(union mounts)ç­‰æŠ€æœ¯æŸ¥çœ‹Docker å®˜æ–¹æ–‡æ¡£https://docs.docker.com/storage/storagedriver/è¿›è¡Œå­¦ä¹ ã€‚ æ¯æ¡æŒ‡ä»¤éƒ½åˆ›å»ºä¸€ä¸ªé•œåƒå±‚ï¼Œä¼šå¢åŠ é•œåƒçš„å¤§å° ä¸‹é¢çœ‹ä¸ªä¾‹å­è¿™é‡Œæˆ‘æœ‰ä¸€ä¸ª1.2Mçš„é•œåƒ 12docker images|grep busyboxbusybox latest 19485c79a9bb 5 weeks ago 1.22MB æˆ‘ä»¬åŸºäºbusyboxå†™ä¸€ä¸ªDockerfileæ¥build 1234567#cat Dockerfilefrom busybox:latestrun mkdir /tmp/dir \ &amp;&amp; dd if=/dev/zero of=/tmp/dir/file1 bs=1M count=10run rm -f /tmp/dir/file1 æ‰§è¡Œbuild 1234567891011121314151617docker build -t busybox-test .Sending build context to Docker daemon 2.048kBStep 1/3 : from busybox:latest ---&gt; 19485c79a9bbStep 2/3 : run mkdir /tmp/dir &amp;&amp; dd if=/dev/zero of=/tmp/dir/file1 bs=1M count=10 ---&gt; Running in 0426f92c77ed10+0 records in10+0 records out10485760 bytes (10.0MB) copied, 0.003785 seconds, 2.6GB/sRemoving intermediate container 0426f92c77ed ---&gt; 5ec75db090c9Step 3/3 : run rm -f /tmp/dir/file1 ---&gt; Running in 540e7d0a5aeaRemoving intermediate container 540e7d0a5aea ---&gt; 00041489cc0eSuccessfully built 00041489cc0eSuccessfully tagged busybox-test:latest æŸ¥çœ‹imageå¤§å° 123docker images|grep busyboxbusybox-test latest 00041489cc0e 10 minutes ago 11.7MBbusybox latest 19485c79a9bb 5 weeks ago 1.22MB ??? æˆ‘ä¸æ˜¯rmåˆ é™¤äº†åˆ›å»ºçš„/tmp/dir/file1 æ–‡ä»¶å—? éš¾é“å®ƒè¿˜åœ¨? æ¥,æˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹ 12# æŸ¥çœ‹ç›®å½•ä¸‹æ˜¯å¦æœ‰æ–‡ä»¶docker run -ti busybox-test ls /tmp/dir ç»“æœæ˜¾ç„¶æ˜¯ç©ºâ€¦ å–”,,, å› ä¸ºâ€åœ¨Dockerfileä¸­ï¼Œæ¯æ¡æŒ‡ä»¤éƒ½ä¼šåˆ›å»ºä¸€ä¸ªé•œåƒå±‚ï¼Œç»§è€Œä¼šå¢åŠ é•œåƒæ•´ä½“çš„å¤§å°â€, åœ¨çœ‹æˆ‘ä»¬å†™çš„Dockerfile,æˆ‘ä»¬ç¬¬ä¸€ä¸ªrun æ‰§è¡Œçš„æ—¶å€™, è¿™é‡Œå‡è£…å« (run1å±‚), æˆ‘ä»¬ç”Ÿæˆäº†file1æ–‡ä»¶å½“æ‰§è¡Œç¬¬äºŒä¸ªrunçš„æ—¶å€™, æˆ‘ä»¬å¤„åœ¨äº† (run2å±‚), (run1å±‚)å·²ç»æ˜¯çˆ¶å±‚,æ˜¯ä¸ªåªè¯»å±‚äº†,åªæœ‰å½“å‰å±‚å¯å†™, è™½ç„¶æˆ‘ä»¬åœ¨ (run2å±‚)åˆ é™¤äº†è¿™ä¸ªæ–‡ä»¶,ä½†åˆ é™¤çš„ä»…ä»…æ˜¯ä»½æ‹·è´è€Œå·², è¿™å°±æ˜¯å†™æ—¶å¤åˆ¶. æ‰€ä»¥ä»¥ä¸Šçš„ä¼˜åŒ–åº”è¯¥æ˜¯: å†™æˆä¸€æ¡run 123456789#cat Dockerfilefrom busybox:latestrun mkdir /tmp/dir \ &amp;&amp; dd if=/dev/zero of=/tmp/dir/file1 bs=1M count=10 \ &amp;&amp; rm -f /tmp/dir/file1# builddocker build -t busybox-test2 . ç»“æœæ˜¾ç„¶ 1234docker images|grep busyboxbusybox-test2 latest faf8b7d4f140 3 seconds ago 1.22MBbusybox-test latest 00041489cc0e 10 minutes ago 11.7MBbusybox latest 19485c79a9bb 5 weeks ago 1.22MB è™½ç„¶è¯´è¿™é‡Œçš„æµ‹è¯•æ²¡æœ‰å¹²ä»»ä½•äº‹æƒ…, ä½†æˆ‘ä»¬åœ¨å†™Dockerfileçš„æ—¶å€™éœ€è¦æ³¨æ„, ä¸¤ä¸ªrunä¹‹é—´æ˜¯ä¸¤ä¸ªä¸åŒçš„ å¯å†™å±‚! ç®€å•æ€»ç»“ç²¾ç®€é•œåƒå¤§å°çš„æ–¹æ³•: 121 ä½¿ç”¨æ›´å°çš„åŸºç¡€é•œåƒ,æ³¨æ„ä¸€äº›å¾ˆå°çš„é•œåƒå¯èƒ½ç¼ºå°‘å¾ˆå¤šä¾èµ–åº“,ä¾‹å¦‚æŸ¥çœ‹redisä¾èµ–åº“ ldd /usr/bin/redis-cli2 åˆå¹¶DockerfilecæŒ‡ä»¤ç²¾ç®€(å¯ä»¥çš„è¯å†™æˆä¸€æ¡run) ä¸€äº›å°çš„é•œåƒ 1 scratch: ä¸€ä¸ªç©ºçš„é•œåƒ, æ— æ³•pull -.-!!! , å†™åœ¨Dockerfileæ˜¯å¯ä»¥çš„ 2 alpine: 5Mçš„linuxé•œåƒ,æœ‰åŒ…ç®¡ç†å·¥å…·apk 123FROM scratchADD alpine-minirootfs-3.10.2-x86_64.tar.gz /CMD ["/bin/sh"] 3 busybox: 1Må¤šçš„é•œåƒ,ç§°ä¸ºåµŒå…¥å¼linuxçš„ç‘å£«å†›åˆ€, Linuxå’Œunixä¸€äº›å¸¸ç”¨çš„å‘½ä»¤]]></content>
      <categories>
        <category>docker</category>
        <category>Dockerfile</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[dockerç®€ä»‹å’Œä½¿ç”¨]]></title>
    <url>%2F2019%2F10%2F16%2F15-docker%E7%AE%80%E4%BB%8B%E5%92%8C%E4%BD%BF%E7%94%A8%2F</url>
    <content type="text"><![CDATA[ç®€å•ä»‹ç»docker docker]]></content>
      <categories>
        <category>docker</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[mysql5.5ç›®å½•copyæ–¹å¼è¿ç§»]]></title>
    <url>%2F2019%2F10%2F15%2F14-mysql%E7%9B%AE%E5%BD%95copy%E6%96%B9%E5%BC%8F%E8%BF%81%E7%A7%BB%2F</url>
    <content type="text"><![CDATA[ä»ç°æœ‰çš„ä¸€å° ä»åº“ å…¨copy dataç›®å½•åˆ°2å°æ–°æœºå™¨ä¸Š, å†é…ç½®mysqlä¸»ä» ç›®å½•copyæ–¹å¼è¿ç§» æ³¨æ„ ä¸è¦åˆ é™¤ibdata1,ä¼šå¯¼è‡´innodbè¡¨ä¸å­˜åœ¨ å¯ä»¥ä¸åˆ é™¤ib_logfile0,ib_logfile1, ä½†my.cnfé…ç½®å¤§å°ä¸€è‡´ åŒºåˆ«ç›®å½•æƒé™ä¸ºmysql,tmpç›®å½•å­˜åœ¨ è¯·è‡ªè¡Œå®‰è£…å¥½mysql5.5 1234567891 é¦–å…ˆåœæ­¢mysql/etc/init.d/mysqld stop2 åŒæ­¥æ•°æ®ç›®å½•åˆ°æ–°æœºå™¨/data/u013 ç¡®è®¤æ–°æœºå™¨ä¸Šmysqlç‰ˆæœ¬å¹¶é…ç½®/etc/my.cof4 å®Œæ•´è¿ç§»æ—¶ä¸éœ€è¦åˆ é™¤å†…å®¹(innodb_log_file_size = 256M é…ç½®è¦ä¸€è‡´)5 å¯åŠ¨mysql é…ç½®ä¸»ä» 1 é¦–å…ˆ ç›®å½•copyæ–¹å¼ åŒæ­¥æŸä¸ªä»åº“åˆ°2å°æ–°æœºå™¨å¹¶å¯åŠ¨å®Œæˆ, æ­¤æ—¶ä¸¤ä¸ªmysqléƒ½å¼€å¯äº†slave 2 æš‚åœåŒæ­¥ï¼Œå¹¶è®¾ç½®è¯»å†™ï¼› 123456stop slave;# è¯¥æ‰§è¡Œä»…ä¸»åº“ä¸Šæ‰§è¡Œ(é…ç½®å¯å†™)SET GLOBAL read_only=0;reset slave all;-- RESET SLAVE ALLæ˜¯æ¸…é™¤ä»åº“çš„åŒæ­¥å¤åˆ¶ä¿¡æ¯ã€åŒ…æ‹¬è¿æ¥ä¿¡æ¯å’ŒäºŒè¿›åˆ¶æ–‡ä»¶åã€ä½ç½®-- ä»åº“ä¸Šæ‰§è¡Œè¿™ä¸ªå‘½ä»¤åï¼Œä½¿ç”¨show slave statuså°†ä¸ä¼šæœ‰è¾“å‡ºã€‚ 3 2å°æ–°çš„mysqlä¸­ä¿®æ”¹ä»åº“slaveé…ç½®, è¿æ¥åˆ°æ–°çš„ä¸»åº“åœ°å€(æˆ‘è¿™é‡Œé€šè¿‡åŸŸåè§£æ) 12CHANGE MASTER TO MASTER_HOST='a_master.b.com',MASTER_PORT=3306,MASTER_USER='repl_user',MASTER_PASSWORD='xxxx',MASTER_LOG_FILE='m1-master-bin.000001',MASTER_LOG_POS=88; 4 ç”±äºæœ¬æœºéœ€è¦å®‰è£…mysql5.5å’Œmysql5.7æ‰€ä»¥æ³¨æ„ä¸€ä¸‹ 123456# åˆå§‹åŒ–æŒ‡å®šé…ç½®æ–‡ä»¶/usr/local/mysql57/bin/mysqld --defaults-file=/etc/my57.cnf --initialize-insecure --user=mysql --basedir=/usr/local/mysql57 --datadir=/data/u001# ä¿®æ”¹/etc/init.d/mysqld57parse_server_arguments `$print_defaults -c /etc/my57.cnf mysqld server mysql_server mysql.server`$bindir/mysqld_safe --defaults-file=/etc/my57.cnf --pid-file="$mysqld_pid_file_path" $other_args &gt;/dev/null &amp; æŠ¥é”™ç»Ÿè®¡ ERROR 1840 (HY000) at line 24: @@GLOBAL.GTID_PURGED can only be set when @@GLOBAL.GTID_EXECUTED is empty. 1æ‰§è¡Œreset master; The MySQL server is running with theâ€“read-only option so it cannot execute this statement 1æ‰§è¡Œ set global read_only=0;]]></content>
      <categories>
        <category>æŠ€æœ¯æ–‡æ¡£</category>
        <category>mysql</category>
      </categories>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[äº‘åŸç”Ÿåšå®¢æ±‡æ€»]]></title>
    <url>%2F2019%2F10%2F12%2F13-%E4%BA%91%E5%8E%9F%E7%94%9F%E5%8D%9A%E5%AE%A2%E6%B1%87%E6%80%BB%2F</url>
    <content type="text"><![CDATA[è®°å½•ä¸€äº›äº‘åŸç”ŸæŠ€æœ¯åšå®¢ æ¥è‡ªServiceMesher[8] ç¾¤KaiRenâ€™s Blog Zlatan Eevee å›½å—ä¹‹å¢ƒ åšå®¢ | é«˜ç­– Kakashiâ€™s Blog Alex Wuâ€™s blog | THINK BIG, START SMALL, DELIVER VALUE TO THE BUSINESS å¼€å…ƒDevOpsçŸ¥è¯†åº“ - çŸ¥è¯†ç®¡ç†ï¼Œæ—¶é—´ç®¡ç†ï¼Œè‡ªæˆ‘ç®¡ç† èµ·é£äº† èŒ¶æ­‡é©¿ç«™ - Gopher, OpenSource Fans, æˆé•¿ä¹‹è·¯æœ‰æˆ‘ç›¸ä¼´ã€‚ Polar Snow Documentation äº‘åŸç”Ÿå®éªŒå®¤ - ç±³å¼€æœ—åŸºæ¨çš„åšå®¢ Jimmy Song - å®‹å‡€è¶…çš„åšå®¢|Cloud Native|äº‘åŸç”Ÿå¸ƒé“å¸ˆ æ¼ ç„¶çš„åšå®¢ | mritd Blog DevOps â€“ æˆé•¿ä¹‹è·¯ birdben æµ®ç”Ÿè‹¥æ¢¦ CNCF Cloud Native Interactive Landscape æœå±¹ä¸œçš„åšå®¢ | å­¦æ— æ­¢å¢ƒ æ¢¦æ—­éšæƒ³ ictfox blog CloudNative æ¶æ„ æˆ‘çˆ±è¥¿çº¢æŸ¿ Doublemine Bingo Huang Arthur Chunqi Liâ€™s Blog Archive | Arthur Chunqi Liâ€™s Blog ITæŠ€æœ¯å·¥ä½œå­¦ä¹ æŠ˜è…¾ç¬”è®° æä½¶æ¾³çš„åšå®¢ å¢¨è·ç¼æ—å®˜ç½‘-ç¼–ç¨‹æ—¥å¿— Archive - Nolla Tomoyaâ€™s Blog å›æ— æ­¢å¢ƒ Jamin Zhang roc - imroc.io|rocçš„åšå®¢|Cloud Native|Kubernetes|Go|Golang Blog | Sysdig sleeleçš„åšå®¢ TauCeti blog Â· TauCeti blog æ°´æ™¶å‘½åŒ£ | ç”Ÿå‘½åœ¨äºæŠ˜è…¾ï¼ŒæŠ˜è…¾ä¸‡å²ï¼ è‹æ´‹åšå®¢ LinuxTOY Infvieâ€™s Blog | è¿ç»´SREç¤¾åŒºåšå®¢ Solar MoeLove Hwchiu Learning Notekubernetes/SDN/DevOps å­˜å‚¨é¢†åŸŸ yangguanjun]]></content>
      <categories>
        <category>æŠ€æœ¯æ–‡æ¡£</category>
        <category>ç½‘å€</category>
        <category>å¤§ä½¬åšå®¢</category>
      </categories>
      <tags>
        <tag>äº‘åŸç”Ÿ</tag>
        <tag>cloud native</tag>
        <tag>å¤§ä½¬åšå®¢</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[awkç®€å•è®°å½•]]></title>
    <url>%2F2019%2F10%2F11%2F12-awk%E7%AE%80%E5%8D%95%E8%AE%B0%E5%BD%95%2F</url>
    <content type="text"><![CDATA[è®°å½•ä¸€äº›ç®€å•ä½¿ç”¨ å®ä¾‹1: è®¡ç®—nginxæ—¥å¿—ä¸­æŸä¸ªæ¥å£çš„æ¬¡æ•°å’Œå¹³å‡å“åº”æ—¶é—´ä¾‹å¦‚æˆ‘çš„a.txt nginxæ—¥å¿—æ ¼å¼å¦‚ä¸‹12a.b.com 1.1.1.1 [08/Sep/2019:23:57:01 +0800] "GET /v1/actionname?xxxx HTTP/1.1" 200 386 "-" "Mozilla/5.0 (Linux; Android 9; V1831A Build/P00610; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/68.0.3440.91 Mobile Safari/537.36" "-" "0.023"a.b.com 1.1.1.1 [08/Sep/2019:23:57:01 +0800] "GET /v1/actionname2?xxxx HTTP/1.1" 200 386 "-" "Mozilla/5.0 (Linux; Android 9; V1831A Build/P00610; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/68.0.3440.91 Mobile Safari/537.36" "-" "0.016" è¿™é‡Œæˆ‘åªæƒ³å–å‡ºæ¥å£å: /v1/actionname å’Œ 0.023 å“åº”æ—¶é—´ é¦–å…ˆæˆ‘å–å‡ºè¿™ä¸¤åˆ—1234567cat a.txt|awk -F '"' '&#123;print $(NF-1),$2&#125;'|awk -F '?' '&#123;print $1&#125;'|awk '&#123;print $1" "$3&#125;' &gt; b.txtcat b.txt0.023 /v1/actionname0.016 /v1/actionname2... å‘½ä»¤è¯¦è§£12345678&gt; ç¬¬ä¸€æ­¥ å“åº”æ—¶é—´æ±‚å’Œ&#123;s[$2]+=$1&#125;: æ¯é‡åˆ°ä¸€ä¸ª$2,æ¯”å¦‚é‡åˆ°/v1/actionname,è®°å½•ä¸€ä¸ªæ•°ç»„s[/v1/actionname] = æ‰€æœ‰$1çš„å€¼çš„æ€»å’Œ&gt; ç¬¬äºŒæ­¥ ç®—æ¥å£çš„æ¬¡æ•°&#123;m[$2]++&#125;: æ¯é‡åˆ°ä¸€ä¸ª$2,æ¯”å¦‚é‡åˆ°/v1/actionname,è®°å½•ä¸€ä¸ªæ•°ç»„m[/v1/actionname] = æ‰€æœ‰$1çš„ä¸ªæ•°&gt; ç¬¬ä¸‰æ­¥ å–å¹³å‡å€¼# è¿™é‡Œè¾“å‡ºcsvæ–‡ä»¶cat b.txt|awk '&#123;m[$2]++&#125; &#123;s[$2]+=$1&#125; ; END &#123;for(i in m) &#123;print s[i]/m[i] "," m[i] "," i&#125;&#125;'|awk -F "," '$2 &gt; 20'|sort -k2nr &gt; test.csv]]></content>
      <categories>
        <category>linux</category>
        <category>awk</category>
      </categories>
      <tags>
        <tag>linux</tag>
        <tag>awk</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[mysqlç®€å•è®°å½•]]></title>
    <url>%2F2019%2F10%2F10%2F11-mysql%E7%AE%80%E5%8D%95%E8%AE%B0%E5%BD%95%2F</url>
    <content type="text"><![CDATA[ç®€å•è®°å½•ä¸€äº›mysqlçŸ¥è¯†ç‚¹ æ¸…ç©ºè¡¨123456789åˆ é™¤è¡¨ä¿¡æ¯çš„æ–¹å¼æœ‰ä¸¤ç§ :truncate table table_name;delete * from table_name;æ³¨ : truncateæ“ä½œä¸­çš„tableå¯ä»¥çœç•¥ï¼Œdeleteæ“ä½œä¸­çš„*å¯ä»¥çœç•¥truncateã€delete æ¸…ç©ºè¡¨æ•°æ®çš„åŒºåˆ« :1&gt; truncate æ˜¯æ•´ä½“åˆ é™¤ (é€Ÿåº¦è¾ƒå¿«)ï¼Œdeleteæ˜¯é€æ¡åˆ é™¤ (é€Ÿåº¦è¾ƒæ…¢)2&gt; truncate ä¸å†™æœåŠ¡å™¨ logï¼Œdelete å†™æœåŠ¡å™¨ logï¼Œä¹Ÿå°±æ˜¯ truncate æ•ˆç‡æ¯” deleteé«˜çš„åŸå› 3&gt; truncate ä¸æ¿€æ´»trigger (è§¦å‘å™¨)ï¼Œä½†æ˜¯ä¼šé‡ç½®Identity (æ ‡è¯†åˆ—ã€è‡ªå¢å­—æ®µ)ï¼Œç›¸å½“äºè‡ªå¢åˆ—ä¼šè¢«ç½®ä¸ºåˆå§‹å€¼ï¼Œåˆé‡æ–°ä»1å¼€å§‹è®°å½•ï¼Œè€Œä¸æ˜¯æ¥ç€åŸæ¥çš„ IDæ•°ã€‚è€Œ delete åˆ é™¤ä»¥åï¼Œidentity ä¾æ—§æ˜¯æ¥ç€è¢«åˆ é™¤çš„æœ€è¿‘çš„é‚£ä¸€æ¡è®°å½•IDåŠ 1åè¿›è¡Œè®°å½•ã€‚å¦‚æœåªéœ€åˆ é™¤è¡¨ä¸­çš„éƒ¨åˆ†è®°å½•ï¼Œåªèƒ½ä½¿ç”¨ DELETEè¯­å¥é…åˆ whereæ¡ä»¶ å¤‡ä»½12345# å…¨é‡é”è¡¨å¤‡ä»½(ä¸å¯å†™)mysqldump --lock-all-tables --all-databases &gt; ALLDB.sql# ä»…å¯¼å‡ºæ‰€æœ‰è¡¨çš„ç»“æ„mysqldump --opt -d æ•°æ®åº“å -u root -p &gt; xxx.sql slave ä¸­ä¿®æ”¹master_host12345678910# æŸ¥çœ‹ master.infoä¸­ä¿¡æ¯# æŸ¥çœ‹ show slave status\G ä¸­ Master_Host# ä¿®æ”¹çš„æ­¥éª¤éœ€è¦å…ˆåœæ­¢slave1 stop slave ;2 change master to master_host='xxx.xxx.xxx'; é¦–æ¬¡é…ç½®ä¸»åº“: CHANGE MASTER TO MASTER_HOST='a_master.b.com',MASTER_PORT=3306,MASTER_USER='repl_user',MASTER_PASSWORD='xxxx',MASTER_LOG_FILE='m1-master-bin.000001',MASTER_LOG_POS=88;3 start slave ; mysqlé—®é¢˜: navicatè¿æ¥æ•°æ®åº“å¾ˆæ…¢123456æŠ¥é”™: 2013-Lost connection to MYSQL server at 'reading for initial communication packet'è¯´æ˜: åªæœ‰windows çš„navicatä¼šå‡ºç°ä¸Šé¢æŠ¥é”™, windowsä¸Šé€šè¿‡mysqlå‘½ä»¤è¿æ¥æ—¶ ä¹Ÿå¾ˆæ…¢#æ·»åŠ å¦‚ä¸‹å†…å®¹:[mysqld]skip-name-resolve mysqlé—®é¢˜: mysql5.7 é”™è¯¯æ€»ç»“-ERROR 1067 (42000): Invalid default value for TIMESTAMP123456show variables like 'sql_mode';+---------------+-------------------------------------------------------------------------------------------------------------------------------------------+| Variable_name | Value |+---------------+-------------------------------------------------------------------------------------------------------------------------------------------+| sql_mode | ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION |+---------------+-------------------------------------------------------------------------------------------------------------------------------------------+ è¿™æ˜¯å› ä¸ºsql_modeä¸­çš„NO_ZEROR_DATEå¯¼åˆ¶çš„ï¼Œåœ¨strict modeä¸­ä¸å…è®¸â€™0000-00-00â€™ä½œä¸ºåˆæ³•æ—¥æœŸ å°†ä¸Šé¢çš„NO_ZERO_DATEæ”¹ä¸ºä¸‹é¢çš„ ALLOW_INVALID_DATES 12set sql_mode='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,ALLOW_INVALID_DATES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION';set session sql_mode='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION'; ä¸Šé¢çš„è®¾ç½®æ˜¯ä¸´æ—¶è®¾ç½®ï¼Œåœ¨é‡æ–°ç™»é™†åï¼Œè¯¥è®¾ç½®åˆæ¢å¤ä¸ºNO_ZERO_DATE mysql5.5ä¸»+mysql5.7ä» é—®é¢˜123ERROR 1794 (HY000): Slave is not configured or failed to initialize properly. You must at least set --server-id to enable either a master or a slave. Additional error messages can be found in the MySQL error log.server_uuidæ˜¯5.6çš„gtidç‰¹æ€§å¼•å…¥çš„ä¸€ä¸ªé…ç½®ï¼ŒæŠŠmysql5.7çš„ rpl_slave.ccæ–‡ä»¶ä¸­get_master_uuidå‡½æ•°æ¢æˆ5.6å¯¹åº”çš„å‡½æ•°å°±å¯ä»¥äº†ã€‚]]></content>
      <categories>
        <category>æŠ€æœ¯æ–‡æ¡£</category>
        <category>mysql</category>
      </categories>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[centos6å®‰è£…nginx1.16+php7.2]]></title>
    <url>%2F2019%2F09%2F27%2F10-centos6%E5%AE%89%E8%A3%85nginx1-16-php7-2%2F</url>
    <content type="text"><![CDATA[è®°å½•ç®€å•çš„å®‰è£…nginxå’Œphpçš„é…ç½®,ä»…ä¾›å‚è€ƒ å…ˆå‡†å¤‡ç¯å¢ƒ123456789# æ›´æ–°æºmv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.bakcurl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-6.repoyum clean allyum makecacheyum install -y epel-release# å®‰è£…ä¸€äº›ä¾èµ–åŒ…yum -y install gcc make cmake ncurses-devel libxml2-devel libtool-ltdl-devel gcc-c++ autoconf automake bison zlib-devel openssl-devel pcre-devel libxml2 libxml2-devel libcurl libcurl-devel autoconf automake libtool-ltdl libtool-ltdl-devel libjpeg libjpeg-turbo-devel libmcrypt-devel libpng-devel centos6ç¼–è¯‘å®‰è£…nginx123456789101112131415#é¦–å…ˆå®˜ç½‘ä¸‹è½½1.16cd /usr/local/src/wget http://nginx.org/download/nginx-1.16.0.tar.gztar -xvf nginx-1.16.0.tar.gz# ç¼–è¯‘ç®€å•çš„æ¨¡å—./configure --prefix=/usr/local/nginx/ --with-http_ssl_module --with-http_stub_status_module --with-http_stub_status_modulemake -j4make install# é€šè¿‡å¯åŠ¨è„šæœ¬å¯åŠ¨chmod +x /etc/init.d/nginxservice nginx start# å¼€æœºå¯åŠ¨chkconfig nginx on nginx å¯åŠ¨è„šæœ¬ /etc/init.d/nginx12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576#!/bin/bash# nginx Startup script for the Nginx HTTP Server# it is v.0.0.2 version.# chkconfig: - 85 15# description: Nginx is a high-performance web and proxy server.# It has a lot of features, but it's not for everyone.# processname: nginx# pidfile: /var/run/nginx.pid# config: /usr/local/nginx/conf/nginx.confnginx=/usr/local/nginx/sbin/nginxnginx_config=/usr/local/nginx/conf/nginx.confnginx_pid=/var/run/nginx.pidRETVAL=0prog="nginx"# Source function library.. /etc/rc.d/init.d/functions# Source networking configuration.. /etc/sysconfig/network# Check that networking is up.[ $&#123;NETWORKING&#125; = "no" ] &amp;&amp; exit 0[ -x $nginx ] || exit 0# Start nginx daemons functions.start() &#123;if [ -e $nginx_pid ];then echo "nginx already running...." exit 1fi echo -n $"Starting $prog: " daemon $nginx -c $&#123;nginx_config&#125; RETVAL=$? echo [ $RETVAL = 0 ] &amp;&amp; touch /var/lock/subsys/nginx return $RETVAL&#125;# Stop nginx daemons functions.stop() &#123; echo -n $"Stopping $prog: " killproc $nginx RETVAL=$? echo [ $RETVAL = 0 ] &amp;&amp; rm -f /var/lock/subsys/nginx /usr/local//nginx/logs/nginx.pid&#125;reload() &#123; echo -n $"Reloading $prog: " #kill -HUP `cat $&#123;nginx_pid&#125;` killproc $nginx -HUP RETVAL=$? echo&#125;# See how we were called.case "$1" instart) start ;;stop) stop ;;reload) reload ;;restart) stop start ;;status) status $prog RETVAL=$? ;;*) echo $"Usage: $prog &#123;start|stop|restart|reload|status|help&#125;" exit 1esacexit $RETVAL nginx.confç®€å•é…ç½®12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394959697user nobody nobody;worker_processes auto;worker_rlimit_nofile 102400;pid /var/run/nginx.pid;events &#123; use epoll; worker_connections 102400;&#125;http &#123; log_format main '$remote_addr - $remote_user [$time_local] "$request" ' '$status $body_bytes_sent "$http_referer" ' '"$http_user_agent" "$http_x_forwarded_for"'; ###å®šä¹‰ä¸€ä¸ªlog_format log_format main '[ $host $request_time $upstream_addr $upstream_response_time ] ' '$status ' '$remote_addr - $remote_user [$time_local] "$request" ' '$body_bytes_sent "$http_referer" "$http_user_agent" "$http_x_forwarded_for " "$bytes_sent" " $request_body"' ; ###æ—¥å¿—ç›®å½•é…ç½® #æ—¥å¿—å…¨éƒ¨å†™å…¥/nginx_logs/access.log æ–‡ä»¶ä¸­ã€‚å…³é—­æœ€åä¸¤ä¸ªserver_nameçš„æ—¥å¿— access_log /data/nginx_logs/access.log server_name_main; error_log /data/nginx_logs/error.log notice; ###æ‚é¡¹é…ç½® charset utf-8; #server nameçš„hashè¡¨ï¼Œ server_names_hash_bucket_size 128; #è¯·æ±‚å¤´å¦‚æœè¿‡å°ï¼Œé‚£ä¹ˆä¼šå¼•èµ·400é”™è¯¯ã€‚ä¸€èˆ¬å¦‚æœcookieè¿‡å¤§ï¼Œä¼šå¼•èµ·é—®é¢˜ã€‚getconf PAGESIZEç³»ç»Ÿåˆ†é¡µ client_header_buffer_size 8k; client_body_buffer_size 512k; large_client_header_buffers 16 16k; client_max_body_size 30m; sendfile on; tcp_nopush on; keepalive_timeout 60; tcp_nodelay on; #fastcgié€šç”¨é…ç½® fastcgi_connect_timeout 600; fastcgi_send_timeout 600; fastcgi_read_timeout 600; fastcgi_buffer_size 128k; fastcgi_buffers 8 256k; fastcgi_busy_buffers_size 256k; fastcgi_temp_file_write_size 256k; ###ä»£ç†æœ‰å…³çš„é…ç½® proxy_connect_timeout 600; proxy_read_timeout 600; proxy_send_timeout 600; proxy_buffer_size 512k; proxy_buffers 6 512k; proxy_busy_buffers_size 512k; proxy_temp_file_write_size 512k; #æˆ–è®¸åœ¨äºæµ‹è¯•,ä»£ç†æœåŠ¡å™¨ä¸ä¸»åŠ¨å…³é—­å®¢æˆ·ç«¯ï¼Œé˜²æ­¢499é”™è¯¯ proxy_ignore_client_abort on; ###gzipé…ç½® gzip on; gzip_min_length 1k; gzip_buffers 4 16k; gzip_http_version 1.0; gzip_comp_level 2; gzip_types text/plain application/x-javascript text/css application/xml; gzip_vary on; include /usr/local/nginx/conf/mime.types; default_type application/octet-stream; # éšè—nginxç‰ˆæœ¬ä¿¡æ¯ server_tokens off; server &#123; listen 80 default_server; server_name _; #server_name localhost; index index.html index.htm; root html; deny all; location / &#123; &#125; error_page 500 502 503 504 /50x.html; location = /50x.html &#123; root html; &#125; &#125;&#125; centos6ç¼–è¯‘å®‰è£…php712345678910111213141516# é¦–å…ˆå®‰è£…freetype2.4tar -xvf freetype-2.4.0.tar.gzcd freetype-2.4.0./configure --prefix=/usr/local/freetypemake -j4 &amp;&amp; make install# ç¼–è¯‘php7(ä¸éœ€è¦çš„å¯ä»¥å»æ‰)tar -xvf php-7.2.2.tar.gzcd php-7.2.2./configure --prefix=/usr/local/php --with-libxml-dir=/usr/ --with-pdo-mysql=mysqlnd --with-zlib --with-libxml-dir --with-openssl --enable-mysqlnd --enable-mbstring --with-config-file-path=/usr/local/php/etc/ --with-config-file-scan-dir=/usr/local/php/etc/conf.d --enable-fpm --with-freetype-dir=/usr/local/freetype --with-jpeg-dir --with-png-dir --with-gd --enable-gd-native-ttf --enable-pdo --enable-mbstring --enable-bcmathmake -j 4 &amp;&amp; make install# å®‰è£…composercurl -sS https://getcomposer.org/installer | php &amp;&amp; mv composer.phar /usr/bin/composer é…ç½®1234567891011# php.inié…ç½®(å…·ä½“é…ç½®å†…å®¹è‡ªè¡Œä¿®æ”¹)cp php.ini-production /usr/local/php7/etc/php.inicp /usr/local/php7/etc/php-fpm.conf.default /usr/local/php7/etc/php-fpm.confcp /usr/local/php7/etc/php-fpm.d/www.conf.default /usr/local/php7/etc/php-fpm.d/www.conf# å¯åŠ¨è„šæœ¬cp ./sapi/fpm/init.d.php-fpm /etc/init.d/php-fpmchmod +x /etc/init.d/php-fpm# åˆ›å»ºlinkln -s /usr/local/php7 /usr/local/php å¯åŠ¨php-fpm12service php-fpm startchkconfig php-fpm on]]></content>
      <categories>
        <category>æŠ€æœ¯æ–‡æ¡£</category>
        <category>nginx</category>
      </categories>
      <tags>
        <tag>nginx</tag>
        <tag>php7</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[linuxé‡åˆ°ä¸€äº›é—®é¢˜ç»Ÿè®¡æ€»ç»“]]></title>
    <url>%2F2019%2F09%2F26%2F9-linux%E9%81%87%E5%88%B0%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98%E7%BB%9F%E8%AE%A1%E6%80%BB%E7%BB%93%2F</url>
    <content type="text"><![CDATA[è®°å½•ä¸€äº›Linux,nginxæˆ–å…¶ä»–æœåŠ¡ä¸€äº›é—®é¢˜ linuxé—®é¢˜: tcpdumpæŠ“åŒ…tcpç¬¬ä¸‰æ¬¡æ¡æ‰‹ackä¸º1 æ‰§è¡Œå‘½ä»¤ç›‘å¬: tcpdump -n port 80 (æƒ³è¦è¯¦ç»†ä¿¡æ¯åŠ  -vv) å®¢æˆ·ç«¯ telnet x.x.x.x 80 æ—¥å¿—å¦‚ä¸‹: 123456tcpdump -n port 80tcpdump: verbose output suppressed, use -v or -vv for full protocol decodelistening on enp0s3, link-type EN10MB (Ethernet), capture size 262144 bytes11:16:40.689157 IP 172.16.54.141.53444 &gt; 172.16.53.106.http: Flags [SEW], seq 1306124348, win 65535, options [mss 1460,nop,wscale 5,nop,nop,TS val 458678777 ecr 0,sackOK,eol], length 011:16:40.689724 IP 172.16.53.106.http &gt; 172.16.54.141.53444: Flags [S.E], seq 1553518959, ack 1306124349, win 64308, options [mss 1410,sackOK,TS val 4208119240 ecr 458678777,nop,wscale 7], length 011:16:40.690320 IP 172.16.54.141.53444 &gt; 172.16.53.106.http: Flags [.], ack 1, win 4106, options [nop,nop,TS val 458678778 ecr 4208119240], length 0 è¿™é‡Œç¬¬ä¸€å’Œç¬¬äºŒæ¬¡æ¡æ‰‹éƒ½æ²¡æœ‰é—®é¢˜, ç¬¬ä¸‰æ¬¡ ack 1, å¹¶éæ˜¯seq+1 è¿™é‡Œæä¸€ä¸‹ACK, ACK æ˜¯ç¡®è®¤å€¼, ack æ˜¯ç¡®è®¤ç¼–å·, ç¬¬ä¸€æ¬¡æ¡æ‰‹ACK=0,åœ¨ç¬¬äºŒæ¬¡æ¡æ‰‹å¼€å§‹ACK=1, è€Œackæ˜¯=seq+1(æ”¶åˆ°çš„éšæœºæ•°+1) é‚£ä¹ˆè¿™é‡Œack 1 æ˜¯å•¥å‘¢? â€¦ åº”è¯¥å°±æ˜¯é»˜è®¤tcpdump æ˜¾ç¤ºæˆç›¸å¯¹å€¼äº†, é€šè¿‡-S å‚æ•°ä¼šæ˜¾ç¤ºç»å¯¹å€¼ æ‰§è¡Œå‘½ä»¤ç›‘å¬: tcpdump -S -n port 8012345tcpdump: verbose output suppressed, use -v or -vv for full protocol decodelistening on enp0s3, link-type EN10MB (Ethernet), capture size 262144 bytes11:16:54.806628 IP 172.16.54.141.53516 &gt; 172.16.53.106.http: Flags [S], seq 316359286, win 65535, options [mss 1460,nop,wscale 5,nop,nop,TS val 458692791 ecr 0,sackOK,eol], length 011:16:54.806861 IP 172.16.53.106.http &gt; 172.16.54.141.53516: Flags [S.], seq 1113466641, ack 316359287, win 64308, options [mss 1410,sackOK,TS val 4208133357 ecr 458692791,nop,wscale 7], length 011:16:54.807576 IP 172.16.54.141.53516 &gt; 172.16.53.106.http: Flags [.], ack 1113466642, win 4106, options [nop,nop,TS val 458692792 ecr 4208133357], length 0 ä¸‰æ¬¡æ¡æ‰‹å›¾ å››æ¬¡æŒ¥æ‰‹å›¾ linuxé—®é¢˜: ç¦ping12345678# ä¸€æ¬¡æ€§ä¿®æ”¹echo 1 &gt; /proc/sys/net/ipv4/icmp_echo_ignore_all# å¼€æœºè‡ªåŠ¨ä¿®æ”¹echo 1 &gt; /proc/sys/net/ipv4/icmp_echo_ignore_all# æ°¸ä¹…ç¦ç”¨,åŠ å…¥åˆ°/etc/sysctl.confnet.ipv4.icmp_echo_ignore_all=1 linuxé—®é¢˜: æ–‡ä»¶é”é—®é¢˜1234567é—®é¢˜æè¿°: php slowlog å‡ºç°session_start() æ…¢é—®é¢˜åŸå› : æˆ‘ä»¬è¿™è¾¹æœ‰A å’ŒB ä¸¤ä¸ªäºŒçº§åŸŸå,A ä¼šè¯·æ±‚ B, å¹¶ä¸”ç”±äºæµ‹è¯•ç¯å¢ƒåœ¨åŒä¸€å°æœåŠ¡å™¨,å…¬ç”¨ä¸€ä¸ªphp,æ‰€ä»¥åœ¨å‘ç”Ÿè°ƒç”¨çš„æ—¶å€™åŒæ—¶å†™äº†session,è€Œphpçš„sessionsé…ç½®æ˜¯é»˜è®¤çš„fileæ–¹å¼, è¿™å°±é€ æˆäº†é”çš„é—®é¢˜é—®é¢˜è§£å†³: 1. ä¿®æ”¹ä»£ç éƒ¨åˆ†2. phpçš„sessioné…ç½®æ”¹æˆredis session.save_handler = redis session.save_path = "tcp://x.x.x.x:xxxx" linuxé—®é¢˜: å†…å­˜é‡Šæ”¾é—®é¢˜123456é—®é¢˜æè¿°: å¼€å‘è¿™è¾¹å†™äº†ä¸ªç»Ÿè®¡è„šæœ¬, å ç”¨49Gå†…å­˜, ä»æ—¥å¿—å‘ç°è„šæœ¬å·²ç»å…¨éƒ¨æ‰§è¡Œå®Œæˆ, ä½†æ˜¯phpè„šæœ¬ä¾ç„¶å­˜åœ¨é—®é¢˜åŸå› : é€šè¿‡ strace -p pid è§‚å¯Ÿè¿›ç¨‹, å‘ç°æ˜¯æŒç»­æ€§çš„åšå†…å­˜é‡Šæ”¾æ“ä½œ munmap(0x7f6db77ad000, 266240) = 0æŒç»­æ‰§è¡Œmunmapå‡½æ•°æ˜¯å› ä¸ºä¸€ç›´åœ¨é‡Šæ”¾å†…å­˜(æ¯•ç«Ÿ49G), ç»“æœ =0 è¯´æ˜å†…å­˜é‡Šæ”¾æ‰§è¡Œå‡½æ•°æ˜¯è¿”å›æ­£å¸¸äº†é—®é¢˜è§£å†³: 1. ä¿®æ”¹ä»£ç é™ä½å†…å­˜2. ç­‰å¾…ä¸€æ®µæ—¶é—´å†…å­˜ä¼šé‡Šæ”¾å®Œæˆ(æµ‹è¯•80åˆ†é’Ÿé‡Šæ”¾å®Œæ¯•) nginxé—®é¢˜: é™æ€æ–‡ä»¶åˆ†ç¦»å¯¹äºä¸€èˆ¬çš„nginx+phpçš„æ–¹å¼, æˆ‘ä»¬phpé‡‡ç”¨nobodyç”¨æˆ·,è€Œä»£ç /lumené‡‡ç”¨web-wwwç”¨æˆ·, è¿™æ ·çš„å¥½å¤„æ˜¯é¡µé¢è®¿é—®åˆ°/lumenæ—¶æ˜¯nobodyç”¨æˆ·, æ˜¯æ— æ³•ä¿®æ”¹ä»£ç çš„ å¯èƒ½æˆ‘ä»¬éœ€æ±‚æ˜¯ä¸Šç”¨æˆ·uploadå›¾ç‰‡ç­‰, è¿™æ—¶å€™å°±å¯èƒ½è¢«ä¼ ä¸ŠæŸä¸ªa.php, è¿™å°±æœ‰å¯èƒ½è¢«ä»£ç æ³¨å…¥(ä¸€èˆ¬æ¥è¯´å›¾ç‰‡æ˜¯æ”¾cdn,é…ç½®å•ç‹¬åŸŸåå›æºçš„,è¿™é‡Œæ˜¯ç›´æ¥å­˜åœ¨é¡¹ç›®ç›®å½•) æ‰€ä»¥ä¸ºäº†é˜²æ­¢ä»£ç æ³¨å…¥,æˆ‘ä»¬éœ€è¦é™åˆ¶uploadç›®å½•çš„è®¿é—®æƒé™ 1234# nginxé…ç½®å¦‚ä¸‹ location ~ /images/.*\.(gif|jpg|jpeg|png)$ &#123; root /lumen/storage/uploads/; &#125; è¿™æ ·æˆ‘ä»¬å›¾ç‰‡ä¼ åˆ° /lumen/storage/uploads/images/ ç›®å½•, è®¿é—®æ˜¯ www.xxx.com/images/x.png æ¥è®¿é—® ä¸”ä¸å…è®¸å…¶ä»–ç±»å‹æ–‡ä»¶è®¿é—®. nginxé—®é¢˜: root å’Œaliasåœ¨é…ç½®æ–‡ä»¶æ˜ å°„çš„æ—¶å€™ï¼Œå¦‚æœä½¿ç”¨äº†æ­£åˆ™è¡¨è¾¾å¼ï¼Œé‚£ä¹ˆå¯èƒ½ä¼šå‡ºç°æ— æ³•è®¿é—®æ–‡ä»¶ï¼Œnginxå¯èƒ½ä¼šå°†æ‰€æœ‰çš„æ–‡ä»¶éƒ½æ˜ å°„æˆä¸ºæ–‡ä»¶å¤¹ï¼Œå¯¼è‡´æ–‡ä»¶æ˜ å°„å¤±è´¥çš„æƒ…å†µå‡ºç°ï¼› rootçš„ä¾‹å­ 1234location /a/ &#123; root /lumen/public;&#125;è¿™é‡Œå®é™…è®¿é—®çš„è·¯å¾„: www.xxx.com/a/ -&gt; /lumen/public/a/ aliasçš„ä¾‹å­ 12345# æ³¨æ„è¿™é‡Œç›®å½•æœ€ååŠ ä¸Š/location /a/ &#123; alias /lumen/public/;&#125;è¿™é‡Œå®é™…è®¿é—®çš„è·¯å¾„: www.xxx.com/a/ -&gt; /lumen/public/ nginxé—®é¢˜: éšè—ç‰ˆæœ¬ä¿¡æ¯123Syntax: server_tokens on | off | build | string;Default: server_tokens on;Context: http, server, location nginxé—®é¢˜: æ—¥å¿—å‡ºç°encodeå†…å®¹å¦‚ä½•æŸ¥çœ‹12# python2 æ‰§è¡Œdecode&gt;&gt;&gt; print "\x22content\x22\x0D\x0A\x0D\x0A\xE8\x8A\x8A\xE8\x8A\x8A\xE8\xBF\x98\xE6\x80\x95\xE5\xA6\x9E\xE5\xA6\x9E\xE4\xB8\x8D\xE8\x80\x81\xE5\xAE\x9E\xEF\xBC\x8C\xE7\x89\xB9\xE5\x9C\xB0\xE8\xBF\x87\xE6\x9D\xA5\xE8\xA7\x86\xE5\xAF\x9F\xE4\xB8\x80\xE4\xB8\x8B\x0D\x0A".decode('utf-8') nginxé—®é¢˜: defaulté…ç½®æœªè®¾ç½®nginx æœªè®¾ç½®defaultæ—¶, å¦‚æœç›´æ¥è®¿é—®æœåŠ¡å™¨å¤–ç½‘ip, ä¼šå»è¯·æ±‚åˆ°ç¬¬ä¸€ä¸ªåŒ¹é…çš„serveræ®µ, æœ‰å¯èƒ½ä¼šè¯·æ±‚åˆ°åç«¯çš„æœåŠ¡å™¨çš„å†…å®¹, è¿™å¾ˆæœ‰å¯èƒ½æš´éœ²æˆ‘ä»¬ä¸æƒ³æš´éœ²çš„æœåŠ¡ä¸€èˆ¬æ¥è¯´å¼€å¤´æ·»åŠ å¦‚ä¸‹é…ç½® 123456 server &#123; listen 80 default_server; listen [::]:80 default_server; server_name _; deny all;&#125; nginx é…ç½®å·²ç»é…ç½®åŸŸåæ–¹å¼è®¿é—®, å¦‚æœè®¿é—®ipä¼šè¿”å›403, æ­£å¸¸æ¥è¯´è¿”å›403å·²ç»ä¸ä¼šå¯¹æœåŠ¡å™¨é€ æˆå‹åŠ›äº† å¯æ˜¯ä¸‡ä¸‡æ²¡æƒ³åˆ°è™½ç„¶è¿”å›äº†403, ä½†æ˜¯ä¹Ÿæœ‰700å­—èŠ‚å¤§å°, å¤§é‡è¯·æ±‚å¯¹å°å¸¦å®½æ¥è¯´è¿˜æ˜¯æœ‰å‹åŠ›çš„ 123456789101112# server &#123; listen 80 default_server; listen [::]:80 default_server; server_name _; return 499; &#125;#å…¶ä»–location,ifé…ç½®,if ($host != a.example.com) &#123; return 499;&#125;]]></content>
      <categories>
        <category>æŠ€æœ¯æ–‡æ¡£</category>
        <category>linux</category>
        <category>é—®é¢˜æ€»ç»“</category>
      </categories>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[mysql5.7äºŒè¿›åˆ¶éƒ¨ç½²]]></title>
    <url>%2F2019%2F09%2F26%2F8-mysql5-7%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%83%A8%E7%BD%B2%2F</url>
    <content type="text"><![CDATA[äºŒè¿›åˆ¶æ–¹å¼éƒ¨ç½²mysql5.7 ä¸‹è½½glibcäºŒè¿›åˆ¶åŒ…12345#æ‰“å¼€ä¸‹è½½é¡µé¢, å¯èƒ½ä¼šæœ‰å°ç‰ˆæœ¬æ›´æ–°(æ³¨æ„ï¼šé€‰æ‹©æ“ä½œç³»ç»Ÿæ—¶é€‰Linux-Genericï¼‰https://dev.mysql.com/downloads/mysql/5.7.html#downloads# æœ€æ–°çš„å¯èƒ½æœ‰å°ç‰ˆæœ¬å˜åŒ–wget https://cdn.mysql.com/Downloads/MySQL-5.7/mysql-5.7.24-linux-glibc2.12-x86_64.tar.gz å®‰è£…é…ç½®1234567891011121314151617181920212223242526272829303132333435363738394041tar -xvf mysql-5.7.24-linux-glibc2.12-x86_64.tar.gzmv mysql-5.7.24-linux-glibc2.12-x86_64 /usr/local/cd /usr/local/# æˆ‘çš„é•œåƒæ˜¯å®‰è£…è¿‡5.5mysql, æ‰€ä»¥éœ€è¦mvä¸€ä¸‹mv mysql mysql-5.5.37# ç”±äºä»¥å‰å®‰è£…è¿‡phpæŒ‡å®šäº†è¯¥mysqç›®å½•, è¿™å¯èƒ½å¯¼è‡´ä»¥å‰å®‰è£…çš„phpç¼ºå°‘libmysqlclient.so.18ln -s /usr/local/mysql-5.5.37/lib/libmysqlclient.so.18 /usr/local/mysql-5.7.24-linux-glibc2.12-x86_64/lib/libmysqlclient.so.18ln -s mysql-5.7.24-linux-glibc2.12-x86_64 mysql# æ·»åŠ å¯åŠ¨æ–‡ä»¶\cp mysql/support-files/mysql.server /etc/init.d/mysqldecho "PATH=$PATH:/usr/local/mysql/bin/" &gt;&gt;~/.bashrc# å¯é€‰wget http://centos.mirrors.ucloud.cn/centos/6/os/x86_64/Packages/numactl-2.0.9-2.el6.x86_64.rpmyum localinstall numactl-2.0.9-2.el6.x86_64.rpm\rm numactl-2.0.9-2.el6.x86_64.rpmuseradd mysql# é…ç½®ä¸‹mysqlçš„æ•°æ®ç›®å½•cd /data/mkdir u01mkdir u02chown -R mysql.mysql u01chown -R mysql.mysql u02chmod 750 u01chmod 750 u02cd /data/u01/# åˆå§‹åŒ–/usr/local/mysql/bin/mysqld --initialize-insecure --user=mysql --basedir=/usr/local/mysql --datadir=/data/u01cat auto.cnf# å¯åŠ¨æœåŠ¡ (åœ¨è¿™ä¹‹å‰å‡†å¤‡å¥½ /etc/my.cnf)/etc/init.d/mysqld start# è®°å½•ä¸‹variablesmysql -e "show global variables" &gt;mysql_option_default.log my.cnf123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172[client]port = 3306socket = /data/u01/mysql.sock[mysql]prompt="\u@m1-u [\d]&gt; "no-auto-rehash[mysqld]user = mysqlport = 3306basedir = /usr/local/mysqldatadir = /data/u01socket = /data/u01/mysql.sockpid-file = /data/u01/m1-u.pidtmpdir = /data/u02server-id = 1001character-set-server = utf8skip_name_resolve = 1innodb_file_per_table = 1explicit_defaults_for_timestamp = 0# buffer&amp;cachetable_open_cache = 100table_definition_cache = 400table_open_cache_instances = 64sort_buffer_size = 4Mjoin_buffer_size = 4Mread_buffer_size = 8Mread_rnd_buffer_size = 4M# thread&amp;connectionthread_stack = 256Kthread_cache_size = 768back_log = 1024max_connections = 3000max_connect_errors = 1000000# temptabletmp_table_size = 32Mmax_heap_table_size = 32M# networkmax_allowed_packet = 32M#lock_wait_timeout = 3600#interactive_timeout = 600#wait_timeout = 600# query cachequery_cache_size = 0query_cache_type = 0# è®¾ç½®errorlogã€slowlogå’Œgenerallogçš„æ—¶åŒºï¼Œé»˜è®¤UTClog_timestamps = SYSTEM# error-loglog_error = /data/u02/mysqld.log# slow-logslow_query_log = 1slow_query_log_file = /data/u02/slow.loglong_query_time = 0.1log_queries_not_using_indexes =1log_throttle_queries_not_using_indexes = 60min_examined_row_limit = 100log_slow_admin_statements = 1log_slow_slave_statements = 1# general log#general-log = 1general_log_file=/data/u02/query.log# binlogbinlog_format = rowbinlog_checksum = 1log-bin = /data/u02/bdm1-binlog-bin-index = /data/u02/bdm1-bin.indexsync_binlog = 0binlog_cache_size = 4Mmax_binlog_cache_size = 2Gmax_binlog_size = 512Mexpire_logs_days = 15# GTIDgtid_mode = onenforce_gtid_consistency = 1log_slave_updates# Replicationmaster_info_repository = TABLErelay_log_info_repository = TABLEslave-rows-search-algorithms = 'INDEX_SCAN,HASH_SCAN'relay_log_recovery = 1relay_log_purge = 1relay-log=/data/u02/bdm1-relay-binrelay-log-index=/data/u02/bdm1-relay-bin.index# innodb-buffer&amp;cacheinnodb_buffer_pool_size = 2Ginnodb_buffer_pool_instances = 4#innodb_additional_mem_pool_size = 16Minnodb_max_dirty_pages_pct = 50# innodb loginnodb_data_file_path = ibdata1:1G:autoextendinnodb_log_file_size = 1Ginnodb_log_files_in_group = 2innodb_flush_log_at_trx_commit = 2innodb_log_buffer_size = 32M#innodb_max_undo_log_size = 4G#innodb_undo_directory = undologinnodb_undo_tablespaces = 4# innodb-ioinnodb_flush_method = O_DIRECTinnodb_io_capacity = 600innodb_io_capacity_max = 2000innodb_flush_sync = 0innodb_flush_neighbors = 0#innodb_lru_scan_depth = 4000innodb_write_io_threads = 8innodb_read_io_threads = 8innodb_purge_threads = 4innodb_page_cleaners = 4# transaction,lock#innodb_sync_spin_loops = 100#innodb_spin_wait_delay = 30innodb_lock_wait_timeout = 10innodb_print_all_deadlocks = 1innodb_rollback_on_timeout = 1innodb_open_files = 65535innodb_online_alter_log_max_size = 2G# innodb statusinnodb_status_file = 1# æ³¨æ„: å¼€å¯ innodb_status_output &amp; innodb_status_output_locks å, å¯èƒ½ä¼šå¯¼è‡´log-erroræ–‡ä»¶å¢é•¿è¾ƒå¿«innodb_status_output = 0innodb_status_output_locks = 0#performance_schemaperformance_schema = 1performance_schema_instrument = '%=on'#innodb monitorinnodb_monitor_enable="module_innodb"innodb_monitor_enable="module_server"innodb_monitor_enable="module_dml"innodb_monitor_enable="module_ddl"innodb_monitor_enable="module_trx"innodb_monitor_enable="module_os"innodb_monitor_enable="module_purge"innodb_monitor_enable="module_log"innodb_monitor_enable="module_lock"innodb_monitor_enable="module_buffer"innodb_monitor_enable="module_index"innodb_monitor_enable="module_ibuf_system"innodb_monitor_enable="module_buffer_page"innodb_monitor_enable="module_adaptive_hash"# MyISAMkey_buffer_size = 1024Mbulk_insert_buffer_size = 64Mmyisam_sort_buffer_size = 128Mmyisam_repair_threads = 1[mysqldump]quickmax_allowed_packet = 32M]]></content>
      <categories>
        <category>æŠ€æœ¯æ–‡æ¡£</category>
        <category>mysql</category>
      </categories>
      <tags>
        <tag>mysql</tag>
        <tag>mysql5.7</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[k8séƒ¨ç½²storageclassåŠ¨æ€åˆ›å»ºpv(nfs&rbd)]]></title>
    <url>%2F2019%2F09%2F26%2F7-k8s%E9%83%A8%E7%BD%B2storageclass%E5%8A%A8%E6%80%81%E5%88%9B%E5%BB%BApv-nfs-rbd%2F</url>
    <content type="text"><![CDATA[è€ƒè™‘åˆ°k8så­˜å‚¨çš„é—®é¢˜, æœ¬æœºç›®å½•æŒ‚è½½å­˜åœ¨å¤ªå¤§å±€é™æ€§, å¤šnodeå¤špodçš„æœåŠ¡å­˜å‚¨æ€¥è¿«éœ€è¦å…±äº«å­˜å‚¨, è¿™é‡Œç®€å•åº”ç”¨k8s storageclass nfså’Œrbdå­˜å‚¨ ç¬¬ä¸€éƒ¨åˆ† nfsè¿™é‡Œå•èŠ‚ç‚¹ç®€å•é…ç½®nfs(é«˜å¹¶å‘å¯é‡‡ç”¨nfs+rsync+inotifyæˆ–Sersync) é«˜å¹¶å‘å‚è€ƒ NFSé«˜å¯ç”¨(NFS+keepalive+Sersync)inotify+rsyncå®æ—¶å¤‡ä»½æ€»ç»“ 12345678910#å®‰è£…nfsyum install -y nfs-utils rpcbind# åˆ›å»ºç›®å½•mkdir /data/nfsecho "/data/nfs 172.16.76.0/24(rw,sync,no_root_squash) " &gt;&gt;/etc/exports# å¯åŠ¨æœåŠ¡systemctl start rpcbindsystemctl start nfs k8séƒ¨ç½²storageclassç¯å¢ƒ-nfså¯¼å…¥å¤–éƒ¨é…ç½®12345git clone https://github.com/kubernetes-incubator/external-storage.gitcd external-storage/nfs-client/deploy#æ³¨æ„1 nodeèŠ‚ç‚¹éœ€è¦å®‰è£…nfs-utils(centos7),nfs-common(ubuntu) ä¿®æ”¹deployment.yaml12345678910111213141516171819202122232425262728293031323334353637apiVersion: v1kind: ServiceAccountmetadata: name: nfs-client-provisioner---kind: DeploymentapiVersion: extensions/v1beta1metadata: name: nfs-client-provisionerspec: replicas: 1 strategy: type: Recreate template: metadata: labels: app: nfs-client-provisioner spec: serviceAccountName: nfs-client-provisioner containers: - name: nfs-client-provisioner image: quay.io/external_storage/nfs-client-provisioner:latest volumeMounts: - name: nfs-client-root mountPath: /persistentvolumes env: - name: PROVISIONER_NAME value: nfs.com/nfs - name: NFS_SERVER value: 172.16.76.134 - name: NFS_PATH value: /data/nfs volumes: - name: nfs-client-root nfs: server: 172.16.76.134 path: /data/nfs ä¿®æ”¹class.yaml1234567apiVersion: storage.k8s.io/v1kind: StorageClassmetadata: name: nfsprovisioner: nfs.com/nfsparameters: archiveOnDelete: "false" rbac.yamlä¸ç”¨ä¿®æ”¹1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859rbac.yamlkind: ServiceAccountapiVersion: v1metadata: name: nfs-client-provisioner---kind: ClusterRoleapiVersion: rbac.authorization.k8s.io/v1metadata: name: nfs-client-provisioner-runnerrules: - apiGroups: [""] resources: ["persistentvolumes"] verbs: ["get", "list", "watch", "create", "delete"] - apiGroups: [""] resources: ["persistentvolumeclaims"] verbs: ["get", "list", "watch", "update"] - apiGroups: ["storage.k8s.io"] resources: ["storageclasses"] verbs: ["get", "list", "watch"] - apiGroups: [""] resources: ["events"] verbs: ["create", "update", "patch"]---kind: ClusterRoleBindingapiVersion: rbac.authorization.k8s.io/v1metadata: name: run-nfs-client-provisionersubjects: - kind: ServiceAccount name: nfs-client-provisioner namespace: defaultroleRef: kind: ClusterRole name: nfs-client-provisioner-runner apiGroup: rbac.authorization.k8s.io---kind: RoleapiVersion: rbac.authorization.k8s.io/v1metadata: name: leader-locking-nfs-client-provisionerrules: - apiGroups: [""] resources: ["endpoints"] verbs: ["get", "list", "watch", "create", "update", "patch"]---kind: RoleBindingapiVersion: rbac.authorization.k8s.io/v1metadata: name: leader-locking-nfs-client-provisionersubjects: - kind: ServiceAccount name: nfs-client-provisioner # replace with namespace where provisioner is deployed namespace: defaultroleRef: kind: Role name: leader-locking-nfs-client-provisioner apiGroup: rbac.authorization.k8s.io éƒ¨ç½²nfsç¯å¢ƒ(åˆ›å»ºnfså­˜å‚¨ç±»)1kubectl apply -f rbac.yaml -f class.yaml -f deployment.yaml k8sä¸­éƒ¨ç½²nginxé¡¹ç›®é‡‡ç”¨nfså­˜å‚¨éƒ¨ç½²nginx-deployment-nfs.yaml(æµ‹è¯•nfs) è¿™ç§æ–¹å¼ä¼šåˆ›å»ºä¸€ä¸ªpvc æŒ‚è½½åˆ°å¤šä¸ªpodä¸­,è¿™ç§æ–¹å¼é€‚åˆnginx-htmlæŒ‚è½½ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465---kind: PersistentVolumeClaimapiVersion: v1metadata: name: html0-deploy-nfs annotations: volume.beta.kubernetes.io/storage-class: 'nfs'spec: accessModes: - ReadWriteMany resources: requests: storage: 1Gi---apiVersion: extensions/v1beta1kind: Deploymentmetadata: name: nginx0-deployspec: replicas: 2 template: metadata: labels: app: nginx0-deploy spec: containers: - name: nginx0-deploy image: hub.boqii.com/bq/nginx:1.15.12 ports: - containerPort: 80 volumeMounts: - name: html0-deploy-nfs mountPath: /usr/share/nginx/html - name: nginx-config mountPath: "/etc/nginx/conf.d" volumes: - name: nginx-config configMap: name: nginx-config - name: html0-deploy-nfs persistentVolumeClaim: claimName: html0-deploy-nfs---apiVersion: v1kind: ConfigMapmetadata: name: nginx-configdata: default.conf: | server &#123; listen 80; server_name localhost; root /usr/share/nginx/html/; access_log /var/log/nginx/host_access.log; error_log /var/log/nginx/host_error.log debug; location / &#123; root /usr/share/nginx/html/; index index.html index.htm index.php; &#125; error_page 500 502 503 504 /50x.html; location = /50x.html &#123; root /usr/share/nginx/html; &#125; &#125; éƒ¨ç½²nginx-statefulset-nfs.yaml(æµ‹è¯•nfs) è¿™é‡Œstatefulset æ–¹å¼ä¼šåˆ›å»ºå¤šä¸ªpvc, æ¯ä¸ªpodçš„htmlå°±å¯ä»¥éƒ½ä¸ä¸€æ ·! 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758---apiVersion: apps/v1beta1kind: StatefulSetmetadata: name: nginx3spec: serviceName: "nginx" replicas: 2 volumeClaimTemplates: - metadata: name: html annotations: volume.beta.kubernetes.io/storage-class: "nfs" # è¿™é‡Œé…ç½® ä¸Šé¢åˆ›å»ºçš„ storageclass çš„åç§° spec: accessModes: [ "ReadWriteOnce" ] resources: requests: storage: 2Gi template: metadata: labels: app: nginx spec: containers: - name: nginx image: hub.boqii.com/bq/nginx:1.15.12 volumeMounts: - mountPath: "/usr/share/nginx/html/" name: html - mountPath: "/etc/nginx/conf.d" name: nginx-config volumes: - name: nginx-config configMap: name: nginx-config---apiVersion: v1kind: ConfigMapmetadata: name: nginx-configdata: default.conf: | server &#123; listen 80; server_name localhost; root /usr/share/nginx/html/; access_log /var/log/nginx/host_access.log; error_log /var/log/nginx/host_error.log debug; location / &#123; root /usr/share/nginx/html/; index index.html index.htm index.php; &#125; error_page 500 502 503 504 /50x.html; location = /50x.html &#123; root /usr/share/nginx/html; &#125; &#125; å¦å¤–è¯´æ˜ä¸€ä¸‹å°†nfsä½œä¸ºæ–‡ä»¶å­˜å‚¨ç±»ä¼¼mountæ–¹å¼,è¿™ç§æ–¹å¼ä¸é€‚ç”¨äºå¤šå®¹å™¨è‡ªåŠ¨åŒ–éƒ¨ç½² ,æ˜¾ç„¶è¿™ç§å¹¶ä¸é€‚åˆceph rbdå­˜å‚¨, cephfsæ˜¯å¯ä»¥çš„é¦–å…ˆéœ€è¦åœ¨nfsç›®å½•åˆ›å»ºéœ€è¦æŒ‚è½½çš„ç›®å½•12#ä¾‹å¦‚mkdir -p /data/nfs/k8s-db-t/mysql-data-dev åœ¨éƒ¨ç½²çš„ymlä¸­ç›´æ¥mount nfsçš„ç›®å½•1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859apiVersion: extensions/v1beta1kind: Deploymentmetadata: name: mysql-server namespace: devopsspec: replicas: 1 template: metadata: labels: app: mysql-server spec: containers: - image: mysql:5.7.16 imagePullPolicy: Always name: mysql-server ports: - containerPort: 3306 protocol: TCP volumeMounts: - name: mysql-data mountPath: /var/lib/mysql resources: requests: cpu: 40m memory: 32Mi limits: cpu: "300m" memory: 256Mi env: - name: MYSQL_ROOT_PASSWORD value: "boqii.123" - name: MYSQL_DATABASE value: "gogs" - name: MYSQL_USER value: "gogs" - name: MYSQL_PASSWORD value: "gogspass" - name: TZ value: "Asia/Shanghai" volumes: - name: mysql-data nfs: server: 172.16.76.134 path: /data/nfs/k8s-db-t/mysql-data-dev---apiVersion: v1kind: Servicemetadata: name: mysql-service namespace: devopsspec: clusterIP: None selector: app: mysql-server ports: - name: http port: 3306 ç¬¬äºŒéƒ¨åˆ† cephk8séƒ¨ç½²storageclassç¯å¢ƒ-cephå¦‚æœé›†ç¾¤æ˜¯ç”¨kubeadméƒ¨ç½²çš„ï¼Œç”±äºcontroller-managerå®˜æ–¹é•œåƒä¸­æ²¡æœ‰rbdå‘½ä»¤ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦å¯¼å…¥å¤–éƒ¨é…ç½®12git clone https://github.com/kubernetes-incubator/external-storage.gitcd external-storage/ceph/rbd/deploy ä»¥ä¸‹æ•´åˆåœ¨ä¸€ä¸ªæ–‡ä»¶, ä¸¤ä¸ªç‰ˆæœ¬,é»˜è®¤ å’Œretain storageclass-cepm.com-rbd.yaml123456789101112131415161718192021222324252627282930313233343536---apiVersion: v1data: key: QVFEYzJRbGQ1VjI5THhBQU00WUtPUU5sUVJqdWtLSWJ2VDZ0a3c9PQ==kind: Secretmetadata: name: ceph-secret-admintype: kubernetes.io/rbd---apiVersion: v1data: key: QVFEYzJRbGQ1VjI5THhBQU00WUtPUU5sUVJqdWtLSWJ2VDZ0a3c9PQ==kind: Secretmetadata: name: ceph-secret-admin namespace: ns-elastictype: kubernetes.io/rbd---apiVersion: storage.k8s.io/v1kind: StorageClassmetadata: name: rbd annotations: storageclass.kubernetes.io/is-default-class: "true"provisioner: ceph.com/rbdparameters: monitors: 172.16.76.134:6789 adminId: admin adminSecretName: ceph-secret-admin adminSecretNamespace: default pool: storageclass-rbd userId: admin userSecretName: ceph-secret-admin fsType: ext4 imageFormat: "2" imageFeatures: "layering" storageclass-cepm.com-rbd-retain.yaml12345678910111213141516171819202122232425262728293031323334353637---apiVersion: v1data: key: QVFEYzJRbGQ1VjI5THhBQU00WUtPUU5sUVJqdWtLSWJ2VDZ0a3c9PQ==kind: Secretmetadata: name: ceph-secret-admintype: kubernetes.io/rbd---apiVersion: v1data: key: QVFEYzJRbGQ1VjI5THhBQU00WUtPUU5sUVJqdWtLSWJ2VDZ0a3c9PQ==kind: Secretmetadata: name: ceph-secret-admin namespace: ns-elastictype: kubernetes.io/rbd---apiVersion: storage.k8s.io/v1kind: StorageClassmetadata: name: rbd-retain annotations: storageclass.kubernetes.io/is-default-class: "false"provisioner: ceph.com/rbdreclaimPolicy: Retainparameters: monitors: 172.16.76.134:6789 adminId: admin adminSecretName: ceph-secret-admin adminSecretNamespace: default pool: storageclass-rbd-retain userId: admin userSecretName: ceph-secret-admin fsType: ext4 imageFormat: "2" imageFeatures: "layering" k8sä¸­éƒ¨ç½²nginxé¡¹ç›®é‡‡ç”¨ ceph.com/rbd å’Œnfsç±»ä¼¼, è¿™é‡Œçœç•¥ ä»¥ä¸Šé‡‡ç”¨çš„æ˜¯persistentVolumeClaim æ–¹å¼åŠ¨æ€åˆ†é…å…¨éƒ¨å†…å®¹]]></content>
      <categories>
        <category>æŠ€æœ¯æ–‡æ¡£</category>
        <category>k8s</category>
        <category>å­˜å‚¨</category>
        <category>ceph</category>
        <category>storageclass</category>
        <category>nfs</category>
      </categories>
      <tags>
        <tag>k8s</tag>
        <tag>ceph</tag>
        <tag>k8så­˜å‚¨</tag>
        <tag>nfs</tag>
        <tag>storageclass</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[cephå®‰è£…éƒ¨ç½²]]></title>
    <url>%2F2019%2F09%2F26%2F6-ceph%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2%2F</url>
    <content type="text"><![CDATA[Cephæ˜¯ä¸€ä¸ªç»Ÿä¸€çš„åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿï¼Œè®¾è®¡åˆè¡·æ˜¯æä¾›è¾ƒå¥½çš„æ€§èƒ½ã€å¯é æ€§å’Œå¯æ‰©å±•æ€§ã€‚ ç®€å•äº†è§£ä»€ä¹ˆæ˜¯å—å­˜å‚¨/å¯¹è±¡å­˜å‚¨/æ–‡ä»¶ç³»ç»Ÿå­˜å‚¨ï¼Ÿceph ç›®å‰æä¾›å¯¹è±¡å­˜å‚¨ï¼ˆRADOSGWï¼‰ã€å—å­˜å‚¨RDBä»¥åŠ CephFS æ–‡ä»¶ç³»ç»Ÿè¿™ 3 ç§åŠŸèƒ½ã€‚å¯¹äºè¿™3ç§åŠŸèƒ½ä»‹ç»ï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š å¯¹è±¡å­˜å‚¨ï¼Œä¹Ÿå°±æ˜¯é€šå¸¸æ„ä¹‰çš„é”®å€¼å­˜å‚¨ï¼Œå…¶æ¥å£å°±æ˜¯ç®€å•çš„GETã€PUTã€DEL å’Œå…¶ä»–æ‰©å±•ï¼Œä»£è¡¨ä¸»è¦æœ‰ Swift ã€S3 ä»¥åŠ Gluster ç­‰ï¼› å—å­˜å‚¨ï¼Œè¿™ç§æ¥å£é€šå¸¸ä»¥ QEMU Driver æˆ–è€… Kernel Module çš„æ–¹å¼å­˜åœ¨ï¼Œè¿™ç§æ¥å£éœ€è¦å®ç° Linux çš„ Block Device çš„æ¥å£æˆ–è€… QEMU æä¾›çš„ Block Driver æ¥å£ï¼Œå¦‚ Sheepdogï¼ŒAWS çš„ EBSï¼Œé’äº‘çš„äº‘ç¡¬ç›˜å’Œé˜¿é‡Œäº‘çš„ç›˜å¤ç³»ç»Ÿï¼Œè¿˜æœ‰ Ceph çš„ RBDï¼ˆRBDæ˜¯Cephé¢å‘å—å­˜å‚¨çš„æ¥å£ï¼‰ã€‚åœ¨å¸¸è§çš„å­˜å‚¨ä¸­ DASã€SAN æä¾›çš„ä¹Ÿæ˜¯å—å­˜å‚¨ï¼› æ–‡ä»¶å­˜å‚¨ï¼Œé€šå¸¸æ„ä¹‰æ˜¯æ”¯æŒ POSIX æ¥å£ï¼Œå®ƒè·Ÿä¼ ç»Ÿçš„æ–‡ä»¶ç³»ç»Ÿå¦‚ Ext4 æ˜¯ä¸€ä¸ªç±»å‹çš„ï¼Œä½†åŒºåˆ«åœ¨äºåˆ†å¸ƒå¼å­˜å‚¨æä¾›äº†å¹¶è¡ŒåŒ–çš„èƒ½åŠ›ï¼Œå¦‚ Ceph çš„ CephFS (CephFSæ˜¯Cephé¢å‘æ–‡ä»¶å­˜å‚¨çš„æ¥å£)ï¼Œä½†æ˜¯æœ‰æ—¶å€™åˆä¼šæŠŠ GlusterFS ï¼ŒHDFS è¿™ç§éPOSIXæ¥å£çš„ç±»æ–‡ä»¶å­˜å‚¨æ¥å£å½’å…¥æ­¤ç±»ã€‚å½“ç„¶ NFSã€NASä¹Ÿæ˜¯å±äºæ–‡ä»¶ç³»ç»Ÿå­˜å‚¨ï¼› å‚è€ƒæ•™ç¨‹Kubernetes é›†æˆ Ceph åç«¯å­˜å‚¨æ•™ç¨‹centos7å®‰è£…cephé›†ç¾¤ å‡†å¤‡é…ç½®æº12345678910111213141516171819202122cat &gt;/etc/yum.repos.d/ceph.repo&lt;&lt;EOF[ceph]name=cephbaseurl=http://mirrors.aliyun.com/ceph/rpm-jewel/el7/x86_64/gpgcheck=0priority=1[ceph-noarch]name=cephnoarchbaseurl=http://mirrors.aliyun.com/ceph/rpm-jewel/el7/noarch/gpgcheck=0priority=1[ceph-source]name=Ceph source packagesbaseurl=http://mirrors.163.com/ceph/rpm-jewel/el7/SRPMSenabled=0gpgcheck=1type=rpm-mdgpgkey=http://mirrors.163.com/ceph/keys/release.ascpriority=1EOF å®‰è£…è¿‡å¸è½½123ceph-deploy purge dk1-t dk2-tceph-deploy purgedata dk1-t dk2-tceph-deploy forgetkeys åœ¨dk2-tèŠ‚ç‚¹åˆ›å»ºé›†ç¾¤ monæ¨¡å—1234567891011121314151617181920212223242526272829303132333435363738394041424344454647yum install ceph-deploy -yceph-deploy --versionmkdir /data/cephcd /data/cephceph-deploy new dk2-t# æŸ¥çœ‹é…ç½®æ–‡ä»¶ls -l# é…ç½®ceph.conf[global]...# å¦‚æœæœ‰å¤šä¸ªç½‘å¡ï¼Œåº”è¯¥é…ç½®å¦‚ä¸‹é€‰é¡¹ï¼Œ# public networkæ˜¯å…¬å…±ç½‘ç»œï¼Œè´Ÿè´£é›†ç¾¤å¯¹å¤–æä¾›æœåŠ¡çš„æµé‡# cluster networkæ˜¯é›†ç¾¤ç½‘ç»œï¼Œè´Ÿè½½é›†ç¾¤ä¸­æ•°æ®å¤åˆ¶ä¼ è¾“é€šä¿¡ç­‰# æœ¬æ¬¡å®éªŒä½¿ç”¨åŒä¸€å—ç½‘å¡ï¼Œç”Ÿå¢ƒç¯å¢ƒå»ºè®®åˆ†åˆ«ä½¿ç”¨ä¸€å—ç½‘å¡public network = 172.16.76.0/22cluster network = 172.16.76.0/22osd pool default size = 2# å®‰è£… ceph åŒ…# å¦‚æœæŒ‰ç…§å®˜æ–¹æ–‡æ¡£å®‰è£…æ–¹æ³• ä¼šé‡æ–°é…ç½®å®‰è£…å®˜æ–¹cephæº# ç”±äºç½‘ç»œé—®é¢˜ï¼Œå®‰è£…å¯èƒ½ä¼šå‡ºé”™ï¼Œéœ€è¦å¤šæ¬¡æ‰§è¡Œ# ceph-deploy install å…¶å®åªæ˜¯ä¼šå®‰è£… ceph ceph-radosgw ä¸¤ä¸ªåŒ…# ceph-deploy install lab1 lab2 lab3# æ¨èä½¿ç”¨é˜¿é‡Œæºå®‰è£…ï¼Œå› ä¸ºä½¿ç”¨ceph-deployå®‰è£…ä¼šå¾ˆæ…¢# ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æ‰‹åŠ¨å®‰è£…åŒ…ï¼Œæ›¿ä»£å®˜æ–¹çš„ ceph-deploy install å‘½ä»¤# å¦‚ä¸‹æ“ä½œåœ¨æ‰€æœ‰nodeèŠ‚ç‚¹ä¸Šæ‰§è¡Œexport CEPH_DEPLOY_REPO_URL=http://mirrors.163.com/ceph/rpm-luminous/el7export CEPH_DEPLOY_GPG_URL=http://mirrors.163.com/ceph/keys/release.asc# å…ˆæ‰§è¡Œæ˜¯å› ä¸º ceph-deploy installå¤ªæ…¢yum install -y ceph ceph-radosgwceph-deploy install dk2-t# éƒ¨ç½²monitorå’Œç”Ÿæˆkeysceph-deploy mon create-initialls -l *.keyring# å¤åˆ¶æ–‡ä»¶åˆ°nodeèŠ‚ç‚¹ceph-deploy dk1-t dk2-t# é¢å¤–monèŠ‚ç‚¹ï¼ŒmonèŠ‚ç‚¹ä¹Ÿéœ€è¦é«˜å¯ç”¨ceph-deploy mon add dk1-t åœ¨dk2-tèŠ‚ç‚¹åˆ›å»ºé›†ç¾¤ mgræ¨¡å—123# éƒ¨ç½²manager ï¼ˆluminous+ï¼‰12åŠä»¥åçš„ç‰ˆæœ¬éœ€è¦éƒ¨ç½²# æœ¬æ¬¡éƒ¨ç½² jewel ç‰ˆæœ¬ ï¼Œä¸éœ€è¦æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ ceph-deploy mgr create dk2-t åœ¨dk2-tèŠ‚ç‚¹åˆ›å»ºé›†ç¾¤ osdæ¨¡å—1234# 12çš„ç‰ˆæœ¬(è¿™é‡ŒæŒ‚è½½ä¸€ä¸ª 10Gçš„ç£ç›˜ /dev/sdb)# create å‘½ä»¤ä¸€æ¬¡å®Œæˆå‡†å¤‡ OSD ã€éƒ¨ç½²åˆ° OSD èŠ‚ç‚¹ã€å¹¶æ¿€æ´»å®ƒã€‚ create å‘½ä»¤æ˜¯ä¾æ¬¡æ‰§è¡Œ prepare å’Œ activate å‘½ä»¤çš„æ·å¾„ã€‚ceph-deploy osd create --data /dev/sdb dk2-tceph-deploy osd create --data /dev/sdc dk1-t å¦‚ä½•å¸è½½osd1234567891011121314# æŸ¥çœ‹ceph osd tree# èŠ‚ç‚¹çŠ¶æ€æ ‡è®°ä¸ºoutceph osd out osd.0# ä»crushä¸­ç§»é™¤èŠ‚ç‚¹ceph osd crush remove osd.0# åˆ é™¤èŠ‚ç‚¹ceph osd rm osd.0# åˆ é™¤èŠ‚ç‚¹è®¤è¯ï¼ˆä¸åˆ é™¤ç¼–å·ä¼šå ä½ï¼‰ceph auth del osd.0 æŸ¥çœ‹ mon ä¿¡æ¯12345678ceph mon dumpdumped monmap epoch 1epoch 1fsid 4620d0c7-4458-4ff9-9296-d1318058bafclast_changed 2019-06-19 14:44:41.361005created 2019-06-19 14:44:41.3610050: 172.16.76.134:6789/0 mon.dk2-t é…ç½®æ–‡ä»¶å†…å®¹ /etc/ceph/ceph.conf1234567891011[global]public network = 172.16.76.0/22cluster network = 172.16.76.0/22osd pool default size = 2fsid = 4620d0c7-4458-4ff9-9296-d1318058bafcmon_initial_members = dk2-tmon_host = 172.16.76.134auth_cluster_required = cephxauth_service_required = cephxauth_client_required = cephxmon_max_pg_per_osd = 1000 ceph ä¸€äº›æµ‹è¯•å‘½ä»¤åˆ›å»º rbd poolï¼Œåå­—å«åš kube1ceph osd pool create kube 256 256 å¦‚ä½•å–å¾—adminçš„å¯†é’¥12ceph auth get client.admin 2&gt;&amp;1 |grep "key = " |awk '&#123;print $3&#125;'AQAn/19bbb21GBAA1kc0HRWoGjeoPTRQziA03A== æµ‹è¯•cephæ˜¯å¦æ­£å¸¸12345678910111213rbd create kube/test --size 1024 --image-format 2rbd ls kuberbd map kube/test # å¦‚æœæŠ¥é”™, è­¦ç”¨ rbd info kube/test rbd feature disable kube/test exclusive-lock object-map fast-diff deep-flattenrbd map kube/testrbd showmappedmkfs.ext4 /dev/rbd0mkdir /data/rbd0mount /dev/rbd0 /data/rbd0cd /data/rbd0 &amp;&amp; echo test &gt; test.txt åœ¨k8s æ‰‹åŠ¨åˆ›å»ºå­˜å‚¨ç±»åˆ›å»ºceph pg123456789101112131415161718192021# Total PGs = (Total_number_of_OSD * 100) / max_replication_count# pg = 1 * 100 /2 ~ 64(å–2çš„æ¬¡æ–¹æ•°)# è¿™é‡Œå‡†å¤‡åˆ›å»º2ä¸ªpool, æ¯ä¸ªpoolceph osd pool create rbd-k8s 16# æŸ¥çœ‹ceph osd lspools# åˆ›å»ºimagerbd create rbd-k8s/cephimageredis --size 500M# æŸ¥çœ‹listrbd list rbd-k8s# å¤„ç†æ–°ç‰¹æ€§# æŸ¥çœ‹inforbd info rbd-k8s/cephimageredis# å…³é—­exclusive-lock object-map fast-diff deep-flatten è¿™äº›ç‰¹æ€§rbd feature disable rbd-k8s/cephimageredis exclusive-lock object-map fast-diff deep-flatten é¦–å…ˆåˆ›å»ºsecret12#è·å–keygrep key /etc/ceph/ceph.client.admin.keyring |awk '&#123;printf "%s", $NF&#125;'|base64 ceph-secret.yaml1234567apiVersion: v1kind: Secretmetadata: name: ceph-secrettype: "kubernetes.io/rbd"data: key: QVFCTFo2dGNGNXFLRnhBQXBGTXJEdm5CY2k2UGtwZmZrN0JSVEE9PQ== å…¶æ¬¡åˆ›å»ºpv, pvæ˜¯æ²¡æœ‰namespaceæ¦‚å¿µçš„ persistentVolumeReclaimPolicyæ˜¯æ¸…ç†è§„åˆ™ (retain: ä¸æ¸…ç†, Recycle: å›æ”¶) redis-ceph-pv.yml 1234567891011121314151617181920apiVersion: v1kind: PersistentVolumemetadata: name: redis2-ceph-rbd-pvspec: capacity: storage: 100Mi accessModes: - ReadWriteOnce rbd: monitors: - '172.16.76.134:6789' pool: rbd-k8s image: cephimageredis user: admin secretRef: name: ceph-secret fsType: ext4 readOnly: false persistentVolumeReclaimPolicy: Recycle æ‰§è¡Œéƒ¨ç½²pv1kubectl create -f redis-ceph-pv.yml ç„¶ååˆ›å»ºpvc redis-ceph-pvc.yml 12345678910apiVersion: v1kind: PersistentVolumeClaimmetadata: name: redis2-ceph-rbd-pvcspec: accessModes: - ReadWriteOnce resources: requests: storage: 100Mi æ‰§è¡Œéƒ¨ç½²pvc1kubectl create -f redis-ceph-pvc.yml æœ€ååœ¨rancherä¸Šé€‰æ‹©æŒ‚è½½rbd]]></content>
      <categories>
        <category>æŠ€æœ¯æ–‡æ¡£</category>
        <category>å­˜å‚¨</category>
        <category>ceph</category>
      </categories>
      <tags>
        <tag>k8s</tag>
        <tag>ceph</tag>
        <tag>cephfs</tag>
        <tag>k8så­˜å‚¨</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[hexoæ·»åŠ çœ‹æ¿å¨˜]]></title>
    <url>%2F2019%2F09%2F24%2F5-hexo%E6%B7%BB%E5%8A%A0%E7%9C%8B%E6%9D%BF%E5%A8%98%2F</url>
    <content type="text"><![CDATA[hexo6 å·¦ä¸‹è§’æ·»åŠ çœ‹æ¿å¨˜ githubåœ°å€: å¼ ä¹¦æ¨µå¤§ç¥ ä¸‹è½½å¤§ç¥é¡¹ç›® (ä¼šè¯´è¯,æ¢äººç‰©,å°æ¸¸æˆç­‰åŠŸèƒ½)12cd themes/nextv6/sourcegit clone https://github.com/stevenjoezhang/live2d-widget.git githubè¯´æ˜æ¯”è¾ƒè¯¦ç»†, è¿™é‡Œç®€å•è¯´æ˜ ç”±äºè¿™é‡Œæ˜¯å…‹éš†åˆ°äº†sourceç›®å½•, hexo d -gçš„æ—¶å€™ä¼šç”Ÿæˆåˆ°publicç›®å½•, ç›¸å½“äºç«™ç‚¹æ ¹ç›®å½•äº† 123456# ç›´æ¥å¼€å¯autoload.jsæ³¨é‡Šconst live2d_path = "/live2d-widget/";# ä¿®æ”¹ themes/nextv6/layout/_layout.swig, æœ€åä¸€è¡Œæ·»åŠ å¦‚ä¸‹&lt;!-- çœ‹æ¿å¨˜ --&gt;&lt;script src="/live2d-widget/autoload.js"&gt;&lt;/script&gt; ä¸€èˆ¬å°ç™½ç®€å•æ•™ç¨‹(åªæœ‰çœ‹é¼ æ ‡æ–¹å‘åŠŸèƒ½) hexo å®˜æ–¹æ”¯æŒç‰ˆ éœ€è¦å®‰è£…æ¨¡æ¿1npm install --save hexo-helper-live2d ä¿®æ”¹ä¸»é¢˜é…ç½®æ–‡ä»¶å„ç§å® ç‰©é¢„è§ˆ 12345678910111213141516171819202122232425# Live2D## https://github.com/EYHN/hexo-helper-live2dlive2d: enable: true # enable: false scriptFrom: local # é»˜è®¤ pluginRootPath: live2dw/ # æ’ä»¶åœ¨ç«™ç‚¹ä¸Šçš„æ ¹ç›®å½•(ç›¸å¯¹è·¯å¾„) pluginJsPath: lib/ # è„šæœ¬æ–‡ä»¶ç›¸å¯¹ä¸æ’ä»¶æ ¹ç›®å½•è·¯å¾„ pluginModelPath: assets/ # æ¨¡å‹æ–‡ä»¶ç›¸å¯¹ä¸æ’ä»¶æ ¹ç›®å½•è·¯å¾„ # scriptFrom: jsdelivr # jsdelivr CDN # scriptFrom: unpkg # unpkg CDN # scriptFrom: https://cdn.jsdelivr.net/npm/live2d-widget@3.x/lib/L2Dwidget.min.js # ä½ çš„è‡ªå®šä¹‰ url tagMode: false # æ ‡ç­¾æ¨¡å¼, æ˜¯å¦ä»…æ›¿æ¢ live2d tagæ ‡ç­¾è€Œéæ’å…¥åˆ°æ‰€æœ‰é¡µé¢ä¸­ debug: false # è°ƒè¯•, æ˜¯å¦åœ¨æ§åˆ¶å°è¾“å‡ºæ—¥å¿— model: use: live2d-widget-model-haruto # npm-module package name # use: wanko # åšå®¢æ ¹ç›®å½•/live2d_models/ ä¸‹çš„ç›®å½•å # use: ./wives/wanko # ç›¸å¯¹äºåšå®¢æ ¹ç›®å½•çš„è·¯å¾„ # use: https://cdn.jsdelivr.net/npm/live2d-widget-model-wanko@1.0.5/assets/wanko.model.json # ä½ çš„è‡ªå®šä¹‰ url display: position: left width: 150 height: 300 mobile: show: true # æ‰‹æœºä¸­æ˜¯å¦å±•ç¤º]]></content>
      <categories>
        <category>æœ‰è¶£</category>
        <category>åšå®¢</category>
        <category>äºŒæ¬¡å…ƒ</category>
        <category>ç¾åŒ–</category>
      </categories>
      <tags>
        <tag>hexo6</tag>
        <tag>ç‰¹æ•ˆ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[hexoé¼ æ ‡ç§»åŠ¨å’Œé¼ æ ‡ç‚¹å‡»ç‰¹æ•ˆ]]></title>
    <url>%2F2019%2F09%2F24%2F4-hexo%E9%BC%A0%E6%A0%87%E7%A7%BB%E5%8A%A8%E5%92%8C%E9%BC%A0%E6%A0%87%E7%82%B9%E5%87%BB%E7%89%B9%E6%95%88%2F</url>
    <content type="text"><![CDATA[hexo6 é¼ æ ‡æ·»åŠ ç‚¹å‡»å‡ºç°æ¡ƒå¿ƒçš„ç‰¹æ•ˆ æ¥è‡ª: Nextä¸»é¢˜ä¸ªæ€§åŒ– æ‰€éœ€è¦çš„jsæ–‡ä»¶ æœªå‹ç¼© 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051! function(e, t, a) &#123; function n() &#123; c( ".heart&#123;width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);&#125;.heart:after,.heart:before&#123;content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: fixed;&#125;.heart:after&#123;top: -5px;&#125;.heart:before&#123;left: -5px;&#125;"), o(), r() &#125; function r() &#123; for (var e = 0; e &lt; d.length; e++) d[e].alpha &lt;= 0 ? (t.body.removeChild(d[e].el), d.splice(e, 1)) : (d[e].y--, d[e].scale += .004, d[e].alpha -= .013, d[e].el.style.cssText = "left:" + d[e].x + "px;top:" + d[e].y + "px;opacity:" + d[e].alpha + ";transform:scale(" + d[e].scale + "," + d[e].scale + ") rotate(45deg);background:" + d[e].color + ";z-index:99999"); requestAnimationFrame(r) &#125; function o() &#123; var t = "function" == typeof e.onclick &amp;&amp; e.onclick; e.onclick = function(e) &#123; t &amp;&amp; t(), i(e) &#125; &#125; function i(e) &#123; var a = t.createElement("div"); a.className = "heart", d.push(&#123; el: a, x: e.clientX - 5, y: e.clientY - 5, scale: 1, alpha: 1, color: s() &#125;), t.body.appendChild(a) &#125; function c(e) &#123; var a = t.createElement("style"); a.type = "text/css"; try &#123; a.appendChild(t.createTextNode(e)) &#125; catch (t) &#123; a.styleSheet.cssText = e &#125; t.getElementsByTagName("head")[0].appendChild(a) &#125; function s() &#123; return "rgb(" + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + ")" &#125; var d = []; e.requestAnimationFrame = function() &#123; return e.requestAnimationFrame || e.webkitRequestAnimationFrame || e.mozRequestAnimationFrame || e.oRequestAnimationFrame || e.msRequestAnimationFrame || function(e) &#123; setTimeout(e, 1e3 / 60) &#125; &#125;(), n()&#125;(window, document); å‹ç¼©å 1!function(e,t,a)&#123;function n()&#123;c(".heart&#123;width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);&#125;.heart:after,.heart:before&#123;content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: fixed;&#125;.heart:after&#123;top: -5px;&#125;.heart:before&#123;left: -5px;&#125;"),o(),r()&#125;function r()&#123;for(var e=0;e&lt;d.length;e++)d[e].alpha&lt;=0?(t.body.removeChild(d[e].el),d.splice(e,1)):(d[e].y--,d[e].scale+=.004,d[e].alpha-=.013,d[e].el.style.cssText="left:"+d[e].x+"px;top:"+d[e].y+"px;opacity:"+d[e].alpha+";transform:scale("+d[e].scale+","+d[e].scale+") rotate(45deg);background:"+d[e].color+";z-index:99999");requestAnimationFrame(r)&#125;function o()&#123;var t="function"==typeof e.onclick&amp;&amp;e.onclick;e.onclick=function(e)&#123;t&amp;&amp;t(),i(e)&#125;&#125;function i(e)&#123;var a=t.createElement("div");a.className="heart",d.push(&#123;el:a,x:e.clientX-5,y:e.clientY-5,scale:1,alpha:1,color:s()&#125;),t.body.appendChild(a)&#125;function c(e)&#123;var a=t.createElement("style");a.type="text/css";try&#123;a.appendChild(t.createTextNode(e))&#125;catch(t)&#123;a.styleSheet.cssText=e&#125;t.getElementsByTagName("head")[0].appendChild(a)&#125;function s()&#123;return"rgb("+~~(255*Math.random())+","+~~(255*Math.random())+","+~~(255*Math.random())+")"&#125;var d=[];e.requestAnimationFrame=function()&#123;return e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame||function(e)&#123;setTimeout(e,1e3/60)&#125;&#125;(),n()&#125;(window,document); å°†ä¸Šé¢çš„å†…å®¹è´´åˆ°æ–°å¢çš„themes/nextv6/source/js/src/love.js æ–‡ä»¶ä¸­ä¿®æ”¹themes/nextv6/layout/_layout.swigæ–‡ä»¶, æœ«å°¾æ·»åŠ å¦‚ä¸‹å†…å®¹12&lt;!-- é¼ æ ‡æ¡ƒå¿ƒåŠ¨ç”» --&gt;&lt;script type="text/javascript" src="/js/src/love.js"&gt;&lt;/script&gt; hexo6 é¼ æ ‡ç§»åŠ¨æ·»åŠ æ˜Ÿæ˜Ÿç‰¹æ•ˆæ¥è‡ª: æ„šäººèŠ‚é¼ æ ‡è·Ÿéšç‰¹æ•ˆ æ–°å¢jsæ–‡ä»¶ themes/nextv6/source/js/src/love2.js123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143/*! * Fairy Dust Cursor.js * - 90's cursors collection * -- https://github.com/tholman/90s-cursor-effects * -- http://codepen.io/tholman/full/jWmZxZ/ */(function fairyDustCursor() &#123; var possibleColors = ["#D61C59", "#E7D84B", "#1B8798"] var width = window.innerWidth; var height = window.innerHeight; var cursor = &#123;x: width/2, y: width/2&#125;; var particles = []; function init() &#123; bindEvents(); loop(); &#125; // Bind events that are needed function bindEvents() &#123; document.addEventListener('mousemove', onMouseMove); document.addEventListener('touchmove', onTouchMove); document.addEventListener('touchstart', onTouchMove); window.addEventListener('resize', onWindowResize); &#125; function onWindowResize(e) &#123; width = window.innerWidth; height = window.innerHeight; &#125; function onTouchMove(e) &#123; if( e.touches.length &gt; 0 ) &#123; for( var i = 0; i &lt; e.touches.length; i++ ) &#123; addParticle( e.touches[i].clientX, e.touches[i].clientY, possibleColors[Math.floor(Math.random()*possibleColors.length)]); &#125; &#125; &#125; function onMouseMove(e) &#123; cursor.x = e.clientX; cursor.y = e.clientY; addParticle( cursor.x, cursor.y, possibleColors[Math.floor(Math.random()*possibleColors.length)]); &#125; function addParticle(x, y, color) &#123; var particle = new Particle(); particle.init(x, y, color); particles.push(particle); &#125; function updateParticles() &#123; // Updated for( var i = 0; i &lt; particles.length; i++ ) &#123; particles[i].update(); &#125; // Remove dead particles for( var i = particles.length -1; i &gt;= 0; i-- ) &#123; if( particles[i].lifeSpan &lt; 0 ) &#123; particles[i].die(); particles.splice(i, 1); &#125; &#125; &#125; function loop() &#123; requestAnimationFrame(loop); updateParticles(); &#125; /** * Particles */ function Particle() &#123; this.character = "*"; this.lifeSpan = 120; //ms this.initialStyles =&#123; "position": "fixed", "top": "0", //å¿…é¡»åŠ  "display": "block", "pointerEvents": "none", "z-index": "10000000", "fontSize": "20px", "will-change": "transform" &#125;; // Init, and set properties this.init = function(x, y, color) &#123; this.velocity = &#123; x: (Math.random() &lt; 0.5 ? -1 : 1) * (Math.random() / 2), y: 1 &#125;; this.position = &#123;x: x - 10, y: y - 20&#125;; this.initialStyles.color = color; console.log(color); this.element = document.createElement('span'); this.element.innerHTML = this.character; applyProperties(this.element, this.initialStyles); this.update(); document.body.appendChild(this.element); &#125;; this.update = function() &#123; this.position.x += this.velocity.x; this.position.y += this.velocity.y; this.lifeSpan--; this.element.style.transform = "translate3d(" + this.position.x + "px," + this.position.y + "px,0) scale(" + (this.lifeSpan / 120) + ")"; &#125; this.die = function() &#123; this.element.parentNode.removeChild(this.element); &#125; &#125; /** * Utils */ // Applies css `properties` to an element. function applyProperties( target, properties ) &#123; for( var key in properties ) &#123; target.style[ key ] = properties[ key ]; &#125; &#125; init();&#125;)(); ä¿®æ”¹themes/nextv6/layout/_layout.swigæ–‡ä»¶, æœ«å°¾æ·»åŠ å¦‚ä¸‹å†…å®¹12&lt;!-- é¼ æ ‡ç§»åŠ¨æ˜Ÿæ˜Ÿç‰¹æ•ˆ --&gt;&lt;script type="text/javascript" src="/js/src/love2.js"&gt;&lt;/script&gt;]]></content>
      <categories>
        <category>æœ‰è¶£</category>
        <category>åšå®¢</category>
        <category>ç¾åŒ–</category>
      </categories>
      <tags>
        <tag>hexo6</tag>
        <tag>ç‰¹æ•ˆ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[k8sé‡åˆ°çš„ä¸€äº›é—®é¢˜ç»Ÿè®¡æ€»ç»“]]></title>
    <url>%2F2019%2F09%2F20%2F3-k8s%E9%81%87%E5%88%B0%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98%E7%BB%9F%E8%AE%A1%E6%80%BB%E7%BB%93%2F</url>
    <content type="text"><![CDATA[ä¸å®šæ—¶æ›´æ–°,æ–‡ç« å¯èƒ½æ¯”è¾ƒæ•£ä¹±,&gt;_&lt; 1. å•æœºç‰ˆk8s podä¸€ç›´æ˜¯pendingçš„é—®é¢˜ describeä¸€ä¸‹podä¼šå‘ç°é”™è¯¯: 1 node(s) had taints that the pod didnâ€™t tolerate.è¿™æ˜¯å› ä¸ºmasterä¸Šå­˜åœ¨æ±¡ç‚¹,podä¸ä¼šå†æ”¹èŠ‚ç‚¹ä¸Šåˆ›å»ºä¸¤ç§åŠæ³•: deploy çš„æ—¶å€™åŠ ä¸Š å®¹å¿è¯¥æ±¡ç‚¹ ç›´æ¥å–æ¶ˆmasterä¸Šçš„æ±¡ç‚¹ 12345# å–æ¶ˆmasterä¸Šæ±¡ç‚¹ kubectl taint nodes --all node-role.kubernetes.io/master-# æŸ¥çœ‹taintkubectl describe node node1 2. ä¿®æ”¹service-node-port-range ç”±äºtraefikéƒ¨ç½²éœ€è¦å¯¹å¤–å¼€æ”¾80ç«¯å£, ä½†é»˜è®¤ä»…å…è®¸30000ä»¥ä¸Šç«¯å£ 123456789# kubeadm 1.14 é…ç½®apiServer: extraArgs: authorization-mode: Node,RBAC service-node-port-range: 79-33000# kubeadm 1.10é…ç½®apiServerExtraArgs: service-node-port-range: 79-33000 3. traefikæ–­ç”µåé‡æ–°å¯åŠ¨æŠ¥é”™ command traefik error: field not found, node: redirect12345çœ‹åˆ°è¿™ä¸ªé”™è¯¯çŒœæµ‹å¯èƒ½æ˜¯ç”¨çš„latesté•œåƒé—®é¢˜, ä»hub.docker.com æŸ¥çœ‹æ›´æ–°äº†v2.0+çš„ç‰ˆæœ¬å°†traefikçš„deploymenté…ç½®ä¸­ imageæ”¹æˆ traefik:1.7é‡æ–°éƒ¨ç½²å é—®é¢˜è§£ 4. æŸ¥çœ‹å½“å‰é›†ç¾¤çš„(CustomResourceDefinition)12345678# æŸ¥çœ‹k8sæœ‰å“ªäº›apikubectl api-versions# æŸ¥çœ‹å½“å‰crdkubectl get crd# å…¶æ¬¡æŸ¥çœ‹è¯¥apiæ˜¯ä»€ä¹ˆç‰ˆæœ¬kubectl describe crd destinationrules.networking.istio.io]]></content>
      <categories>
        <category>æŠ€æœ¯æ–‡æ¡£</category>
        <category>k8s</category>
        <category>é—®é¢˜æ€»ç»“</category>
      </categories>
      <tags>
        <tag>k8s</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[éƒ¨ç½²elk7.2.0]]></title>
    <url>%2F2019%2F09%2F19%2F2-%E9%83%A8%E7%BD%B2elk7-2-0%2F</url>
    <content type="text"><![CDATA[è¯´æ˜: 121 å•å°k8s,æœ¬æœºç›®å½•æŒ‚è½½(æœªé…ç½®cephfs)2 å¦‚æœreplicaså¤§äº1, å°±ä¼šå‡ºç°å¤šä¸ªesæŒ‚è½½åŒä¸€ä¸ªç›®å½•,ä¼šå‡ºç°æŠ¥é”™(uuid block) 1. esé…ç½®æœ¬åœ°æŒ‚è½½ k8s-es-7.2.0.yml123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128---apiVersion: v1kind: ServiceAccountmetadata: labels: app: elasticsearch name: elasticsearch7-admin namespace: ns-elastic7---apiVersion: rbac.authorization.k8s.io/v1kind: ClusterRoleBindingmetadata: name: elasticsearch7-admin labels: app: elasticsearchroleRef: apiGroup: rbac.authorization.k8s.io kind: ClusterRole name: cluster-adminsubjects: - kind: ServiceAccount name: elasticsearch7-admin namespace: ns-elastic7---apiVersion: apps/v1kind: StatefulSetmetadata: labels: app: elasticsearch role: master name: elasticsearch-master namespace: ns-elastic7spec: replicas: 1 serviceName: elasticsearch-master selector: matchLabels: app: elasticsearch role: master template: metadata: labels: app: elasticsearch role: master spec: serviceAccountName: elasticsearch7-admin restartPolicy: Always securityContext: fsGroup: 1000 containers: - name: elasticsearch-master image: hub.boqii.com/bq/elasticsearch:7.2.0 command: ["bash", "-c", "ulimit -l unlimited &amp;&amp; sysctl -w vm.max_map_count=262144 &amp;&amp; chown -R elasticsearch:elasticsearch /usr/share/elasticsearch/data &amp;&amp; exec su elasticsearch docker-entrypoint.sh"] imagePullPolicy: IfNotPresent securityContext: privileged: true ports: - containerPort: 9200 protocol: TCP - containerPort: 9300 protocol: TCP resources: requests: cpu: "50m" limits: cpu: "800m" env: - name: cluster.name value: "es_cluster" - name: node.master value: "true" - name: node.data value: "true" - name: cluster.initial_master_nodes value: "elasticsearch-master-0" # æ ¹æ®å‰¯æœ¬æ•°å’Œnameé…ç½® - name: discovery.zen.ping_timeout value: "5s" - name: node.ingest value: "false" - name: ES_JAVA_OPTS value: "-Xms1g -Xmx1g" - name: "discovery.zen.ping.unicast.hosts" value: "elasticsearch-discovery" # Disvocery Service - name: "http.cors.enabled" value: "true" - name: "http.cors.allow-origin" value: "*" volumeMounts: - name: elasticsearch-data-volume mountPath: /usr/share/elasticsearch/data volumes: - name: elasticsearch-data-volume hostPath: path: /data/k8s-container/elk-7.2.0/es-7.2.0/data---apiVersion: v1kind: Servicemetadata: labels: app: elasticsearch name: elasticsearch-discovery namespace: ns-elastic7spec: publishNotReadyAddresses: true ports: - name: transport port: 9300 targetPort: 9300 selector: app: elasticsearch role: master---kind: ServiceapiVersion: v1metadata: labels: app: elasticsearch name: elasticsearch-service namespace: ns-elastic7spec: type: NodePort ports: - port: 9200 targetPort: 9200 nodePort: 19230 protocol: TCP selector: app: elasticsearch 2. esé…ç½®nfsåŠ¨æ€æŒ‚è½½ k8s-es-7.2.0-nfs.yml123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129---apiVersion: v1kind: ServiceAccountmetadata: labels: app: elasticsearch name: elasticsearch-admin namespace: ns-elastic---apiVersion: rbac.authorization.k8s.io/v1kind: ClusterRoleBindingmetadata: name: elasticsearch-admin labels: app: elasticsearchroleRef: apiGroup: rbac.authorization.k8s.io kind: ClusterRole name: cluster-adminsubjects: - kind: ServiceAccount name: elasticsearch-admin namespace: ns-elastic---apiVersion: apps/v1kind: StatefulSetmetadata: labels: app: elasticsearch role: master name: elasticsearch-master namespace: ns-elasticspec: replicas: 2 volumeClaimTemplates: - metadata: name: elasticsearch-data-nfs annotations: volume.beta.kubernetes.io/storage-class: "nfs" spec: accessModes: [ "ReadWriteOnce" ] resources: requests: storage: 2Gi serviceName: elasticsearch-master selector: matchLabels: app: elasticsearch role: master template: metadata: labels: app: elasticsearch role: master spec: serviceAccountName: elasticsearch-admin restartPolicy: Always securityContext: fsGroup: 1000 containers: - name: elasticsearch-master image: elasticsearch:7.2.0 command: ["bash", "-c", "ulimit -l unlimited &amp;&amp; sysctl -w vm.max_map_count=262144 &amp;&amp; chown -R elasticsearch:elasticsearch /usr/share/elasticsearch/data &amp;&amp; exec su elasticsearch docker-entrypoint.sh"] imagePullPolicy: IfNotPresent volumeMounts: - name: elasticsearch-data-nfs mountPath: /usr/share/elasticsearch/data securityContext: privileged: true ports: - containerPort: 9200 protocol: TCP - containerPort: 9300 protocol: TCP env: - name: cluster.name value: "es_cluster" - name: node.master value: "true" - name: node.data value: "true" - name: cluster.initial_master_nodes value: "elasticsearch-master-0,elasticsearch-master-1" # æ ¹æ®å‰¯æœ¬æ•°å’Œnameé…ç½® - name: discovery.zen.ping_timeout value: "5s" - name: node.ingest value: "false" - name: ES_JAVA_OPTS value: "-Xms1g -Xmx1g" - name: "discovery.zen.ping.unicast.hosts" value: "elasticsearch-discovery" # Disvocery Service - name: "http.cors.enabled" value: "true" - name: "http.cors.allow-origin" value: "*"---apiVersion: v1kind: Servicemetadata: labels: app: elasticsearch name: elasticsearch-discovery namespace: ns-elasticspec: publishNotReadyAddresses: true ports: - name: transport port: 9300 targetPort: 9300 selector: app: elasticsearch role: master---kind: ServiceapiVersion: v1metadata: labels: app: elasticsearch name: elasticsearch-service namespace: ns-elasticspec: type: NodePort ports: - port: 9200 targetPort: 9200 nodePort: 19220 protocol: TCP selector: app: elasticsearch 3. kibanaé…ç½®k8s-kibana-7.2.0.yml12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485apiVersion: v1kind: ConfigMapmetadata: name: kibana-config namespace: ns-elastic7 labels: elastic-app: kibanadata: kibana.yml: | server.name: kibana server.host: "0" elasticsearch.hosts: [ "http://elasticsearch-service:9200" ] xpack.monitoring.ui.container.elasticsearch.enabled: true---kind: DeploymentapiVersion: apps/v1beta2metadata: labels: elastic-app: kibana name: kibana namespace: ns-elastic7spec: replicas: 1 revisionHistoryLimit: 10 selector: matchLabels: elastic-app: kibana template: metadata: labels: elastic-app: kibana spec: containers: - name: kibana image: hub.boqii.com/bq/kibana:7.2.0 ports: - containerPort: 5601 protocol: TCP resources: requests: cpu: "50m" limits: cpu: "800m" volumeMounts: - name: kibana-config mountPath: /usr/share/kibana/config volumes: - name: kibana-config configMap: name: kibana-config tolerations: - key: node-role.kubernetes.io/master effect: NoSchedule---kind: ServiceapiVersion: v1metadata: labels: elastic-app: kibana name: kibana-service namespace: ns-elastic7spec: ports: - port: 5601 targetPort: 5601 selector: elastic-app: kibana type: NodePort---apiVersion: extensions/v1beta1kind: Ingressmetadata: labels: elastic-app: kibana name: kibana-ingress namespace: ns-elastic7spec: rules: - host: elk-kibana-dev.boqii.com http: paths: - backend: serviceName: kibana-service servicePort: 5601 4. logstashé…ç½® æœ¬åœ°æŒ‚è½½ k8s-logstash-7.2.0.yml 4.1 config/pipelines.yml 12- pipeline.id: main path.config: "/usr/share/logstash/config/pipeline/*.conf" 4.2 é¦–å…ˆé…ç½®grokè§„åˆ™ config/pipeline/logstash.conf 12345678910111213141516171819202122input &#123; udp &#123; port =&gt; "10000" &#125; &#125; filter &#123; grok &#123; match =&gt; &#123; "message" =&gt; "\&#123;\"id\":\"(?&lt;id&gt;(.)*)\",\"tag\":\"(?&lt;tag&gt;(.)*)\",\"title\":\"%&#123;GREEDYDATA:title&#125;(?&lt;title&gt;(.|\r|\n)*)\",\"value\":\"%&#123;GREEDYDATA:value&#125;(?&lt;value&gt;(.|\r|\n)*)\",\"createdAt\":\"(?&lt;createdAt&gt;\S+ \S+)\",\"Telephone\":\"(?&lt;Telephone&gt;(.)*)\",\"uid\":\"(?&lt;uid&gt;(.)*)\",\"updateTime\":\"(?&lt;updateTime&gt;(.)*)\",\"appVersion\":\"(?&lt;appVersion&gt;(.)*)\",\"mobileModel\":\"(?&lt;mobileModel&gt;(.)*)\",\"osVersion\":\"(?&lt;osVersion&gt;(.)*)\",\"channel\":\"(?&lt;channel&gt;(.)*)\",\"UDID\":\"(?&lt;UDID&gt;(.)*)\"\&#125;" &#125; &#125; &#125;output &#123; elasticsearch &#123; hosts =&gt; [ "http://elasticsearch-service:9200" ] index =&gt; "k8s2-dev-%&#123;+YYYY.MM.dd&#125;" &#125; &#125; 4.3 é…ç½®æ–‡ä»¶ k8s-logstash-7.2.0.yml 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455---kind: DeploymentapiVersion: apps/v1beta2metadata: labels: elastic-app: logstash name: logstash namespace: ns-elasticspec: replicas: 1 revisionHistoryLimit: 10 selector: matchLabels: elastic-app: logstash template: metadata: labels: elastic-app: logstash spec: containers: - name: logstash image: hub.boqii.com/bq/logstash:7.2.0 ports: - containerPort: 10000 protocol: UDP volumeMounts: - name: logstash-config mountPath: /usr/share/logstash/config volumes: - name: logstash-config hostPath: path: /data/k8s-pod/elk-7.2.0/logstash-7.2.0/config tolerations: - key: node-role.kubernetes.io/master effect: NoSchedule---kind: ServiceapiVersion: v1metadata: labels: elastic-app: logstash name: logstash-service namespace: ns-elasticspec: type: NodePort ports: - port: 10000 targetPort: 10000 nodePort: 10000 protocol: UDP selector: elastic-app: logstash type: NodePort---]]></content>
      <categories>
        <category>æŠ€æœ¯æ–‡æ¡£</category>
        <category>k8s</category>
        <category>elk</category>
        <category>elk7</category>
        <category>elasticsearch7</category>
      </categories>
      <tags>
        <tag>k8s</tag>
        <tag>elk</tag>
        <tag>elk7</tag>
        <tag>elasticsearch7</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[é¦–æ¬¡æ­å»ºhexoåšå®¢ç³»ç»Ÿ]]></title>
    <url>%2F2019%2F09%2F19%2F%E9%A6%96%E6%AC%A1%E6%90%AD%E5%BB%BAhexo%E5%8D%9A%E5%AE%A2%E7%B3%BB%E7%BB%9F%2F</url>
    <content type="text"><![CDATA[1 å®‰è£…hexo 1.1 åœ¨macä¸Šå®‰è£… 12# å®‰è£…nodebrew install node npm 1.2 åœ¨linuxå®‰è£… 123# å®‰è£…node10curl -sL https://rpm.nodesource.com/setup_10.x | bash -yum install -y nodejs 1.3 å®‰è£…hexo 12# å®‰è£…hexonpm install -g hexo 2 åˆå§‹åŒ–123456789101112cd /data/github/# åˆå§‹åŒ–hexo init blog# æ¡†æ¶å®‰è£…npm install#å®‰è£… Hexo å…³äºå¯åŠ¨æœåŠ¡å™¨çš„æ’ä»¶npm install hexo-server --save# å¯åŠ¨æœåŠ¡å™¨, æœ¬åœ°æŸ¥çœ‹æ•ˆæœ, å¦‚æœä¸æŒ‡å®šç«¯å£ï¼Œé»˜è®¤ä¸º4000hexo server 3 ä¸»é¢˜å’Œé…ç½® ä¸‹è½½ä¸»é¢˜ï¼šhttps://github.com/theme-next/hexo-theme-next 12unzip hexo-theme-next-master.zipmv hexo-theme-next-master $blog/themes/ ä¿®æ”¹ä¸»é¢˜é…ç½® _config.yml ä¸­çš„å…¶ä»–å±æ€§ 12345title: Zhangzhiwei's Blog...theme: hexo-theme-next...scheme: Mist 4. ç¼–å†™æ›´æ–°åšå®¢ åˆ›å»ºåšå®¢ 1hexo new 'ç¬¬ä¸€ä¸ªåšå®¢' cat source/_posts/ç¬¬ä¸€ä¸ªåšå®¢.md 123456title: ç¬¬ä¸€ä¸ªåšå®¢date: 2019-09-19 16:58:01tags: - hexocategories: - hexoå­¦ä¹  github åˆ›å»ºä¸€ä¸ªRepositoryä»“åº“ 1231. ä»“åº“åå­—å¿…é¡»æ˜¯ xxx.github.io2. åœ¨settingsä¸­ å‹¾é€‰Template repository3. è®°å¾—æ·»åŠ è‡ªå·±çš„ssh githubé…ç½® 12 # å®‰è£… hexo å…³äº git çš„ç»„ä»¶npm install hexo-deployer-git --save åœ¨_config.yml ä¸­ä¸º git æ·»åŠ é…ç½® 1234deploy: type: git repository: git@github.com:*/*.github.io.git branch: master æŸ¥çœ‹æ˜¯å¦èƒ½æäº¤ä»£ç github 1ssh -T -ai ~/.ssh/id_rsa git@github.com éƒ¨ç½² 1234hexo ghexo dæˆ–è€…hexo d -g 5. next6è®©é¦–é¡µæ–‡å­—é¢„è§ˆæ˜¾ç¤º 5.1 æ–¹æ³•ä¸€: è‡ªåŠ¨å½¢æˆæ‘˜è¦,é»˜è®¤æˆªå–çš„é•¿åº¦ä¸º 150 å­—ç¬¦ 1231. æ‰¾åˆ°ä¸»é¢˜çš„é…ç½®æ–‡ä»¶(themes/next/_config.yml)2. ä¿®æ”¹auto_excerpt,æŠŠenableæ”¹ä¸ºå¯¹åº”çš„falseæ”¹ä¸ºtrue3. hexo d -g 5.2 æ–¹æ³•äºŒ: åšå®¢å†…å®¹ä¸­æ·»åŠ  &lt; !â€“moreâ€“&gt; 123# å®‰è£…nodebrew install node npm &lt;!-- more --&gt; 5.3 æ–¹æ³•ä¸‰: åœ¨æ–‡ç« ä¸­çš„front-matterä¸­æ·»åŠ descriptionï¼Œå¹¶æä¾›æ–‡ç« æ‘˜å½•,è¿™ç§æ–¹å¼åªä¼šåœ¨é¦–é¡µåˆ—è¡¨ä¸­æ˜¾ç¤ºæ–‡ç« çš„æ‘˜è¦å†…å®¹ï¼Œè¿›å…¥æ–‡ç« è¯¦æƒ…åä¸ä¼šå†æ˜¾ç¤ºã€‚ 1234567891011title: éƒ¨ç½²elk7.2.0date: 2019-09-19 17:59:53copyright: truetags: - k8s - elk - elk7categories: - æŠ€æœ¯æ–‡æ¡£ - elkdescription: æœ¬æ–‡ä¸»è¦æ˜¯ç®€å•å•æœºç‰ˆéƒ¨ç½²elk7ä½“éªŒ, å¹¶éé«˜å¯ç”¨é›†ç¾¤æ–¹å¼éƒ¨ç½², éƒ¨åˆ†å®‰è£…æ­¥éª¤çœç•¥. ä¸»è¦æ˜¯è®°å½•ymlé…ç½®æ–‡ä»¶, ä»…ä¾›å‚è€ƒ. è¯¦ç»†å†…å®¹è¯·ç‚¹å‡»ä¸‹æ–¹é˜…è¯»å…¨æ–‡, éå¸¸æ„Ÿè°¢! 6. next6æ·»åŠ æœç´¢åŠŸèƒ½123456789101. npm install hexo-generator-searchdb --save2. å…¨å±€é…ç½®æ–‡ä»¶_config.ymlsearch: path: search.xml field: post format: html limit: 100003. ä¿®æ”¹ä¸»é¢˜çš„_config.ymllocal_search: enable: true 7. next6 Mistå­—ä½“çš„ é¦–é¡µæ–‡ç« é—´è·å’Œé¦–é¡µé¡µå®½,å­—ä½“ 7.1 é¦–é¡µæ–‡ç« é—´è· 12345å¢åŠ ä¸€äº›å†…å®¹: source/css/_schemes/Mist/_posts-expanded.styl.posts-expand .post &#123; margin-top: 30px; margin-bottom: 30px;&#125; 7.2 é¡µå®½ 1234source/css/_variables/base.styl$content-desktop = 900px$content-desktop-large = 1000px$content-desktop-largest = 1100px 7.3 å­—ä½“å¤§å° 1234567891011themes/next/source/css/_variables/base.styl$font-size-base = 0.95em;$font-size-base = unit(hexo-config('font.global.size'), em) if hexo-config('font.global.size') is a 'unit';$font-size-smallest = .75em;$font-size-smaller = .8125em;$font-size-small = .855em;$font-size-medium = 0.95em;$font-size-large = 0.975em;$font-size-larger = 1.em;$font-size-largest = 1.125em; 8. æ·»åŠ ç½‘æ ¼ 8.1 è‡ªå®šä¹‰æ–¹å¼ä¿®æ”¹ 1234567891011121314# æ–°åˆ›å»ºè‡ªå®šä¹‰æ–‡ä»¶cat themes/next/source/css/_custom/custom.styl// ä¸»é¡µæ–‡ç« æ·»åŠ é˜´å½±æ•ˆæœ.post &#123;margin-top: 60px;margin-bottom: 60px;padding: 25px;-webkit-box-shadow: 0 0 5px rgba(202, 203, 203, .5);-moz-box-shadow: 0 0 5px rgba(202, 203, 204, .5);&#125;# ä¿®æ”¹configæ–‡ä»¶vim ./themes/next/_config.ymlcustom: custom 8.2 next6ç‰ˆæœ¬ä¿®æ”¹æ–¹å¼ å‚è€ƒ: hexo6â€“nextç¾åŒ–æ•´ç† ä¿®æ”¹ themes/next/layout/_layout.swig 1234&#123;% if theme.canvas_nest %&#125;&lt;script type="text/javascript" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"&gt;&lt;/script&gt;&#123;% endif %&#125; å°†ä¸Šè¿°ä»£ç é˜²æ­¢åœ¨&lt; /body&gt; å‰å°±å¯ä»¥äº†(æ³¨æ„ä¸è¦æ”¾åœ¨&lt; /head&gt;çš„åé¢)ã€‚ ä¿®æ”¹ä¸»é¢˜çš„_config.yml 123456canvas_nest: true//color: çº¿æ¡é¢œè‰², é»˜è®¤: '0,0,0'ï¼›ä¸‰ä¸ªæ•°å­—åˆ†åˆ«ä¸º(R,G,B)//opacity: çº¿æ¡é€æ˜åº¦ï¼ˆ0~1ï¼‰, é»˜è®¤: 0.5//count: çº¿æ¡çš„æ€»æ•°é‡, é»˜è®¤: 150//zIndex: èƒŒæ™¯çš„z-indexå±æ€§ï¼Œcsså±æ€§ç”¨äºæ§åˆ¶æ‰€åœ¨å±‚çš„ä½ç½®, é»˜è®¤: -1 æ³¨æ„:æˆ‘è¿™é‡Œæ‰“å¼€æç¤ºç¼ºå°‘ canvas-nest.min.jsæ–‡ä»¶,è¿™é‡Œæ˜¯æ‰‹åŠ¨copyçš„ä¸€ä»½å†™åˆ° source/lib/canvas-nest/canvas-nest.min.js 1!function()&#123;function o(w,v,i)&#123;return w.getAttribute(v)||i&#125;function j(i)&#123;return document.getElementsByTagName(i)&#125;function l()&#123;var i=j("script"),w=i.length,v=i[w-1];return&#123;l:w,z:o(v,"zIndex",-1),o:o(v,"opacity",0.5),c:o(v,"color","0,0,0"),n:o(v,"count",99)&#125;&#125;function k()&#123;r=u.width=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,n=u.height=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight&#125;function b()&#123;e.clearRect(0,0,r,n);var w=[f].concat(t);var x,v,A,B,z,y;t.forEach(function(i)&#123;i.x+=i.xa,i.y+=i.ya,i.xa*=i.x&gt;r||i.x&lt;0?-1:1,i.ya*=i.y&gt;n||i.y&lt;0?-1:1,e.fillRect(i.x-0.5,i.y-0.5,1,1);for(v=0;v&lt;w.length;v++)&#123;x=w[v];if(i!==x&amp;&amp;null!==x.x&amp;&amp;null!==x.y)&#123;B=i.x-x.x,z=i.y-x.y,y=B*B+z*z;y&lt;x.max&amp;&amp;(x===f&amp;&amp;y&gt;=x.max/2&amp;&amp;(i.x-=0.03*B,i.y-=0.03*z),A=(x.max-y)/x.max,e.beginPath(),e.lineWidth=A/2,e.strokeStyle="rgba("+s.c+","+(A+0.2)+")",e.moveTo(i.x,i.y),e.lineTo(x.x,x.y),e.stroke())&#125;&#125;w.splice(w.indexOf(i),1)&#125;),m(b)&#125;var u=document.createElement("canvas"),s=l(),c="c_n"+s.l,e=u.getContext("2d"),r,n,m=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(i)&#123;window.setTimeout(i,1000/45)&#125;,a=Math.random,f=&#123;x:null,y:null,max:20000&#125;;u.id=c;u.style.cssText="position:fixed;top:0;left:0;z-index:"+s.z+";opacity:"+s.o;j("body")[0].appendChild(u);k(),window.onresize=k;window.onmousemove=function(i)&#123;i=i||window.event,f.x=i.clientX,f.y=i.clientY&#125;,window.onmouseout=function()&#123;f.x=null,f.y=null&#125;;for(var t=[],p=0;s.n&gt;p;p++)&#123;var h=a()*r,g=a()*n,q=2*a()-1,d=2*a()-1;t.push(&#123;x:h,y:g,xa:q,ya:d,max:6000&#125;)&#125;setTimeout(function()&#123;b()&#125;,100)&#125;();% zhangzw@MacBook-Pro î‚° /data/github/blog î‚° î‚  master â— î‚° 9. æ·»åŠ è¯„è®ºåŠŸèƒ½ 9.1 æ³¨å†Œleancloud 1æ³¨å†Œ-&gt; éªŒè¯é‚®ç®±-&gt; å®åè®¤è¯ -&gt; è®¾ç½®è·å–appidå’Œappkey 9.2 ä¿®æ”¹é…ç½®æ–‡ä»¶ 123456valine: enable: true appid: 'appid' appkey: 'appkey' placeholder: "ãƒ¾ï¾‰â‰§âˆ€â‰¦)o æ¥å‘€ï¼å¿«æ´»å‘€ï¼~å•¦å•¦å•¦~ å•¦å•¦å•¦å•¦~" visitor: true //è¿™ä¸ªæ‰“å¼€é¡µä¼šç»Ÿè®¡æ–‡ç« é˜…è¯»æ•° 10. next6æ·»åŠ å­—æ•°ç»Ÿè®¡ å’Œé˜…è¯»æ—¶é•¿ hexo-symbols-count-time 10.1 å®‰è£…nodeæ‰©å±• 1npm install hexo-symbols-count-time --save 10.2 ä¿®æ”¹å…¨å±€é…ç½® _config.yml 123456symbols_count_time: symbols: true time: true total_symbols: true total_time: true exclude_codeblock: false 10.3 ä¿®æ”¹ä¸»é¢˜é…ç½® _config.yml 1234567symbols_count_time: separated_meta: true item_text_post: true item_text_total: false awl: 4 wpm: 275 suffix: mins. 11. next6 æ–‡ç« ç½®é¡¶åŠŸèƒ½ 11.1 å®‰è£…nodeæ‰©å±• 12npm uninstall hexo-generator-index --savenpm install hexo-generator-index-pin-top --save 11.2 åœ¨æ–‡ç« å¼€å¤´æ·»åŠ ç½®é¡¶æ ‡è¯† 1top: 10 11.3 é¦–é¡µæ·»åŠ æ˜æ˜¾ç½®é¡¶æ ‡è¯† 123456themes/next/layout/_macro/post.swig åœ¨&lt;div class="post-meta"&gt; ä¸‹æ·»åŠ å¦‚ä¸‹ä»£ç &#123;% if post.top %&#125; &lt;i class="fa fa-thumb-tack"&gt;&lt;/i&gt; &lt;font color=green&gt;ç½®é¡¶&lt;/font&gt; &lt;span class="post-meta-divider"&gt;|&lt;/span&gt;&#123;% endif %&#125; 12. next6 å¼€å¯æ ‡ç­¾å’Œåˆ†ç±» 12.1 åˆ›å»ºtagsç›¸å…³ç›®å½• 12hexo new page tagshexo new page categories 12.2 å¼€å¯tagsæ ‡ç­¾å’Œåˆ†ç±» 123vim themes/next/_config.ymltags: /tags/ || tagscategories: /categories/ || th 12.3 ä¿®æ”¹tagsç«™ç‚¹æ–‡ä»¶ 12345678cat source/tags/index.md---title: tagsdate: 2019-09-24 10:08:59type: "tags"layout: "tags"comments: false--- 12.4 ä¿®æ”¹categoriesç«™ç‚¹æ–‡ä»¶ 12345678cat source/categories/index.md---title: categoriesdate: 2019-09-24 10:09:55type: "categories"layout: "categories"comments: false--- 12.5 å»æ‰xxx.github.io/tags/ é¡µé¢çš„post-title(å› ä¸ºæˆ‘çš„è¿™ä¸ªcsså·¦å¯¹é½äº†,é»˜è®¤æ˜¯å±…ä¸­,æ‰€ä»¥å¾ˆä¸‘) 123# æ³¨é‡Šä¸‹é¢è¿™æ®µä»£ç vim themes/nextv/layout/page.swig &lt;!-- &#123;% include '_partials/page/page-header.swig' %&#125; --&gt; 12.6 æ–‡ç« ä¸­å¤šä¸ªtagå’Œcategories 123456tags: - k8s - k8så®‰è£…categories: - [k8s,å®‰è£…] - [æŠ€æœ¯æ–‡æ¡£]]]></content>
      <categories>
        <category>æœ‰è¶£</category>
        <category>åšå®¢</category>
        <category>ç¾åŒ–</category>
      </categories>
      <tags>
        <tag>hexo6</tag>
        <tag>hexoç¾åŒ–</tag>
      </tags>
  </entry>
</search>
